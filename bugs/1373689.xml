<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1373689</bug_id>

    <creation_ts>2016-09-06 20:35:00 -0400</creation_ts>
    <short_desc>PPTP broken after kernel update</short_desc>
    <delta_ts>2016-12-03 05:56:46 -0500</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>pptp</component>
    <version>24</version>
    <rep_platform>i686</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <see_also>https://bugzilla.kernel.org/show_bug.cgi?id=152101</see_also>

    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1369489</see_also>

    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1375006</see_also>
    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="D. E. Evans">sinuhe</reporter>
    <assigned_to name="Jaroslav Å karvada">jskarvad</assigned_to>
    <cc>iliverez</cc>

    <cc>jbonatakis</cc>

    <cc>jskarvad</cc>

    <cc>msekleta</cc>

    <cc>nmilosevnm</cc>

    <cc>rhbz2</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>pptp-1.8.0-9.fc24 pptp-1.8.0-9.fc25</cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-11-30 00:28:31</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9684554</commentid>
<comment_count>0</comment_count>
<who name="D. E. Evans">sinuhe</who>
<bug_when>2016-09-06 20:35:58 -0400</bug_when>
<thetext>Description of problem: VPN connection over PPTP broken after kernel update to 4.7.2 from 4.6.7. Booting back to 4.6.7 kernel works as work around. nf_conntrack_pptp and nf_nat_pptp are running in both cases after boot. This is command-line
only environment. NetworkManager is running. NetworkManager-pptp package is not installed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9695162</commentid>
<comment_count>1</comment_count>
<who name="D. E. Evans">sinuhe</who>
<bug_when>2016-09-09 14:32:37 -0400</bug_when>
<thetext>It seems my x86_64 Fedora laptop has the same problem, connecting as a client, (instead of connecting through the iptables configuration of the other system from either Windows or Fedora). Booting back to the 4.6.7 kernel fixes it, too. PPTP
and 4.7.2 are not getting a long.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9696551</commentid>
<comment_count>2</comment_count>
<who name="Yiannis Liverezas">iliverez</who>
<bug_when>2016-09-11 02:44:25 -0400</bug_when>
<thetext>I confirm the pptp connection problem on x86_64 with 4.7.2 kernel. Trying to connect with pptp through NetworkManager fails after upgrade to 4.7.2. NetworkManager-pptp-gnome is installed. Going back to 4.6.6 works.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9718091</commentid>
<comment_count>3</comment_count>
<who name="Yiannis Liverezas">iliverez</who>
<bug_when>2016-09-17 14:04:42 -0400</bug_when>
<thetext>Problem continues to exist with kernel 4.7.3 (x86_64).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9748484</commentid>
<comment_count>4</comment_count>
<who name="jiannis">jbonatakis</who>
<bug_when>2016-09-27 18:27:14 -0400</bug_when>
<thetext>i have the same problem with 3.7.x kernels journalctl shows Sep 27 23:22:21 chaos.net NetworkManager[1314]: &lt;info&gt; [1475014941.5848] vpn-connection[0x55ed74e361d0,9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;,0]: Started the
VPN service, PID 2732 Sep 27 23:22:21 chaos.net NetworkManager[1314]: &lt;info&gt; [1475014941.5933] vpn-connection[0x55ed74e361d0,9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;,0]: Saw the service appear; activating connection Sep 27
23:22:25 chaos.net audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=systemd-hostnamed comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=?
res=success&apos; Sep 27 23:22:27 chaos.net audit[1]: SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=systemd-localed comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=?
addr=? terminal=? res=success&apos; Sep 27 23:22:31 chaos.net NetworkManager[1314]: &lt;info&gt; [1475014951.5814] keyfile: update /etc/NetworkManager/system-connections/Vaber (9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;) Sep 27 23:22:31
chaos.net NetworkManager[1314]: &lt;info&gt; [1475014951.5930] vpn-connection[0x55ed74e361d0,9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;,0]: VPN connection: (ConnectInteractive) reply received Sep 27 23:22:33 chaos.net
NetworkManager[1314]: ** Message: pppd started with pid 2758 Sep 27 23:22:33 chaos.net NetworkManager[1314]: &lt;info&gt; [1475014953.6962] vpn-connection[0x55ed74e361d0,9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;,0]: VPN plugin: state
changed: starting (3) Sep 27 23:22:33 chaos.net pppd[2758]: Plugin /usr/lib64/pppd/2.4.7/nm-pptp-pppd-plugin.so loaded. Sep 27 23:22:33 chaos.net NetworkManager[1314]: Plugin /usr/lib64/pppd/2.4.7/nm-pptp-pppd-plugin.so loaded. Sep 27 23:22:33
chaos.net NetworkManager[1314]: ** Message: nm-pptp-ppp-plugin: (plugin_init): initializing Sep 27 23:22:33 chaos.net realmd[1940]: quitting realmd service after timeout Sep 27 23:22:33 chaos.net realmd[1940]: stopping service Sep 27 23:22:34
chaos.net kernel: PPP generic driver version 2.4.2 Sep 27 23:22:34 chaos.net pppd[2758]: pppd 2.4.7 started by root, uid 0 Sep 27 23:22:34 chaos.net NetworkManager[1314]: ** Message: nm-pptp-ppp-plugin: (nm_phasechange): status 3 / phase &apos;serial
connection&apos; Sep 27 23:22:35 chaos.net pptp[2766]: nm-pptp-service-2732 log[main:pptp.c:333]: The synchronous pptp option is NOT activated Sep 27 23:22:35 chaos.net pppd[2758]: Using interface ppp0 Sep 27 23:22:35 chaos.net NetworkManager[1314]:
Using interface ppp0 Sep 27 23:22:35 chaos.net NetworkManager[1314]: Connect: ppp0 &lt;--&gt; /dev/pts/1 Sep 27 23:22:35 chaos.net NetworkManager[1314]: ** Message: nm-pptp-ppp-plugin: (nm_phasechange): status 5 / phase &apos;establish&apos; Sep 27
23:22:35 chaos.net pppd[2758]: Connect: ppp0 &lt;--&gt; /dev/pts/1 Sep 27 23:22:35 chaos.net NetworkManager[1314]: &lt;info&gt; [1475014955.8752] manager: (ppp0): new Generic device (/org/freedesktop/NetworkManager/Devices/6) Sep 27 23:22:35
chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_rep:pptp_ctrl.c:258]: Sent control packet type is 1 &apos;Start-Control-Connection-Request&apos; Sep 27 23:22:35 chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_disp:pptp_ctrl.c:758]: Received
Start Control Connection Reply Sep 27 23:22:35 chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_disp:pptp_ctrl.c:792]: Client connection established. Sep 27 23:22:36 chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_rep:pptp_ctrl.c:258]: Sent
control packet type is 7 &apos;Outgoing-Call-Request&apos; Sep 27 23:22:36 chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_disp:pptp_ctrl.c:877]: Received Outgoing Call Reply. Sep 27 23:22:36 chaos.net pptp[2778]: nm-pptp-service-2732
log[ctrlp_disp:pptp_ctrl.c:916]: Outgoing call established (call ID 0, peer&apos;s call ID 59005). Sep 27 23:23:06 chaos.net pppd[2758]: LCP: timeout sending Config-Requests Sep 27 23:23:06 chaos.net pppd[2758]: Connection terminated. Sep 27 23:23:06
chaos.net NetworkManager[1314]: LCP: timeout sending Config-Requests Sep 27 23:23:06 chaos.net NetworkManager[1314]: ** Message: nm-pptp-ppp-plugin: (nm_phasechange): status 11 / phase &apos;disconnect&apos; Sep 27 23:23:06 chaos.net
NetworkManager[1314]: Connection terminated. Sep 27 23:23:06 chaos.net NetworkManager[1314]: ** Message: Terminated ppp daemon with PID 2758. Sep 27 23:23:06 chaos.net NetworkManager[1314]: &lt;error&gt; [1475014986.9075] platform-linux:
do-change-link[7]: failure changing link: failure 19 (No such device) Sep 27 23:23:06 chaos.net NetworkManager[1314]: &lt;warn&gt; [1475014986.9076] device (ppp0): failed to disable userspace IPv6LL address handling Sep 27 23:23:06 chaos.net
pppd[2758]: Terminating on signal 15 Sep 27 23:23:06 chaos.net org.gnome.Shell.desktop[1593]: Gjs-Message: JS LOG: Removing a network device that was not added Sep 27 23:23:06 chaos.net NetworkManager[1314]: ** Message: nm-pptp-ppp-plugin:
(nm_phasechange): status 1 / phase &apos;dead&apos; Sep 27 23:23:06 chaos.net NetworkManager[1314]: Terminating on signal 15 Sep 27 23:23:06 chaos.net NetworkManager[1314]: Modem hangup Sep 27 23:23:06 chaos.net NetworkManager[1314]: ** Message:
nm-pptp-ppp-plugin: (nm_exit_notify): cleaning up Sep 27 23:23:06 chaos.net org.gnome.Shell.desktop[2172]: Gjs-Message: JS LOG: Removing a network device that was not added Sep 27 23:23:06 chaos.net NetworkManager[1314]: &lt;info&gt;
[1475014986.9124] vpn-connection[0x55ed74e361d0,9f6b2596-11f1-419d-a84c-9c4d78e1504f,&quot;Vaber&quot;,0]: VPN service disappeared Sep 27 23:23:06 chaos.net pppd[2758]: Modem hangup Sep 27 23:23:06 chaos.net pppd[2758]: Exit. Sep 27 23:23:06
chaos.net pptp[2778]: nm-pptp-service-2732 log[callmgr_main:pptp_callmgr.c:245]: Closing connection (unhandled) Sep 27 23:23:06 chaos.net pptp[2778]: nm-pptp-service-2732 log[ctrlp_rep:pptp_ctrl.c:258]: Sent control packet type is 12
&apos;Call-Clear-Request&apos; Sep 27 23:23:06 chaos.net pptp[2778]: nm-pptp-service-2732 log[call_callback:pptp_callmgr.c:84]: Closing connection (call state) works perfect with kernel-4.6.5-300.fc24.x86_64</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9752742</commentid>
<comment_count>5</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-09-29 04:38:03 -0400</bug_when>
<thetext>Hmm, it seems it&apos;s working for me (cmdline without NetworkManager, kernel-4.7.4). But maybe your problem is related to the: https://bugzilla.kernel.org/show_bug.cgi?id=152101 Please try: # sysctl net.netfilter.nf_conntrack_helper=1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9752767</commentid>
<comment_count>6</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-09-29 04:44:22 -0400</bug_when>
<thetext>And probably other dupes: bug 1369489, bug 1375006.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9755233</commentid>
<comment_count>7</comment_count>
<who name="Yiannis Liverezas">iliverez</who>
<bug_when>2016-09-29 16:28:39 -0400</bug_when>
<thetext>Confirmed, this solves the problem (kernel 4.7.4-200).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9756588</commentid>
<comment_count>8</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-09-30 05:50:50 -0400</bug_when>
<thetext>(In reply to Yiannis Liverezas from comment #7) &gt; Confirmed, this solves the problem (kernel 4.7.4-200). Thanks for info. I think there is nothing to fix in pptp, the firewall needs to be correctly setup. But we could add note to the
README or somewhere.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9758611</commentid>
<comment_count>9</comment_count>
<who name="D. E. Evans">sinuhe</who>
<bug_when>2016-09-30 17:59:22 -0400</bug_when>
<thetext>&gt; Please try: &gt; # sysctl net.netfilter.nf_conntrack_helper=1 Under 4.6.7, this is the default. When I reboot into a 4.7 kernel, it is set to 0. Setting it back to 1 solves the problem for me. Thank you!</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9760344</commentid>
<comment_count>10</comment_count>
<who name="Yiannis Liverezas">iliverez</who>
<bug_when>2016-10-03 03:49:02 -0400</bug_when>
<thetext>(In reply to Jaroslav Å karvada from comment #8) &gt; (In reply to Yiannis Liverezas from comment #7) &gt; &gt; Confirmed, this solves the problem (kernel 4.7.4-200). &gt; Please see my comments inline &gt; Thanks for info. &gt; &gt; I think
there is nothing to fix in pptp, So it seems. Nothing to do here. &gt; the firewall needs to be correctly &gt; setup. But we could add note to the README or somewhere. Which README? At first glance, I don&apos;t think pptp&apos;s README is the
appropriate place. The firewall configuration documentation maybe is more suitable. I don&apos;t know what this setting affects exactly (other services, security issues etc), but if there is a good reason for the default to be changed to 0, then for
desktop users, a workaround/different setting should be handled under the hood by NetworkManager or whatever appropriate component. Trying to see this from a simple desktop user&apos;s perspective, all that is required is to setup the connection in
network manager (settings) and expect things to work. Btw, better late than never, thank you for providing the solution to the problem. Just my .02</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9760536</commentid>
<comment_count>11</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-10-03 05:25:14 -0400</bug_when>
<thetext>(In reply to Yiannis Liverezas from comment #10) &gt; I don&apos;t know what this setting affects exactly (other services, security &gt; issues etc), but if there is a good reason for the default to be changed to &gt; 0, then for desktop
users, a workaround/different setting should be handled &gt; under the hood by NetworkManager or whatever appropriate component. Trying &gt; to see this from a simple desktop user&apos;s perspective, all that is required &gt; is to setup the
connection in network manager (settings) and expect things &gt; to work. &gt; Yes, AFAIK the upstream configuration change is to improve security and the related information has bee around for a long time. In the short the connection tracking helpers
could be exploited to bypass firewalls, so it&apos;s much better if the admin enables only those she/he really needs. Unfortunately this change broke many things, there is Fedora kernel bug 1369489 asking for the downstream revert. But personally I
think that better solution is to fix/workaround the problem in the affected components. Regarding NetworkManager there is bug 1375006.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9905966</commentid>
<comment_count>12</comment_count>
<who name="Nemanja Milosevic">nmilosevnm</who>
<bug_when>2016-11-19 17:12:10 -0500</bug_when>
<thetext>Can reproduce this on F24 (4.8.4-200.fc24.x86_64) After applying sudo sysctl net.netfilter.nf_conntrack_helper=1 connection works fine. Is this intended? Kind regards, Nemanja</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9908462</commentid>
<comment_count>13</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-11-21 08:58:05 -0500</bug_when>
<thetext>It&apos;s due to upstream kernel change not to automatically attach conntrack helpers. Conntrack helpers could be abused for e.g. firewall bypass, by disabling their autoloading, user is responsible to manually load only what she/he needs -
this can improve security. I think we can do what we have already have done in pptpd - explictly load nf_conntrack_pptp module.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9908714</commentid>
<comment_count>14</comment_count>
<who name="Nemanja Milosevic">nmilosevnm</who>
<bug_when>2016-11-21 09:53:04 -0500</bug_when>
<thetext>Just wanted to check. I will try loading the module and see if it works that way, but the provided workaround is also ok. Thank you for the quick reply. Kind regards, Nemanja</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9909188</commentid>
<comment_count>15</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-11-21 11:53:19 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-500dfc46f1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9909192</commentid>
<comment_count>16</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-11-21 11:55:58 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-bdea79a0fb</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9917613</commentid>
<comment_count>17</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-11-23 15:31:49 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-bdea79a0fb</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9917870</commentid>
<comment_count>18</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-11-23 18:06:41 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-500dfc46f1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9941425</commentid>
<comment_count>19</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-11-30 00:28:31 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9947120</commentid>
<comment_count>20</comment_count>
<who name="Christian Stadelmann">rhbz2</who>
<bug_when>2016-12-01 07:30:24 -0500</bug_when>
<thetext>This update caused a regression. See bug #1400041 for details.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9951617</commentid>
<comment_count>21</comment_count>
<who name="Jaroslav Å karvada">jskarvad</who>
<bug_when>2016-12-02 10:14:38 -0500</bug_when>
<thetext>Reverting this patch because it&apos;s against upstream opinion. Reply from upstream: nf_conntrack_pptp is not needed by pptp. nf_conntrack_pptp is for systems that route pptp. nf_conntrack_pptp has a side-effect of ICMP unreachable
suppression. Some people try nf_conntrack_pptp to fix interoperability problems between systems; yet they are not routing pptp. It hides the problem, and doesn&apos;t fix it. It works by side-effect. Once a problem is identified, we can design a
better solution. I&apos;ve not seen a good description of the problem, but if it has to do with zero call id, we have a new patch in 1.9.0 which may also fix the problem. Can you please work with people who use nf_conntrack_pptp to find out what the
problem is, instead of accepting a side-effect solution?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9953192</commentid>
<comment_count>22</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-03 05:56:46 -0500</bug_when>
<thetext>pptp-1.8.0-9.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

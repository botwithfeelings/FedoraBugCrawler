<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1227001</bug_id>

    <creation_ts>2015-06-01 11:58:00 -0400</creation_ts>
    <short_desc>Using DNF to with --installroot fails where yum works</short_desc>
    <delta_ts>2016-10-04 15:14:23 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>dnf</component>
    <version>24</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>RAWHIDE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened, Triaged</keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>
    <dependson>1163028</dependson>

    <everconfirmed>1</everconfirmed>
    <reporter name="Sam Tygier">samtygier</reporter>
    <assigned_to name="Jaroslav Mracek">jmracek</assigned_to>
    <cc>aliakc</cc>

    <cc>ignatenko</cc>

    <cc>jmracek</cc>

    <cc>jsilhan</cc>

    <cc>jzeleny</cc>

    <cc>mluscon</cc>

    <cc>mmraka</cc>

    <cc>packaging-team-maint</cc>

    <cc>phil.regier</cc>

    <cc>pnemade</cc>

    <cc>rbu</cc>

    <cc>tla</cc>

    <cc>vmukhame</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-07-21 11:04:48</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>8293481</commentid>
<comment_count>0</comment_count>
<who name="Sam Tygier">samtygier</who>
<bug_when>2015-06-01 11:58:26 -0400</bug_when>
<thetext>Description of problem: I am trying to install a Scientific Linux chroot within a Fedora 22 host. Instructions do not work with dnf, but do with yum-deprecated. Version-Release number of selected component (if applicable): Host Fedora 22,
guest Scientific Linux 6.6 Steps to Reproduce: Setup: mkdir -p /data/vm/chroot/sl6/var/lib/rpm rpm --root /data/vm/chroot/sl6 --initdb cd /data/vm/chroot wget http://linuxsoft.cern.ch/scientific/6.6/x86_64/os/Packages/sl-release-6.6-1.x86_64.rpm sudo
rpm -ivh --nodeps --root /data/vm/chroot/sl6 sl-release-6.6-1.x86_64.rpm At this stage instructions say I should do: sudo yum --nogpg --installroot /data/vm/chroot/sl6 install yum If I replace this with: sudo dnf --nogpg --installroot
/data/vm/chroot/sl6 install yum I get: Error: Failed to synchronize cache for repo &apos;fedora&apos; from &apos;https://mirrors.fedoraproject.org/metalink?repo=fedora-6.6&amp;arch=x86_64&apos;: Cannot prepare internal mirrorlist: file
&quot;repomd.xml&quot; was not found in metalink If I run: sudo yum-deprecated --nogpg--installroot /data/vm/chroot/sl6 install yum then the install works</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8476848</commentid>
<comment_count>1</comment_count>
<who name="Radek Holy">rholy</who>
<bug_when>2015-07-24 05:41:21 -0400</bug_when>
<thetext>Thanks for the report. We&apos;ll take a look.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8477251</commentid>
<comment_count>2</comment_count>
<who name="Radek Holy">rholy</who>
<bug_when>2015-07-24 08:08:57 -0400</bug_when>
<thetext>*** Bug 1229442 has been marked as a duplicate of this bug. ***</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8558293</commentid>
<comment_count>3</comment_count>
<who name="Phil Regier">phil.regier</who>
<bug_when>2015-08-20 03:00:09 -0400</bug_when>
<thetext>I don&apos;t *think* this is quite the same bug, exactly, but I get a very similar message trying to install a Fedora 22 root: [root@localhost ~]# dnf --installroot=/lxcroot install vpnc Error: Failed to synchronize cache for repo
&apos;fedora&apos; from &apos;https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&amp;arch=x86_64&apos;: Cannot prepare internal mirrorlist: file &quot;repomd.xml&quot; was not found in metalink I get much better results if I give
&quot;--releasever=&quot; explicitly: [root@localhost ~]# dnf --installroot=/lxcroot --releasever=22 install vpnc Fedora 22 - x86_64 758 kB/s | 41 MB 00:55 ... So it looks like the host mirrorlist is being used with the guest&apos;s releasever
variable. If this is correct behavior, then would the problem be with the SL instructions? Either way, a careful selection of repos and --setopt arguments would enable a variety of workarounds for those currently getting this error from similar
operations; unfortunately, I can&apos;t quite seem to figure out where the variable is coming from (one successful install appears to fix the problem so that --releasever is no longer necessary).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8558921</commentid>
<comment_count>4</comment_count>
<who name="Radek Holy">rholy</who>
<bug_when>2015-08-20 06:21:00 -0400</bug_when>
<thetext>You&apos;ve described the problem very well. *So far*, DNF takes the repositories from the host while the release version is taken from the guest [1]. You two demonstrate how it can be useful for one and annoying for another one. If you are
preparing a chroot with the same system as the host, you probably like the fact that you don&apos;t need to manually configure the repositories in the chroot in advance (or run a &quot;rpm -ivh --root /path foo-release.rpm&quot;). On the other hand,
if you are preparing a chroot with a different system, you don&apos;t want the host&apos;s repositories to be used there. YUM does some guessing based on what is already present in the chroot (YUM&apos;s configs etc.). It seems that DNF inherited
just part of this behaviour. We are currently considering what would be the best (let&apos;s discuss it in the bug 1163028 if necessary). Phil, IMO, what you see is what YUM does as well. I cannot guarantee you that DNF will behave the same in the
future but anyway, what was your expectation? [1] FYI, the release version is derived from special packages providing this information. Once you install something, such package is always pulled in as a dependency. That&apos;s why you don&apos;t need
to set --releasever then. In case of SL, it&apos;s the sl-release package, for example. But let&apos;s don&apos;t remember this undocumented fact.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8634018</commentid>
<comment_count>5</comment_count>
<who name="Phil Regier">phil.regier</who>
<bug_when>2015-09-14 15:55:07 -0400</bug_when>
<thetext>D&apos;oh! Somehow I didn&apos;t get the CC; otherwise I would have noticed and acknowledged earlier that your explanation was very helpful, Radek. I didn&apos;t expect any particular behavior, except that I expected the sort of rigorous,
documented consistency/predictability that I&apos;ve come to treasure in proper RPM/yum/dnf-based distributions (Red Hat, CentOS, and Fedora first and foremost). Whatever data are used to determine the actions that rpm/yum/dnf will take, it would be
nice if they were documented somewhere so that as related patterns continue to evolve, downstream documentation can evolve with it instead of bitrotting immediately. The point is of course not to manually tinker with the file in question, but to
inform better workflows. If this behavior may yet be evolving then as far as I&apos;m concerned your explanation here is sufficient interim documentation (Google brought me here, so hopefully others will find your explanations as helpful as I did)
until the long-term intentions are ironed out. Bug 1163028, as you pointed out, also has useful information though I don&apos;t think I have anything valuable to add there at this point. Thanks, Radek!</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8979349</commentid>
<comment_count>6</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2016-01-14 04:08:00 -0500</bug_when>
<thetext>This bug will be fixed by pullrequest: https://github.com/rpm-software-management/dnf/pull/428</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9184990</commentid>
<comment_count>7</comment_count>
<who name="Mike McCune">mmccune</who>
<bug_when>2016-03-28 19:16:15 -0400</bug_when>
<thetext>This bug was accidentally moved from POST to MODIFIED via an error in automation, please see mmccune@redhat.com with any questions</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9524603</commentid>
<comment_count>8</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2016-07-19 10:26:55 -0400</bug_when>
<thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is no longer maintained, which means that it will not receive any further security or bug fix updates. As a result we are closing this bug. If you can reproduce this bug
against a currently maintained version of Fedora please feel free to reopen this bug against that version. If you are unable to reopen this bug, please file a new report against the current release. If you experience problems, please add a comment to
this bug. Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9537386</commentid>
<comment_count>9</comment_count>
<who name="Igor Gnatenko">ignatenko</who>
<bug_when>2016-07-21 11:04:48 -0400</bug_when>
<thetext>Fixed in upcoming DNF 2.0.</thetext>
</long_desc>

</bug>

</bugzilla>

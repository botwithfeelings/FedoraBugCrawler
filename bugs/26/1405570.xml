<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1405570</bug_id>
          
          <creation_ts>2016-12-16 13:08:00 -0500</creation_ts>
          <short_desc>koji build for rawhide fails with &lt;class &apos;_rpm.error&apos;&gt;: error reading package header</short_desc>
          <delta_ts>2017-02-28 20:25:02 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>rpm</component>
          <version>26</version>
          <rep_platform>aarch64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc>https://koji.fedoraproject.org/koji/taskinfo?taskID=16905568</bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>245418</blocked>
    
    
    <blocked>1376324</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Mattias Ellert">mattias.ellert</reporter>
          <assigned_to name="Panu Matilainen">pmatilai</assigned_to>
          <cc>atigro</cc>
    
    
    <cc>dennis</cc>
    
    
    <cc>dominik</cc>
    
    
    <cc>ignatenko</cc>
    
    
    <cc>kardos.lubos</cc>
    
    
    <cc>mhroncok</cc>
    
    
    <cc>mikem</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pknirsch</cc>
    
    
    <cc>pmatilai</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>rpm-4.13.0-11.fc26 rpm-4.13.0.1-1.fc24 rpm-4.13.0.1-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-28 20:21:03</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9994380</commentid>
    <comment_count>0</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2016-12-16 13:08:31 -0500</bug_when>
    <thetext>Description of problem:

I have now tried to build an update for Fedora Rawhide several times during the last week, and it fails consistently.

Build:
https://koji.fedoraproject.org/koji/buildinfo?buildID=823483

Tasks for the three attempts:
https://koji.fedoraproject.org/koji/taskinfo?taskID=16787974
https://koji.fedoraproject.org/koji/taskinfo?taskID=16796570
https://koji.fedoraproject.org/koji/taskinfo?taskID=16800637
https://koji.fedoraproject.org/koji/taskinfo?taskID=16856402
https://koji.fedoraproject.org/koji/taskinfo?taskID=16905568

For each of the attempts, the sub tasks of the srpm creation and the package builds for each architecture succeeds. There is however no tagBuild subtask started. When pressing the &quot;Show results&quot; link for the main task the same - to me very cryptic error message - is displayed for all of the attempts:

&lt;class &apos;_rpm.error&apos;&gt;: error reading package header

The same build for Fedora 25, Fedora 24 and EPEL 7 has competed without problems:

https://koji.fedoraproject.org/koji/buildinfo?buildID=823482
https://koji.fedoraproject.org/koji/buildinfo?buildID=823485
https://koji.fedoraproject.org/koji/buildinfo?buildID=823484

So the problem is Rawhide specific, and I can not tell what the cause is from the information I see en koji.

Version-Release number of selected component (if applicable):
The version on the Fedora Build system.

How reproducible:
Five times so far.

Steps to Reproduce:
1. See above

Actual results:
&lt;class &apos;_rpm.error&apos;&gt;: error reading package header

Expected results:
Successful build</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9994607</commentid>
    <comment_count>1</comment_count>
    <who name="Mike McLean">mikem</who>
    <bug_when>2016-12-16 14:18:33 -0500</bug_when>
    <thetext>I doubt this is a koji bug.

Looks like broken deps in the buildroot

DEBUG util.py:426:  nothing provides libpoppler.so.65()(64bit) needed by texlive-xetex-bin-6:svn41091-24.20160520.fc26.1.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9994695</commentid>
    <comment_count>2</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2016-12-16 15:10:03 -0500</bug_when>
    <thetext>You are looking a recent resubmit by kevin that suffers from a newly introduced problem that is unrelated to the reported bug. Please follow the links to the failed tasks in the bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9995748</commentid>
    <comment_count>3</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2016-12-17 12:17:24 -0500</bug_when>
    <thetext>Texlive&apos;s broken deps due to the poppler soname bump was fixed by a rebuild.

Trying building again gives the same error as before:

https://koji.fedoraproject.org/koji/taskinfo?taskID=16921481

class &apos;_rpm.error&apos;&gt;: error reading package header</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9995862</commentid>
    <comment_count>4</comment_count>
    <who name="Mike McLean">mikem</who>
    <bug_when>2016-12-17 14:31:18 -0500</bug_when>
    <thetext>One of the rpms is bad and does not read

# rpm -Kv /mnt/koji//work/tasks/1483/16921483/root-debuginfo-6.08.02-1.fc26.aarch64.rpm
error: /mnt/koji//work/tasks/1483/16921483/root-debuginfo-6.08.02-1.fc26.aarch64.rpm: headerRead failed: hdr magic: BAD

This is the only rpm in the set that is bad. The does not appear to be truncated. It&apos;s over 600M, but the magic is wrong.

Digging into the file, it appears that the rpm header is placed incorrectly.

The signature header is in the correct place (offset 96), and appears to have a length of 4296. However the rpm header appears to start (judging by the magic) at offset 4400.

If this is happening consistently, that suggests that something is wrong with rpm on aarch64 in the buildroot.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9995863</commentid>
    <comment_count>5</comment_count>
    <who name="Mike McLean">mikem</who>
    <bug_when>2016-12-17 14:32:08 -0500</bug_when>
    <thetext>Here&apos;s the bad rpm:
https://kojipkgs.fedoraproject.org//work/tasks/1483/16921483/root-debuginfo-6.08.02-1.fc26.aarch64.rpm</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9995941</commentid>
    <comment_count>6</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2016-12-17 18:58:42 -0500</bug_when>
    <thetext>(In reply to Mike McLean from comment #4)
&gt; If this is happening consistently, that suggests that something is wrong
&gt; with rpm on aarch64 in the buildroot.

Thank you for your analysis. I reassign to rpm then.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9996158</commentid>
    <comment_count>7</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2016-12-18 04:28:27 -0500</bug_when>
    <thetext>Now that it was established that it is the debuginfo package for aarch64 that is causing the problems, it was easier to know where to look for errors.

In the build.log for the build on aarch64 I see this error message repeated a few times during the execution of /usr/lib/rpm/find-debuginfo.sh:

readelf: Error: the dynamic segment offset + size exceeds the size of the file

It seems that rpm-build is ignoring this error and just goes on, resulting in it creating a broken rpm. This error does not appear in the logs for the other architectures.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10034665</commentid>
    <comment_count>8</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2017-01-04 10:54:11 -0500</bug_when>
    <thetext>Right, this is actually not aarch64-specific at all but a generic rpmbuild regression originating from commit https://github.com/rpm-software-management/rpm/commit/68bddc353a7ea87ea00ad957858cd509e845e84c

The problem occurs when the estimated and actual payload size happen to be on different sides of UINT32_MAX which causes the signature header size tags to flip from 64bit to 32bit, causing the header to be off by eight bytes.

That this hasn&apos;t been seen on other architectures is just luck, but certainly arch-specific issues can make it more common (eg produced binaries being larger than on other arches)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10060157</commentid>
    <comment_count>9</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2017-01-13 04:11:04 -0500</bug_when>
    <thetext>Fixed upstream: https://github.com/rpm-software-management/rpm/commit/e51644e0ee2d33c02c06560f87ea6aecb9991673</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10088615</commentid>
    <comment_count>10</comment_count>
    <who name="Mattias Ellert">mattias.ellert</who>
    <bug_when>2017-01-23 08:23:43 -0500</bug_when>
    <thetext>Will there be a fix for this before the F26 mass rebuild (scheduled 2017-02-01)?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10088635</commentid>
    <comment_count>11</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2017-01-23 08:28:05 -0500</bug_when>
    <thetext>I&apos;ve been intending to put out rpm 4.13.1 including this among other things ASAP but it seems somehow elusive... and certainly that&apos;s not going to happen this week due to Devconf. So I better fix it for the mass rebuild separately, thanks for the heads-up!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10088756</commentid>
    <comment_count>12</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2017-01-23 09:06:10 -0500</bug_when>
    <thetext>Fixed in rawhide as of rpm-4.13.0-11.fc26.

As for other Fedora versions, the idea is to provide this and other fixes via upstream bugfix release.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10181642</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-24 08:36:45 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-beb25f1953</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10181734</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-24 08:59:38 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-54078f9dd2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10183336</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-24 19:53:33 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-54078f9dd2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10183366</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-24 20:52:29 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-beb25f1953</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10191758</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2017-02-28 05:48:35 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 26 development cycle.
Changing version to &apos;26&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10195660</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-28 20:21:03 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10195682</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-28 20:25:02 -0500</bug_when>
    <thetext>rpm-4.13.0.1-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1417753</bug_id>
          
          <creation_ts>2017-01-30 16:41:00 -0500</creation_ts>
          <short_desc>built-in memcmp() does not work on ppc64le</short_desc>
          <delta_ts>2017-03-02 03:57:16 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gcc</component>
          <version>26</version>
          <rep_platform>ppc64le</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Regression</keywords>
          <priority>high</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kamil Dudka">kdudka</reporter>
          <assigned_to name="Jakub Jelinek">jakub</assigned_to>
          <cc>davejohansen</cc>
    
    
    <cc>jakub</cc>
    
    
    <cc>jwakely</cc>
    
    
    <cc>kdudka</cc>
    
    
    <cc>law</cc>
    
    
    <cc>mpolacek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>gcc-7.0.1-0.4.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-01 15:42:29</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="GNU Compiler Collection">79170</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10107147</commentid>
    <comment_count>0</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2017-01-30 16:41:38 -0500</bug_when>
    <thetext>Description of problem:
The built-in implementation of memcmp() returns a wrong result on the ppc64le architecture.  Please have a look at the attached reproducer, which demonstrates how memcmp() returns a different result for the same input if compiled with -fno-builtin-memcmp.


Version-Release number of selected component (if applicable):
gcc-7.0.1-0.3.fc26.ppc64le


How reproducible:
Observed on Koji builders, then reconstructed in mock on a RHEL-7 machine.


Steps to Reproduce:
1. download the attached reproducer
2. run it as a shell script on a ppc64le machine


Additional info:
This bug breaks findutils, which uses memcmp() in a callback of qsort() and bsearch() to compare values of code pointers.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10107150</commentid>
    <comment_count>1</comment_count>
      <attachid>1246010</attachid>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2017-01-30 16:44:12 -0500</bug_when>
    <thetext>Created attachment 1246010
reproducer</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10107154</commentid>
    <comment_count>2</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2017-01-30 16:45:08 -0500</bug_when>
    <thetext>Perhaps http://gcc.gnu.org/PR79170 ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10107156</commentid>
    <comment_count>3</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2017-01-30 16:46:20 -0500</bug_when>
    <thetext>$ curl -JO &apos;https://bugzilla.redhat.com/attachment.cgi?id=1246010&apos;
$ sh bz1417753.c 
+ gcc -O2 bz1417753.c
+ ./a.out
memcmp(...) = -64
+ gcc -O2 -fno-builtin-memcmp bz1417753.c
+ ./a.out
memcmp(...) = 1
+ exit 0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10107177</commentid>
    <comment_count>4</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2017-01-30 16:54:22 -0500</bug_when>
    <thetext>I think -mblock-compare-inline-limit=0 should be a short-term workaround for that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10192090</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2017-02-28 06:08:33 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 26 development cycle.
Changing version to &apos;26&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10199038</commentid>
    <comment_count>6</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2017-03-01 15:42:29 -0500</bug_when>
    <thetext>Should be fixed in gcc-7.0.1-0.24.fc26 and later.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10200929</commentid>
    <comment_count>7</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2017-03-02 03:57:16 -0500</bug_when>
    <thetext>Thank you for fixing the bug!

(In reply to Jakub Jelinek from comment #6)
&gt; Should be fixed in gcc-7.0.1-0.24.fc26 and later.

Minor typo: should be gcc-7.0.1-0.4.fc26 and later.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1246010</attachid>
            <date>2017-01-30 16:44:00 -0500</date>
            <delta_ts>2017-01-30 16:44:12 -0500</delta_ts>
            <desc>reproducer</desc>
            <filename>bz1417753.c</filename>
            <type>text/plain</type>
            <size>406</size>
            <attacher name="Kamil Dudka">kdudka</attacher>
            
              <data encoding="base64">I2lmIDAKc2V0IC14CmdjYyAtTzIgJDAgJiYgLi9hLm91dApnY2MgLU8yIC1mbm8tYnVpbHRpbi1t
ZW1jbXAgJDAgJiYgLi9hLm91dApleGl0ICQ/CiNlbmRpZgoKI2luY2x1ZGUgPHN0ZGlvLmg+CiNp
bmNsdWRlIDxzdHJpbmcuaD4KCnR5cGVkZWYgdm9pZCAoKmZ1bmMpKHZvaWQpOwoKaW50IG1haW4o
KQp7CiAgICB1bmlvbiB7CiAgICAgICAgZnVuYyBwZm47CiAgICAgICAgY2hhciBtZW1bc2l6ZW9m
KGZ1bmMpXTsKICAgIH0gdTEsIHUyOwoKICAgIHUxLnBmbiA9IChmdW5jKTB4NTE4NDkzZjA7CiAg
ICB1Mi5wZm4gPSAoZnVuYykweDUxODQ5NDIwOwoKICAgIHByaW50ZigibWVtY21wKC4uLikgPSAl
aVxuIiwgbWVtY21wKHUxLm1lbSwgdTIubWVtLCBzaXplb2YodTEucGZuKSkpOwoKICAgIHJldHVy
biAwOwp9Cg==
</data>

          </attachment>
      

    </bug>

</bugzilla>
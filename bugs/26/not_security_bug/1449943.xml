<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1449943</bug_id>

    <creation_ts>2017-05-11 04:31:00 -0400</creation_ts>
    <short_desc>RHEL7.3 hvm guest was destroyed after triggered crash in it</short_desc>
    <delta_ts>2017-06-15 04:37:36 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>xen</component>
    <version>26</version>
    <rep_platform>x86_64</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>CURRENTRELEASE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>medium</priority>
    <bug_severity>medium</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Xiao, Liang">xiliang</reporter>
    <assigned_to name="Michael Young">m.a.young</assigned_to>
    <cc>m.a.young</cc>

    <cc>robinlee.sysu</cc>

    <cc>virt-maint</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-06-10 08:56:56</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>10403108</commentid>
<comment_count>0</comment_count>
<who name="Xiao, Liang">xiliang</who>
<bug_when>2017-05-11 04:31:29 -0400</bug_when>
<thetext>Description of problem: Created a RHEL7.3 hvm guest on Fedora26 xen4 host and enabled its kdump service. Ran &quot;echo c &gt;/proc/sysrq-trigger&quot; the panic and the guest was destroyed after reboot. Failed logs: [root@dhcp-1-208
rhel7.3]# xl list Name ID Mem VCPUs State Time(s) Domain-0 0 13978 8 r----- 3310.3 guest_7.3 8 1023 8 -b---- 58.0 [root@dhcp-1-208 rhel7.3]# xl console guest_7.3 Red Hat Enterprise Linux Server 7.3 (Maipo) Kernel 3.10.0-514.el7.x86_64 on an x86_64
dhcp-1-196 login: root Password: Last login: Tue May 9 15:12:47 on ttyS0 &apos;abrt-cli status&apos; timed out [root@dhcp-1-196 ~]# systemctl status kdump.service ‚óè kdump.service - Crash recovery kernel arming Loaded: loaded
(/usr/lib/systemd/system/kdump.service; enabled; vendor preset: enabled) Active: active (exited) since Tue 2017-05-09 21:02:56 CST; 28min ago Process: 1177 ExecStart=/usr/bin/kdumpctl start (code=exited, status=0/SUCCESS) Main PID: 1177 (code=exited,
status=0/SUCCESS) CGroup: /system.slice/kdump.service May 09 21:02:51 dhcp-1-196.nay.redhat.com systemd[1]: Starting Crash recovery... May 09 21:02:56 dhcp-1-196.nay.redhat.com kdumpctl[1177]: kexec: loaded kdump... May 09 21:02:56
dhcp-1-196.nay.redhat.com kdumpctl[1177]: Starting kdump: [OK] May 09 21:02:56 dhcp-1-196.nay.redhat.com systemd[1]: Started Crash recovery ... Hint: Some lines were ellipsized, use -l to show in full. [root@dhcp-1-196 ~]# echo
&quot;c&quot;&gt;/proc/sysrq-trigger [ 1747.176828] SysRq : Trigger a crash [ 1747.183994] BUG: unable to handle kernel NULL pointer dereference at (null) [ 1747.184930] IP: [&lt;ffffffff813ed416&gt;] sysrq_handle_crash+0x16/0x20 [ 1747.184930] PGD
5967067 PUD 86f0067 PMD 0 [ 1747.184930] Oops: 0002 [#1] SMP [ 1747.184930] Modules linked in: xt_CHECKSUM ipt_MASQUERADE nf_nat_masquerade_ipv4 tun ip6t_rpfilter ipt_REJECT nf_reject_ipv4 ip6t_REJECT nf_reject_ipv6 xt_conntrack ip_set nfnetlink
ebtable_nat ebtable_broute bridge stp llc ip6table_nat nf_conntrack_ipv6 nf_defrag_ipv6 nf_nat_ipv6 ip6table_mangle ip6table_security ip6table_raw iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat nf_conntrack iptable_mangle
iptable_security iptable_raw ebtable_filter ebtables ip6table_filter ip6_tables iptable_filter intel_powerclamp intel_rapl iosf_mbi crc32_pclmul ghash_clmulni_intel aesni_intel ppdev lrw gf128mul xen_kbdfront glue_helper parport_pc ablk_helper
parport cryptd i2c_piix4 pcspkr nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables xfs libcrc32c ata_generic pata_acpi cirrus drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops xen_netfront ttm crct10dif_pclmul crct10dif_common
xen_blkfront ata_piix crc32c_intel drm libata serio_raw i2c_core floppy fjes dm_mirror dm_region_hash dm_log dm_mod [ 1747.184930] CPU: 0 PID: 3209 Comm: bash Not tainted 3.10.0-514.el7.x86_64 #1 [ 1747.184930] Hardware name: Xen HVM domU, BIOS 4.8.1
05/03/2017 [ 1747.184930] task: ffff88003ab00fb0 ti: ffff88000c13c000 task.ti: ffff88000c13c000 [ 1747.184930] RIP: 0010:[&lt;ffffffff813ed416&gt;] [&lt;ffffffff813ed416&gt;] sysrq_handle_crash+0x16/0x20 [ 1747.184930] RSP: 0018:ffff88000c13fe88
EFLAGS: 00010246 [ 1747.184930] RAX: 000000000000000f RBX: ffffffff81a7bfe0 RCX: 0000000000000000 [ 1747.184930] RDX: 0000000000000000 RSI: ffff88003f80f838 RDI: 0000000000000063 [ 1747.184930] RBP: ffff88000c13fe88 R08: 0000000000000086 R09:
0000000000000238 [ 1747.184930] R10: 0000000000000237 R11: 0000000000000003 R12: 0000000000000063 [ 1747.184930] R13: 0000000000000000 R14: 0000000000000004 R15: 0000000000000000 [ 1747.184930] FS: 00007fcd0018a740(0000) GS:ffff88003f800000(0000)
knlGS:0000000000000000 [ 1747.184930] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [ 1747.184930] CR2: 0000000000000000 CR3: 00000000087a4000 CR4: 00000000001406f0 [ 1747.184930] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000 [
1747.184930] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400 [ 1747.184930] Stack: [ 1747.184930] ffff88000c13feb8 ffffffff813edc37 0000000000000002 00007fcd0019e000 [ 1747.184930] ffff88000c13ff48 0000000000000002 ffff88000c13fed0
ffffffff813ee0af [ 1747.184930] ffff88003d3f00c0 ffff88000c13fef0 ffffffff8126b57d 0000000000000002 [ 1747.184930] Call Trace: [ 1747.184930] [&lt;ffffffff813edc37&gt;] __handle_sysrq+0x107/0x170 [ 1747.184930] [&lt;ffffffff813ee0af&gt;]
write_sysrq_trigger+0x2f/0x40 [ 1747.184930] [&lt;ffffffff8126b57d&gt;] proc_reg_write+0x3d/0x80 [ 1747.184930] [&lt;ffffffff811fe12d&gt;] vfs_write+0xbd/0x1e0 [ 1747.184930] [&lt;ffffffff811fec4f&gt;] SyS_write+0x7f/0xe0 [ 1747.184930]
[&lt;ffffffff816964c9&gt;] system_call_fastpath+0x16/0x1b [ 1747.184930] Code: eb 9b 45 01 f4 45 39 65 34 75 e5 4c 89 ef e8 e2 f7 ff ff eb db 0f 1f 44 00 00 55 48 89 e5 c7 05 41 e4 5f 00 01 00 00 00 0f ae f8 &lt;c6&gt; 04 25 00 00 00 00 01 5d c3 0f
1f 44 00 00 55 31 c0 c7 05 be [ 1747.184930] RIP [&lt;ffffffff813ed416&gt;] sysrq_handle_crash+0x16/0x20 [ 1747.184930] RSP &lt;ffff88000c13fe88&gt; [ 1747.184930] CR2: 0000000000000000 After guest crash, it was destroyed and can not be displayed.
[root@dhcp-1-208 rhel7.3]# xl list Name ID Mem VCPUs State Time(s) Domain-0 0 13978 8 r----- 3329.2 The configuration file: [root@dhcp-1-208 rhel7.3]# cat guest_7.3.cfg name = &quot;guest_7.3&quot; maxmem = 1024 memory = 1024 vcpus = 8 pae = 1 acpi =
1 apic = 1 viridian = 0 rtc_timeoffset = 0 localtime = 0 on_poweroff = &quot;destroy&quot; on_reboot = &quot;restart&quot; on_crash = &quot;restart&quot; device_model = &quot;/usr/lib64/xen/bin/qemu-dm&quot; sdl = 0 vnc = 1 vncunused = 1 vnclisten =
&quot;127.0.0.1&quot; keymap = &quot;en-us&quot; vif = [ &quot;mac=00:16:35:f3:1c:53,bridge=xenbr0,script=vif-bridge&quot; ] parallel = &quot;none&quot; serial = &quot;pty&quot; builder = &quot;hvm&quot; kernel =
&quot;/usr/lib/xen/boot/hvmloader&quot; boot = &quot;cdn&quot; disk = [ &quot;file:/media/rhel7.3/guest_7.3.img,hda,w&quot;] usb = 1 usbdevice = &quot;tablet&quot; Version-Release number of selected component (if applicable): Fedora 26 latest
version(4.11.0-1.fc26.x86_64) RHEL Version: RHEL7.3(3.10.0-514.el7.x86_64) How reproducible: 100% Steps to Reproduce: 1. Install Fedora 26 Alpha release and xen packages. 2. Upgrade system to the latest version( &apos;dnf upgrade --refresh&apos;). 2.
Boot into xen environment and create the hvm guest configuration file as bug description. 3. Enabled guest kdump service and trigger a panic in guest. 4. Guest was destroyed after panic. Actual results: The guest was destroyed after crashed. Expected
results: The guest should be able to restart and generate the core dump file in guest. Additional info: Some packages information: [root@dhcp-1-208 rhel7.3]# rpm -qa|egrep &quot;xen-4|libvirt-3|kernel-4&quot; kernel-4.11.0-0.rc3.git0.2.fc26.x86_64
xen-4.8.1-2.fc26.x86_64 kernel-4.11.0-0.rc7.git0.1.fc26.x86_64 libvirt-3.2.0-1.fc26.x86_64 kernel-4.11.0-1.fc26.x86_64 More status of verification. 1. This problem is not reproduced on Fedora26 alpha release
build(kernel-4.11.0-0.rc3.git0.2.fc26.x86_64). 2. This problem is reproduced on Fedora26 later build(kernel-4.11.0-0.rc8.git0.1.fc26.x86_64).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10495165</commentid>
<comment_count>1</comment_count>
<who name="Robin Lee">robinlee.sysu</who>
<bug_when>2017-06-10 06:41:28 -0400</bug_when>
<thetext>Not reproduced with [root@localhost ~]# rpm -q kernel kernel-4.11.3-302.fc26.x86_64 [root@localhost ~]# rpm -q xen xen-4.8.1-2.fc26.x86_64</thetext>
</long_desc>

</bug>

</bugzilla>

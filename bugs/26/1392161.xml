<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1392161</bug_id>
          
          <creation_ts>2016-11-05 08:42:00 -0400</creation_ts>
          <short_desc>SELinux is preventing (ostnamed) from &apos;mounton&apos; accesses on the directory /proc/irq.</short_desc>
          <delta_ts>2017-03-03 23:23:44 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>selinux-policy</component>
          <version>26</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:b67442336fefc433297f5b6344760efc0de51e79d35083f5f1156f828c4b5a2a;VARIANT_ID=workstation; AcceptedBlocker</status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1349188</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Nicolas Mailhot">nicolas.mailhot</reporter>
          <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>fyndzzz</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>lslebodn</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>pmoore</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>samuel-rhbugs</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>ssekidde</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>selinux-policy-3.13.1-235.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-03 23:23:44</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9863982</commentid>
    <comment_count>0</comment_count>
    <who name="Nicolas Mailhot">nicolas.mailhot</who>
    <bug_when>2016-11-05 08:42:27 -0400</bug_when>
    <thetext>Description of problem:
SELinux is preventing (ostnamed) from &apos;mounton&apos; accesses on the directory /proc/irq.

*****  Plugin catchall (100. confidence) suggests   **************************

If vous pensez que (ostnamed) devrait être autorisé à accéder mounton sur irq directory par défaut.
Then vous devriez rapporter ceci en tant qu&apos;anomalie.
Vous pouvez générer un module de stratégie local pour autoriser cet accès.
Do
allow this access for now by executing:
# ausearch -c &apos;(ostnamed)&apos; --raw | audit2allow -M my-ostnamed
# semodule -X 300 -i my-ostnamed.pp

Additional Information:
Source Context                system_u:system_r:init_t:s0
Target Context                system_u:object_r:sysctl_irq_t:s0
Target Objects                /proc/irq [ dir ]
Source                        (ostnamed)
Source Path                   (ostnamed)
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-222.fc26.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     (removed)
Platform                      Linux (removed) 4.8.0-1.fc26.x86_64 #1 SMP Mon Oct
                              3 14:09:56 UTC 2016 x86_64 x86_64
Alert Count                   8
First Seen                    2016-11-04 19:15:31 CET
Last Seen                     2016-11-04 22:00:41 CET
Local ID                      e515b0ae-36d7-4120-9a82-cd045650911e

Raw Audit Messages
type=AVC msg=audit(1478293241.618:1111): avc:  denied  { mounton } for  pid=4004 comm=&quot;(-localed)&quot; path=&quot;/proc/irq&quot; dev=&quot;proc&quot; ino=4026531858 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:sysctl_irq_t:s0 tclass=dir permissive=0


Hash: (ostnamed),init_t,sysctl_irq_t,dir,mounton

Version-Release number of selected component:
selinux-policy-3.13.1-222.fc26.noarch

Additional info:
reporter:       libreport-2.8.0
hashmarkername: setroubleshoot
kernel:         4.8.0-1.fc26.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10050665</commentid>
    <comment_count>1</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2017-01-10 16:02:31 -0500</bug_when>
    <thetext>Description of problem:
Installed Fedora-Workstation-Live-x86_64-Rawhide-20170110.n.0.iso. As soon as the system booted the first time, was issued this SELinux denial alert.

Version-Release number of selected component:
selinux-policy-3.13.1-233.fc26.noarch

Additional info:
reporter:       libreport-2.9.0
hashmarkername: setroubleshoot
kernel:         4.10.0-0.rc3.git0.1.fc26.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10050887</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2017-01-10 17:50:46 -0500</bug_when>
    <thetext>Proposed as a Blocker for 26-final by Fedora user coremodule using the blocker tracking app because:

 This bug violates the following F26 Final criteria:

&quot;There must be no SELinux denial notifications or crash notifications on boot of or during installation from a release-blocking live image, or at first login after a default install of a release-blocking desktop.&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10051506</commentid>
    <comment_count>3</comment_count>
    <who name="Fnoob">fyndzzz</who>
    <bug_when>2017-01-11 00:58:21 -0500</bug_when>
    <thetext>Description of problem:
Updated Rawhide 26.  AVC regarding truncated &apos;ostnamed&apos; after logging in.  Duplicate of 1392161.  Looks like 1361809 , 1367292 .  Last comment on 1367292 said &quot;If problems still persist, please make note of it in this bug report.&quot;

Version-Release number of selected component:
selinux-policy-3.13.1-231.fc26.noarch

Additional info:
reporter:       libreport-2.9.0
hashmarkername: setroubleshoot
kernel:         4.10.0-0.rc2.git4.1.fc26.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10060815</commentid>
    <comment_count>4</comment_count>
    <who name="Lukas Slebodnik">lslebodn</who>
    <bug_when>2017-01-13 08:03:40 -0500</bug_when>
    <thetext>And attached audit log with permissive mode

type=AVC msg=audit(1484227039.425:11726): avc:  denied  { mounton } for  pid=19024 comm=&quot;(ostnamed)&quot; path=&quot;/proc/irq&quot; dev=&quot;proc&quot; ino=4026531858 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:sysctl_irq_t:s0 tclass=dir permissive=1
type=AVC msg=audit(1484227039.425:11727): avc:  denied  { mounton } for  pid=19024 comm=&quot;(ostnamed)&quot; path=&quot;/proc/mtrr&quot; dev=&quot;proc&quot; ino=4026531973 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:mtrr_device_t:s0 tclass=file permissive=1
type=SERVICE_START msg=audit(1484227039.463:11728): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=systemd-hostnamed comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=? res=success&apos;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10064500</commentid>
    <comment_count>5</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-01-15 16:33:32 -0500</bug_when>
    <thetext>Nearly every openQA test is running into this in recent composes. +1 blocker.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10066064</commentid>
    <comment_count>6</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2017-01-16 08:06:26 -0500</bug_when>
    <thetext>+1 blocker</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10066563</commentid>
    <comment_count>7</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2017-01-16 10:13:30 -0500</bug_when>
    <thetext>Description of problem:
Simply booted a freshly installed Rawhide VM and logged in.

Version-Release number of selected component:
selinux-policy-3.13.1-233.fc26.noarch

Additional info:
reporter:       libreport-2.9.0
hashmarkername: setroubleshoot
kernel:         4.10.0-0.rc3.git4.1.fc26.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10071726</commentid>
    <comment_count>8</comment_count>
    <who name="Michal Sekletar">msekleta</who>
    <bug_when>2017-01-17 08:59:48 -0500</bug_when>
    <thetext>AVC is generated because systemd-hostnamed.service has option ProtectKernelTunables set to yes. If this option is enabled for the service then systemd will disable sysctl syscall by installing seccomp filter. Also the service will be spawned in its own mount namespace where some filesystem paths that are otherwise write-able by root will become read-only. This is done by recursively bind mounting those paths into the same locations and then remounting bind mounts as read-only.

If you want to get rid of AVC then either allow systemd to do remounting or remove ProtectKernelTunables=yes from systemd-hostnamed.service. Note that that localed, resolved, timesyncd and timedated unit files also contain ProtectKernelTunables=yes option.

I think it would make sense to adjust our SELinux policy because otherwise services can&apos;t take full advantage of this new systemd security feature.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10071794</commentid>
    <comment_count>9</comment_count>
    <who name="Lukas Slebodnik">lslebodn</who>
    <bug_when>2017-01-17 09:11:28 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #5)
&gt; Nearly every openQA test is running into this in recent composes. +1 blocker.

(In reply to Stephen Gallagher from comment #6)
&gt; +1 blocker

It super nice that you gave +1 for harmless AVC bug.
IMHO there are different bugs which should get blocker.  (BZ1413075 and maybe related/duplicate BZ1413047)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10071889</commentid>
    <comment_count>10</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2017-01-17 09:31:26 -0500</bug_when>
    <thetext>It&apos;s hard to know which one is at fault, but SELinux is preventing the system from working *at all* on Fedora 26/Rawhide right now. This looked likely to be the culprit. If this one is indeed harmless and the problem is elsewhere, please advise.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10071890</commentid>
    <comment_count>11</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2017-01-17 09:31:26 -0500</bug_when>
    <thetext>It&apos;s hard to know which one is at fault, but SELinux is preventing the system from working *at all* on Fedora 26/Rawhide right now. This looked likely to be the culprit. If this one is indeed harmless and the problem is elsewhere, please advise.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10071924</commentid>
    <comment_count>12</comment_count>
    <who name="Lukas Slebodnik">lslebodn</who>
    <bug_when>2017-01-17 09:35:48 -0500</bug_when>
    <thetext>I can see this AVC even on older kernel but it does not cause such problem as I reported in different bugs(BZ1413075 BZ1413047)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10072244</commentid>
    <comment_count>13</comment_count>
    <who name="Michal Sekletar">msekleta</who>
    <bug_when>2017-01-17 10:32:42 -0500</bug_when>
    <thetext>FWIW, filesystem paths that systemd may try to remount due to use of new security related features can be found in respective tables here,

https://github.com/systemd/systemd/blob/master/src/core/namespace.c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10072597</commentid>
    <comment_count>14</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2017-01-17 11:50:17 -0500</bug_when>
    <thetext>Michal, 
Thank you. Fixed. Build will be available ASAP.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10085388</commentid>
    <comment_count>15</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-01-20 18:28:30 -0500</bug_when>
    <thetext>Any news on that build?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10113327</commentid>
    <comment_count>16</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2017-02-01 11:31:29 -0500</bug_when>
    <thetext>commit 08645ba5ed6467bee8218bec32015ef4f1c70fa0
Author: Lukas Vrabec &lt;lvrabec@redhat.com&gt;
Date:   Tue Jan 17 17:47:55 2017 +0100

    Allow systemd using ProtectKernelTunables securit feature. BZ(1392161)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10113391</commentid>
    <comment_count>17</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2017-02-01 11:44:53 -0500</bug_when>
    <thetext>Adam, 
Issue is fixed here:
https://koji.fedoraproject.org/koji/buildinfo?buildID=834475</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10116312</commentid>
    <comment_count>18</comment_count>
    <who name="Lukas Slebodnik">lslebodn</who>
    <bug_when>2017-02-02 10:32:47 -0500</bug_when>
    <thetext>I think that this change caused another bug @see BZ1418682</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10144318</commentid>
    <comment_count>19</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2017-02-13 15:30:10 -0500</bug_when>
    <thetext>Discussed during the 2017-02-13 blocker review meeting: [1]

The decision was made to classify this bug as an AcceptedBlocker was made as it violates the following Final criteria:

&quot;There must be no SELinux denial notifications or crash notifications on boot of or during installation from a release-blocking live image, or at first login after a default install of a release-blocking desktop.&quot;

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2017-02-13/f26-blocker-review.2017-02-13-18.01.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10147931</commentid>
    <comment_count>20</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-02-14 16:04:59 -0500</bug_when>
    <thetext>A similar AVC still shows up in Fedora-Rawhide-20170214.n.0 testing, e.g.:

https://openqa.fedoraproject.org/tests/56815#step/_console_avc_crash/9

it now seems to be complaining about /proc/mtrr .</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10191520</commentid>
    <comment_count>21</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2017-02-28 05:33:48 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 26 development cycle.
Changing version to &apos;26&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10208071</commentid>
    <comment_count>22</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-03-03 23:23:44 -0500</bug_when>
    <thetext>There&apos;s another report for the /proc/mtrr one:
https://bugzilla.redhat.com/show_bug.cgi?id=1411360
so let&apos;s close this.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
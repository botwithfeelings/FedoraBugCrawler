<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1451071</bug_id>
          
          <creation_ts>2017-05-15 13:08:00 -0400</creation_ts>
          <short_desc>Secure boot flag could not be determined</short_desc>
          <delta_ts>2017-06-29 19:28:34 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>kernel</component>
          <version>26</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1418360</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedFreezeException</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1465517</blocked>
    
    
    <blocked>1349188</blocked>
    
    
    <blocked>1349189</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter>dherault</reporter>
          <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>bugzilla</cc>
    
    
    <cc>dhowells</cc>
    
    
    <cc>dominik</cc>
    
    
    <cc>gansalmon</cc>
    
    
    <cc>hanishkvc</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>mchehab</cc>
    
    
    <cc>mjg59</cc>
    
    
    <cc>pjones</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>thomas</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>grub-2.02-0.40.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-29 19:28:34</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10413912</commentid>
    <comment_count>0</comment_count>
    <who name="">dherault</who>
    <bug_when>2017-05-15 13:08:08 -0400</bug_when>
    <thetext>Secure boot is activated in the bios and i can boot without issue.

But dmesg output is :
dmesg -t | grep -i &apos;edk\|secure&apos;
Secure boot could not be determined

While normally it should be:
Secure boot enabled and kernel locked down

Kernel 4.11.0-2.fc26.x86_64
Bootloader : Grub2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10416773</commentid>
    <comment_count>1</comment_count>
    <who name="David Howells">dhowells</who>
    <bug_when>2017-05-16 08:55:21 -0400</bug_when>
    <thetext>What grub version do you have?  There&apos;s a bug in grub that might be the culprit (bug 1418360).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10417008</commentid>
    <comment_count>2</comment_count>
    <who name="">dherault</who>
    <bug_when>2017-05-16 09:55:28 -0400</bug_when>
    <thetext>The last one : 1:2.02-0.38.fc26
I have at boot a EFI stub message that informs me that secure boot is enabled. But no kernel lockdown for dmesg.

Maybe the problem is for me related to the fact that I activated secure boot after the installation of the system?

efibootmgr -v
BootCurrent: 0001
Timeout: 1 seconds
BootOrder: 0001,0000,0005
Boot0000* Windows Boot Manager	HD(2,GPT,e3179291-056a-448c-a5a1-ba56fb60e852,0xe1800,0x32000)/File(\EFI\MICROSOFT\BOOT\BOOTMGFW.EFI)WINDOWS.........x...B.C.D.O.B.J.E.C.T.=.{.9.d.e.a.8.6.2.c.-.5.c.d.d.-.4.e.7.0.-.a.c.c.1.-.f.3.2.b.3.4.4.d.4.7.9.5.}...7................
Boot0001* Fedora	HD(1,GPT,fe1e748e-4c4a-4791-b11f-3865772b4ce3,0x800,0x2f800)/File(\EFI\FEDORA\SHIM.EFI)
Boot0005* UEFI OS	HD(1,GPT,fe1e748e-4c4a-4791-b11f-3865772b4ce3,0x800,0x2f800)/File(\EFI\BOOT\BOOTX64.EFI)


Secureboot efivar is present, but not SecurebootEnforce... 
ls  /sys/firmware/efi/efivars/ |grep Secure*
SecureBoot-8be4df61-93ca-11d2-aa0d-00e098032b8c

Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10424605</commentid>
    <comment_count>3</comment_count>
    <who name="">dherault</who>
    <bug_when>2017-05-18 05:56:09 -0400</bug_when>
    <thetext>Kernel updated to 4.11.1-300.fc26.x86_64 : 
Same issue
dmesg |grep Secur*
[    0.000000] Secure boot could not be determined


If it can be useful :
bootctl status
Using EFI System Partition at /boot/efi.
System:
     Firmware: n/a (n/a)
  Secure Boot: enabled
   Setup Mode: user

Loader:
      Product: n/a
    Partition: n/a
         File: └─n/a

Boot Loader Binaries:
          ESP: /dev/disk/by-partuuid/fe1e748e-4c4a-4791-b11f-3865772b4ce3
systemd-boot not installed in ESP.
         File: └─/EFI/BOOT/BOOTX64.EFI

Boot Loader Entries in EFI Variables:
        Title: Fedora
           ID: 0x0001
       Status: active, boot-order
    Partition: /dev/disk/by-partuuid/fe1e748e-4c4a-4791-b11f-3865772b4ce3
         File: └─/EFI/FEDORA/SHIM.EFI

        Title: Windows Boot Manager
           ID: 0x0000
       Status: active, boot-order
    Partition: /dev/disk/by-partuuid/e3179291-056a-448c-a5a1-ba56fb60e852
         File: └─/EFI/MICROSOFT/BOOT/BOOTMGFW.EFI

        Title: UEFI OS
           ID: 0x0005
       Status: active, boot-order
    Partition: /dev/disk/by-partuuid/fe1e748e-4c4a-4791-b11f-3865772b4ce3
         File: └─/EFI/BOOT/BOOTX64.EFI</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10427941</commentid>
    <comment_count>4</comment_count>
    <who name="">dherault</who>
    <bug_when>2017-05-19 03:44:27 -0400</bug_when>
    <thetext>Tried to reinstall grub-efi but same issue :

sudo dnf reinstall grub2-efi grub2-efi-modules shim
sudo grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10443789</commentid>
    <comment_count>5</comment_count>
    <who name="David Howells">dhowells</who>
    <bug_when>2017-05-24 08:51:17 -0400</bug_when>
    <thetext>The bug has not yet been fixed in grub.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10477312</commentid>
    <comment_count>6</comment_count>
    <who name="hanishkvc">hanishkvc</who>
    <bug_when>2017-06-05 09:19:06 -0400</bug_when>
    <thetext>Any specific reason why this bug is still not resolved? Also isn&apos;t there a bug in kernel also.

Looking at the note given in struct boot_param, as well as how the efi boot wrapper within in the kernel is using some part of the boot_param to set its own parameters, after it has got control from the original bootloader, why is the sanitize_boot_params WRONGLY reseting parameters which are (or can be as is the case here) set outside/after the bootloader.

Other than fixing the blind and potentially wrong copying of parameters area into boot_param by grub. The kernel should also be fixed to have some additional parameter to check if bootloader has set the secure boot related params or the kernel&apos;s efi boot wrapper has set it, and then sanitize only if required.

OR am I missing something here?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10526464</commentid>
    <comment_count>7</comment_count>
    <who name="">dherault</who>
    <bug_when>2017-06-21 04:55:23 -0400</bug_when>
    <thetext>Same issue kernel 4.11.5-300 FC26 beta.

I do not have the impression that this bug is moving to be fixed. If the grub team is the only one competent, is their informed of this bug? 
Replacing grub with a signed systemd-boot could help solve the problem. But I do not know if it&apos;s in the pipes...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10541832</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-26 17:27:56 -0400</bug_when>
    <thetext>grub2-2.02-0.40.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-01b07bc086</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10541836</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2017-06-26 17:33:27 -0400</bug_when>
    <thetext>Proposed as a Blocker and Freeze Exception for 26-final by Fedora user pjones using the blocker tracking app because:

 Without this we can&apos;t verify from inside the OS that Secure Boot is enabled.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10543544</commentid>
    <comment_count>10</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-27 06:15:23 -0400</bug_when>
    <thetext>(In reply to Fedora Update System from comment #8)
&gt; grub2-2.02-0.40.fc26 has been submitted as an update to Fedora 26.
&gt; https://bodhi.fedoraproject.org/updates/FEDORA-2017-01b07bc086

What about F25? The issue occurs there as well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545648</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 16:25:00 -0400</bug_when>
    <thetext>grub2-2.02-0.40.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-01b07bc086</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10551218</commentid>
    <comment_count>12</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-06-28 17:51:36 -0400</bug_when>
    <thetext>Same question as the other bug: Would the fix for this take effect after a normal update of grub2, or is there some reason the fix for this needs to appear in the frozen release package set?

Also, presumably *both* fixes are needed?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10554696</commentid>
    <comment_count>13</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-06-29 15:11:12 -0400</bug_when>
    <thetext>For the record, pjones added further information by email:

&quot;basically Secure Boot doesn&apos;t trigger kmod signature checking, read-only /dev/mem, etc., in the current trees. This update fixes a grub bug that&apos;s triggering that behavior in the newer kernels, but was not triggering it in the older ones.&quot;

AIUI, &quot;kmod signature checking, read-only /dev/mem, etc.&quot; refers to various measures that are taken by the kernel when SB is known to be enabled, intended to defeat attempts to circumvent SB by e.g. loading a nefarious kernel module. So if I understand correctly, this is effectively a security issue (as it reduces the effectiveness of SB protections on systems which are using SB).

With that in mind: Discussed at 2017-06-29 blocker review meeting: https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2017-06-29/f26-blocker-review.2017-06-29-16.00.html . We agreed to at least accept this (and the companion bug #1418360) as freeze exception issues, which should be sufficient to ensure they&apos;re resolved in Final as the fixes are already available. We considered also accepting them as blockers under the &quot;The release must contain no known security bugs of &apos;important&apos; or higher impact according to the Red Hat severity classification scale which cannot be satisfactorily resolved by a package update (e.g. issues during installation).&quot; criterion, but as this issue isn&apos;t *formally* a security issue at least yet, and doesn&apos;t have a formal security evaluation, and FE status should be sufficient to get the fixes in anyhow, we decided to leave blocker status undetermined for now. FESCo may choose to make these bugs blockers by fiat.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10555080</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-29 19:28:34 -0400</bug_when>
    <thetext>grub2-2.02-0.40.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
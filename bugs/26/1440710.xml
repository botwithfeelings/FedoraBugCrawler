<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1440710</bug_id>
          
          <creation_ts>2017-04-10 06:36:00 -0400</creation_ts>
          <short_desc>monkey_patches.rb:104:in `&lt;class:SSLContext&gt;&apos;: undefined method `&lt;&lt;&apos; for nil:NilClass (NoMethodError)</short_desc>
          <delta_ts>2017-06-09 15:08:17 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>puppet</component>
          <version>26</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Patricia Moeller">patricia.moeller</reporter>
          <assigned_to name="Dominic Cleal">dominic</assigned_to>
          <cc>dominic</cc>
    
    
    <cc>esm</cc>
    
    
    <cc>fedora</cc>
    
    
    <cc>gchamoul</cc>
    
    
    <cc>jose.p.oliveira.oss</cc>
    
    
    <cc>k.georgiou</cc>
    
    
    <cc>marianne</cc>
    
    
    <cc>mastahnke</cc>
    
    
    <cc>mmagr</cc>
    
    
    <cc>moses</cc>
    
    
    <cc>s</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>puppet-4.6.2-4.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-09 15:08:17</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10318940</commentid>
    <comment_count>0</comment_count>
    <who name="Patricia Moeller">patricia.moeller</who>
    <bug_when>2017-04-10 06:36:32 -0400</bug_when>
    <thetext>Description of problem:
I am trying to run puppet 4.6.2-2 standalone in a F26 alpha chroot environment but always got the following error message:

/usr/share/ruby/vendor_ruby/puppet/util/monkey_patches.rb:104:in `&lt;class:SSLContext&gt;&apos;: undefined method `&lt;&lt;&apos; for nil:NilClass (NoMethodError)
	from /usr/share/ruby/vendor_ruby/puppet/util/monkey_patches.rb:98:in `&lt;top (required)&gt;&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/ruby/vendor_ruby/puppet/util.rb:16:in `&lt;module:Util&gt;&apos;
	from /usr/share/ruby/vendor_ruby/puppet/util.rb:15:in `&lt;module:Puppet&gt;&apos;
	from /usr/share/ruby/vendor_ruby/puppet/util.rb:14:in `&lt;top (required)&gt;&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/ruby/vendor_ruby/puppet.rb:12:in `&lt;top (required)&gt;&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/ruby/vendor_ruby/puppet/util/command_line.rb:12:in `&lt;top (required)&gt;&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/share/rubygems/rubygems/core_ext/kernel_require.rb:55:in `require&apos;
	from /usr/bin/puppet:4:in `&lt;main&gt;&apos;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10319075</commentid>
    <comment_count>1</comment_count>
    <who name="Dominic Cleal">dominic</who>
    <bug_when>2017-04-10 07:19:13 -0400</bug_when>
    <thetext>This looks like an incompatibility of the Puppet monkey patch with Ruby 2.4 when using OpenSSL 1.1.0 or higher.

Ruby 2.4 only sets a default ciphers list of its own on OpenSSL versions older than 1.1 (https://github.com/ruby/ruby/commit/c9dc016#diff-8406e11e4a42f9de6badcd0f6a6c4262R33), so this monkey patch is trying to modify an array that&apos;s no longer present.

The Ruby OpenSSL commit (https://github.com/ruby/openssl/commit/b9aea27) that removed it suggest the cipher list in 1.1.0 is secure enough by default, and the list in the commit doesn&apos;t list any SSLv2 ciphers, which is what Puppet&apos;s trying to disable.

I think the monkey patch could be removed or made conditional in Puppet in Fedora 26+, which uses OpenSSL 1.1.0.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10319081</commentid>
    <comment_count>2</comment_count>
    <who name="Patricia Moeller">patricia.moeller</who>
    <bug_when>2017-04-10 07:23:25 -0400</bug_when>
    <thetext>Thanks for pointing that out. Sounds like a good idea to me. I just want to confirm that it not only occurs in chroot but also when simply trying to execute it on a F26 box.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10319095</commentid>
    <comment_count>3</comment_count>
    <who name="Dominic Cleal">dominic</who>
    <bug_when>2017-04-10 07:26:15 -0400</bug_when>
    <thetext>Already tracked upstream at https://tickets.puppetlabs.com/browse/PUP-7383.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10424007</commentid>
    <comment_count>4</comment_count>
    <who name="Dominic Cleal">dominic</who>
    <bug_when>2017-05-18 03:15:15 -0400</bug_when>
    <thetext>Fixed in https://github.com/puppetlabs/puppet/commit/578687a00195191185f44d8cb38f4b7716d99c31 (.patch)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10438697</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-23 04:41:45 -0400</bug_when>
    <thetext>puppet-4.6.2-4.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-b9b66117bb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10441131</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-23 14:16:18 -0400</bug_when>
    <thetext>puppet-4.6.2-4.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-b9b66117bb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10494156</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-09 15:08:17 -0400</bug_when>
    <thetext>puppet-4.6.2-4.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
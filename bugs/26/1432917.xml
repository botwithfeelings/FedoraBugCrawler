<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1432917</bug_id>
          
          <creation_ts>2017-03-16 08:16:00 -0400</creation_ts>
          <short_desc>connection handling is looping on timeout event</short_desc>
          <delta_ts>2017-04-01 13:29:06 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>389-ds-base</component>
          <version>26</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tomas Krizek">tkrizek</reporter>
          <assigned_to>mreynolds</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>edewata</cc>
    
    
    <cc>mreynolds</cc>
    
    
    <cc>nhosoi</cc>
    
    
    <cc>nkinder</cc>
    
    
    <cc>rmeggins</cc>
    
    
    <cc>tbordaz</cc>
    
    
    <cc>wibrown</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>389-ds-base-1.3.6.3-4.f26 389-ds-base-1.3.6.3-4.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-04-01 13:29:06</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10245597</commentid>
    <comment_count>0</comment_count>
    <who name="Tomas Krizek">tkrizek</who>
    <bug_when>2017-03-16 08:16:41 -0400</bug_when>
    <thetext>Description of problem:

directory server log is getting flooded with the following warnings:

WARN - ns_handle_pr_read_ready - Received idletime out with c-&gt;c_idletimeout as 0. Ignoring.


Version-Release number of selected component (if applicable):
389-ds-base-1.3.6.2-2.fc26.x86_64

How reproducible:
always

Steps to Reproduce:
1. dnf update -y
2. dnf config-manager --enable=updates-testing
3. dnf install -y freeipa-server freeipa-server-dns
4. ipa-server-install -a $password -p $password --domain $domain --realm $realm -U--setup-dns --auto-forwarders

Actual results:
IPA serve with DNS is installed and the mentioned warning message is logged in directory server error log.

Expected results:
No such warning messages in error log.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10245655</commentid>
    <comment_count>1</comment_count>
    <who name="wibrown@redhat.com">wibrown</who>
    <bug_when>2017-03-16 08:29:21 -0400</bug_when>
    <thetext>Okay, I need to work out why this is looping. I think in an ideal world we would have a default timeout set so this wouldn&apos;t be an issue.

I need to see why libevent is throwing a timeout event back on this when it has a 0 timeout. I&apos;ll see if I can reproduce.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10245717</commentid>
    <comment_count>3</comment_count>
    <who name="wibrown@redhat.com">wibrown</who>
    <bug_when>2017-03-16 08:45:00 -0400</bug_when>
    <thetext>Upstream ticket:
https://pagure.io/389-ds-base/issue/49174</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10245819</commentid>
    <comment_count>4</comment_count>
    <who name="wibrown@redhat.com">wibrown</who>
    <bug_when>2017-03-16 09:06:17 -0400</bug_when>
    <thetext>@tbordaz: see.

https://pagure.io/389-ds-base/issue/49174#comment-431838</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10246038</commentid>
    <comment_count>5</comment_count>
    <who name="Tomas Krizek">tkrizek</who>
    <bug_when>2017-03-16 09:57:36 -0400</bug_when>
    <thetext>This also affects FreeIPA setup with DNS. Although SyncRepl seems to be working after the server is installed, there are the following errors in the named-pkcs11 log generated by bind-dyndb-ldap.

Mar 16 14:34:35 vm.example.com named-pkcs11[18630]: LDAP error: Can&apos;t contact LDAP server: connection error
Mar 16 14:34:35 vm.example.com named-pkcs11[18630]: retrying LDAP operation (modifying(replace)) on entry &apos;idnsname=dom.example.com.,cn=dns,dc=dom,dc=example,dc=com&apos;
Mar 16 14:34:35 vm.example.com named-pkcs11[18630]: LDAP error: Can&apos;t contact LDAP server: while modifying(replace) entry &apos;idnsname=dom.example.com.,cn=dns,dc=dom,dc=example,dc=com&apos;
Mar 16 14:34:35 vm.example.com named-pkcs11[18630]: unsupported operation: object class in resource record template DN &apos;idnsname=_ntp._udp,idnsname=idnsname=dom.example.com.,cn=dns,dc=dom,dc=example,dc=com&apos; changed: rndc reload might be necessary

If nunc-stans is turned off in cn=config,

nsslapd-enable-nunc-stans: off

and dirsrv and named-pkcs11 is restarted, the errors disappear and the DNS seems to work properly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10246075</commentid>
    <comment_count>6</comment_count>
    <who name="">mreynolds</who>
    <bug_when>2017-03-16 10:06:46 -0400</bug_when>
    <thetext>I&apos;m going to disable nunc-stans by default and do another build.  Once we get these issues sorted out we will re-enable for the next build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10246302</commentid>
    <comment_count>7</comment_count>
    <who name="">mreynolds</who>
    <bug_when>2017-03-16 10:59:36 -0400</bug_when>
    <thetext>Since this is not a blocker for fedora 26, I&apos;m not doing to do another build with nunc-stans disabled.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10246941</commentid>
    <comment_count>8</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-03-16 13:35:07 -0400</bug_when>
    <thetext>Do we know what the practical consequences of this bug are? Our (Fedora&apos;s) automated FreeIPA tests appear to be passing now, but it would be nice to know what this might be causing...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10246993</commentid>
    <comment_count>9</comment_count>
    <who name="thierry bordaz">tbordaz</who>
    <bug_when>2017-03-16 13:41:40 -0400</bug_when>
    <thetext>(In reply to Adam Williamson from comment #8)
&gt; Do we know what the practical consequences of this bug are? Our (Fedora&apos;s)
&gt; automated FreeIPA tests appear to be passing now, but it would be nice to
&gt; know what this might be causing...

Hi Adam,

You are right, some tests can pass successfully. In syncRepl tests (DNS), syncRepl was still able to send updates although the server hit that bug.

two symptoms are:

- constant CPU consumption (but quite low &lt;10%)
- DS error logs flooded with warnings : ns_handle_pr_read_ready - Received idletime out with c-&gt;c_idletimeout as 0. Ignoring.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10251012</commentid>
    <comment_count>10</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2017-03-17 17:52:17 -0400</bug_when>
    <thetext>Confirming I see this in openQA testing also.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10263595</commentid>
    <comment_count>11</comment_count>
    <who name="wibrown@redhat.com">wibrown</who>
    <bug_when>2017-03-22 00:13:14 -0400</bug_when>
    <thetext>I have found the root cause of this issue, and provided a patch upstream. Mark will rebuild this for Fedora shortly for testing. 

https://pagure.io/389-ds-base/issue/49174</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10269188</commentid>
    <comment_count>12</comment_count>
    <who name="Tomas Krizek">tkrizek</who>
    <bug_when>2017-03-23 06:48:21 -0400</bug_when>
    <thetext>I&apos;ve tested 389-ds-base-1.3.6.3-4.fc26 and I can confirm the issue has been fixed.

Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10270486</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-23 11:39:39 -0400</bug_when>
    <thetext>389-ds-base-1.3.6.3-4.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-846f41cfeb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10275156</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-24 10:51:51 -0400</bug_when>
    <thetext>389-ds-base-1.3.6.3-4.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-846f41cfeb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10296894</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-01 13:29:06 -0400</bug_when>
    <thetext>389-ds-base-1.3.6.3-4.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1386223</bug_id>
          
          <creation_ts>2016-10-18 08:48:00 -0400</creation_ts>
          <short_desc>Libvirt is blocking me running VMS because of no svm?</short_desc>
          <delta_ts>2017-05-03 15:07:21 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>libvirt</component>
          <version>26</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Daniel Walsh">dwalsh</reporter>
          <assigned_to name="Libvirt Maintainers">libvirt-maint</assigned_to>
          <cc>agedosier</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>clalancette</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jdenemar</cc>
    
    
    <cc>laine</cc>
    
    
    <cc>libvirt-maint</cc>
    
    
    <cc>pahan</cc>
    
    
    <cc>veillard</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-05-03 15:07:21</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9800743</commentid>
    <comment_count>0</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-18 08:48:46 -0400</bug_when>
    <thetext>vagrant up
Bringing machine &apos;default&apos; up with &apos;libvirt&apos; provider...
==&gt; default: Starting domain.
There was an error talking to Libvirt. The error message is shown
below:

Call to virDomainCreateWithFlags failed: the CPU is incompatible with host CPU: Host CPU does not provide required features: svm</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9800750</commentid>
    <comment_count>1</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-18 08:50:05 -0400</bug_when>
    <thetext>These VM&apos;s were working before but they are broken in latest rawhide.

libvirt-2.3.0-1.fc26.x86_64

Happening on both kernels.

rpm -q kernel
kernel-4.7.7-200.fc24.x86_64
kernel-4.9.0-0.rc1.git0.2.fc26.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9802349</commentid>
    <comment_count>2</comment_count>
    <who name="Jiri Denemark">jdenemar</who>
    <bug_when>2016-10-18 16:24:28 -0400</bug_when>
    <thetext>Would you mind sharing the domain XML with us? And since it was working before, please attach the XML from a host where it works too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805342</commentid>
    <comment_count>3</comment_count>
      <attachid>1212210</attachid>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-19 12:40:41 -0400</bug_when>
    <thetext>Created attachment 1212210
virsh dumpxml f24_atomic_default</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805350</commentid>
    <comment_count>4</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-19 12:43:11 -0400</bug_when>
    <thetext>All of my vagrant images are showing the same error.

Trying to start a Centos image via virt-manager gives me.

Error starting domain: the CPU is incompatible with host CPU: Host CPU does not provide required features: svm

Traceback (most recent call last):
  File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 88, in cb_wrapper
    callback(asyncjob, *args, **kwargs)
  File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 124, in tmpcb
    callback(*args, **kwargs)
  File &quot;/usr/share/virt-manager/virtManager/libvirtobject.py&quot;, line 83, in newfn
    ret = fn(self, *args, **kwargs)
  File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1404, in startup
    self._backend.create()
  File &quot;/usr/lib64/python2.7/site-packages/libvirt.py&quot;, line 1035, in create
    if ret == -1: raise libvirtError (&apos;virDomainCreate() failed&apos;, dom=self)
libvirtError: the CPU is incompatible with host CPU: Host CPU does not provide required features: svm</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805458</commentid>
    <comment_count>5</comment_count>
    <who name="Daniel Berrange">berrange</who>
    <bug_when>2016-10-19 13:07:30 -0400</bug_when>
    <thetext>This is a very strange configuration:

  &lt;cpu mode=&apos;host-model&apos;&gt;
    &lt;model fallback=&apos;allow&apos;&gt;qemu64&lt;/model&gt;
  &lt;/cpu&gt;

Specifying a named model doesn&apos;t make sense when using &apos;host-model&apos;. Based on the error message it sounds like libvirt is trying to use the qemu64 model, instead of the host model, and thus seeing the &apos;svm&apos; flag in qemu64, which is not present in your host model.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9806029</commentid>
    <comment_count>6</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-19 16:57:36 -0400</bug_when>
    <thetext>Could this be a bug in how vagrant creates the images then.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9806032</commentid>
    <comment_count>7</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-19 16:58:11 -0400</bug_when>
    <thetext>Should those lines be removed or changed?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9807233</commentid>
    <comment_count>8</comment_count>
    <who name="Jiri Denemark">jdenemar</who>
    <bug_when>2016-10-20 04:12:06 -0400</bug_when>
    <thetext>Yeah, sounds like a bug in vagrant or whatever created the XML. And since you say it was working well before, I believe they must have changed it recently. The XML should contain just

    &lt;cpu mode=&apos;host-model&apos;/&gt;

I was thinking about changing libvirt to just ignore any CPU model for host-model CPUs, but unfortunately we can&apos;t do that because of backwards compatibility. Old libvirt used to add a CPU model and features into a host-model CPU specification for migration to make sure the domain won&apos;t lose any features on the destination host. We&apos;ve recently switched to properly changing host-model CPU definition into a custom one when a domain is started, but we still need to be able to consume domain XMLs generated by older libvirt.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9809180</commentid>
    <comment_count>9</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-20 14:10:34 -0400</bug_when>
    <thetext>Made that change but I still see the same error.  Could this be a setting in my bios causing this issue?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9968962</commentid>
    <comment_count>10</comment_count>
    <who name="Pavel Alexeev">pahan</who>
    <bug_when>2016-12-08 12:07:49 -0500</bug_when>
    <thetext>Fore me helps set cpu_model to host-passthrough. Add something like:

  config.vm.provider :libvirt do |domain|
      â€¦
      domain.cpu_mode = &quot;host-passthrough&quot;
  end

into Vagrantfile.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10191420</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2017-02-28 05:27:56 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 26 development cycle.
Changing version to &apos;26&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10383509</commentid>
    <comment_count>12</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2017-05-03 15:07:21 -0400</bug_when>
    <thetext>Since this stalled I assume it was either fixed or worked around, so closing. If anyone is still hitting this with latest f26/rawhide bits, please reopen</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1212210</attachid>
            <date>2016-10-19 12:40:00 -0400</date>
            <delta_ts>2016-10-19 12:40:41 -0400</delta_ts>
            <desc>virsh dumpxml f24_atomic_default</desc>
            <filename>f24_atomic_default.xml</filename>
            <type>text/plain</type>
            <size>2072</size>
            <attacher name="Daniel Walsh">dwalsh</attacher>
            
              <data encoding="base64">PGRvbWFpbiB0eXBlPSdrdm0nPgogIDxuYW1lPmYyNF9hdG9taWNfZGVmYXVsdDwvbmFtZT4KICA8
dXVpZD5iMDQyYjU1NS01OWU2LTRhZTUtYjNmYi0wOWVhNGUxNzBmY2E8L3V1aWQ+CiAgPG1lbW9y
eSB1bml0PSdLaUInPjUyNDI4ODwvbWVtb3J5PgogIDxjdXJyZW50TWVtb3J5IHVuaXQ9J0tpQic+
NTI0Mjg4PC9jdXJyZW50TWVtb3J5PgogIDx2Y3B1IHBsYWNlbWVudD0nc3RhdGljJz4xPC92Y3B1
PgogIDxvcz4KICAgIDx0eXBlIGFyY2g9J3g4Nl82NCcgbWFjaGluZT0ncGMtaTQ0MGZ4LTIuNic+
aHZtPC90eXBlPgogICAgPGJvb3QgZGV2PSdoZCcvPgogIDwvb3M+CiAgPGZlYXR1cmVzPgogICAg
PGFjcGkvPgogICAgPGFwaWMvPgogICAgPHBhZS8+CiAgPC9mZWF0dXJlcz4KICA8Y3B1IG1vZGU9
J2hvc3QtbW9kZWwnPgogICAgPG1vZGVsIGZhbGxiYWNrPSdhbGxvdyc+cWVtdTY0PC9tb2RlbD4K
ICA8L2NwdT4KICA8Y2xvY2sgb2Zmc2V0PSd1dGMnLz4KICA8b25fcG93ZXJvZmY+ZGVzdHJveTwv
b25fcG93ZXJvZmY+CiAgPG9uX3JlYm9vdD5yZXN0YXJ0PC9vbl9yZWJvb3Q+CiAgPG9uX2NyYXNo
PmRlc3Ryb3k8L29uX2NyYXNoPgogIDxkZXZpY2VzPgogICAgPGVtdWxhdG9yPi91c3IvYmluL3Fl
bXUta3ZtPC9lbXVsYXRvcj4KICAgIDxkaXNrIHR5cGU9J2ZpbGUnIGRldmljZT0nZGlzayc+CiAg
ICAgIDxkcml2ZXIgbmFtZT0ncWVtdScgdHlwZT0ncWNvdzInLz4KICAgICAgPHNvdXJjZSBmaWxl
PScvdmFyL2xpYi9saWJ2aXJ0L2ltYWdlcy9mMjRfZGVmYXVsdC5pbWcnLz4KICAgICAgPHRhcmdl
dCBkZXY9J3ZkYScgYnVzPSd2aXJ0aW8nLz4KICAgICAgPGFkZHJlc3MgdHlwZT0ncGNpJyBkb21h
aW49JzB4MDAwMCcgYnVzPScweDAwJyBzbG90PScweDAzJyBmdW5jdGlvbj0nMHgwJy8+CiAgICA8
L2Rpc2s+CiAgICA8Y29udHJvbGxlciB0eXBlPSd1c2InIGluZGV4PScwJyBtb2RlbD0ncGlpeDMt
dWhjaSc+CiAgICAgIDxhZGRyZXNzIHR5cGU9J3BjaScgZG9tYWluPScweDAwMDAnIGJ1cz0nMHgw
MCcgc2xvdD0nMHgwMScgZnVuY3Rpb249JzB4MicvPgogICAgPC9jb250cm9sbGVyPgogICAgPGNv
bnRyb2xsZXIgdHlwZT0ncGNpJyBpbmRleD0nMCcgbW9kZWw9J3BjaS1yb290Jy8+CiAgICA8aW50
ZXJmYWNlIHR5cGU9J25ldHdvcmsnPgogICAgICA8bWFjIGFkZHJlc3M9JzUyOjU0OjAwOjg0OmYy
OjIyJy8+CiAgICAgIDxzb3VyY2UgbmV0d29yaz0ndmFncmFudC1saWJ2aXJ0Jy8+CiAgICAgIDxt
b2RlbCB0eXBlPSd2aXJ0aW8nLz4KICAgICAgPGFkZHJlc3MgdHlwZT0ncGNpJyBkb21haW49JzB4
MDAwMCcgYnVzPScweDAwJyBzbG90PScweDA1JyBmdW5jdGlvbj0nMHgwJy8+CiAgICA8L2ludGVy
ZmFjZT4KICAgIDxzZXJpYWwgdHlwZT0ncHR5Jz4KICAgICAgPHRhcmdldCBwb3J0PScwJy8+CiAg
ICA8L3NlcmlhbD4KICAgIDxjb25zb2xlIHR5cGU9J3B0eSc+CiAgICAgIDx0YXJnZXQgdHlwZT0n
c2VyaWFsJyBwb3J0PScwJy8+CiAgICA8L2NvbnNvbGU+CiAgICA8aW5wdXQgdHlwZT0nbW91c2Un
IGJ1cz0ncHMyJy8+CiAgICA8aW5wdXQgdHlwZT0na2V5Ym9hcmQnIGJ1cz0ncHMyJy8+CiAgICA8
Z3JhcGhpY3MgdHlwZT0ndm5jJyBwb3J0PSctMScgYXV0b3BvcnQ9J3llcycgbGlzdGVuPScxMjcu
MC4wLjEnIGtleW1hcD0nZW4tdXMnPgogICAgICA8bGlzdGVuIHR5cGU9J2FkZHJlc3MnIGFkZHJl
c3M9JzEyNy4wLjAuMScvPgogICAgPC9ncmFwaGljcz4KICAgIDx2aWRlbz4KICAgICAgPG1vZGVs
IHR5cGU9J2NpcnJ1cycgdnJhbT0nMTYzODQnIGhlYWRzPScxJyBwcmltYXJ5PSd5ZXMnLz4KICAg
ICAgPGFkZHJlc3MgdHlwZT0ncGNpJyBkb21haW49JzB4MDAwMCcgYnVzPScweDAwJyBzbG90PScw
eDAyJyBmdW5jdGlvbj0nMHgwJy8+CiAgICA8L3ZpZGVvPgogICAgPG1lbWJhbGxvb24gbW9kZWw9
J3ZpcnRpbyc+CiAgICAgIDxhZGRyZXNzIHR5cGU9J3BjaScgZG9tYWluPScweDAwMDAnIGJ1cz0n
MHgwMCcgc2xvdD0nMHgwNCcgZnVuY3Rpb249JzB4MCcvPgogICAgPC9tZW1iYWxsb29uPgogIDwv
ZGV2aWNlcz4KPC9kb21haW4+Cgo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
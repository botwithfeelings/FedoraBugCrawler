<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1427646</bug_id>
          
          <creation_ts>2017-02-28 15:00:00 -0500</creation_ts>
          <short_desc>Set the order of NSS modules to &quot;sss files systemd&quot; for the &quot;passwd&quot; and &quot;group&quot; databases</short_desc>
          <delta_ts>2017-03-01 08:10:02 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>glibc</component>
          <version>26</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1357418</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Jakub Hrozek">jhrozek</reporter>
          <assigned_to name="Florian Weimer">fweimer</assigned_to>
          <cc>arjun.is</cc>
    
    
    <cc>codonell</cc>
    
    
    <cc>dj</cc>
    
    
    <cc>fweimer</cc>
    
    
    <cc>law</cc>
    
    
    <cc>mfabian</cc>
    
    
    <cc>pfrankli</cc>
    
    
    <cc>sid</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>glibc-2.25-3.fc26, glibc-2.25-3.fc27</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-01 08:10:02</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10195058</commentid>
    <comment_count>0</comment_count>
    <who name="Jakub Hrozek">jhrozek</who>
    <bug_when>2017-02-28 15:00:25 -0500</bug_when>
    <thetext>Description of problem:
In order to support https://fedoraproject.org/wiki/Changes/SSSDCacheForLocalUsers we should change the order of the NSS modules configured in NSS switch so that sss comes before files

Version-Release number of selected component (if applicable):
glibc-2.25-1.fc26.x86_64

How reproducible:
always

Steps to Reproduce:
1. dnf install sssd
2. systemctl start sssd
3. strace getent passwd $user_from_etc_passwd

Actual results:
/etc/passwd is opened and read on every request

Expected results:
The first request reads from /var/lib/sss/pipes/nss, subsequent requests read from /var/lib/sss/mc/passwd 

Additional info:
The first version in Fedora that ships the files provider is sssd-1.15.0-4.fc26 in case you want to add conflicts with a previous version of sssd-client.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10197074</commentid>
    <comment_count>1</comment_count>
      <attachid>1258662</attachid>
    <who name="Jakub Hrozek">jhrozek</who>
    <bug_when>2017-03-01 07:15:12 -0500</bug_when>
    <thetext>Created attachment 1258662
a proposed patch

Reverses the order of the sss and files modules in nsswitch.conf. The shadow modules are not reversed -- and it would be pointless since sssd doesn&apos;t implement the shadow map and probably never will. We might as well remove sss from the shadow map altogether.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10197315</commentid>
    <comment_count>2</comment_count>
    <who name="Florian Weimer">fweimer</who>
    <bug_when>2017-03-01 08:10:02 -0500</bug_when>
    <thetext>(In reply to Jakub Hrozek from comment #1)
&gt; Created attachment 1258662 [details]
&gt; a proposed patch
&gt; 
&gt; Reverses the order of the sss and files modules in nsswitch.conf. The shadow
&gt; modules are not reversed -- and it would be pointless since sssd doesn&apos;t
&gt; implement the shadow map and probably never will. We might as well remove
&gt; sss from the shadow map altogether.

Thanks, applied.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1258662</attachid>
            <date>2017-03-01 07:15:00 -0500</date>
            <delta_ts>2017-03-01 07:15:12 -0500</delta_ts>
            <desc>a proposed patch</desc>
            <filename>0001-Reverse-the-order-of-sss-and-files-modules-for-passw.patch</filename>
            <type>text/plain</type>
            <size>1679</size>
            <attacher name="Jakub Hrozek">jhrozek</attacher>
            
              <data encoding="base64">RnJvbSA1MDI0NTcxMjJkMjJjZDhmMDUzMTI4NGE5MDQ2NTQ0YTg3NjRjMDQzIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBKYWt1YiBIcm96ZWsgPGpha3ViLmhyb3pla0Bwb3N0ZW8uc2U+
CkRhdGU6IFdlZCwgMjIgRmViIDIwMTcgMTE6MzQ6NDggKzAxMDAKU3ViamVjdDogW1BBVENIXSBS
ZXZlcnNlIHRoZSBvcmRlciBvZiBzc3MgYW5kIGZpbGVzIG1vZHVsZXMgZm9yIHBhc3N3ZCBhbmQK
IGdyb3VwIG1hcHMKClJlc29sdmVzOiByaGJ6IzE0Mjc2NDYgLSBTZXQgdGhlIG9yZGVyIG9mIE5T
UyBtb2R1bGVzIHRvICJzc3MgZmlsZXMgc3lzdGVtZCIgZm9yIHRoZSAicGFzc3dkIiBhbmQgImdy
b3VwIiBkYXRhYmFzZXMKLS0tCiBnbGliYy5zcGVjICAgIHwgNiArKysrKy0KIG5zc3dpdGNoLmNv
bmYgfCA0ICsrLS0KIDIgZmlsZXMgY2hhbmdlZCwgNyBpbnNlcnRpb25zKCspLCAzIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2dsaWJjLnNwZWMgYi9nbGliYy5zcGVjCmluZGV4IDE2MWI1NGEy
YjBhN2ViNzIxYWUxNDE4MDU3MzZiZDkzMDAyYTMwY2UuLmYyYzNiNzEyMzMyNjc1MzhlY2RhNTA4
NGFiMjVkNDM1YjY5ODliOGIgMTAwNjQ0Ci0tLSBhL2dsaWJjLnNwZWMKKysrIGIvZ2xpYmMuc3Bl
YwpAQCAtMSw2ICsxLDYgQEAKICVkZWZpbmUgZ2xpYmNzcmNkaXIgIGdsaWJjLTIuMjUKICVkZWZp
bmUgZ2xpYmN2ZXJzaW9uIDIuMjUKLSVkZWZpbmUgZ2xpYmNyZWxlYXNlIDElez9kaXN0fQorJWRl
ZmluZSBnbGliY3JlbGVhc2UgMiV7P2Rpc3R9CiAjIFByZS1yZWxlYXNlIHRhcmJhbGxzIGFyZSBw
dWxsZWQgaW4gZnJvbSBnaXQgdXNpbmcgYSBjb21tYW5kIHRoYXQgaXMKICMgZWZmZWN0aXZlbHk6
CiAjCkBAIC0yMjcwLDYgKzIyNzAsMTAgQEAgcm0gLWYgKi5maWxlbGlzdCoKICVlbmRpZgogCiAl
Y2hhbmdlbG9nCisqIFdlZCBGZWIgMjIgMjAxNyBKYWt1YiBIcm96ZWsgPGpocm96ZWtAcmVkaGF0
LmNvbT4gLSAyLjI1LTIKKy0gUmV2ZXJzZSB0aGUgb3JkZXIgb2Ygc3NzIGFuZCBmaWxlcyBtb2R1
bGVzIGZvciBwYXNzd2QgYW5kIGdyb3VwIG1hcHMKKy0gUmVsYXRlZDogcmhieiMxMzU3NDE4IC0g
U1NTRCBmYXN0IGNhY2hlIGZvciBsb2NhbCB1c2VycworCiAqIFdlZCBGZWIgMDggMjAxNyBDYXJs
b3MgTydEb25lbGwgPGNhcmxvc0ByZWRoYXQuY29tPiAtIDIuMjUtMQogLSBVcGRhdGUgdG8gZmlu
YWwgcmVsZWFzZWQgZ2xpYmMgMi4yNS4KIApkaWZmIC0tZ2l0IGEvbnNzd2l0Y2guY29uZiBiL25z
c3dpdGNoLmNvbmYKaW5kZXggMWUyYjYzZDU4NDFkODRjOTlhMDNmODBhMDgwM2FlMDIzZGI5Njg3
ZS4uYzNkM2ZiNjUzN2IzZDY2MjM0ZjU4NzE1ZTM4OWVjZTE5ZWZlN2Y0NSAxMDA2NDQKLS0tIGEv
bnNzd2l0Y2guY29uZgorKysgYi9uc3N3aXRjaC5jb25mCkBAIC0zMCw5ICszMCw5IEBACiAjc2hh
ZG93OiAgICBkYiBmaWxlcyBuaXNwbHVzIG5pcwogI2dyb3VwOiAgICAgZGIgZmlsZXMgbmlzcGx1
cyBuaXMKIAotcGFzc3dkOiAgICAgZmlsZXMgc3NzCitwYXNzd2Q6ICAgICBzc3MgZmlsZXMKIHNo
YWRvdzogICAgIGZpbGVzIHNzcwotZ3JvdXA6ICAgICAgZmlsZXMgc3NzCitncm91cDogICAgICBz
c3MgZmlsZXMKIAogI2hvc3RzOiAgICAgZGIgZmlsZXMgbmlzcGx1cyBuaXMgZG5zCiBob3N0czog
ICAgICBmaWxlcyBkbnMKLS0gCjIuOS4zCgo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
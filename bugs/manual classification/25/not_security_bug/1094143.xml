<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1094143</bug_id>

    <creation_ts>2014-05-05 03:07:00 -0400</creation_ts>
    <short_desc>Desktop centric polkit ejabberdctl policy file, prevents server use</short_desc>
    <delta_ts>2017-01-05 15:21:19 -0500</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>ejabberd</component>
    <version>25</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened</keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <blocked>1094121</blocked>
    <everconfirmed>1</everconfirmed>
    <reporter name="Stef Walter">stefw</reporter>
    <assigned_to name="Randy Barlow">randy</assigned_to>
    <cc>erlang</cc>

    <cc>jkaluza</cc>

    <cc>j.orti.alcaine</cc>

    <cc>lemenkov</cc>

    <cc>martin</cc>

    <cc>randy</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>ejabberd-16.09-5.fc26 ejabberd-16.09-5.fc25</cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-01-05 15:21:19</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>7060841</commentid>
<comment_count>0</comment_count>
<who name="Stef Walter">stefw</who>
<bug_when>2014-05-05 03:07:13 -0400</bug_when>
<thetext>Description of problem: The shipped polkit policy is completely desktop-centric and expects that the admin user is logged in a local session (ie: a seat in logind parlance, with a monitor and keyboard). This prevents DBus API use when logged
in via ssh (and using pkttyagent as your polkit agent) or via Cockpit. The &lt;allow_any&gt; tag in polkit policy applies to non-local sessions. It should be set to something other than &apos;no&apos; unless the action directly affects hardware of
the login seat. Version-Release number of selected component (if applicable): 2.1.13-7.fc20</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8283041</commentid>
<comment_count>1</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2015-05-29 07:45:48 -0400</bug_when>
<thetext>This message is a reminder that Fedora 20 is nearing its end of life. Approximately 4 (four) weeks from now Fedora will stop maintaining and issuing updates for Fedora 20. It is Fedora&apos;s policy to close all bug reports from releases
that are no longer maintained. At that time this bug will be closed as EOL if it remains open with a Fedora &apos;version&apos; of &apos;20&apos;. Package Maintainer: If you wish for this bug to remain open because you plan to fix it in a currently
maintained version, simply change the &apos;version&apos; to a later Fedora version. Thank you for reporting this issue and we are sorry that we were not able to fix it before Fedora 20 is end of life. If you would still like to see this bug fixed
and are able to reproduce it against a later version of Fedora, you are encouraged change the &apos;version&apos; to a later Fedora version prior this bug is closed as described in the policy above. Although we aim to fix as many bugs as possible
during every release&apos;s lifetime, sometimes those efforts are overtaken by events. Often a more recent Fedora release includes newer upstream software that fixes bugs or makes them obsolete.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8385697</commentid>
<comment_count>2</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2015-06-29 16:27:32 -0400</bug_when>
<thetext>Fedora 20 changed to end-of-life (EOL) status on 2015-06-23. Fedora 20 is no longer maintained, which means that it will not receive any further security or bug fix updates. As a result we are closing this bug. If you can reproduce this bug
against a currently maintained version of Fedora please feel free to reopen this bug against that version. If you are unable to reopen this bug, please file a new report against the current release. If you experience problems, please add a comment to
this bug. Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9390768</commentid>
<comment_count>3</comment_count>
<who name="Peter Lemenkov">lemenkov</who>
<bug_when>2016-06-06 11:33:24 -0400</bug_when>
<thetext>We should review polkit rules again.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9549349</commentid>
<comment_count>4</comment_count>
<who name="Jan Kurik">jkurik</who>
<bug_when>2016-07-26 00:32:58 -0400</bug_when>
<thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle. Changing version to &apos;25&apos;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9926320</commentid>
<comment_count>5</comment_count>
<who name="Randy Barlow">randy</who>
<bug_when>2016-11-24 15:31:18 -0500</bug_when>
<thetext>The /usr/share/polkit-1/actions/ejabberdctl.policy file does have allow_any set to no, but it also has allow_inactive and allow_active set to auth_self. By my reading of some Arch documentation[0] I found about policykit, this means that ssh
and physical users should both have to authenticate to run ejabberdctl. Setting one or both of those values to yes would allow those users to execute the command without authenticating. In either case, even the root user cannot meaningfully use
ejabberdctl without being the ejabberd user, as there is a /var/lib/ejabberd/.erlang.cookie file that is needed to connect to the running ejabberd daemon. Since that file isn&apos;t in the root user&apos;s home folder, it is not found. When I use the
utility on my own system, I typically have to do something like this: sudo -u ejabberd /bin/sh /usr/bin/ejabberdctl &lt;command&gt; Peter, do you know a way to work around that so that any properly authenticated user (root, me, etc.) can find that
.erlang.cookie file automatically? I found some documentation that seems to indicate that the cookie is searched for at $HOME[1], and it suggests that copying the cookie to other places might be a reasonable way to proceed. There is also a -setcookie
parameter for /usr/bin/erl, but I think it might not be related to the path of the cookie but rather its value. If we can&apos;t have a way for other users (including root) to be able to access this cookie, it seems to me that having a policykit
policy at all does not make much sense since the ejabberdctl has to always be run as the user that started the daemon. That is, unless users know to copy that cookie around, in which case they should also know they could write their own policykit
rules (or use sudo). What do you think? [0] https://wiki.archlinux.org/index.php/Polkit#Actions [1] http://erlang.org/doc/reference_manual/distributed.html#id88336 [2] http://erlang.org/doc/man/erl.html</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9995816</commentid>
<comment_count>6</comment_count>
<who name="Randy Barlow">randy</who>
<bug_when>2016-12-17 13:36:24 -0500</bug_when>
<thetext>I have resolved the issue I referred to where users had to use the -u ejabberd flag in a recent update for F25 and Rawhide, but I still am not sure what to do about the policykit issue here. What is the value in using policykit with
ejabberdctl when a sudoers file can be used to control access? Policykit does seem valuable to be on a Desktop system, but I&apos;m not sure how it is useful for a server like ejabberd. I&apos;m leaning towards removing the policykit integration
since I&apos;m not very familiar with it, but if someone can make a case for keeping it I&apos;m interested to listen!</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9996000</commentid>
<comment_count>7</comment_count>
<who name="Kevin Kofler">kevin</who>
<bug_when>2016-12-17 19:43:49 -0500</bug_when>
<thetext>AIUI, allow_active and allow_inactive are both only for local sessions, active if that&apos;s the session currently being displayed on the screen, inactive if it is in the background (think user switching). SSH sessions are allow_any. Also,
defaulting to auth_self is very useless, because it allows any local user to run the daemon! This needs to be set to auth_admin (which will allow their own password only to wheel users, the others need the root password).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10012451</commentid>
<comment_count>8</comment_count>
<who name="Randy Barlow">randy</who>
<bug_when>2016-12-21 17:20:11 -0500</bug_when>
<thetext>Kevin, do you think there is a use case for keeping ejabberd with auth_admin, or do you think sudo is sufficient? I started a thread on fedora-devel about the usefulness of keeping policykit integration for ejabberd, but it&apos;s gotten no
replies so far: https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/thread/HLVK5YP3NMDKJCYNFHXXPCPAOELZI6OC/#HLVK5YP3NMDKJCYNFHXXPCPAOELZI6OC</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10019538</commentid>
<comment_count>9</comment_count>
<who name="Randy Barlow">randy</who>
<bug_when>2016-12-25 11:55:52 -0500</bug_when>
<thetext>I&apos;m going to adjust all three to be auth_admin.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10019587</commentid>
<comment_count>10</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-25 13:58:16 -0500</bug_when>
<thetext>ejabberd-16.09-5.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-5d9f0a5954</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10021166</commentid>
<comment_count>11</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-27 01:20:04 -0500</bug_when>
<thetext>ejabberd-16.09-5.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-5d9f0a5954</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10038816</commentid>
<comment_count>12</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-01-05 15:21:19 -0500</bug_when>
<thetext>ejabberd-16.09-5.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1358805</bug_id>

    <creation_ts>2016-07-21 10:01:00 -0400</creation_ts>
    <short_desc>SELinux is preventing (amavisd) from mounton access on the directory /etc</short_desc>
    <delta_ts>2016-08-24 12:25:30 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>selinux-policy-targeted</component>
    <version>24</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>CURRENTRELEASE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>high</priority>
    <bug_severity>high</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Anthony Messina">amessina</reporter>
    <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
    <cc>alanh</cc>

    <cc>dwalsh</cc>

    <cc>edgar.hoch</cc>

    <cc>lvrabec</cc>

    <cc>matt</cc>
    <qa_contact name="Ben Levenson">benl</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-08-16 12:26:51</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9537067</commentid>
<comment_count>0</comment_count>
<who name="Anthony Messina">amessina</who>
<bug_when>2016-07-21 10:01:45 -0400</bug_when>
<thetext>Starting Clean amavisd quarantine folder... Starting Clean amavisd tmp folder... AVC avc: denied { mounton } for pid=16123 comm=&quot;(tmpwatch)&quot; path=&quot;/etc&quot; dev=&quot;md1&quot; ino=57915649
scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 AVC avc: denied { mounton } for pid=16122 comm=&quot;(tmpwatch)&quot; path=&quot;/etc&quot; dev=&quot;md1&quot; ino=57915649
scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 Started Clean amavisd quarantine folder. SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0
msg=&apos;unit=amavisd-clean-quarantine comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=? res=success&apos; SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0
msg=&apos;unit=amavisd-clean-quarantine comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=? res=success&apos; Started Clean amavisd tmp folder. SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295
subj=system_u:system_r:init_t:s0 msg=&apos;unit=amavisd-clean-tmp comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=? res=success&apos; SERVICE_STOP pid=1 uid=0 auid=4294967295 ses=4294967295
subj=system_u:system_r:init_t:s0 msg=&apos;unit=amavisd-clean-tmp comm=&quot;systemd&quot; exe=&quot;/usr/lib/systemd/systemd&quot; hostname=? addr=? terminal=? res=success&apos; SELinux is preventing (amavisd) from mounton access on the directory
/etc. For complete SELinux messages. run sealert -l 194bfe9e-4e87-41c2-91eb-954506ff9865 SELinux is preventing (amavisd) from mounton access on the directory /etc.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9544465</commentid>
<comment_count>1</comment_count>
<who name="Dirk Cummings">matt</who>
<bug_when>2016-07-24 16:42:33 -0400</bug_when>
<thetext>Same thing for me on a fresh install of Fedora 24. After trying to &quot;systemctl start amavisd.service&quot;, the following avc denials get logged: type=AVC msg=audit(1469391217.586:189): avc: denied { mounton } for pid=857
comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469391220.034:194): avc: denied { mounton } for
pid=871 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469391222.051:199): avc: denied { mounton }
for pid=889 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469391224.036:203): avc: denied {
mounton } for pid=904 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469391226.293:208): avc:
denied { mounton } for pid=915 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469391228.036:212):
avc: denied { mounton } for pid=930 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC
msg=audit(1469391230.031:217): avc: denied { mounton } for pid=941 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0
type=AVC msg=audit(1469392828.600:130): avc: denied { mounton } for pid=660 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir
permissive=0 type=AVC msg=audit(1469392831.599:135): avc: denied { mounton } for pid=694 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0
tclass=dir permissive=0 type=AVC msg=audit(1469392834.076:141): avc: denied { mounton } for pid=717 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0
tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392836.596:146): avc: denied { mounton } for pid=736 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074
scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392838.814:152): avc: denied { mounton } for pid=754 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot;
ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392840.897:158): avc: denied { mounton } for pid=770 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot;
dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392842.967:164): avc: denied { mounton } for pid=787 comm=&quot;(amavisd)&quot;
path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392845.059:170): avc: denied { mounton } for pid=806
comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0 type=AVC msg=audit(1469392847.318:175): avc: denied { mounton } for
pid=827 comm=&quot;(amavisd)&quot; path=&quot;/etc&quot; dev=&quot;vda1&quot; ino=131074 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=dir permissive=0</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9589797</commentid>
<comment_count>2</comment_count>
<who name="Alan Hamilton">alanh</who>
<bug_when>2016-08-05 14:56:23 -0400</bug_when>
<thetext>Looks like it&apos;s missing a rule to transition from init_t to antivirus_t. Amavisd ends up running as init_t. If I run in permissive mode: system_u:system_r:init_t:s0 amavis 1920 1 0 11:28 ? 00:00:01 /usr/sbin/amavisd (master)
system_u:system_r:init_t:s0 amavis 1921 1920 0 11:28 ? 00:00:04 /usr/sbin/amavisd (ch15-avail) system_u:system_r:init_t:s0 amavis 1922 1920 0 11:28 ? 00:00:04 /usr/sbin/amavisd (ch17-avail)</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9621032</commentid>
<comment_count>3</comment_count>
<who name="Alan Hamilton">alanh</who>
<bug_when>2016-08-16 23:17:43 -0400</bug_when>
<thetext>I&apos;m afraid I&apos;m still seeing it with selinux-policy-targeted-3.13.1-191.10.fc24.noarch. amavisd is still not transitioning from init_t to antivirus_t. This is running in permissive mode: type=SELINUX_ERR
msg=audit(1471403360.719:9671): op=security_bounded_transition seresult=denied oldcontext=system_u:system_r:init_t:s0 newcontext=system_u:syste m_r:antivirus_t:s0 type=AVC msg=audit(1471403360.719:9672): avc: denied { execute_no_trans } for pid=10298
comm=&quot;(amavisd)&quot; path=&quot;/usr/sbin/amavisd&quot; dev=&quot;xvda1&quot; ino=14629 scont ext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:antivirus_exec_t:s0 tclass=file permissive=1 type=AVC msg=audit(1471403360.721:9673): avc:
denied { ioctl } for pid=10298 comm=&quot;amavisd&quot; path=&quot;/usr/sbin/amavisd&quot; dev=&quot;xvda1&quot; ino=14629 ioctlcmd=5401 scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:antivirus_exec_t:s0 tclass=file permissive=1
type=AVC msg=audit(1471403361.676:9674): avc: denied { create } for pid=10300 comm=&quot;/usr/sbin/amavi&quot; name=&quot;amavisd.pid&quot; scontext=system_u:system_r:init_t:s0 tcontext=system_u:object_r:antivirus_var_run_t:s0 tclass=file
permissive=1 type=AVC msg=audit(1471403361.676:9675): avc: denied { write } for pid=10300 comm=&quot;/usr/sbin/amavi&quot; path=&quot;/run/amavisd/amavisd.pid&quot; dev=&quot;tmpfs&quot; ino=225714 scontext=system_u:system_r:init_t:s0
tcontext=system_u:object_r:antivirus_var_run_t:s0 tclass=file permissive=1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9646472</commentid>
<comment_count>4</comment_count>
<who name="Alan Hamilton">alanh</who>
<bug_when>2016-08-24 12:25:30 -0400</bug_when>
<thetext>Just FYI, the issue was a custom unit file in /etc/systemd/system. Resting the context on it didn&apos;t work, but copying the new unit file from /usr/lib/systemd/system and re-customizing it did. I&apos;m not sure exactly what was wrong
with the old file to prevent the transisition (it was from F23).</thetext>
</long_desc>

</bug>

</bugzilla>

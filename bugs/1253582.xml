<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1253582</bug_id>

    <creation_ts>2015-08-14 03:18:00 -0400</creation_ts>
    <short_desc>SELinux is preventing /usr/bin/docker from &apos;write&apos; accesses on the sock_file docker.sock.</short_desc>
    <delta_ts>2016-08-16 23:03:49 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>selinux-policy</component>
    <version>25</version>
    <rep_platform>x86_64</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard>abrt_hash:606e40316b29a160f53649bd83837f4b7ab0e8b2cde788ee262d8ccc939a6241</status_whiteboard>
    <keywords>Reopened</keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="William Brown">william</reporter>
    <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
    <cc>dominick.grift</cc>

    <cc>dwalsh</cc>

    <cc>lvrabec</cc>

    <cc>mgrepl</cc>

    <cc>plautrba</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>selinux-policy-3.13.1-208.fc25</cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-08-16 23:03:49</cf_last_closed>
<cf_type>---</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>8542019</commentid>
<comment_count>0</comment_count>
<who name="William Brown">william</who>
<bug_when>2015-08-14 03:18:59 -0400</bug_when>
<thetext>Description of problem: Running docker run commands as a confined selinux root user. SELinux is preventing /usr/bin/docker from &apos;write&apos; accesses on the sock_file docker.sock. ***** Plugin catchall (100. confidence) suggests
************************** If you believe that docker should be allowed write access on the docker.sock sock_file by default. Then you should report this as a bug. You can generate a local policy module to allow this access. Do allow this access for
now by executing: # grep docker /var/log/audit/audit.log | audit2allow -M mypol # semodule -i mypol.pp Additional Information: Source Context staff_u:sysadm_r:sysadm_t:s0-s0:c0.c1023 Target Context system_u:object_r:docker_var_run_t:s0 Target Objects
docker.sock [ sock_file ] Source docker Source Path /usr/bin/docker Port &lt;Unknown&gt; Host (removed) Source RPM Packages docker-1.7.1-8.gitb6416b7.fc22.x86_64 Target RPM Packages Policy RPM selinux-policy-3.13.1-128.8.fc22.noarch Selinux Enabled
True Policy Type targeted Enforcing Mode Permissive Host Name (removed) Platform Linux (removed) 4.2.0-0.rc2.git0.1.local.fc23.x86_64 #1 SMP Sat Jul 18 23:10:42 ACST 2015 x86_64 x86_64 Alert Count 10 First Seen 2015-08-14 15:49:23 ACST Last Seen
2015-08-14 16:48:10 ACST Local ID 8c598d76-f4e8-42f9-a808-3a40894513a7 Raw Audit Messages type=AVC msg=audit(1439536690.215:565): avc: denied { write } for pid=27409 comm=&quot;docker&quot; name=&quot;docker.sock&quot; dev=&quot;tmpfs&quot; ino=52076
scontext=staff_u:sysadm_r:sysadm_t:s0-s0:c0.c1023 tcontext=system_u:object_r:docker_var_run_t:s0 tclass=sock_file permissive=1 type=AVC msg=audit(1439536690.215:565): avc: denied { connectto } for pid=27409 comm=&quot;docker&quot;
path=&quot;/run/docker.sock&quot; scontext=staff_u:sysadm_r:sysadm_t:s0-s0:c0.c1023 tcontext=system_u:system_r:docker_t:s0 tclass=unix_stream_socket permissive=1 type=SYSCALL msg=audit(1439536690.215:565): arch=x86_64 syscall=connect success=yes
exit=0 a0=6 a1=c20802e490 a2=17 a3=0 items=0 ppid=27391 pid=27409 auid=1343600009 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts1 ses=1 comm=docker exe=/usr/bin/docker subj=staff_u:sysadm_r:sysadm_t:s0-s0:c0.c1023 key=(null) Hash:
docker,sysadm_t,docker_var_run_t,sock_file,write Version-Release number of selected component: selinux-policy-3.13.1-128.8.fc22.noarch Additional info: reporter: libreport-2.6.2 hashmarkername: setroubleshoot kernel:
4.2.0-0.rc2.git0.1.local.fc23.x86_64 type: libreport</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8542544</commentid>
<comment_count>1</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2015-08-14 06:29:00 -0400</bug_when>
<thetext>We should add this, but with current docker, talking to the docker daemon gives you full root access. At least on targeted policy systems.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8543144</commentid>
<comment_count>2</comment_count>
<who name="William Brown">william</who>
<bug_when>2015-08-14 10:13:01 -0400</bug_when>
<thetext>When you say full root, do you mean &quot;privileges beyond the confines of sysadm_t&quot;?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8543398</commentid>
<comment_count>3</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2015-08-14 11:32:55 -0400</bug_when>
<thetext>docker run -ti --privilged -v /:/host fedora chroot /host WIll give you a process running as root with spc_t label, which is an unconfined label. So yes more powerful then sysadm_t, (But only slightly)</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9526477</commentid>
<comment_count>4</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2016-07-19 13:30:26 -0400</bug_when>
<thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is no longer maintained, which means that it will not receive any further security or bug fix updates. As a result we are closing this bug. If you can reproduce this bug
against a currently maintained version of Fedora please feel free to reopen this bug against that version. If you are unable to reopen this bug, please file a new report against the current release. If you experience problems, please add a comment to
this bug. Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9531631</commentid>
<comment_count>5</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-07-20 06:42:13 -0400</bug_when>
<thetext>Created pull request https://github.com/fedora-selinux/selinux-policy/pull/137</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9532516</commentid>
<comment_count>6</comment_count>
<who name="Lukas Vrabec">lvrabec</who>
<bug_when>2016-07-20 09:50:34 -0400</bug_when>
<thetext>merged.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9549410</commentid>
<comment_count>7</comment_count>
<who name="Jan Kurik">jkurik</who>
<bug_when>2016-07-26 00:37:16 -0400</bug_when>
<thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle. Changing version to &apos;25&apos;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9611257</commentid>
<comment_count>8</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-12 10:17:52 -0400</bug_when>
<thetext>selinux-policy-3.13.1-208.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-662487f8f1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9611652</commentid>
<comment_count>9</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-12 11:56:15 -0400</bug_when>
<thetext>selinux-policy-3.13.1-208.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to
install test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-662487f8f1</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9620994</commentid>
<comment_count>10</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-16 23:02:14 -0400</bug_when>
<thetext>selinux-policy-3.13.1-208.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

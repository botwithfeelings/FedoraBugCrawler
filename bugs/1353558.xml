<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1353558</bug_id>

    <creation_ts>2016-07-07 08:53:00 -0400</creation_ts>
    <short_desc>Starting docker.service produces SELinux error op=security_compute_av perms=siginh</short_desc>
    <delta_ts>2016-09-02 19:19:59 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>kernel</component>
    <version>24</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Jan Pazdziora">jpazdziora</reporter>
    <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
    <cc>adimania</cc>

    <cc>admiller</cc>

    <cc>amurdaca</cc>

    <cc>dwalsh</cc>

    <cc>eparis</cc>

    <cc>gansalmon</cc>

    <cc>ichavero</cc>

    <cc>itamar</cc>

    <cc>jcajka</cc>

    <cc>jchaloup</cc>

    <cc>jonathan</cc>

    <cc>jpazdziora</cc>

    <cc>kernel-maint</cc>

    <cc>labbott</cc>

    <cc>lsm5</cc>

    <cc>madhu.chinakonda</cc>

    <cc>marianne</cc>

    <cc>mchehab</cc>

    <cc>miminar</cc>

    <cc>nalin</cc>

    <cc>pmoore</cc>

    <cc>riek</cc>

    <cc>sds</cc>

    <cc>vbatts</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>kernel-4.7.2-201.fc24</cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-09-02 16:52:43</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9487363</commentid>
<comment_count>0</comment_count>
<who name="Jan Pazdziora">jpazdziora</who>
<bug_when>2016-07-07 08:53:20 -0400</bug_when>
<thetext>Description of problem: Starting docker.service with systemctl produces SELinux error op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh
Version-Release number of selected component (if applicable): selinux-policy-3.13.1-191.fc24.3.noarch docker-1.10.3-21.git19b5791.fc24.x86_64 How reproducible: Deterministic. Steps to Reproduce: 1. systemctl start docker Actual results: SELinux error
type=SELINUX_ERR msg=audit(1467895329.542:133): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh Expected results: No SELinux error. Additional info:</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488557</commentid>
<comment_count>2</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-07-07 14:17:45 -0400</bug_when>
<thetext>On Rawhide or F24 I am seeing lots of these issues. type=SELINUX_ERR msg=audit(1467279926.188:1637): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh
type=SELINUX_ERR msg=audit(1467279927.251:1667): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467284272.194:89):
op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467284273.218:114): op=security_compute_av reason=bounds
scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467284274.977:202): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0
tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467322197.426:1000): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process
perms=siginh type=SELINUX_ERR msg=audit(1467322209.675:1004): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR
msg=audit(1467322310.560:1045): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467322320.960:1051): op=security_compute_av
reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467322443.190:1102): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0
tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467322447.295:1121): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process
perms=siginh type=SELINUX_ERR msg=audit(1467381662.616:1411): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR
msg=audit(1467381663.640:1415): op=security_compute_av reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467381668.565:1433): op=security_compute_av
reason=bounds scontext=system_u:system_r:init_t:s0 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=siginh type=SELINUX_ERR msg=audit(1467381733.630:1445): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c544,c880 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467382241.866:1471): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c478,c576 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467383542.071:1483): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c478,c576 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467383661.552:1504): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c499,c827 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467383745.386:1548): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c1,c2 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467383766.370:1570): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_qemu_net_t:s0:c595,c1023 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr type=SELINUX_ERR msg=audit(1467385202.122:1603): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c132,c826 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr Does not seem to block anything, but how do I get rid of them. Do I need to say docker_t is bounded by init_t?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488797</commentid>
<comment_count>3</comment_count>
<who name="Paul Moore">pmoore</who>
<bug_when>2016-07-07 16:07:19 -0400</bug_when>
<thetext>Without looking closely at the policy, any chance you could try one of the kernels below? * https://copr.fedorainfracloud.org/coprs/pcmoore/kernel-secnext</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488848</commentid>
<comment_count>4</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-07-07 16:28:43 -0400</bug_when>
<thetext>Here is the kernel I am running. 4.7.0-0.rc4.git1.1.fc25.x86_64 docker run fedora echo hello grep SELINUX_ERR /var/log/audit/audit.log type=SELINUX_ERR msg=audit(1467923289.773:1348): op=security_compute_av reason=bounds
scontext=system_u:system_r:svirt_lxc_net_t:s0:c188,c208 tcontext=system_u:system_r:docker_t:s0 tclass=process perms=getattr</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488860</commentid>
<comment_count>5</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-07-07 16:35:30 -0400</bug_when>
<thetext># grep SELINUX_ERR /var/log/audit/audit.log # docker run -it --rm --name tools1 -v /sys/fs/selinux:/sys/fs/selinux:ro --privileged --ipc=host --net=host --pid=host -e HOST=/host -e NAME=tools -e IMAGE=centos/tools -v /run:/run -v
/var/log:/var/log -v /etc/localtime:/etc/localtime -v /:/host centos/tools # exit # grep SELINUX_ERR /var/log/audit/audit.log # docker run fedora echo hello hello # grep SELINUX_ERR /var/log/audit/audit.log # uname -r
4.7.0-0.rc6.git0.1.1.secnext.fc25.x86_64 Seems like it is fixed in this kernel.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488909</commentid>
<comment_count>6</comment_count>
<who name="Paul Moore">pmoore</who>
<bug_when>2016-07-07 17:10:30 -0400</bug_when>
<thetext>Thanks for the testing help. The fix is the commit below which was just pushed as part of the patches for Linux 4.8. If this fix is urgent we would need to appeal to the Fedora Kernel guys to backport this patch, the good news is that it is
relatively self-contained and not likely to be problematic. commit 7ea59202db8d20806d9ae552acd1875c3a978bcc Author: Stephen Smalley &lt;sds@tycho.nsa.gov&gt; Date: Mon May 23 10:54:11 2016 -0400 selinux: Only apply bounds checking to source types The
current bounds checking of both source and target types requires allowing any domain that has access to the child domain to also have the same permissions to the parent, which is undesirable. Drop the target bounds checking. KaiGai Kohei originally
removed all use of target bounds in commit 7d52a155e38d (&quot;selinux: remove dead code in type_attribute_bounds_av()&quot;) but this was reverted in commit 2ae3ba39389b (&quot;selinux: libsepol: remove dead code in
check_avtab_hierarchy_callback()&quot;) because it would have required explicitly allowing the parent any permissions to the child that the child is allowed to itself. This change in contrast retains the logic for the case where both source and
target types are bounded, thereby allowing access if the parent of the source is allowed the corresponding permissions to the parent of the target. Further, this change reworks the logic such that we only perform a single computation for each case
and there is no ambiguity as to how to resolve a bounds violation. Under the new logic, if the source type and target types are both bounded, then the parent of the source type must be allowed the same permissions to the parent of the target type. If
only the source type is bounded, then the parent of the source type must be allowed the same permissions to the target type. Examples of the new logic and comparisons with the old logic: 1. If we have: typebounds A B; then: allow B self:process
&lt;permissions&gt;; will satisfy the bounds constraint iff: allow A self:process &lt;permissions&gt;; is also allowed in policy. Under the old logic, the allow rule on B satisfies the bounds constraint if any of the following three are allowed:
allow A B:process &lt;permissions&gt;; or allow B A:process &lt;permissions&gt;; or allow A self:process &lt;permissions&gt;; However, either of the first two ultimately require the third to satisfy the bounds constraint under the old logic, and
therefore this degenerates to the same result (but is more efficient - we only need to perform one compute_av call). 2. If we have: typebounds A B; typebounds A_exec B_exec; then: allow B B_exec:file &lt;permissions&gt;; will satisfy the bounds
constraint iff: allow A A_exec:file &lt;permissions&gt;; is also allowed in policy. This is essentially the same as #1; it is merely included as an example of dealing with object types related to a bounded domain in a manner that satisfies the bounds
relationship. Note that this approach is preferable to leaving B_exec unbounded and having: allow A B_exec:file &lt;permissions&gt;; in policy because that would allow B&apos;s entrypoints to be used to enter A. Similarly for _tmp or other related
types. 3. If we have: typebounds A B; and an unbounded type T, then: allow B T:file &lt;permissions&gt;; will satisfy the bounds constraint iff: allow A T:file &lt;permissions&gt;; is allowed in policy. The old logic would have been identical for
this example. 4. If we have: typebounds A B; and an unbounded domain D, then: allow D B:unix_stream_socket &lt;permissions&gt;; is not subject to any bounds constraints under the new logic because D is not bounded. This is desirable so that we can
allow a domain to e.g. connectto a child domain without having to allow it to do the same to its parent. The old logic would have required: allow D A:unix_stream_socket &lt;permissions&gt;; to also be allowed in policy. Signed-off-by: Stephen Smalley
&lt;sds@tycho.nsa.gov&gt; [PM: re-wrapped description to appease checkpatch.pl] Signed-off-by: Paul Moore &lt;paul@paul-moore.com&gt;</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9488924</commentid>
<comment_count>7</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-07-07 17:21:35 -0400</bug_when>
<thetext>No I don&apos;t see anything being blocked other then a bogus error message in the audit log. So most people will not see this, and can be fixed when this kernel makes its way upstream.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9617872</commentid>
<comment_count>8</comment_count>
<who name="Jan Pazdziora">jpazdziora</who>
<bug_when>2016-08-16 04:57:15 -0400</bug_when>
<thetext>Is the 4.8 kernel expected to come to Fedora 24 as well when it&apos;s released? Currently this bug blocks us from moving our automation from Fedora 23 to 24 (due to tests marked as failing) and I&apos;d like to plan future steps. Thank you, Jan</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9618768</commentid>
<comment_count>9</comment_count>
<who name="Paul Moore">pmoore</who>
<bug_when>2016-08-16 08:50:21 -0400</bug_when>
<thetext>(In reply to Jan Pazdziora from comment #8) &gt; Is the 4.8 kernel expected to come to Fedora 24 as well when it&apos;s released? That is something you will need to ask the Fedora Kernel Team, I only control the upstream bits.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9618806</commentid>
<comment_count>10</comment_count>
<who name="Daniel Walsh">dwalsh</who>
<bug_when>2016-08-16 08:59:50 -0400</bug_when>
<thetext>I am pretty sure they will update it when 4.8 is released.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9619264</commentid>
<comment_count>11</comment_count>
<who name="Laura Abbott">labbott</who>
<bug_when>2016-08-16 10:33:45 -0400</bug_when>
<thetext>Yes, F24 will eventually get the 4.8 kernel, That won&apos;t happen for at least a couple of months though given 4.8 is only at -rc2. Given the fix is in Linus&apos; tree, I&apos;m okay with bringing it in. I&apos;ll bring it in as part of
the 4.7 rebase which should happen either end of this week or next week.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9619300</commentid>
<comment_count>12</comment_count>
<who name="Jan Pazdziora">jpazdziora</who>
<bug_when>2016-08-16 10:37:27 -0400</bug_when>
<thetext>Thank you!</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9641229</commentid>
<comment_count>13</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-23 12:04:27 -0400</bug_when>
<thetext>kernel-4.7.2-200.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-c654464bce</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9642386</commentid>
<comment_count>14</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-23 16:10:07 -0400</bug_when>
<thetext>kernel-4.7.2-100.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2016-91e80601a0</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9646639</commentid>
<comment_count>15</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-24 13:25:09 -0400</bug_when>
<thetext>kernel-4.7.2-200.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-c654464bce</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9646722</commentid>
<comment_count>16</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-24 13:52:41 -0400</bug_when>
<thetext>kernel-4.7.2-100.fc23 has been pushed to the Fedora 23 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-91e80601a0</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9660104</commentid>
<comment_count>17</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-29 12:20:31 -0400</bug_when>
<thetext>kernel-4.7.2-201.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-2e5ebfed6d</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9660116</commentid>
<comment_count>18</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-29 12:22:45 -0400</bug_when>
<thetext>kernel-4.7.2-101.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2016-f1adaaadc6</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9667392</commentid>
<comment_count>19</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-31 08:58:24 -0400</bug_when>
<thetext>kernel-4.7.2-201.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-2e5ebfed6d</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9667402</commentid>
<comment_count>20</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-08-31 08:58:50 -0400</bug_when>
<thetext>kernel-4.7.2-101.fc23 has been pushed to the Fedora 23 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-f1adaaadc6</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9676215</commentid>
<comment_count>21</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-09-02 16:51:22 -0400</bug_when>
<thetext>kernel-4.7.2-201.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9676391</commentid>
<comment_count>22</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-09-02 19:19:59 -0400</bug_when>
<thetext>kernel-4.7.2-101.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

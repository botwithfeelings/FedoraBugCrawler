<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1268847</bug_id>

    <creation_ts>2015-10-05 08:34:00 -0400</creation_ts>
    <short_desc>ssh fails to connect to VPN hosts - hangs at &quot;expecting SSH2_MSG_KEX_ECDH_REPLY&quot;</short_desc>
    <delta_ts>2016-12-19 02:52:52 -0500</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>openconnect</component>
    <version>24</version>
    <rep_platform>x86_64</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened</keywords>
    <priority>unspecified</priority>
    <bug_severity>high</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Nineth">udayreddy</reporter>
    <assigned_to name="David Woodhouse">dwmw2</assigned_to>
    <cc>dcbw</cc>

    <cc>dwmw2</cc>

    <cc>marcodriusso</cc>

    <cc>nmavrogi</cc>

    <cc>psimerda</cc>

    <cc>rkhan</cc>

    <cc>thaller</cc>

    <cc>turchi</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>openconnect-7.08-1.fc25 openconnect-7.08-1.fc24</cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-12-19 01:02:47</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>8691937</commentid>
<comment_count>0</comment_count>
<who name="Nineth">udayreddy</who>
<bug_when>2015-10-05 08:34:12 -0400</bug_when>
<thetext>Description of problem: ssh fails to connect to hosts on the VPN; it hangs at &quot;debug1: expecting SSH2_MSG_KEX_ECDH_REPLY&quot; as shown by debug output with -vvv. Changing the vpn interface&apos;s MTU size to 1200 fixes the problem.
This problem exists for ssh to all servers on the VPN that I tried (running different OSs - Ubuntu, Cent OS) - so it has nothing to do with the server. I started noticing this after a big update to my packages after a long time. I never faced this
problem earlier through this VPN. Version-Release number of selected component (if applicable): NetworkManager-vpnc-1.0.2-1.fc22.x86_64 openssh-clients-6.9p1-7.fc22.x86_64 How reproducible: Always Steps to Reproduce: 1. ssh -vvv 2. 3. Actual results:
Hangs at debug1: expecting SSH2_MSG_KEX_ECDH_REPLY After a long time, the connection is closed. Expected results: Should have connected. Additional info:</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8695175</commentid>
<comment_count>1</comment_count>
<who name="Jirka Klimes">jklimes</who>
<bug_when>2015-10-06 07:29:38 -0400</bug_when>
<thetext>Can you try with NetworkManager-1.0.6-6.fc22? It fixed a bug for VPN MTU - bug 1244547.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8695494</commentid>
<comment_count>2</comment_count>
<who name="Nineth">udayreddy</who>
<bug_when>2015-10-06 09:05:13 -0400</bug_when>
<thetext>Works fine with NetworkManager-1.0.6-6.fc22. The MTU is set to 1406 (it was 1500 earlier).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8720375</commentid>
<comment_count>3</comment_count>
<who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
<bug_when>2015-10-14 10:49:02 -0400</bug_when>
<thetext>This package has changed ownership in the Fedora Package Database. Reassigning to the new owner of this component.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8816232</commentid>
<comment_count>4</comment_count>
<who name="Marco Driusso">marcodriusso</who>
<bug_when>2015-11-12 14:08:54 -0500</bug_when>
<thetext>I&apos;m facing the same bug, even with NetworkManager-1.0.6-7.fc22. Indeed, in my case, mtu 1406 is not sufficient for enabling a successful connection, and I have to set it to 1200. Ubuntu has a similar bug:
https://bugs.launchpad.net/ubuntu/+source/openssh/+bug/1254085. Some additional info: VPN type: openconnect NetworkManager-openconnect.x86_64 1.0.2-1.fc22 openconnect.x86_64 7.06-1.fc22</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9111220</commentid>
<comment_count>5</comment_count>
<who name="Gabriele Turchi">turchi</who>
<bug_when>2016-03-01 12:22:50 -0500</bug_when>
<thetext>I have the same problem with NetworkManager-1.0.10-2.fc22.x86_64 and vpnc. I need to set MTU to 1340, having default set to 1412. I suspect that could be better to allow the user to set this value by hand...</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9528299</commentid>
<comment_count>6</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2016-07-19 15:19:31 -0400</bug_when>
<thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is no longer maintained, which means that it will not receive any further security or bug fix updates. As a result we are closing this bug. If you can reproduce this bug
against a currently maintained version of Fedora please feel free to reopen this bug against that version. If you are unable to reopen this bug, please file a new report against the current release. If you experience problems, please add a comment to
this bug. Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9640669</commentid>
<comment_count>7</comment_count>
<who name="Marco Driusso">marcodriusso</who>
<bug_when>2016-08-23 10:28:27 -0400</bug_when>
<thetext>I&apos;m still experiencing the same bug in Fedora 24 (and I had it also in Fedora 23). It appears to be still unsolved also in Ubuntu (see link in comment 4, where workarounds are also proposed). Again, the workaround I use is lowering the
MTU for the vpn to 1200 with: # ip li set mtu 1200 dev vpn0 Info: NetworkManager.x86_64 1:1.2.4-2.fc24 NetworkManager-openconnect.x86_64 1.2.2-1.fc24 openconnect.x86_64 7.07-2.fc24</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9641043</commentid>
<comment_count>8</comment_count>
<who name="David Woodhouse">dwmw2</who>
<bug_when>2016-08-23 11:30:57 -0400</bug_when>
<thetext>It would be useful to know precisely what the problem is. Is OpenConnect not negotiating the correct MTU for its connection to your server... or is it just that your internal network is broken and a lower MTU happens to work around its
brokenness. After you SSH into the remote machine, can you put your MTU back *up* again, then attempt &apos;ping -M do&apos; with different packet sizes in both directions. Does your VPN server correctly send ICMP &apos;needs fragmentation&apos;
responses when you send a packet that&apos;s too large? If not, start by finding the idiot sysadmin and nailing it to the wall until it stops blocking ICMP....</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9646803</commentid>
<comment_count>9</comment_count>
<who name="Marco Driusso">marcodriusso</who>
<bug_when>2016-08-24 14:28:13 -0400</bug_when>
<thetext>Ok, some additional info. First, I tried to connect to the VPN using AnyConnect from Windows, and there the MTU is 1406, which is the same value set by openconnect and that generates the ssh problem. I tried what asked in comment 8, but
unfortunately it seems that ICMP is blocked, since I don&apos;t get any answer from the VPN server. Anyway, find below the results: 1) First I access the VPN through openconnect (NetworkManager), having: [me@local ~]$ ip addr list ... 8: vpn0:
&lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1406 qdisc fq_codel state UP group default qlen 500 link/none inet 172.30.224.1/24 brd 172.30.224.255 scope global vpn0 valid_lft forever preferred_lft forever inet6 fe80::bdc:9f50:b231:19bf/64
scope link flags 800 valid_lft forever preferred_lft forever 2) Then I decrease the MTU in order to be able to access the remote node with ssh. I discovered that the maximum value for the MTU in order to ssh the remote node is 1386 (don&apos;t know
where this comes from). Hence, after: [me@local ~]$ sudo ip li set mtu 1386 dev vpn0 I have: [me@local ~]$ ip addr list ... 8: vpn0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1386 qdisc fq_codel state UP group default qlen 500 link/none
inet 172.30.224.1/24 brd 172.30.224.255 scope global vpn0 valid_lft forever preferred_lft forever inet6 fe80::bdc:9f50:b231:19bf/64 scope link flags 800 valid_lft forever preferred_lft forever 3) Now I ssh the remote node, and increase again the MTU,
in order to have again the same situation of point 1). 4) Then, ping from local (172.30.224.1) to remote (172.30.50.172), obtaining: [me@local ~]$ ping 172.30.50.172 -c 3 -M do -s 1358 PING 172.30.50.172 (172.30.50.172) 1358(1386) bytes of data. 1366
bytes from 172.30.50.172: icmp_seq=1 ttl=63 time=70.2 ms 1366 bytes from 172.30.50.172: icmp_seq=2 ttl=63 time=70.5 ms 1366 bytes from 172.30.50.172: icmp_seq=3 ttl=63 time=73.4 ms --- 172.30.50.172 ping statistics --- 3 packets transmitted, 3
received, 0% packet loss, time 2002ms rtt min/avg/max/mdev = 70.233/71.422/73.494/1.470 ms [me@local ~]$ ping 172.30.50.172 -c 3 -M do -s 1359 PING 172.30.50.172 (172.30.50.172) 1359(1387) bytes of data. --- 172.30.50.172 ping statistics --- 3
packets transmitted, 0 received, 100% packet loss, time 1999ms 5) Finally, ping from remote (172.30.50.172) to local (172.30.224.1), obtaining: [me@remote ~]$ ping 172.30.224.1 -c 3 -M do -s 1358 PING 172.30.224.1 (172.30.224.1) 1358(1386) bytes of
data. 1366 bytes from 172.30.224.1: icmp_req=1 ttl=63 time=71.1 ms 1366 bytes from 172.30.224.1: icmp_req=2 ttl=63 time=70.2 ms 1366 bytes from 172.30.224.1: icmp_req=3 ttl=63 time=121 ms --- 172.30.224.1 ping statistics --- 3 packets transmitted, 3
received, 0% packet loss, time 2002ms rtt min/avg/max/mdev = 70.259/87.630/121.472/23.933 ms [me@remote ~]$ ping 172.30.224.1 -c 3 -M do -s 1359 PING 172.30.224.1 (172.30.224.1) 1359(1387) bytes of data. --- 172.30.224.1 ping statistics --- 3 packets
transmitted, 0 received, 100% packet loss, time 2014ms</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9984417</commentid>
<comment_count>10</comment_count>
<who name="David Woodhouse">dwmw2</who>
<bug_when>2016-12-14 07:04:26 -0500</bug_when>
<thetext>OpenConnect 7.08 has automatic MTU detection. Does it fix this?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9984712</commentid>
<comment_count>11</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-14 07:57:36 -0500</bug_when>
<thetext>openconnect-7.08-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-236fdd6917</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9984717</commentid>
<comment_count>12</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-14 07:58:35 -0500</bug_when>
<thetext>openconnect-7.08-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4e680d77fa</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9988351</commentid>
<comment_count>13</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-15 00:04:03 -0500</bug_when>
<thetext>openconnect-7.08-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-4e680d77fa</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9988402</commentid>
<comment_count>14</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-15 00:07:40 -0500</bug_when>
<thetext>openconnect-7.08-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install test
updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-236fdd6917</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9991227</commentid>
<comment_count>15</comment_count>
<who name="Marco Driusso">marcodriusso</who>
<bug_when>2016-12-15 15:24:02 -0500</bug_when>
<thetext>(In reply to David Woodhouse from comment #10) &gt; OpenConnect 7.08 has automatic MTU detection. Does it fix this? Yes, openconnect-7.08-1.fc24 fixes it, many thanks!</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9997187</commentid>
<comment_count>16</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-19 01:02:47 -0500</bug_when>
<thetext>openconnect-7.08-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9997358</commentid>
<comment_count>17</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-12-19 02:52:52 -0500</bug_when>
<thetext>openconnect-7.08-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1259559</bug_id>
          
          <creation_ts>2015-09-02 23:49:00 -0400</creation_ts>
          <short_desc>VMs get stuck at Waiting for SSH when ssh-agent is running and has a ed25519 key</short_desc>
          <delta_ts>2017-01-09 03:46:52 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>vagrant-libvirt</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>WONTFIX</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1369491</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Randy Barlow">rbarlow</reporter>
          <assigned_to name="Vít Ondruch">vondruch</assigned_to>
          <cc>dima85</cc>
    
    
    <cc>hhorak</cc>
    
    
    <cc>jshubin</cc>
    
    
    <cc>madam</cc>
    
    
    <cc>matej</cc>
    
    
    <cc>randy</cc>
    
    
    <cc>vondruch</cc>
    
    
    <cc>xtr.xtrnet</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-09 03:46:52</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8600920</commentid>
    <comment_count>0</comment_count>
      <attachid>1069620</attachid>
    <who name="Randy Barlow">rbarlow</who>
    <bug_when>2015-09-02 23:49:31 -0400</bug_when>
    <thetext>Created attachment 1069620
Vagrantfile

Description of problem:
On rawhide I have a very repeatable problem where vagrant-libvirt never thinks the guest VM&apos;s ssh server is running and sits forever at &quot;Waiting for SSH to become available...&quot;. The SSH server is running in the guest, as I can ssh to it from the host and it answers and allows me to login. I&apos;ve attached a simple Vagrantfile that demonstrates the issue.

Version-Release number of selected component (if applicable):
vagrant-libvirt-0.0.30-2.fc23.noarch

How reproducible:
Every time

Steps to Reproduce:
1. Put the attached Vagrantfile into an empty directory
2. $ vagrant up

Actual results:
The echo statement in the Vagrantfile will not execute, and the vagrant up command will get stuck at the &quot;Waiting for SSH&quot; message.

Expected results:
The echo statement should execute, and the vagrant up command should finish successfully.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8600926</commentid>
    <comment_count>1</comment_count>
    <who name="Randy Barlow">rbarlow</who>
    <bug_when>2015-09-02 23:54:52 -0400</bug_when>
    <thetext>The upstream bug report is here: https://github.com/pradels/vagrant-libvirt/issues/452</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8631673</commentid>
    <comment_count>2</comment_count>
    <who name="Josef Stribny">jstribny</who>
    <bug_when>2015-09-14 04:50:41 -0400</bug_when>
    <thetext>I&apos;ve just tried this:

[strzibny@jstribnyntb test]$ vagrant up
Bringing machine &apos;default&apos; up with &apos;libvirt&apos; provider...
==&gt; default: Box &apos;http://download.gluster.org/pub/gluster/purpleidea/vagrant/fedora-22/fedora-22.box&apos; could not be found. Attempting to find and install...
    default: Box Provider: libvirt
    default: Box Version: &gt;= 0
==&gt; default: Adding box &apos;http://download.gluster.org/pub/gluster/purpleidea/vagrant/fedora-22/fedora-22.box&apos; (v0) for provider: libvirt
    default: Downloading: http://download.gluster.org/pub/gluster/purpleidea/vagrant/fedora-22/fedora-22.box
==&gt; default: Successfully added box &apos;http://download.gluster.org/pub/gluster/purpleidea/vagrant/fedora-22/fedora-22.box&apos; (v0) for &apos;libvirt&apos;!
==&gt; default: Uploading base box image as volume into libvirt storage...
==&gt; default: Creating image (snapshot of base box volume).
==&gt; default: Creating domain with the following settings...
==&gt; default:  -- Name:              test_default
==&gt; default:  -- Domain type:       kvm
==&gt; default:  -- Cpus:              1
==&gt; default:  -- Memory:            512M
==&gt; default:  -- Base box:          http://download.gluster.org/pub/gluster/purpleidea/vagrant/fedora-22/fedora-22.box
==&gt; default:  -- Storage pool:      default
==&gt; default:  -- Image:             /var/lib/libvirt/images/test_default.img
==&gt; default:  -- Volume Cache:      default
==&gt; default:  -- Kernel:            
==&gt; default:  -- Initrd:            
==&gt; default:  -- Graphics Type:     vnc
==&gt; default:  -- Graphics Port:     5900
==&gt; default:  -- Graphics IP:       127.0.0.1
==&gt; default:  -- Graphics Password: Not defined
==&gt; default:  -- Video Type:        cirrus
==&gt; default:  -- Video VRAM:        9216
==&gt; default:  -- Keymap:            en-us
==&gt; default:  -- Command line : 
==&gt; default: Starting domain.
==&gt; default: Waiting for domain to get an IP address...
==&gt; default: Waiting for SSH to become available...
    default: 
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default: 
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if its present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==&gt; default: Starting domain.
==&gt; default: Waiting for domain to get an IP address...
==&gt; default: Waiting for SSH to become available...
==&gt; default: Creating shared folders metadata...
==&gt; default: Rsyncing folder: /home/strzibny/tmp/test/ =&gt; /vagrant
==&gt; default: Configuring and enabling network interfaces...
==&gt; default: Running provisioner: shell...
    default: Running: inline script
==&gt; default: This won&apos;t happen


Works fine. 

I am running:

$ rpm -q vagrant
vagrant-1.7.2-9.fc22.noarch
$ rpm -q vagrant-libvirt
vagrant-libvirt-0.0.26-3.fc22.noarch

Do you have any real reproducer for me? Otherwise I am not sure why it fails for you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8633765</commentid>
    <comment_count>3</comment_count>
    <who name="Randy Barlow">rbarlow</who>
    <bug_when>2015-09-14 14:12:14 -0400</bug_when>
    <thetext>I changed the subject of this bug to better reflect what has been noted on the upstream bug report. It seems to be related to my use of the ed25519 ssh key. See if you can reproduce with these steps:

0) Create an ed25519 ssh key.
1) Start ssh-agent.
2) Add the ed25519 to the running ssh-agent with ssh-add.
3) Use the example Vagrant file, and vagrant up.

I&apos;m not sure if it matters, but I am also using vagrant and vagrant-libvirt from Rawhide.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9094259</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 10:30:58 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9646024</commentid>
    <comment_count>5</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2016-08-24 10:27:53 -0400</bug_when>
    <thetext>Since you are referencing bug 1369491, did you have a chance to test F25+, since I updated the rubygem-net-ssh there ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9647032</commentid>
    <comment_count>6</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-08-24 16:04:08 -0400</bug_when>
    <thetext>Hello Vit!

I have not tested this on F25, but I do have plans to update one of my Vagrant systems to F25 soon. I&apos;ll report back here when I do (probably a couple or three weeks).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9677398</commentid>
    <comment_count>7</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-09-04 00:32:01 -0400</bug_when>
    <thetext>Hello Vit! I tested this on Fedora 25 tonight, and it worked there. You may still want to fix it on Fedora 24, but I&apos;ll leave that decision to you. Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9678749</commentid>
    <comment_count>8</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2016-09-05 03:52:10 -0400</bug_when>
    <thetext>(In reply to Randy Barlow from comment #7)
&gt; Hello Vit! I tested this on Fedora 25 tonight, and it worked there.

Thx for testing and confirmation.

&gt; You may
&gt; still want to fix it on Fedora 24, but I&apos;ll leave that decision to you.
&gt; Thanks!

Frankly, I consider this niche issue, so I&apos;d prefer to close the ticket, especially if net-ssh rebase is required, which could break other things.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9757546</commentid>
    <comment_count>9</comment_count>
    <who name="Matěj Koudelka">matej</who>
    <bug_when>2016-09-30 10:00:49 -0400</bug_when>
    <thetext>I have same problem on Fedora24 with libvirt box Centos7. The problem is in wrong rights of new authorized_keys file.
Try log in as user vagrant  using default password (&apos;vagrant&apos;) and change rights of file &apos;chmod 600 ~/.ssh/authorized_keys&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9760702</commentid>
    <comment_count>10</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2016-10-03 07:06:48 -0400</bug_when>
    <thetext>(In reply to Matěj Koudelka from comment #9)
Your might experience similar symptoms, but from your description, comparing to comment 3, it seems to be different one.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9760949</commentid>
    <comment_count>11</comment_count>
    <who name="Matěj Koudelka">matej</who>
    <bug_when>2016-10-03 08:23:34 -0400</bug_when>
    <thetext>(In reply to Vít Ondruch from comment #10)
&gt; (In reply to Matěj Koudelka from comment #9)
&gt; Your might experience similar symptoms, but from your description, comparing
&gt; to comment 3, it seems to be different one.

OK</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10042238</commentid>
    <comment_count>12</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2017-01-06 22:39:44 -0500</bug_when>
    <thetext>Vit I won&apos;t personally mind if you want to close this ticket. I&apos;ve moved my primary Vagrant host to Fedora 25, so I don&apos;t hit this issue often anymore.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10044377</commentid>
    <comment_count>13</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2017-01-09 03:46:52 -0500</bug_when>
    <thetext>(In reply to Randy Barlow from comment #12)
&gt; Vit I won&apos;t personally mind if you want to close this ticket. I&apos;ve moved my
&gt; primary Vagrant host to Fedora 25, so I don&apos;t hit this issue often anymore.

Thank you. I&apos;m closing this now.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1069620</attachid>
            <date>2015-09-02 23:49:00 -0400</date>
            <delta_ts>2015-09-02 23:49:31 -0400</delta_ts>
            <desc>Vagrantfile</desc>
            <filename>Vagrantfile</filename>
            <type>text/plain</type>
            <size>350</size>
            <attacher name="Randy Barlow">rbarlow</attacher>
            
              <data encoding="base64">IyAtKi0gbW9kZTogcnVieSAtKi0KIyB2aTogc2V0IGZ0PXJ1YnkgOgoKVkFHUkFOVEZJTEVfQVBJ
X1ZFUlNJT04gPSAiMiIKClZhZ3JhbnQuY29uZmlndXJlKFZBR1JBTlRGSUxFX0FQSV9WRVJTSU9O
KSBkbyB8Y29uZmlnfAogY29uZmlnLnZtLmJveCA9ICJodHRwczovL2Rvd25sb2FkLmdsdXN0ZXIu
b3JnL3B1Yi9nbHVzdGVyL3B1cnBsZWlkZWEvdmFncmFudC9mZWRvcmEtMjIvZmVkb3JhLTIyLmJv
eCIKCiBjb25maWcudm0ucHJvdmlkZXIgOmxpYnZpcnQgZG8gfGRvbWFpbnwKIGVuZAoKIGNvbmZp
Zy52bS5wcm92aXNpb24gInNoZWxsIiwgaW5saW5lOiAiZWNobyBcIlRoaXMgd29uJ3QgaGFwcGVu
XCIiCmVuZAo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
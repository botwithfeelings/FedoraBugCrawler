<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1309346</bug_id>
          
          <creation_ts>2016-02-17 09:31:00 -0500</creation_ts>
          <short_desc>arm64: unhandled instruction 0x694004A2 (ldpsw) causes check failure while building hawkey</short_desc>
          <delta_ts>2016-03-26 14:06:02 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>valgrind</component>
          <version>24</version>
          <rep_platform>aarch64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>922257</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Marcin Juszkiewicz">mjuszkie</reporter>
          <assigned_to name="Mark Wielaard">mjw</assigned_to>
          <cc>dodji</cc>
    
    
    <cc>jakub</cc>
    
    
    <cc>mjw</cc>
    
    
    <cc>mjw</cc>
    
    
    <cc>pbrobinson</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>valgrind-3.11.0-18.fc23 valgrind-3.11.0-18.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-24 21:24:36</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="KDE Software Compilation">360425</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9072195</commentid>
    <comment_count>0</comment_count>
    <who name="Marcin Juszkiewicz">mjuszkie</who>
    <bug_when>2016-02-17 09:31:06 -0500</bug_when>
    <thetext>Description of problem:

During build of hawkey hawkey-0.6.2-4.fc24 valgrind fails with unhandled instruction:

1: ARM64 front end: load_store
1: disInstr(arm64): unhandled instruction 0x694004A2
1: disInstr(arm64): 0110&apos;1001 0100&apos;0000 0000&apos;0100 1010&apos;0010
1: ==29033== valgrind: Unrecognised instruction at address 0x4ad1260.
1: ==29033==    at 0x4AD1260: __mktime_internal (in /usr/lib64/libc-2.22.90.so)
1: ==29033==    by 0x49FFA9F: ??? (in /usr/lib64/libsolvext.so.0)
1: ==29033==    by 0x4F385EB: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F38EA3: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3A10F: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3A733: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3C3E7: XML_ParseBuffer (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4A0055B: repo_add_updateinfoxml (in /usr/lib64/libsolvext.so.0)
1: ==29033==    by 0x48C23A7: load_updateinfo_cb (sack.c:384)
1: ==29033==    by 0x48C3B8B: load_ext (sack.c:349)
1: ==29033==    by 0x48C42DB: hy_sack_load_repo (sack.c:1046)
1: ==29033==    by 0x18727F: setup_yum_sack (fixtures.c:193)
1: ==29033== Your program just tried to execute an instruction that Valgrind
1: ==29033== did not recognise.  There are two possible reasons for this.
1: ==29033== 1. Your program has a bug and erroneously jumped to a non-code
1: ==29033==    location.  If you are running Memcheck and you just saw a
1: ==29033==    warning about a bad jump, it&apos;s probably your program&apos;s fault.
1: ==29033== 2. The instruction is legitimate but Valgrind doesn&apos;t handle it,
1: ==29033==    i.e. it&apos;s Valgrind&apos;s fault.  If you think this is the case or
1: ==29033==    you are not sure, please let us know and we&apos;ll try to fix it.
1: ==29033== Either way, Valgrind will now raise a SIGILL signal which will
1: ==29033== probably kill your program.
1: ==29033== 
1: ==29033== Process terminating with default action of signal 4 (SIGILL)
1: ==29033==  Illegal opcode at address 0x4AD1260
1: ==29033==    at 0x4AD1260: __mktime_internal (in /usr/lib64/libc-2.22.90.so)
1: ==29033==    by 0x49FFA9F: ??? (in /usr/lib64/libsolvext.so.0)
1: ==29033==    by 0x4F385EB: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F38EA3: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3A10F: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3A733: ??? (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4F3C3E7: XML_ParseBuffer (in /usr/lib64/libexpat.so.1.6.0)
1: ==29033==    by 0x4A0055B: repo_add_updateinfoxml (in /usr/lib64/libsolvext.so.0)
1: ==29033==    by 0x48C23A7: load_updateinfo_cb (sack.c:384)
1: ==29033==    by 0x48C3B8B: load_ext (sack.c:349)
1: ==29033==    by 0x48C42DB: hy_sack_load_repo (sack.c:1046)
1: ==29033==    by 0x18727F: setup_yum_sack (fixtures.c:193)
1: ==29033== 

Version-Release number of selected component (if applicable):

valgrind-3.11.0-12.fc24

How reproducible:

always

Steps to Reproduce:
1. do a build of hawkey on aarch64

Actual results:

build fails

Expected results:

build works

Additional info:

There is also warning about missing syscall but patching valgrind to handle it does not change situation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9073043</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2016-02-17 14:33:29 -0500</bug_when>
    <thetext>Would you be able to use valgrind with gdb (http://valgrind.org/docs/manual/manual-core-adv.html#manual-core-adv.gdbserver-gdb) or otherwise disassemble 0x4AD1260: __mktime_internal libc-2.22.90.so to give the actual instruction?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9073409</commentid>
    <comment_count>2</comment_count>
    <who name="Marcin Juszkiewicz">mjuszkie</who>
    <bug_when>2016-02-17 17:17:02 -0500</bug_when>
    <thetext>   a1260:	694004a2 	ldpsw	x2, x1, [x5]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9073488</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2016-02-17 17:45:01 -0500</bug_when>
    <thetext>Yes looks like valgrind supports ldp, but not ldpsw.
Do you happen to know whether this is an AArch64 8.1 extension?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9074577</commentid>
    <comment_count>4</comment_count>
    <who name="Marcin Juszkiewicz">mjuszkie</who>
    <bug_when>2016-02-18 04:03:50 -0500</bug_when>
    <thetext>No idea is it 8.1 or 8.0 instruction. My hardware is 8.0 for sure (APM X-Gene).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9094148</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 10:24:40 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9147466</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2016-03-14 16:15:18 -0400</bug_when>
    <thetext>Proposed a patch upstream: https://bugs.kde.org/show_bug.cgi?id=360425</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9147760</commentid>
    <comment_count>7</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2016-03-14 19:22:56 -0400</bug_when>
    <thetext>I did a scratch build of valgrind-3.11.0-18.fc25 for aarch64:
http://arm.koji.fedoraproject.org/koji/taskinfo?taskID=3457331
Which contains the proposed patch for this issue and some other arm64 fixes.
If you could try it out to see if it resolves this issue that would be appreciated.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9148768</commentid>
    <comment_count>8</comment_count>
    <who name="Marcin Juszkiewicz">mjuszkie</who>
    <bug_when>2016-03-15 05:52:05 -0400</bug_when>
    <thetext>Wrote: /builddir/build/RPMS/hawkey-0.6.2-4.fc24.aarch64.rpm

With -18 valgrind ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150378</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-15 14:39:41 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-ba7dc44867</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150393</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-15 14:44:45 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2016-0186345d7f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150841</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-15 17:29:33 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-ba7dc44867</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9153536</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-16 11:22:54 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc23 has been pushed to the Fedora 23 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-0186345d7f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9178396</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-24 21:24:29 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9180241</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-26 14:05:55 -0400</bug_when>
    <thetext>valgrind-3.11.0-18.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
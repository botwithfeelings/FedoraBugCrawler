<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1374925</bug_id>
          
          <creation_ts>2016-09-10 08:54:00 -0400</creation_ts>
          <short_desc>why is pypolicyd-spf on F24 still using python2</short_desc>
          <delta_ts>2017-02-04 11:33:14 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>pypolicyd-spf</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Harald Reindl">h.reindl</reporter>
          <assigned_to name="Bojan Smojver">bojan</assigned_to>
          <cc>bojan</cc>
    
    
    <cc>don.allen</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>pypolicyd-spf-2.0.1-1.fc25 pypolicyd-spf-2.0.1-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-28 19:20:10</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9696132</commentid>
    <comment_count>0</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-09-10 08:54:00 -0400</bug_when>
    <thetext>upstream supports python3 which is the default in Fedora 24 for over 4 years now but F24 is stlll using python2 leading you can&apos;t get rid off python2 and have the whole python3 stack additional on small machines becasue of system deps like dnf


https://launchpad.net/pypolicyd-spf/+announcement/10352
pypolicyd-spf now supports Python 3

Written for pypolicyd-spf by Scott Kitterman on 2012-07-22

As of version 1.1, released today, pypolicyd-spf can be run with any of python2.6, python2.7, and python3.2.

Version 1.1 is functionally identical to version 1.0, so there is no need to upgrade unless you prefer to use Python 3. Users of older Python versions (python2.4 and python2.5 will need to stay with version 1.0).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9696516</commentid>
    <comment_count>1</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-09-11 00:48:56 -0400</bug_when>
    <thetext>Inertia. Lack of dependencies in python3 in the past. Laziness of the maintainer. Take your pick. :-)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9817967</commentid>
    <comment_count>2</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-10-25 01:53:14 -0400</bug_when>
    <thetext>I just had a quick peek at this today. Essentially, there is package python-pyspf in Fedora, which is a python2 package. So, unless we get that built for python3, we won&apos;t have this package running under python3.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9936767</commentid>
    <comment_count>3</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-28 19:34:48 -0500</bug_when>
    <thetext>Please see:

http://koji.fedoraproject.org/koji/buildinfo?buildID=820968

Totally untested, so any feedback is very welcome.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9936808</commentid>
    <comment_count>4</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-28 19:54:22 -0500</bug_when>
    <thetext>i would need an F24 scratch-build to install it on my testserver</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9936894</commentid>
    <comment_count>5</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-28 20:41:10 -0500</bug_when>
    <thetext>Unfortunately, python3-pyspf is only available for F26. So, probably the &quot;easiest&quot; thing to do is to grab that from F26 (still built as python-pyspf, but contains both python2 and python3 stuff) and try to install alongside pypolicyd-spf from F26.

Not quite sure whether that will try to pull in a whole lot of other stuff, but it&apos;s worth a try.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9936936</commentid>
    <comment_count>6</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-28 20:48:01 -0500</bug_when>
    <thetext>Cannot speak for F24, because I have none lying around any more, but this is what happens on F25:

# dnf install https://kojipkgs.fedoraproject.org//packages/pypolicyd-spf/1.3.2/4.fc26/noarch/pypolicyd-spf-1.3.2-4.fc26.noarch.rpm https://kojipkgs.fedoraproject.org//packages/python-pyspf/2.0.12/1.fc26/noarch/python3-pyspf-2.0.12-1.fc26.noarch.rpm
Last metadata expiration check: 2:54:31 ago on Tue Nov 29 09:52:15 2016.
Dependencies resolved.
================================================================================
 Package              Arch         Version             Repository          Size
================================================================================
Installing:
 python3-py3dns       noarch       3.0.4-8.fc25        fedora              47 k
 python3-pyspf        noarch       2.0.12-1.fc26       @commandline        52 k
Upgrading:
 pypolicyd-spf        noarch       1.3.2-4.fc26        @commandline        48 k

Transaction Summary
================================================================================
Install  2 Packages
Upgrade  1 Package

Total size: 148 k
Total download size: 47 k
Is this ok [y/N]:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9936975</commentid>
    <comment_count>7</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-28 21:07:25 -0500</bug_when>
    <thetext>Had to also add:

https://kojipkgs.fedoraproject.org//packages/python-pyspf/2.0.12/1.fc26/noarch/python2-pyspf-2.0.12-1.fc26.noarch.rpm

To that dnf install. This replaces existing F25 python-pyspf, in order to avoid conflicts.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9937714</commentid>
    <comment_count>8</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-29 02:42:47 -0500</bug_when>
    <thetext>how does it matter if you have F24 lying around for a https://fedoraproject.org/wiki/Using_the_Koji_build_system#Scratch_Builds while it matters that i as reporter hd a good reason to choose F24 for that bugreport and have no F25/F26 lying around which won&apos;t change in the next few months and my intention is to red rid of Python2 on our inbound mailserver aka production machine while on my testmachines it&apos;s neeeded anyways because of tue un-usability of DNF in borercases</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9937756</commentid>
    <comment_count>9</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 03:00:13 -0500</bug_when>
    <thetext>I don&apos;t have F24 lying around to test F26 builds. I tested them on F25 and they work.

Have you tried them on F24?

If they work for you, then we can ask the maintainer of pyspf to backport and do everything properly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938463</commentid>
    <comment_count>10</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-29 05:56:16 -0500</bug_when>
    <thetext>you can install the packages with &quot;dnf install&quot; since dnf update &quot;still don&apos;t work&quot; (https://bugzilla.redhat.com/show_bug.cgi?id=1263888#c63) but as explected F26 builds don&apos;t run well at F24

*please* read https://fedoraproject.org/wiki/Using_the_Koji_build_system#Scratch_Builds

Nov 29 11:54:31 testserver postfix/spawn[18157]: warning: command /usr/bin/python exit status 1
Nov 29 11:54:31 testserver postfix/smtpd[18151]: warning: premature end-of-input on private/spf-policy-info while reading input attribute name
Nov 29 11:54:32 testserver postfix/spawn[18157]: warning: command /usr/bin/python exit status 1
Nov 29 11:54:32 testserver postfix/smtpd[18151]: warning: premature end-of-input on private/spf-policy-info while reading input attribute name
Nov 29 11:54:32 testserver postfix/smtpd[18151]: warning: problem talking to server private/spf-policy-info: Connection reset by peer</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938509</commentid>
    <comment_count>11</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 06:10:27 -0500</bug_when>
    <thetext>I know how to build scratch builds.

What is interesting is the fact /usr/bin/python is dying. Not sure how that&apos;s happening when F26 package executable has /usr/bin/python3 in the shebang line.

I can make you a scratch build for F24, but unless you also rebuild pyspf for F24, you&apos;ll still have to use that F26 build for testing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938513</commentid>
    <comment_count>12</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-29 06:12:42 -0500</bug_when>
    <thetext>we need srcatch build for the depending packages too - it makes just no sense to play around on F24 machines in context of a F24 bugreport with F26 packages from the start</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938546</commentid>
    <comment_count>13</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 06:25:32 -0500</bug_when>
    <thetext>I don&apos;t maintain the other package. I think your best bet is to rebuild both locally and give it a try.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938582</commentid>
    <comment_count>14</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-29 06:41:36 -0500</bug_when>
    <thetext>sorry but then i have to wait another two years while that changes should have happened for Fedora 23 and not Fedora 26

https://fedoraproject.org/wiki/Changes/Python_3_as_Default</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9938661</commentid>
    <comment_count>15</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 07:04:32 -0500</bug_when>
    <thetext>I am planning on backporting this to F24/25, but pyspf maintainer will have to rebuild that first (not hard).

Not everything was ported to python3 in F23. If I remember correctly, we were still mucking about with ipaddr/up address stuff at that point, maybe even later.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9940954</commentid>
    <comment_count>16</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 19:25:39 -0500</bug_when>
    <thetext>(In reply to Harald Reindl from comment #10)

&gt; Nov 29 11:54:31 testserver postfix/spawn[18157]: warning: command
&gt; /usr/bin/python exit status 1

Can I just ask regarding this, what is in your /etc/postfix/master.cf file when it comes to policyd-spf? The first line of /usr/libexec/postfix/policyd-spf is:

#!/usr/bin/python3 -s

No idea why /usr/bin/python would be invoked on your machine. On my F25 machine, that is a symlink to python2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9940959</commentid>
    <comment_count>17</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-11-29 19:28:30 -0500</bug_when>
    <thetext>why is this still a symlink to python2
that&apos;s not really portable in case of &quot;Python_3_as_Default&quot;

[root@testserver:~]$ cat /etc/postfix/master.cf | grep spf
spf-policy-info unix  -       n       n       -        0      spawn user=nobody argv=/usr/bin/python /usr/libexec/postfix/policyd-spf /etc/python-policyd-spf/policyd-spf-noreject.conf
spf-policy      unix  -       n       n       -        0      spawn user=nobody argv=/usr/bin/python /usr/libexec/postfix/policyd-spf /etc/python-policyd-spf/policyd-spf.conf</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9941007</commentid>
    <comment_count>18</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-11-29 19:56:28 -0500</bug_when>
    <thetext>(In reply to Harald Reindl from comment #17)
&gt; why is this still a symlink to python2
&gt; that&apos;s not really portable in case of &quot;Python_3_as_Default&quot;

Cannot really answer that, to be honest. I don&apos;t make such decisions.

&gt; [root@testserver:~]$ cat /etc/postfix/master.cf | grep spf
&gt; spf-policy-info unix  -       n       n       -        0      spawn
&gt; user=nobody argv=/usr/bin/python /usr/libexec/postfix/policyd-spf
&gt; /etc/python-policyd-spf/policyd-spf-noreject.conf
&gt; spf-policy      unix  -       n       n       -        0      spawn
&gt; user=nobody argv=/usr/bin/python /usr/libexec/postfix/policyd-spf
&gt; /etc/python-policyd-spf/policyd-spf.conf

Try removing /usr/bin/python from argv and running that again. Python3 should then be picked up by the script and so should the relevant pyspf python3 stuff.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9945787</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-30 22:17:55 -0500</bug_when>
    <thetext>pypolicyd-spf-1.3.2-4.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-12ccd1d81c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9945789</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-30 22:18:05 -0500</bug_when>
    <thetext>pypolicyd-spf-1.3.2-4.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-c4082feb27</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9952905</commentid>
    <comment_count>21</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-02 23:34:26 -0500</bug_when>
    <thetext>pypolicyd-spf-1.3.2-4.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-12ccd1d81c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9953011</commentid>
    <comment_count>22</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-03 00:41:02 -0500</bug_when>
    <thetext>pypolicyd-spf-1.3.2-4.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-c4082feb27</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9953346</commentid>
    <comment_count>23</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-12-03 07:23:24 -0500</bug_when>
    <thetext>looks good and the also &quot;python2-pyspf&quot; can be removed afterwards which is important to be able uninstall finally python2, postfix config needs to explizit use &quot;python3&quot; since /usr/bin/python is stll python2 and on machines where python2 is uninstalled there is no /usr/bin/python at all but python3
___________________________________________________

[root@testserver:~]$ cat /etc/postfix/master.cf | grep spf
spf-policy-info unix  -       n       n       -        0      spawn user=nobody argv=/usr/bin/python3 /usr/libexec/postfix/policyd-spf /etc/python-policyd-spf/policyd-spf-noreject.conf
spf-policy      unix  -       n       n       -        0      spawn user=nobody argv=/usr/bin/python3 /usr/libexec/postfix/policyd-spf /etc/python-policyd-spf/policyd-spf.conf
___________________________________________________

[root@testserver:~]$ rpm -qa | grep -i spf
perl-Mail-SPF-2.9.0-8.fc24.noarch
pypolicyd-spf-1.3.2-4.fc24.noarch
python3-pyspf-2.0.12-1.fc24.noarch
___________________________________________________

Dec  3 13:18:10 testserver postfix/smtpd[30101]: connect from local.rhsoft.net[62.178.103.85]
Dec  3 13:18:12 testserver policyd-spf[30109]: Pass; identity=helo; client-ip=62.178.103.85; helo=srv-rhsoft.rhsoft.net; envelope-from=h.reindl@thelounge.net; receiver=rhsoft@test.rh
Dec  3 13:18:12 testserver policyd-spf[30109]: Fail; identity=mailfrom; client-ip=62.178.103.85; helo=srv-rhsoft.rhsoft.net; envelope-from=h.reindl@thelounge.net; receiver=rhsoft@test.rh
Dec  3 13:18:12 testserver postfix/smtpd[30101]: NOQUEUE: reject: RCPT from local.rhsoft.net[62.178.103.85]: 550 5.7.1 &lt;rhsoft@test.rh&gt;: Recipient address rejected: Message rejected due to: SPF fail - not authorized. Please see http://www.openspf.net/Why?s=mfrom;id=h.reindl@thelounge.net;ip=62.178.103.85;r=rhsoft@test.rh; from=&lt;h.reindl@thelounge.net&gt; to=&lt;rhsoft@test.rh&gt; proto=ESMTP helo=&lt;srv-rhsoft.rhsoft.net&gt;
Dec  3 13:18:12 testserver postfix/smtpd[30101]: lost connection after RCPT from local.rhsoft.net[62.178.103.85]
Dec  3 13:18:12 testserver postfix/smtpd[30101]: disconnect from local.rhsoft.net[62.178.103.85] ehlo=1 mail=1 rcpt=0/1 commands=2/3</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9964090</commentid>
    <comment_count>24</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-12-07 06:12:51 -0500</bug_when>
    <thetext>i guess that only becomes more visible with Python3

&quot;OSError: [Errno 98] Address already in use&quot; - why does that stuff deal at it&apos;s own with the source-port? on a busy machine running dns-resolvers and all sort of milters and deamons for mail-processing that is racy by definition

Dec  6 12:03:20 mail-gw policyd-spf[8410]: Traceback (most recent call last):
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/DNS/Base.py&quot;, line 198, in getSource
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    self.s.bind((&apos;&apos;, source_port))
Dec  6 12:03:20 mail-gw policyd-spf[8410]: OSError: [Errno 98] Address already in use
Dec  6 12:03:20 mail-gw policyd-spf[8410]: 
Dec  6 12:03:20 mail-gw policyd-spf[8410]: During handling of the above exception, another exception occurred:
Dec  6 12:03:20 mail-gw policyd-spf[8410]: Traceback (most recent call last):
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/libexec/postfix/policyd-spf&quot;, line 707, in &lt;module&gt;
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    instance_dict, configData, peruser)
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/libexec/postfix/policyd-spf&quot;, line 419, in _spfcheck
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    res = spf.check2(ip, helo_fake_sender, helo, querytime=configData.get(&apos;Lookup_Time&apos;))
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 304, in check2
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    receiver=receiver,timeout=timeout,verbose=verbose,querytime=querytime).check()
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 569, in check
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    rc = self.check1(spf, self.d, 0)
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 608, in check1
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    return self.check0(spf, recursion)
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 917, in check0
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    if self.cidrmatch(self.dns_a(arg,self.A), cidrlength):
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 1222, in dns_a
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    r = self.dns(domainname, A)
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 1310, in dns
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    for k, v in DNSLookup(name, qtype, self.strict, timeout):
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/spf.py&quot;, line 127, in DNSLookup
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    resp = req.req()
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/DNS/Base.py&quot;, line 244, in req
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    self.sendUDPRequest(server)
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/DNS/Base.py&quot;, line 269, in sendUDPRequest
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    self.conn()
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/DNS/Base.py&quot;, line 205, in conn
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    self.getSource()
Dec  6 12:03:20 mail-gw policyd-spf[8410]:  File &quot;/usr/lib/python3.5/site-packages/DNS/Base.py&quot;, line 202, in getSource
Dec  6 12:03:20 mail-gw policyd-spf[8410]:    if msg[0] != 98: raise
Dec  6 12:03:20 mail-gw policyd-spf[8410]: TypeError: &apos;OSError&apos; object is not subscriptable</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9966222</commentid>
    <comment_count>25</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-12-07 18:29:32 -0500</bug_when>
    <thetext>(In reply to Harald Reindl from comment #24)
&gt; i guess that only becomes more visible with Python3
&gt; 
&gt; &quot;OSError: [Errno 98] Address already in use&quot; - why does that stuff deal at
&gt; it&apos;s own with the source-port? on a busy machine running dns-resolvers and
&gt; all sort of milters and deamons for mail-processing that is racy by
&gt; definition

I think you should open an upstream bug for this (or at least another one in Red Hat Bugzilla). I haven&apos;t personally seen this, but then my config may be different.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10016687</commentid>
    <comment_count>26</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-12-22 12:19:06 -0500</bug_when>
    <thetext>https://bugzilla.redhat.com/show_bug.cgi?id=1408273</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10074667</commentid>
    <comment_count>27</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-17 23:19:16 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-ec45fbc96e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10074669</commentid>
    <comment_count>28</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-17 23:19:27 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-6e287bbdc7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10075585</commentid>
    <comment_count>29</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2017-01-18 06:02:09 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc24 has a regression 

look at the receiver=&lt;UNKNOWN&gt; that is now on every logline and header besides that the logformat slightly changed

Jan 18 11:38:25 mail-gw policyd-spf[27152]: prepend Received-SPF: Pass (mailfrom) identity=mailfrom; client-ip=66.220.144.147; helo=mx-out.facebook.com; envelope-from=****; receiver=&lt;UNKNOWN&gt;

Received-SPF: Pass (mailfrom) identity=mailfrom; client-ip=62.210.161.103;
 helo=r103.p3.neolane.net; envelope-from****;
 receiver=&lt;UNKNOWN&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10075686</commentid>
    <comment_count>30</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2017-01-18 06:44:11 -0500</bug_when>
    <thetext>(In reply to Harald Reindl from comment #29)
&gt; pypolicyd-spf-2.0.1-1.fc24 has a regression 
&gt; 
&gt; look at the receiver=&lt;UNKNOWN&gt; that is now on every logline and header
&gt; besides that the logformat slightly changed
&gt; 
&gt; Jan 18 11:38:25 mail-gw policyd-spf[27152]: prepend Received-SPF: Pass
&gt; (mailfrom) identity=mailfrom; client-ip=66.220.144.147;
&gt; helo=mx-out.facebook.com; envelope-from=****; receiver=&lt;UNKNOWN&gt;
&gt; 
&gt; Received-SPF: Pass (mailfrom) identity=mailfrom; client-ip=62.210.161.103;
&gt;  helo=r103.p3.neolane.net; envelope-from****;
&gt;  receiver=&lt;UNKNOWN&gt;

From the documentation of 2.0.1:

# In order to avoid disclosing BCC recipients in SPF header fields,
# Hide_Receiver is set to Yes by default in the interest of maximizing
# privacy.  This setting will replace the actual recipient with &lt;UNKNOWN&gt; both
# in header fields and SMTP responses.  The latter may make it more difficult
# for senders to troubleshoot issues with their SPF deployments.
#Hide_Receiver = No
Hide_Receiver = Yes</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10075719</commentid>
    <comment_count>31</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2017-01-18 06:55:16 -0500</bug_when>
    <thetext>thanks - i turn my karma to +1 with that option</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10078967</commentid>
    <comment_count>32</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-19 02:23:19 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-6e287bbdc7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10079286</commentid>
    <comment_count>33</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-19 04:10:54 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-ec45fbc96e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10080425</commentid>
    <comment_count>34</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2017-01-19 09:36:33 -0500</bug_when>
    <thetext>BTW: can someone ping the &quot;logwatch&quot; maintainers - the unnecessary change of logging to &quot;prepend Received-SPF: &quot; leads to blow all entries into **Unmatched Entries** in the daily logwatch mails - i would really love when developers stop fix things which ain&apos;t broken</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10080447</commentid>
    <comment_count>35</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2017-01-19 09:40:26 -0500</bug_when>
    <thetext>prepend Received-SPF: Pass (mailfrom) identity=mailfrom; client-ip=217.158.205.98; helo=***; envelope-from=***; receiver=*** also breaks scripts doing simple things like &quot;/usr/bin/grep &apos;policyd-spf&apos; /var/log/maillog | /usr/bin/grep &apos;Pass; identity=mailfrom&apos;&quot; as exmaple used in some helper scripts i had written long ago on our inbound server to filter whitelist_auth candidates for SpamAssassin

i could puke!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10082055</commentid>
    <comment_count>36</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2017-01-19 18:25:51 -0500</bug_when>
    <thetext>(In reply to Harald Reindl from comment #34)
&gt; BTW: can someone ping the &quot;logwatch&quot; maintainers

Probably best if you open a logwatch bug in Fedora. Maintainers will then take it from there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10103845</commentid>
    <comment_count>37</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-28 19:20:10 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10103889</commentid>
    <comment_count>38</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-28 19:49:16 -0500</bug_when>
    <thetext>pypolicyd-spf-2.0.1-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10121316</commentid>
    <comment_count>39</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2017-02-04 11:33:14 -0500</bug_when>
    <thetext>see https://bugzilla.redhat.com/show_bug.cgi?id=1419274 because logwatch and could somebody ask upstream if they are crazy - there is a similar dicussion on isc-bind list because they introduced a new field for debugging purpose in the querylog breaking all sorts of analyze software</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
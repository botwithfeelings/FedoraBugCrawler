<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1336879</bug_id>
          
          <creation_ts>2016-05-17 12:45:00 -0400</creation_ts>
          <short_desc>dnf fails to respect conditional level in comps.xml</short_desc>
          <delta_ts>2017-02-10 10:54:37 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf</component>
          <version>24</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1349743</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>RejectedBlocker RejectedFreezeException</status_whiteboard>
          <keywords>Triaged</keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1369129</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Luya Tshimbalanga">luya</reporter>
          <assigned_to>rpm-software-management</assigned_to>
          <cc>3ndymion.1</cc>
    
    
    <cc>awilliam</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>ghborrmann</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>jmracek</cc>
    
    
    <cc>luya</cc>
    
    
    <cc>marek78uk</cc>
    
    
    <cc>mcatanzaro</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>red</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-10 10:54:37</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9334283</commentid>
    <comment_count>0</comment_count>
    <who name="Luya Tshimbalanga">luya</who>
    <bug_when>2016-05-17 12:45:30 -0400</bug_when>
    <thetext>Description of problem:
dnf failed to respect the conditional level of packages from comps.xml during nightly compose for either Fedora Spins and Labs (in this case Design Suite[0]). As an example from comps.f241[1]

&lt;packagereq type=&quot;conditional&quot; requires=&quot;gimp&quot;&gt;gimp-data-extras&lt;/packagereq&gt;

should automatically be installed because Gimp is set as default

&lt;packagereq type=&quot;default&quot;&gt;gimp&lt;/packagereq&gt;

yet it is missing in the built[2]

Version-Release number of selected component (if applicable):


How reproducible:
Always

Steps to Reproduce:
1. Livemedia task [3]
2.
3.

Actual results:
gimp-data-extras is not installed during the built

Expected results:
gimp-data-extras should be added 

Additional info:
[0] http://koji.fedoraproject.org/koji/taskinfo?taskID=14119221
[1] https://pagure.io/fedora-comps/blob/master/f/comps-f24.xml.in
[2] https://kojipkgs.fedoraproject.org//work/tasks/9221/14119221/packaging.log
[3] http://koji.fedoraproject.org/koji/tasks?state=all&amp;view=tree&amp;method=livemedia&amp;order=-id</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9339404</commentid>
    <comment_count>1</comment_count>
    <who name="Luya Tshimbalanga">luya</who>
    <bug_when>2016-05-19 00:22:05 -0400</bug_when>
    <thetext>According to Fedora Comps (https://pagure.io/fedora-comps), &quot;conditional&quot; level of packages should be brought in with required packages installed. That process worked on previous release of Fedora 23, it now failed in Fedora 24 and more as observed on livemedia built.
The comps.xml in question is listed on the comment #0 which include the resulting packaging.log. 
It would be nice to fix as soon as possible.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9339585</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2016-05-19 02:34:59 -0400</bug_when>
    <thetext>Proposed as a Blocker for 24-final by Fedora user luya using the blocker tracking app because:

 This bug was found with the livemedia compose using conditional level of packages inside comps.xm from Fedora 24 and up. The result is those conditional packages will not be fulfilled when installing the required packages. Affected groups are:
- Assamese Support
- Bengali Support 
- Bodo Support
- Design Suite
- Dogro Support
- Finnish Support
- Graphics
- Gujarati Support
- Haskell
- Hindi Support
- Input Methods
- Japanese Support
- Kannada Support
- Kashmiri Support
- KDE
- Konkani Support
- Korean Support
- Lepcha Support
- Maithili Support
- Malayalam Support
- Manipuri Support
- Marathi Support
- MinGW cross-compiler
- Multimedia
- Nepali Support
- Online Help and Documentation
- Odia Support
- Punjabi Support
- Sanskrit Support
- Santali Support
- Simplified Chinese Support
- Sindhi Support
- Sinhala Support
- Standard
- Tamil Support
- Telugu Support
- Thai Support
- Tibetan Support
- Urdu Support
- Vietnamese Support</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9339668</commentid>
    <comment_count>3</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-05-19 03:16:09 -0400</bug_when>
    <thetext>I can verify this bug. Just check the yum vs dnf output for say a haskell group.

[parag@f24 ~]$ sudo dnf groupinstall haskell --assumeno |grep emacs
Operation aborted.

[parag@f24 ~]$ sudo yum-deprecated groupinstall haskell --assumeno |grep emacs
Yum command has been deprecated, use dnf instead.
See &apos;man dnf&apos; and &apos;man yum2dnf&apos; for more information.

---&gt; Package emacs-haskell-mode.noarch 0:13.18-1.fc24 will be installed
 emacs-haskell-mode            noarch 13.18-1.fc24        fedora          290 k


So the conditional packages specified in comps are not processed by dnf but by yum.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9351615</commentid>
    <comment_count>4</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-05-23 14:08:42 -0400</bug_when>
    <thetext>Discussed during the 2016-05-23 blocker review meeting: [1]

This bug was classified as a RejectedBlocker and a RejectedFreezeException as the impact of this bug does not violate the blocker criteria and a fix as this point in the release cycle could prove to be too dangerous for the benefit it would provide.

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-05-23/f24-blocker-review.2016-05-23-16.00.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9432595</commentid>
    <comment_count>5</comment_count>
    <who name="Michal Luscon">mluscon</who>
    <bug_when>2016-06-20 07:19:55 -0400</bug_when>
    <thetext>*** Bug 1346251 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9449521</commentid>
    <comment_count>6</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-06-24 04:50:30 -0400</bug_when>
    <thetext>Well I don&apos;t know when DNF developers will get time to fix this but anyway I would like to change priority to High to get their attention.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9472923</commentid>
    <comment_count>7</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-07-01 12:47:36 -0400</bug_when>
    <thetext>*** Bug 1352122 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9473024</commentid>
    <comment_count>8</comment_count>
    <who name="3ndymion">3ndymion.1</who>
    <bug_when>2016-07-01 13:21:27 -0400</bug_when>
    <thetext>I confirm that this problem happens with XFCE as well.  Trying to do a fresh, clean install of XFCE from the net-installer, &amp; it installs Cinnamon instead.  Happens every time.

I don&apos;t mean to sound negative, but how was this not considered an urgent issue???  I&apos;ve seen unimportant bugs that don&apos;t get fixed for years, but this is the most absurd I&apos;ve seen yet.  I ask to install XFCE, &amp; I get Cinnamon instead.  As a somewhat similar example, it&apos;s like if somebody tries to download the new Windows OS, &amp; they get Mac OS instead.  That&apos;s definitely an urgent issue, &amp; so is this.

I apologize that I don&apos;t have the knowledge to help with this, but I think that this really needs more attention.  I can only really use XFCE on my little netbook, &amp; now I&apos;m stuck with no Fedora at all.  I&apos;m pretty sure other people are going through the same thing as well.

Please help.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9473153</commentid>
    <comment_count>9</comment_count>
    <who name="Luya Tshimbalanga">luya</who>
    <bug_when>2016-07-01 14:17:26 -0400</bug_when>
    <thetext>Raising the (In reply to 3ndymion from comment #8)
&gt; I confirm that this problem happens with XFCE as well.  Trying to do a
&gt; fresh, clean install of XFCE from the net-installer, &amp; it installs Cinnamon
&gt; instead.  Happens every time.

It turned out the issues also affected KDE and MATE according to the duplicated reports with comments provided by David Shea. DNF developers are working on it for Fedora 25


&gt; I apologize that I don&apos;t have the knowledge to help with this, but I think 
&gt; that this really needs more attention.  I can only really use XFCE on my 
&gt; little netbook, &amp; now I&apos;m stuck with no Fedora at all. 

Current workaround is to download XFCE livemedia spin for the time being.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9474061</commentid>
    <comment_count>10</comment_count>
    <who name="3ndymion">3ndymion.1</who>
    <bug_when>2016-07-02 14:22:38 -0400</bug_when>
    <thetext>(In reply to Luya Tshimbalanga from comment #9)
...
&gt; Current workaround is to download XFCE livemedia spin for the time being.

OK, thank you.  I really don&apos;t like the live media install &amp; I&apos;ve always avoided it, but since I have no choice this time, I tried it out.  It seems to be working.

I really hope the developers can get this fixed really soon.  This is definitely NOT the way to release a new product.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9479227</commentid>
    <comment_count>11</comment_count>
    <who name="markm">marek78uk</who>
    <bug_when>2016-07-04 15:10:37 -0400</bug_when>
    <thetext>(In reply to 3ndymion from comment #10)
&gt; (In reply to Luya Tshimbalanga from comment #9)
&gt; ...
&gt; &gt; Current workaround is to download XFCE livemedia spin for the time being.
&gt; 
&gt; OK, thank you.  I really don&apos;t like the live media install &amp; I&apos;ve always
&gt; avoided it, but since I have no choice this time, I tried it out.  It seems
&gt; to be working.
&gt; 
&gt; I really hope the developers can get this fixed really soon.  This is
&gt; definitely NOT the way to release a new product.

Developers have limited capacity and this is an open source project.

Also cinnamon is relatively easy to remove once MATE is installed and configured. Worked for me!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9480857</commentid>
    <comment_count>12</comment_count>
    <who name="3ndymion">3ndymion.1</who>
    <bug_when>2016-07-05 06:14:18 -0400</bug_when>
    <thetext>(In reply to markm from comment #11)
...
&gt; Developers have limited capacity and this is an open source project.
&gt; 
&gt; Also cinnamon is relatively easy to remove once MATE is installed and
&gt; configured. Worked for me!

Cinnamon is definitely nice.  I like it so much that I&apos;m getting ready to put it on my main laptop instead of KDE.  : )

I apologize to all if my previous words were too harsh.  It&apos;s just very frustrating as a user, especially having to find out about all of this the hard way.  I do know how hard this is for developers, especially when they have to work jobs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9480867</commentid>
    <comment_count>13</comment_count>
    <who name="3ndymion">3ndymion.1</who>
    <bug_when>2016-07-05 06:20:37 -0400</bug_when>
    <thetext>TO ALL DEVELOPERS EVERYWHERE, PLEASE READ THIS

In light of this situation, I&apos;d like to state some important things.  This is not meant to be offensive in any way, so please don&apos;t take it as such.  Instead, please keep these things in mind, &amp; feel free to spread this message everywhere you possibly can.

The main point I&apos;d like to make is this:
If something is broken (specifically something that&apos;s very important)...

EITHER
   ---Do not release it.
OR
   ---Release it with a warning that something is wrong, &amp; what can be done about it.

As developers, ask yourselves this: What are you working so hard for???  Are you working hard because you want people to turn away from your work &amp; badmouth your efforts in the worst ways possible???  Of course not.  BUT, when something like what happened here is done, the answer to that question is YES.  Yes, you are working hard only to have people throw your work in the garbage.  Yes, you want people to speak bad about your work in the worst ways possible, &amp; spread the word to everyone they know.  You are only shooting yourself in the foot.

Why is that???  It is because of this:  It is not only Fedora experts &amp; advanced Linux users that are trying to use your product.  No, it is also normal people who are not so technically inclined that want to try out what you have to offer.  People who are coming from Windows &amp; want to try something better.  People who come from many different areas of life.  This includes high reaching public facing figures.

What happens when somebody tries to use this nice, new OS, &amp; finds out the hard way that it&apos;s broken &amp; doesn&apos;t work right???  They&apos;ll curse it &amp; turn away from it.  They&apos;ll remember it, &amp; tell everyone to stay away from it.  Now what happens when that person happens to be a journalist, or blogger???  Rest assured, they will let the entire world know about your broken product &amp; how much it sucks.  They&apos;ll spread the bad news all over the internet.  &quot;Stay away from Fedora.  It&apos;s broken, it sucks, etc...&quot;

Certainly, nobody who puts lots of hard work &amp; effort into something wants those types of results.  As an upcoming developer myself, I know how time consuming all of this stuff is, &amp; how hard it is to do this while working some job that takes all of your time away.  I also know that there will always be problems.  I&apos;m not asking for things to be perfect from the start, but please, PLEASE, reconsider your priorities.

In this particular case, the net-installer is broken.  This is of the highest priority.  What good is an OS that can&apos;t even be installed???  It&apos;s almost like buying a brand new car, &amp; then finding out on your own that the key is broken &amp; does not start the car.  The dealer knew of the problem, but decided that it&apos;s not important for you to know, &amp; never told you about it.  Clearly, the dealer should have EITHER fixed the problem before selling the new car, OR sell it with the warning that something is wrong, &amp; what can be done to work around it.

In this case, IF net-installer is broken, EITHER do not release it, OR make it available for download with a warning right next to it, stating that there is an issue, what it is, &amp; what can be done to work around it.  PLEASE do not give people something that is broken, hoping they won&apos;t notice.  Trust me, they will definitely notice, &amp; it also takes the risk of the media spreading bad words about your hard work.

I speak all of this as both a user, &amp; a developer.  I now know what it&apos;s like to be on both sides; how frustrating it can be for users, &amp; how difficult things can be for developers.  Again, I do not intend to offend anyone by any of this, but only to raise awareness.  I do not like to see something great, &amp; people&apos;s hard work, tarnished by something like this.  Please consider these things.

Please feel free to copy any of this everywhere possible.  I think there are many Linux developers everywhere that need to see this.  I do appreciate the effort you all have done for this Fedora that I like to use, &amp; for that, I thank you all.  Thank you for taking the time to look through all of this.

Best Regards,
3ndymion</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9490332</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-07-08 05:32:56 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9496557</commentid>
    <comment_count>15</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-07-11 08:52:59 -0400</bug_when>
    <thetext>*** Bug 1354072 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9622249</commentid>
    <comment_count>16</comment_count>
    <who name="Michal Luscon">mluscon</who>
    <bug_when>2016-08-17 07:53:36 -0400</bug_when>
    <thetext>As there is no official documentation for comps I want to make sure we are on the same page here. 

I have already implemented behavior from https://pagure.io/fedora-comps in https://github.com/rpm-software-management/dnf/pull/559 . Effectively it means that a conditional package is pulled into transaction if and only if it&apos;s required package has been already installed on the system. 

Please take note that if you are installing a group with conditional package and a requirement of that conditional package together in one transaction, the conditional package won&apos;t be installed.

Please let me know whether the behavior described above is expected.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9623083</commentid>
    <comment_count>17</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-08-17 10:47:27 -0400</bug_when>
    <thetext>No, that would not match my expectations. I would expect the opposite behaviour in the second-described case. Remember one of comps&apos; main use case is to define the package groups available during *initial install* of the system; obviously no packages at all are already installed during initial system installation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9623087</commentid>
    <comment_count>18</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-08-17 10:48:19 -0400</bug_when>
    <thetext>...however I take the point about there being no documentation, so I&apos;d suggest we double-check the behaviour of the old code in this case. Just the fact of the bug report suggests it previously behaved differently, but we can run an install from an old DVD to check.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9631295</commentid>
    <comment_count>19</comment_count>
    <who name="Davide Repetto">red</who>
    <bug_when>2016-08-19 13:31:16 -0400</bug_when>
    <thetext>I agree with Adam, as you can see from bugs 1352122 and 1346251 this unpredictable behaviour creates strange results when you&apos;re trying to install a new system (or just to add a new group).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9631326</commentid>
    <comment_count>20</comment_count>
    <who name="Davide Repetto">red</who>
    <bug_when>2016-08-19 13:35:43 -0400</bug_when>
    <thetext>ie. it installs things that you don&apos;t intend to, when you do things such as trying to install the mate-desktop environment group. In which case you end up with installed pieces of KDE and Cinnamon that shouldn&apos;t be there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138610</commentid>
    <comment_count>21</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-02-10 10:54:37 -0500</bug_when>
    <thetext>Bugs fixed in version of dnf-2.0.1-1.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
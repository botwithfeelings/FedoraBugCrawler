<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1395366</bug_id>
          
          <creation_ts>2016-11-15 14:35:00 -0500</creation_ts>
          <short_desc>Segfault when no GL available on X server</short_desc>
          <delta_ts>2017-05-18 16:58:36 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>libepoxy</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tom Horsley">horsley1953</reporter>
          <assigned_to name="Dave Airlie">airlied</assigned_to>
          <cc>airlied</cc>
    
    
    <cc>igeorgex</cc>
    
    
    <cc>ionic</cc>
    
    
    <cc>ngaywood</cc>
    
    
    <cc>rkudyba</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>libepoxy-1.4.1-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-05-18 16:58:36</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9894047</commentid>
    <comment_count>0</comment_count>
    <who name="Tom Horsley">horsley1953</who>
    <bug_when>2016-11-15 14:35:39 -0500</bug_when>
    <thetext>Description of problem:

Some recent update is making every gtk3 program abort when run under x2go.
The most immediate symptom appears to be libepoxy passing a NULL pointer to
sscanf to interpret what it believes is a version string:

From virt-manager blowing up under gdb:

#0  0x00007ffff6da025f in rawmemchr () at /lib64/libc.so.6
#1  0x00007ffff6d87fe2 in _IO_str_init_static_internal () at /lib64/libc.so.6
#2  0x00007ffff6d76767 in __isoc99_vsscanf () at /lib64/libc.so.6
#3  0x00007ffff6d76707 in __isoc99_sscanf () at /lib64/libc.so.6
#4  0x00007fffdd72db35 in epoxy_glx_version () at /lib64/libepoxy.so.0

From emacs blowing up in a shell:

/lib64/libc.so.6(__rawmemchr+0x1f)[0x7f488fee625f]
/lib64/libc.so.6(+0x7afe2)[0x7f488fecdfe2]
/lib64/libc.so.6(__isoc99_vsscanf+0x57)[0x7f488febc767]
/lib64/libc.so.6(__isoc99_sscanf+0x87)[0x7f488febc707]
/lib64/libepoxy.so.0(epoxy_glx_version+0x45)[0x7f488f3a9b35]

You&apos;ll note the common theme :-).

Version-Release number of selected component (if applicable):
libepoxy-1.3.1-2.fc24.x86_64


How reproducible:
100%

Steps to Reproduce:
1.Run an x2go session
2.Run any gtk3 program under that session
3.

Actual results:
Boom.

Expected results:
Gtk3 displaying something without using GL.

Additional info:

Just looking at the libepoxy source rpm I see things like:

    version_string = glXQueryServerString(dpy, screen, GLX_VERSION);
    ret = sscanf(version_string, &quot;%d.%d&quot;, &amp;server_major, &amp;server_minor);

No check for NULL version_string :-(.

I have no idea if the programs would work if they got past these calls, but
this seems to happen really early in all gtk3 programs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9896895</commentid>
    <comment_count>1</comment_count>
      <attachid>1221160</attachid>
    <who name="Tom Horsley">horsley1953</who>
    <bug_when>2016-11-16 09:20:41 -0500</bug_when>
    <thetext>Created attachment 1221160
Patch to add NULL pointer checks to libepoxy

Here is the patch I used to stick checks for NULL pointers in lots of places that were calling str* and sscanf routines. I can now start virt-manager and virt-viewer under an x2go session without getting a segfault.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10189544</commentid>
    <comment_count>2</comment_count>
    <who name="Mihai Moldovan">ionic</who>
    <bug_when>2017-02-27 21:59:38 -0500</bug_when>
    <thetext>X2Go users are seeing this on FC25 as well.

Please backport upstream&apos;s fix: https://github.com/anholt/libepoxy/commit/a15a92c2cbe0a8f45a1ff6258b22957c17c7118e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10196596</commentid>
    <comment_count>3</comment_count>
    <who name="Mihai Moldovan">ionic</who>
    <bug_when>2017-03-01 04:35:36 -0500</bug_when>
    <thetext>This bug seems to be triggered by a MESA upgrade, check https://bugzilla.redhat.com/show_bug.cgi?id=1427174

Backporting the fix might still be worthwhile - even of MESA wasn&apos;t broken and reported a correct GLX version, instead of crashing on a NULL version.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10223177</commentid>
    <comment_count>4</comment_count>
    <who name="JM">igeorgex</who>
    <bug_when>2017-03-08 19:28:33 -0500</bug_when>
    <thetext>The bug is fixed in Version 1.4.1 (stable) of libepoxy , see &quot;https://github.com/anholt/libepoxy/releases&quot;, so maybe it&apos;s time to update libepoxy?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10223402</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-08 21:32:54 -0500</bug_when>
    <thetext>libepoxy-1.4.1-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-4ebc23db22</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10250837</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-17 16:24:21 -0400</bug_when>
    <thetext>libepoxy-1.4.1-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-4ebc23db22</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10427053</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-18 16:58:36 -0400</bug_when>
    <thetext>libepoxy-1.4.1-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1221160</attachid>
            <date>2016-11-16 09:20:00 -0500</date>
            <delta_ts>2016-11-16 09:20:41 -0500</delta_ts>
            <desc>Patch to add NULL pointer checks to libepoxy</desc>
            <filename>libepoxy.patch</filename>
            <type>text/plain</type>
            <size>2042</size>
            <attacher name="Tom Horsley">horsley1953</attacher>
            
              <data encoding="base64">ZGlmZiAtdXIgbGliZXBveHktMS4zLjEvc3JjL2Rpc3BhdGNoX2NvbW1vbi5jIGxpYmVwb3h5LTEu
My4xL3NyYy9kaXNwYXRjaF9jb21tb24uYwotLS0gbGliZXBveHktMS4zLjEvc3JjL2Rpc3BhdGNo
X2NvbW1vbi5jCTIwMTYtMTEtMTYgMDk6MDM6NTIuODA5MDY2MjQ3IC0wNTAwCisrKyBsaWJlcG94
eS0xLjMuMS9zcmMvZGlzcGF0Y2hfY29tbW9uLmMJMjAxNS0wNy0xNSAxOTo0NjozNi4wMDAwMDAw
MDAgLTA0MDAKQEAgLTM0OCw4ICszNDgsNiBAQAogZXBveHlfZXh0ZW5zaW9uX2luX3N0cmluZyhj
b25zdCBjaGFyICpleHRlbnNpb25fbGlzdCwgY29uc3QgY2hhciAqZXh0KQogewogICAgIGNvbnN0
IGNoYXIgKnB0ciA9IGV4dGVuc2lvbl9saXN0OwotICAgIGlmICghIHB0cikgcmV0dXJuIGZhbHNl
OwotICAgIGlmICghIGV4dCkgcmV0dXJuIGZhbHNlOwogICAgIGludCBsZW4gPSBzdHJsZW4oZXh0
KTsKIAogICAgIC8qIE1ha2Ugc3VyZSB0aGF0IGRvbid0IGp1c3QgZmluZCBhbiBleHRlbnNpb24g
d2l0aCBvdXIgbmFtZSBhcyBhIHByZWZpeC4gKi8KQEAgLTM4Miw3ICszODAsNiBAQAogCiAgICAg
ICAgIGZvciAoaSA9IDA7IGkgPCBudW1fZXh0ZW5zaW9uczsgaSsrKSB7CiAgICAgICAgICAgICBj
b25zdCBjaGFyICpnbF9leHQgPSAoY29uc3QgY2hhciAqKWdsR2V0U3RyaW5naShHTF9FWFRFTlNJ
T05TLCBpKTsKLSAgICAgICAgICAgIGlmICghIGdsX2V4dCkgcmV0dXJuIGZhbHNlOwogICAgICAg
ICAgICAgaWYgKHN0cmNtcChleHQsIGdsX2V4dCkgPT0gMCkKICAgICAgICAgICAgICAgICByZXR1
cm4gdHJ1ZTsKICAgICAgICAgfQpkaWZmIC11ciBsaWJlcG94eS0xLjMuMS9zcmMvZGlzcGF0Y2hf
ZWdsLmMgbGliZXBveHktMS4zLjEvc3JjL2Rpc3BhdGNoX2VnbC5jCi0tLSBsaWJlcG94eS0xLjMu
MS9zcmMvZGlzcGF0Y2hfZWdsLmMJMjAxNi0xMS0xNiAwODo0MDozNC4wNjkzNTg3MDkgLTA1MDAK
KysrIGxpYmVwb3h5LTEuMy4xL3NyYy9kaXNwYXRjaF9lZ2wuYwkyMDE1LTA3LTE1IDE5OjQ2OjM2
LjAwMDAwMDAwMCAtMDQwMApAQCAtNDYsNyArNDYsNiBAQAogICAgIGludCByZXQ7CiAKICAgICB2
ZXJzaW9uX3N0cmluZyA9IGVnbFF1ZXJ5U3RyaW5nKGRweSwgRUdMX1ZFUlNJT04pOwotICAgIGlm
ICghIHZlcnNpb25fc3RyaW5nKSByZXR1cm4gMDsKICAgICByZXQgPSBzc2NhbmYodmVyc2lvbl9z
dHJpbmcsICIlZC4lZCIsICZtYWpvciwgJm1pbm9yKTsKICAgICBhc3NlcnQocmV0ID09IDIpOwog
ICAgIHJldHVybiBtYWpvciAqIDEwICsgbWlub3I7CmRpZmYgLXVyIGxpYmVwb3h5LTEuMy4xL3Ny
Yy9kaXNwYXRjaF9nbHguYyBsaWJlcG94eS0xLjMuMS9zcmMvZGlzcGF0Y2hfZ2x4LmMKLS0tIGxp
YmVwb3h5LTEuMy4xL3NyYy9kaXNwYXRjaF9nbHguYwkyMDE2LTExLTE2IDA4OjQxOjAzLjA2NTcz
MDM3MCAtMDUwMAorKysgbGliZXBveHktMS4zLjEvc3JjL2Rpc3BhdGNoX2dseC5jCTIwMTUtMDct
MTUgMTk6NDY6MzYuMDAwMDAwMDAwIC0wNDAwCkBAIC01NywxMyArNTcsMTEgQEAKICAgICBpbnQg
cmV0OwogCiAgICAgdmVyc2lvbl9zdHJpbmcgPSBnbFhRdWVyeVNlcnZlclN0cmluZyhkcHksIHNj
cmVlbiwgR0xYX1ZFUlNJT04pOwotICAgIGlmICghIHZlcnNpb25fc3RyaW5nKSByZXR1cm4gMDsK
ICAgICByZXQgPSBzc2NhbmYodmVyc2lvbl9zdHJpbmcsICIlZC4lZCIsICZzZXJ2ZXJfbWFqb3Is
ICZzZXJ2ZXJfbWlub3IpOwogICAgIGFzc2VydChyZXQgPT0gMik7CiAgICAgc2VydmVyID0gc2Vy
dmVyX21ham9yICogMTAgKyBzZXJ2ZXJfbWlub3I7CiAKICAgICB2ZXJzaW9uX3N0cmluZyA9IGds
WEdldENsaWVudFN0cmluZyhkcHksIEdMWF9WRVJTSU9OKTsKLSAgICBpZiAoISB2ZXJzaW9uX3N0
cmluZykgcmV0dXJuIDA7CiAgICAgcmV0ID0gc3NjYW5mKHZlcnNpb25fc3RyaW5nLCAiJWQuJWQi
LCAmY2xpZW50X21ham9yLCAmY2xpZW50X21pbm9yKTsKICAgICBhc3NlcnQocmV0ID09IDIpOwog
ICAgIGNsaWVudCA9IGNsaWVudF9tYWpvciAqIDEwICsgY2xpZW50X21pbm9yOwo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1316359</bug_id>
          
          <creation_ts>2016-03-09 22:56:00 -0500</creation_ts>
          <short_desc>grep update broke German spell checking</short_desc>
          <delta_ts>2016-04-13 17:35:11 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>hunspell-de</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sebastian Keller">sebastian-keller</reporter>
          <assigned_to name="Michael Stahl">mstahl</assigned_to>
          <cc>bjoern</cc>
    
    
    <cc>fedora</cc>
    
    
    <cc>mstahl</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>rhbz2</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>hunspell-de-0.20151222-4.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-04-13 17:35:11</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9136300</commentid>
    <comment_count>0</comment_count>
    <who name="Sebastian Keller">sebastian-keller</who>
    <bug_when>2016-03-09 22:56:23 -0500</bug_when>
    <thetext>Updating from hunspell-de-0.20151222-2.fc24 to hunspell-de-0.20151222-3.fc24 breaks German spell checking.

Looking at the rpm files there is a big difference in file sizes. The .dic files in 0.20151222-3 are ~45kB while those in 0.20151222-2 are ~1.1MB. So probably large parts of the dictionaries are missing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9136337</commentid>
    <comment_count>1</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-03-10 00:08:57 -0500</bug_when>
    <thetext>You are right, file size is dropped to just ~45kB. What I did now is just tried to scratch build older -2 release for F24 and see here http://koji.fedoraproject.org/koji/taskinfo?taskID=13292731 the results are same. so something required to build this package is causing this problem. The update change looks okay to me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9199985</commentid>
    <comment_count>2</comment_count>
    <who name="Thorsten Leemhuis">fedora</who>
    <bug_when>2016-04-01 09:04:15 -0400</bug_when>
    <thetext>I quickly looked into this and noticed a small difference between
https://kojipkgs.fedoraproject.org//packages/hunspell-de/0.20151222/2.fc24/data/logs/noarch/build.log (the old build that works) and https://kojipkgs.fedoraproject.org//packages/hunspell-de/0.20151222/3.fc24/data/logs/noarch/build.log (the one that does not). In the latter one the areas with &quot;Capital prefixes will be expanded: &quot; are way shorter. That might be symptom only, but maybe that does ring a bell to anyone here…</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9200722</commentid>
    <comment_count>3</comment_count>
    <who name="Michael Stahl">mstahl</who>
    <bug_when>2016-04-01 12:58:02 -0400</bug_when>
    <thetext>if i build the rawhide package with &quot;fedpkg local&quot; on F23, it works.
with &quot;fedpkg mockbuild --no-clean-all&quot; it fails.

a diff contains a lot of stuff like:

-Binaries/m
-Binary/m
-Binde/ijm
-Binden/SJm
-Binder/NFSm
-Binderei/Pm
-Bindestrick/dEPS
-Bindfäden/m
-Bindfaden/Sm
+Binary file (standard input) matches
+Binary file hunspell-capmain-small_de_AT.tmp.tmp matches/m
+Binde/hij
 Bindungs/hij
-Bingen/Sm


smells like something invokes grep and rawhide grep thinks input is binary, some of the time.

apparently the problem is in bin/hunspell-capmain ...

on Fedora 23 this results in the expected output:

LC_ALL=C LANG=C grep &quot;^[A-ZÄÖÜÉ]&quot; igerman98-20151222/hunspell-capmain-small_de_AT.tmp.tmp

whereas using rawhide&apos;s grep produces the &quot;Binary file hunspell-capmain-small_de_AT.tmp.tmp matches&quot; at the first line with a non-ASCII char, &quot;Praliné/S&quot;:

LC_ALL=C LANG=C /var/lib/mock/fedora-rawhide-x86_64/root/usr/bin/grep &quot;^[A-ZÄÖÜÉ]&quot; igerman98-20151222/hunspell-capmain-small_de_AT.tmp.tmp

so apparently the interpretation of the &quot;C&quot; locale changed between
grep-2.22-6.fc23.x86_64 and grep-2.24-1.fc25.x86_64

http://git.savannah.gnu.org/cgit/grep.git/tree/NEWS says:

 * Noteworthy changes in release 2.23 (2016-02-04) [stable]

 ** Bug fixes

  Binary files are now less likely to generate diagnostics and more
  likely to yield text matches.  grep now reports &quot;Binary file FOO
  matches&quot; and suppresses further output instead of outputting a line
  containing an encoding error; hence grep can now report matching text
  before a later binary match.  Formerly, grep reported FOO to be
  binary when it found an encoding error in FOO before generating
  output for FOO, which meant it never reported both matching text and
  matching binary data; this was less useful for searching text
  containing encoding errors in non-matching lines.
  [bug introduced in grep-2.21]

  grep no longer outputs encoding errors in unibyte locales.
  For example, if the byte &apos;\x81&apos; is not a valid character in a
  unibyte locale, grep treats the byte as binary data.
  [bug introduced in grep-2.21]


... sounds like an intentional change, and the build worked by accident before.

try to fix it by forcing more use of en_US.iso885915 locale.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9203302</commentid>
    <comment_count>4</comment_count>
    <who name="Thorsten Leemhuis">fedora</who>
    <bug_when>2016-04-04 01:38:30 -0400</bug_when>
    <thetext>&gt; Fixed In Version: hunspell-de-0.20151222-4.fc24

Works for me. Many thx for taking care of this!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9210138</commentid>
    <comment_count>5</comment_count>
    <who name="Björn Jacke">bjoern</who>
    <bug_when>2016-04-05 19:24:42 -0400</bug_when>
    <thetext>The C locale is the fallback locale and should always give reasonable results. The result that GNU grep gives back does not seem to be in line whaty you should expect according to http://pubs.opengroup.org/onlinepubs/009604499/utilities/grep.html

Setting some legacy locale to be able to work with iso8895-1 encoded files will only work when the given locale definitions exist on the system. But you cannot assume any locale definition to pre-exist except for C.

# echo -e &quot;test\ntäst&quot; | iconv -f utf8 -t latin1 | LC_ALL=C grep st ; echo $?
Binary file (standard input) matches
0
#

IMHO GNU grep ist heavily broken here. I will require a different grep implementation with the next igerman98 release. You might also switch to use busybox grep, which seems to work better.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9220125</commentid>
    <comment_count>6</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-04-08 09:03:03 -0400</bug_when>
    <thetext>(In reply to Thorsten Leemhuis from comment #4)
&gt; &gt; Fixed In Version: hunspell-de-0.20151222-4.fc24
&gt; 
&gt; Works for me. Many thx for taking care of this!

Any chance of getting this pushed to Fedora 24 repositories? The -4 update only got pushed to Fedora 25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9220152</commentid>
    <comment_count>7</comment_count>
    <who name="Björn Jacke">bjoern</who>
    <bug_when>2016-04-08 09:07:47 -0400</bug_when>
    <thetext>or just update igerman98 to 20160407. This one now detects if we have a broken grep version and allows to use busybox&apos; grep to build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9220174</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-08 09:12:43 -0400</bug_when>
    <thetext>hunspell-de-0.20151222-4.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-e2e32afb32</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9220189</commentid>
    <comment_count>9</comment_count>
    <who name="Michael Stahl">mstahl</who>
    <bug_when>2016-04-08 09:16:52 -0400</bug_when>
    <thetext>sorry i usually only push to rawhide so i forgot that i need to &quot;fedpkg update&quot; for f24...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9222128</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-09 14:52:42 -0400</bug_when>
    <thetext>hunspell-de-0.20151222-4.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-e2e32afb32</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9234845</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-13 17:35:06 -0400</bug_when>
    <thetext>hunspell-de-0.20151222-4.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1373206</bug_id>
          
          <creation_ts>2016-09-05 09:35:00 -0400</creation_ts>
          <short_desc>dump/restore No longer work</short_desc>
          <delta_ts>2016-10-28 15:51:04 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dump</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ray Holme">rayholme</reporter>
          <assigned_to name="Josef Ridky">jridky</assigned_to>
          <cc>jridky</cc>
    
    
    <cc>phracek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>dump-0.4-0.30.b46.fc25 dump-0.4-0.30.b46.fc23 dump-0.4-0.30.b46.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-27 20:40:10</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9679689</commentid>
    <comment_count>0</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-05 09:35:51 -0400</bug_when>
    <thetext>Description of problem: I installed dump (was standard with Fedora 22, now an addition in Fedora 24) and dumped my new system after upgrading to Fedora 24, I tried to recover a file from the dump image today. Huge amounts of &quot;Incorrect block for &lt;file removal list&gt; at NNNN blocks&quot; appear. The dump file is not usable.

Version-Release number of selected component (if applicable): 
Installed Packages
Name        : dump
Arch        : x86_64
Epoch       : 1
Version     : 0.4
Release     : 0.29.b45.fc24


How reproducible: 100% - I tried to see if restore worked on any of the file systems (root, boot, home) - same problems with each. Prior dumps made with Fedora 22 dump work fine using newer restore. Dumps from both of my 64 bit Fedora boxes made with Fedora 24 and the added dump FAIL - all 6 file systems.


Steps to Reproduce:
1. put in a mountable disk, change directory to somewhere on it
2. e.g. - boot is small so only one volume
dump -u0 -f - -A boot.toc -L boot -z2 /boot | split -b 2GB -d - boot.dmp
3. restore if boot.dmp00
other file systems require a line like the below
  cat root.dmp* | restore if -

Actual results:
Dump tape is compressed.
Incorrect block for &lt;file removal list&gt; at 19 blocks
Incorrect block for &lt;file removal list&gt; at 20 blocks
..... two thousand times
Incorrect block for &lt;file removal list&gt; at 2057 blocks
Incorrect block for &lt;file removal list&gt; at 2058 blocks
decompression error, block 2059: data error
File decompression error while restoring &lt;file removal list&gt;
continue? [yn] 


Expected results:
Dump tape is compressed.
restore &gt;

Additional info: This means going back to Fedora 22 if I cannot have backups or using TAR instead of Dump (a poor choice IMHO).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9681344</commentid>
    <comment_count>1</comment_count>
    <who name="Josef Ridky">jridky</who>
    <bug_when>2016-09-06 03:39:31 -0400</bug_when>
    <thetext>Thank you for reporting this bug.

This issue has been reported to upstream.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9682131</commentid>
    <comment_count>2</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-06 07:55:55 -0400</bug_when>
    <thetext>So for a while, I must find another way to backup systems (tar I guess) until this is fixed. boo hoo hoo

One other point, I believe I had to install a &quot;development&quot; version of dump a month ago due to some problem encountered at the very startup. I cannot find it in my history or I would say more.

Hope you can fix it soon. A lot of people use dump. Most of my ex-clients (retired) use scripts I wrote that depend on it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9686856</commentid>
    <comment_count>3</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-07 09:48:10 -0400</bug_when>
    <thetext>Hope this helps. First I removed the pipe to split - that did nothing.
Then I remove all options EXCEPT compressing - that did nothing.
Then I removed compresssion (-z2) and the restore worked fine.

I guess I could remove this option in my scripts and get a lot more files written to the backup device. I have room for right now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9689104</commentid>
    <comment_count>4</comment_count>
    <who name="Josef Ridky">jridky</who>
    <bug_when>2016-09-08 01:07:33 -0400</bug_when>
    <thetext>(In reply to Ray Holme from comment #3)

&gt; Then I removed compression (-z2) and the restore worked fine.

Thank you for this suggestion. It should be easier to find the issue in source code right now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9690348</commentid>
    <comment_count>5</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-08 08:07:53 -0400</bug_when>
    <thetext>And I now have a work-around. :=]

dump -u0 -f - -A root.toc -L root / | gzip | split -b 2GB -d - root.dmp

 followed by

zcat root.dmp* | restore if -

WORKS!!!!!!

And by the way the &quot;-A&quot; option does nothing - the file generated is 0 bytes.

[ray@rainbow tmp]$ !!
ls -l /home/root*
-rw-r--r--. 1 root root 2000000000 Sep  8 08:00 /home/root.dmp00
-rw-r--r--. 1 root root 2000000000 Sep  8 08:04 /home/root.dmp01
-rw-r--r--. 1 root root  304644335 Sep  8 08:05 /home/root.dmp02
-rw-r--r--. 1 root root          0 Sep  8 07:55 /home/root.toc

:=]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9721309</commentid>
    <comment_count>6</comment_count>
    <who name="Josef Ridky">jridky</who>
    <bug_when>2016-09-19 09:11:27 -0400</bug_when>
    <thetext>New update of dump is available (dump-1:0.4-0.30.b46).
You can upgrade it by following command:

sudo dnf --enablerepo=updates-testing upgrade dump

This update has expected results as mentioned in comment #1.
Please check, if is this update satisfying.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9721322</commentid>
    <comment_count>7</comment_count>
    <who name="Josef Ridky">jridky</who>
    <bug_when>2016-09-19 09:13:09 -0400</bug_when>
    <thetext>I am apologize, correct is comment #0 (Expected results)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9721674</commentid>
    <comment_count>8</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-19 10:22:14 -0400</bug_when>
    <thetext>Interesting timing. :=]]]
I was busy copying my dump files to my son&apos;s external disk drive for an
 offsite copy and vice versa for him
So I used a local file system not the normal external one.

Anyway, I did the following test:

  cd /home; mkdir dump_test; cd dump_test
  dump -u0 -f - -A root.toc -L root -z2 / | split -b 2GB -d - root.dmp

Got:

  DUMP: Date of this level 0 dump: Mon Sep 19 10:09:35 2016
  DUMP: Dumping /dev/mapper/fedora_rainbow-root (/) to standard output
...
  DUMP: Archiving dump to (null)
  DUMP: DUMP IS DONE

[root@rainbow dump_test]# ls -l
total 5156356
-rw-r--r--. 1 root root 2000000000 Sep 19 10:12 root.dmp00
-rw-r--r--. 1 root root 2000000000 Sep 19 10:13 root.dmp01
-rw-r--r--. 1 root root 1216246296 Sep 19 10:14 root.dmp02
-rw-r--r--. 1 root root   63840256 Sep 19 10:14 root.toc

OK, you fixed the Table of Contents. Great!
[root@rainbow dump_test]# cat root.dmp* | restore if -
Dump tape is compressed.
restore &gt; 


Looks good! This is not a very extensive test, but I could look at &quot;/etc&quot;
and that looks decent. I did NOT try restoring anything, but I think you got it.

Thanks and great job!!!

Ray</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9724533</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-20 01:37:17 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-df773b62ca</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9724535</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-20 01:38:13 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-efe4ccf884</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9724536</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-20 01:38:40 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2016-28c594c4a9</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9828312</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-27 20:40:10 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9830307</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-28 14:49:38 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9830388</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-28 15:51:04 -0400</bug_when>
    <thetext>dump-0.4-0.30.b46.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
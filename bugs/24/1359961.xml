<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1359961</bug_id>
          
          <creation_ts>2016-07-25 21:12:00 -0400</creation_ts>
          <short_desc>pmchart plots disappear when legend is turned off and back on again</short_desc>
          <delta_ts>2017-06-09 15:02:31 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>pcp</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mark Goodwin">mgoodwin</reporter>
          <assigned_to name="Dave Brolley">brolley</assigned_to>
          <cc>brolley</cc>
    
    
    <cc>fche</cc>
    
    
    <cc>lberk</cc>
    
    
    <cc>mgoodwin</cc>
    
    
    <cc>nathans</cc>
    
    
    <cc>pcp</cc>
    
    
    <cc>scox</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>pcp-3.11.9-1.fc24 pcp-3.11.10-1.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-09 15:02:31</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9548418</commentid>
    <comment_count>0</comment_count>
    <who name="Mark Goodwin">mgoodwin</who>
    <bug_when>2016-07-25 21:12:28 -0400</bug_when>
    <thetext>Description of problem: pmchart plots disappear when legend is turned off and back on again using the Edit/chart dialog

Version-Release number of selected component (if applicable): pcp-3.11.3-1 / F24

How reproducible: easily

Steps to Reproduce:
1. pmchart -c Loadavg
2. Edit/Chart
3. Disable legend, Apply, Enable legend, Apply

Actual results: all plots disappear for the current chart

Expected results: legend re-enabled without loss of any plots!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10280876</commentid>
    <comment_count>1</comment_count>
    <who name="Dave Brolley">brolley</who>
    <bug_when>2017-03-27 15:57:27 -0400</bug_when>
    <thetext>Here is a patch which fixes this problem. Reversed boolean logic was making the plots disappear when they were still visible. Seems like an obvious fix.

However, I&apos;m wondering why this loop and replot are necessary at all. There is no similar check and replot when the legend is turned off. Removing this entire loop and the call to replot() also fixes this problem.

----------------------------------------------------------

diff --git a/src/pmchart/chart.cpp b/src/pmchart/chart.cpp
index f6b92a4..6a1f974 100644
--- a/src/pmchart/chart.cpp
+++ b/src/pmchart/chart.cpp
@@ -890,7 +890,7 @@ Chart::setLegendVisible(bool on)
            // force each Legend item to &quot;checked&quot; state matching
            // the initial plotting state
            for (int i = 0; i &lt; my.items.size(); i++)
-               my.items[i]-&gt;item()-&gt;setVisible(my.items[i]-&gt;removed());
+               my.items[i]-&gt;item()-&gt;setVisible(!my.items[i]-&gt;removed());
            replot();
        }
     }</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10281017</commentid>
    <comment_count>2</comment_count>
    <who name="Dave Brolley">brolley</who>
    <bug_when>2017-03-27 16:51:08 -0400</bug_when>
    <thetext>Here&apos;s a possible reason for this check when restoring the legend.

If you click on a metric in the legend, you can toggle the plotting of that metric on and off. If you remove the legend while a metric is &quot;off&quot;, it remains &quot;off&quot; if you later restore the legend. However the new legend is literally newly created and thinks that the metric is &quot;on&quot;.

Including this loop and replot restores all active metrics to the &quot;on&quot; state in the plot.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10281036</commentid>
    <comment_count>3</comment_count>
    <who name="Dave Brolley">brolley</who>
    <bug_when>2017-03-27 16:58:43 -0400</bug_when>
    <thetext>The original patch is now available as
 commit 7b23667da3449cf7adbbfcc83bff678f914054cc at
 git://git.pcp.io/brolley/pcp.git rhbz1359961</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297201</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 01:13:10 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-aca0a468b4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297204</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 01:14:56 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-def05eeac1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297207</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 01:15:34 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-c6c3616693</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297882</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 22:21:36 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-c6c3616693</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297886</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 22:22:02 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-def05eeac1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10297956</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-02 23:53:15 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-aca0a468b4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10321964</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-10 17:20:38 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10322716</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-11 00:51:10 -0400</bug_when>
    <thetext>pcp-3.11.9-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10426118</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-18 12:31:00 -0400</bug_when>
    <thetext>pcp-3.11.10-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-c0a1605df5</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10430287</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-19 17:10:10 -0400</bug_when>
    <thetext>pcp-3.11.10-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-c0a1605df5</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10494074</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-09 15:02:31 -0400</bug_when>
    <thetext>pcp-3.11.10-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
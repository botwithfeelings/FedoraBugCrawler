<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1318303</bug_id>
          
          <creation_ts>2016-03-16 09:24:00 -0400</creation_ts>
          <short_desc>rolekit cannot deploy domain controller due to missing nss_myhostname</short_desc>
          <delta_ts>2016-03-28 15:30:41 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>rolekit</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedBlocker AcceptedFreezeException</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1284323</dependson>
          <blocked>1230432</blocked>
    
    
    <blocked>1230433</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephen Gallagher">sgallagh</reporter>
          <assigned_to name="Stephen Gallagher">sgallagh</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>codonell</cc>
    
    
    <cc>fweimer</cc>
    
    
    <cc>harald</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>twoerner</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-26 13:54:14</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9152963</commentid>
    <comment_count>0</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-03-16 09:24:21 -0400</bug_when>
    <thetext>Description of problem:
From Fedora 21 to 23, the rolekit service on Fedora Server has provided a simplified mechanism for quickly deploying a FreeIPA Domain Controller. In order to avoid a classic chicken-and-egg problem where setting up the FreeIPA server to provide DNS requires a valid DNS entry for the server itself, we have historically been able to rely on the presence of nss_myhostname in /etc/nsswitch.conf to ensure that the local hostname is resolvable to something meaningful.

Without this, the FreeIPA installation fails in a difficult-to-understand way.


Version-Release number of selected component (if applicable):
rolekit-0.5.1-1.fc24
systemd-libs-229-6.fc24.x86_64.rpm
glibc-2.23.1-5.fc24.x86_64.rpm

How reproducible:


Steps to Reproduce:
1. Install the latest Fedora Server 24 pre-release, taking all defaults
2. On the booted system, run `rolectl deploy --name=example.com domaincontroller`


Actual results:
Deployment fails with &quot;Error 256&quot;. Installation logs show that it failed attempting to determine the IP address for the machine&apos;s hostname and gethostbyname() returned nothing.

Expected results:
FreeIPA should be installed and available.

Additional info:

I&apos;m not sure where the best place to solve this is:

* Have systemd %post return to installing nss_myhostname
* Have glibc enable nss_myhostname by default
* Have rolekit modify /etc/nsswitch to add nss_myhostname when deploying
* Have rolekit modify /etc/hosts to add the current IP address(es) for the domain name.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9152982</commentid>
    <comment_count>1</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2016-03-16 09:28:11 -0400</bug_when>
    <thetext>Proposed as a Blocker for 24-beta by Fedora user sgallagh using the blocker tracking app because:

 &quot;The core functional requirements for all Featured Server Roles must be met, but it is acceptable if moderate workarounds are necessary to achieve this.&quot; -- Alpha criteria

Not a blocker for Alpha because:
&quot;For instance, if a service needs to be manually enabled or a configuration file minimally tweaked, this is acceptable.&quot;

The workaround for now is to modify either /etc/hosts or /etc/nsswitch (which we should put into Common Bugs)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9152983</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2016-03-16 09:28:35 -0400</bug_when>
    <thetext>Proposed as a Freeze Exception for 24-alpha by Fedora user sgallagh using the blocker tracking app because:

 &quot;The core functional requirements for all Featured Server Roles must be met, but it is acceptable if moderate workarounds are necessary to achieve this.&quot; -- Alpha criteria

Not a blocker for Alpha because:
&quot;For instance, if a service needs to be manually enabled or a configuration file minimally tweaked, this is acceptable.&quot;

The workaround for now is to modify either /etc/hosts or /etc/nsswitch (which we should put into Common Bugs)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9156615</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-03-17 10:43:12 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9156755</commentid>
    <comment_count>4</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-03-17 11:13:00 -0400</bug_when>
    <thetext>Adding of nss-myhostname to /etc/resolv.conf in glibc got stalled on the question whether &quot;gateway&quot; should be resolved by nss-myhostname or not. The lack of nss-myhostname is causing real issues, while we never had any bug reports about &quot;gateway&quot;. So I think we should enable nss-myhostname by default while the remaining issues are discussed.

My order of preference:
1. let glibc add myhostname to /etc/resolv.conf
2. restore the hack to enable it in systmed.rpm
3. wait</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9157169</commentid>
    <comment_count>5</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-03-17 12:54:53 -0400</bug_when>
    <thetext>(In reply to Zbigniew Jędrzejewski-Szmek from comment #4)
&gt; Adding of nss-myhostname to /etc/resolv.conf in glibc got stalled on the
&gt; question whether &quot;gateway&quot; should be resolved by nss-myhostname or not. The
&gt; lack of nss-myhostname is causing real issues, while we never had any bug
&gt; reports about &quot;gateway&quot;. So I think we should enable nss-myhostname by
&gt; default while the remaining issues are discussed.
&gt; 
&gt; My order of preference:
&gt; 1. let glibc add myhostname to /etc/resolv.conf
&gt; 2. restore the hack to enable it in systmed.rpm
&gt; 3. wait

Is there any possibility of disabling &quot;gateway&quot; in the Fedora build while that&apos;s sorted out? That way we could get nss-myhostname back in ASAP and then merge &quot;gateway&quot; back in (or not) as we work through the open questions?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9157409</commentid>
    <comment_count>6</comment_count>
    <who name="Florian Weimer">fweimer</who>
    <bug_when>2016-03-17 14:18:19 -0400</bug_when>
    <thetext>We could also use “_gateway” instead of “gateway”.  This would address my primary concern (the namespace hijack).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9158255</commentid>
    <comment_count>7</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-17 20:59:50 -0400</bug_when>
    <thetext>I&apos;m +1 freeze exception on this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9159678</commentid>
    <comment_count>8</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-03-18 10:23:49 -0400</bug_when>
    <thetext>I would vote to only resolve &quot;gateway.&quot; and not &quot;gateway&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9164357</commentid>
    <comment_count>9</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-03-21 07:42:32 -0400</bug_when>
    <thetext>Since this doesn&apos;t seem likely to get resolved for Alpha, I&apos;m going to add the following to the Common Bugs page as a temporary solution:

== Deploying Domain Controller Fails ==
Due to some changes with how the machine handles hostname resolution, the machine may not be able to look up the UP address for its own hostname. The workaround for this issue is to add a line similar to:

192.168.122.123 mymachine.mydomain.com

to /etc/hosts (replacing the IP address with the actual *external* IP and the hostname with the real hostname of the system).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9165948</commentid>
    <comment_count>10</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-03-21 13:17:12 -0400</bug_when>
    <thetext>Discussed at today&apos;s blocker review meeting [1]. Voted as  AcceptedFreezeException (Alpha) - this is clearly a significant issue for Server that cannot be fully fixed with an update. It&apos;s accepted as a freeze exception, if a sufficiently targeted fix is found it will be accepted

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-03-21</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9166082</commentid>
    <comment_count>11</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-03-21 14:01:22 -0400</bug_when>
    <thetext>In the same meeting, also voted as AcceptedBlocker (Beta) - clear violation of &quot;The core functional requirements for all Featured Server Roles must be met, without any workarounds being necessary.&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9169350</commentid>
    <comment_count>12</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-03-22 11:13:18 -0400</bug_when>
    <thetext>I&apos;ll start the process to change the resolution of &quot;gateway&quot; upstream, but I think this will take a while, and we need some fix now.

I restored the addition of myhostname to /etc/nsswitch.conf in systemd %post now. It&apos;s building in rawhide/f24 currently.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9169501</commentid>
    <comment_count>13</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-03-22 11:36:36 -0400</bug_when>
    <thetext>Zbigniew, could you please modify that so it follows the implementation I suggested in BZ#1284323 ?

That way, it at least won&apos;t cache-poison for temporary DNS failures.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9170920</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-22 19:32:29 -0400</bug_when>
    <thetext>systemd-229-7.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-14ac3b6fd4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9174199</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-23 15:56:18 -0400</bug_when>
    <thetext>systemd-229-7.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-14ac3b6fd4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9180129</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-26 13:54:06 -0400</bug_when>
    <thetext>systemd-229-7.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
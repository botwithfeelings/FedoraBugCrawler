<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1315098</bug_id>
          
          <creation_ts>2016-03-06 11:39:00 -0500</creation_ts>
          <short_desc>ejabberd-16.01-3 fails to start due to &quot;Application p1_zlib exited&quot;</short_desc>
          <delta_ts>2016-03-06 12:31:02 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>erlang-p1_zlib</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Randy Barlow">rbarlow</reporter>
          <assigned_to name="Randy Barlow">rbarlow</assigned_to>
          <cc>erlang</cc>
    
    
    <cc>jeremy</cc>
    
    
    <cc>rbarlow</cc>
          <qa_contact name="Randy Barlow">rbarlow</qa_contact>
          
          <cf_fixed_in>erlang-p1_zlib-1.0.0-2.fc24, erlang-p1_zlib-1.0.1-2.fc25</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-06 12:31:02</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9123785</commentid>
    <comment_count>0</comment_count>
    <who name="Randy Barlow">rbarlow</who>
    <bug_when>2016-03-06 11:39:06 -0500</bug_when>
    <thetext>ejabberd does not start correctly, seemingly due to the p1_zlib package not providing a shared object that it can find. Here is what I see in the ejabberd log file:

2016-03-06 11:09:28.773 [info] &lt;0.7.0&gt; Application lager started on node ejabberd@localhost
2016-03-06 11:09:28.889 [info] &lt;0.7.0&gt; Application crypto started on node ejabberd@localhost
2016-03-06 11:09:28.938 [info] &lt;0.7.0&gt; Application sasl started on node ejabberd@localhost
2016-03-06 11:09:28.986 [info] &lt;0.7.0&gt; Application asn1 started on node ejabberd@localhost
2016-03-06 11:09:28.986 [info] &lt;0.7.0&gt; Application public_key started on node ejabberd@localhost
2016-03-06 11:09:29.022 [info] &lt;0.7.0&gt; Application ssl started on node ejabberd@localhost
2016-03-06 11:09:29.085 [info] &lt;0.7.0&gt; Application p1_yaml started on node ejabberd@localhost
2016-03-06 11:09:29.173 [info] &lt;0.7.0&gt; Application p1_tls started on node ejabberd@localhost
2016-03-06 11:09:29.223 [info] &lt;0.7.0&gt; Application p1_xml started on node ejabberd@localhost
2016-03-06 11:09:29.328 [info] &lt;0.7.0&gt; Application p1_stringprep started on node ejabberd@localhost
2016-03-06 11:09:29.384 [error] &lt;0.123.0&gt; failed to load zlib driver: cannot open shared object file: Not a directory
2016-03-06 11:09:29.384 [error] &lt;0.123.0&gt; CRASH REPORT Process &lt;0.123.0&gt; with 0 neighbours exited with reason: {open_error,-10} in gen_server:init_it/6 line 344
2016-03-06 11:09:29.384 [error] &lt;0.122.0&gt; Supervisor ezlib_sup had child undefined started with ezlib:start_link() at undefined exit with reason {open_error,-10} in context start_error
2016-03-06 11:09:29.384 [critical] &lt;0.38.0&gt;@ejabberd:exit_or_halt:133 failed to start application &apos;p1_zlib&apos;: {error,
                                        {{shutdown,
                                          {failed_to_start_child,ezlib,
                                           {open_error,-10}}},
                                         {ezlib_app,start,[normal,[]]}}}
2016-03-06 11:09:29.384 [error] &lt;0.120.0&gt; CRASH REPORT Process &lt;0.120.0&gt; with 0 neighbours exited with reason: {{shutdown,{failed_to_start_child,ezlib,{open_error,-10}}},{ezlib_app,start,[normal,[]]}} in application_master:init/4 line 134
2016-03-06 11:09:29.385 [info] &lt;0.7.0&gt; Application p1_zlib exited with reason: {{shutdown,{failed_to_start_child,ezlib,{open_error,-10}}},{ezlib_app,start,[normal,[]]}}

When I look at the p1_zlib installation, I notice that the shared object is just called &quot;lib&quot;, which doesn&apos;t seem right but it does seem to be the correct .so:
# ldd /usr/lib64/erlang/lib/p1_zlib-1.0.0/priv/lib 
	linux-vdso.so.1 (0x00007ffc598d8000)
	libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f926b1c7000)
	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f926adf9000)
	/lib64/ld-linux-x86-64.so.2 (0x000056174697d000)

I&apos;m not sure what the .so should be named, but I am pretty sure lib is not correct.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9123792</commentid>
    <comment_count>1</comment_count>
    <who name="Randy Barlow">rbarlow</who>
    <bug_when>2016-03-06 11:47:24 -0500</bug_when>
    <thetext>The issue was that the spec file installs the ezlib_drv.so to $RPM_BUILD_ROOT%{_erllibdir}/%{srcname}-%{version}/priv/lib instead of to $RPM_BUILD_ROOT%{_erllibdir}/%{srcname}-%{version}/priv/lib/. At least it&apos;s an easy fix!</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
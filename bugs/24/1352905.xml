<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1352905</bug_id>
          
          <creation_ts>2016-07-05 08:29:00 -0400</creation_ts>
          <short_desc>In fedora-24 virt-builder template, chronyd is running but timedatectl says &quot;Networktime: no&quot;</short_desc>
          <delta_ts>2016-07-20 12:24:24 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>comps</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marius Vollmer">mvollmer</reporter>
          <assigned_to name="Kevin Fenzi">kevin</assigned_to>
          <cc>kevin</cc>
    
    
    <cc>mbooth</cc>
    
    
    <cc>ptoscano</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>virt-maint</cc>
    
    
    <cc>vpavlin</cc>
          
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-07-20 12:24:24</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9481139</commentid>
    <comment_count>0</comment_count>
    <who name="Marius Vollmer">mvollmer</who>
    <bug_when>2016-07-05 08:29:26 -0400</bug_when>
    <thetext>Description of problem:

On Fedora Server, chronyd is running but timedatectl says &quot;Network time: no&quot;.



Version-Release number of selected component (if applicable):
chrony-2.4-1.fc24.x86_64
systemd-229-8.fc24.x86_64
package timedatex is not installed

How reproducible:
Always

Steps to Reproduce:

$ virt-builder fedora-24

In that VM:
# systemctl status chronyd
● chronyd.service - NTP client/server
   Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled; vendor pres
   Active: active (running) since Tue 2016-07-05 03:51:01 EDT; 4h 23min ago
 Main PID: 477 (chronyd)
    Tasks: 1 (limit: 512)
   CGroup: /system.slice/chronyd.service
           └─477 /usr/sbin/chronyd

# timedatectl 
      Local time: Tue 2016-07-05 08:13:57 EDT
  Universal time: Tue 2016-07-05 12:13:57 UTC
        RTC time: Tue 2016-07-05 12:13:56
       Time zone: America/New_York (EDT, -0400)
 Network time on: no
NTP synchronized: yes
 RTC in local TZ: no

# timedatectl set-ntp on

# systemctl is-active chronyd
inactive

# systemctl is-active systemd-timesyncd
active

Actual results:
Chronyd is initially running, timedatectl says &quot;Network time: no&quot;, and timedatectl set-ntp on starts timesyncd.

Expected results:
Either: chronyd is not initially running and timedatectl starts/stops timesyncd.
Or: chronyd is initially running and started/stopped by timedatectl.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9481232</commentid>
    <comment_count>1</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-07-05 09:13:21 -0400</bug_when>
    <thetext>I have literally no idea about this, except it&apos;s unlikely to be anything
to do with virt-builder.

Are you using user networking for the VM?  User networking (ie SLIRP)
probably doesn&apos;t let NTP packets pass.

If it&apos;s not that, would suggest asking systemd folk.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9481255</commentid>
    <comment_count>2</comment_count>
    <who name="Marius Vollmer">mvollmer</who>
    <bug_when>2016-07-05 09:24:34 -0400</bug_when>
    <thetext>&gt; I have literally no idea about this, except it&apos;s unlikely to be anything
to do with virt-builder.

Yeah, I filed it here because most likely this is a issue with how the OS is installed.  I.e., chrony probably shouldn&apos;t be there by default.

Where would I file a bug like &quot;chrony should not be in the @core package group&quot;?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9481291</commentid>
    <comment_count>3</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-07-05 09:32:43 -0400</bug_when>
    <thetext>I believe you would have to change the &quot;Component&quot; field to &quot;comps&quot;
(alternately, file a new bug against &quot;comps&quot;).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9486362</commentid>
    <comment_count>4</comment_count>
    <who name="Marius Vollmer">mvollmer</who>
    <bug_when>2016-07-07 03:49:38 -0400</bug_when>
    <thetext>(In reply to Richard W.M. Jones from comment #3)
&gt; I believe you would have to change the &quot;Component&quot; field to &quot;comps&quot;
&gt; (alternately, file a new bug against &quot;comps&quot;).

Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9497720</commentid>
    <comment_count>5</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-07-11 15:23:57 -0400</bug_when>
    <thetext>As far as I know, Chrony is in fact the default in Fedora (and hasn&apos;t been overridden by any working groups). https://fedoraproject.org/wiki/Features/ChronyDefaultNTP

Sounds like perhaps we should be also installing timedatex so timedatectl does the right thing? 

If you install timedatex does it work as expected?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9500954</commentid>
    <comment_count>6</comment_count>
    <who name="Marius Vollmer">mvollmer</who>
    <bug_when>2016-07-12 06:47:09 -0400</bug_when>
    <thetext>(In reply to Kevin Fenzi from comment #5)
 
&gt; If you install timedatex does it work as expected?

Yes, it does.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9502391</commentid>
    <comment_count>7</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-07-12 13:37:48 -0400</bug_when>
    <thetext>Created pull request to add it: 

https://pagure.io/fedora-comps/pull-request/33</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9533301</commentid>
    <comment_count>8</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-07-20 12:24:24 -0400</bug_when>
    <thetext>Merged upstream. Should be in the next pushes...</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1351007</bug_id>
          
          <creation_ts>2016-06-28 22:49:00 -0400</creation_ts>
          <short_desc>nodejs should provides npm and obsolete npm-3.5.4-5.fc24.noarch</short_desc>
          <delta_ts>2017-04-18 02:46:52 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>nodejs</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1096506</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sergio Monteiro Basto">sergio</reporter>
          <assigned_to name="NodeJS Packaging SIG">nodejs-sig</assigned_to>
          <cc>alick9188</cc>
    
    
    <cc>hhorak</cc>
    
    
    <cc>jamielinux</cc>
    
    
    <cc>jorris</cc>
    
    
    <cc>jpopelka</cc>
    
    
    <cc>marseille07</cc>
    
    
    <cc>mike</cc>
    
    
    <cc>mrunge</cc>
    
    
    <cc>ncross</cc>
    
    
    <cc>nodejs-sig</cc>
    
    
    <cc>piotr1212</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>tchollingsworth</cc>
    
    
    <cc>thrcka</cc>
    
    
    <cc>tn</cc>
    
    
    <cc>tom</cc>
    
    
    <cc>zsvetlik</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>nodejs-4.5.0-1.fc24 nodejs-6.4.0-102.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-24 09:50:40</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9461222</commentid>
    <comment_count>0</comment_count>
    <who name="Sergio Monteiro Basto">sergio</who>
    <bug_when>2016-06-28 22:49:09 -0400</bug_when>
    <thetext>Description of problem:
when rpm spec requires npm in a ock build I got 

error: package npm-3.5.4-5.fc24.noarch requires nodejs(engine), but none of the providers can be installed

reading npm last commit that nodejs bundle npm , seems to me , that nodejs rpm spec also should have [1]

Provides: oldpackagename = $provEVR
Obsoletes: oldpackagename &lt; $obsEVR

[1] 
https://fedoraproject.org/wiki/Packaging:Guidelines#Renaming.2FReplacing_Existing_Packages


Version-Release number of selected component (if applicable):
nodejs-4.4.6-2.fc24

How reproducible:
add BuildRequires: npm in one .spec file .</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9461541</commentid>
    <comment_count>1</comment_count>
    <who name="Tom Hughes">tom</who>
    <bug_when>2016-06-29 02:13:33 -0400</bug_when>
    <thetext>It already does:

bericote [~] % rpm -q --provides nodejs 
npm = 1:2.15.5
npm(npm) = 2.15.5
bericote [~] % rpm -q --obsoletes nodejs
npm &lt; 0:3.5.4-6

Discussion of the actual problem is here:

https://lists.fedoraproject.org/archives/list/nodejs@lists.fedoraproject.org/thread/ZVMIY5LM5HXGWCP7FTZCLTAAEKPVHNMW/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9463349</commentid>
    <comment_count>2</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-06-29 07:45:12 -0400</bug_when>
    <thetext>I suspect the problem may actually be the virtual &apos;Provides: npm(npm)&apos; since we
had to drop the epoch on that for other reasons. Since that virtual Provides
went backwards and other packages in the transaction have explicit &quot;Requires:
npm(npm) &gt;= something&quot; in them, DNF is trying to pull in the package that
satisfies the highest version of that virtual dependency available.

At this point, I think we have three choices:

1) Hope that the NPM bundled in Node.js eventually updates past 3.5.4 (unlikely).

2) Figure out how to fix the automatic dependency generation so that it&apos;s aware
and tolerant of epochs.

3) Drop the bundled NPM from Node.js in F24 only, create an updated NPM package
(bundled, to avoid the dependency nightmare) providing the version we&apos;re going
to have in Fedora 25 (and tracking it). Then when F25 rolls around, it will get dropped on upgrade. We will just have to make sure that the release field on F25 is always at least one higher than on F24 so we can bump the Obsoletes safely.

I think 3) is the best choice. People will get newer NPM features (and NPM is
backwards-compatible), and it still lets us kill off the separate NPM package in
F25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9463353</commentid>
    <comment_count>3</comment_count>
    <who name="Tom Hughes">tom</who>
    <bug_when>2016-06-29 07:47:58 -0400</bug_when>
    <thetext>Sergio - can you clarify what your spec was requiring? Was it &quot;npm&quot; or &quot;npm(npm)&quot; that you were requiring?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9463776</commentid>
    <comment_count>4</comment_count>
    <who name="Sergio Monteiro Basto">sergio</who>
    <bug_when>2016-06-29 09:18:02 -0400</bug_when>
    <thetext>is &quot;BuildRequires: npm&quot; ,  it easy to reproduce : 


mock -r fedora-24-x86_64 --init
mock -r fedora-24-x86_64 --install nodejs npm

Error: package npm-3.5.4-5.fc24.noarch requires nodejs(engine), but none of the providers can be installed
(try to add &apos;--allowerasing&apos; to command line to replace conflicting packages)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9463940</commentid>
    <comment_count>5</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-06-29 09:53:29 -0400</bug_when>
    <thetext>(In reply to Sergio Monteiro Basto from comment #4)
&gt; is &quot;BuildRequires: npm&quot; ,  it easy to reproduce : 
&gt; 
&gt; 
&gt; mock -r fedora-24-x86_64 --init
&gt; mock -r fedora-24-x86_64 --install nodejs npm
&gt; 
&gt; Error: package npm-3.5.4-5.fc24.noarch requires nodejs(engine), but none of
&gt; the providers can be installed
&gt; (try to add &apos;--allowerasing&apos; to command line to replace conflicting packages)

That at least looks like we&apos;re hitting https://bugzilla.redhat.com/show_bug.cgi?id=1096506 which is about DNF&apos;s Obsoletes handling not dealing properly with a new Provides: packagename while the old one is also in the enabled repositories.

I&apos;m linking this bug to that one.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9493258</commentid>
    <comment_count>6</comment_count>
    <who name="Tom Hughes">tom</who>
    <bug_when>2016-07-09 02:47:25 -0400</bug_when>
    <thetext>*** Bug 1339284 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9493687</commentid>
    <comment_count>7</comment_count>
    <who name="Satoshi Yagi">marseille07</who>
    <bug_when>2016-07-09 16:22:55 -0400</bug_when>
    <thetext>Why can&apos;t we kill off the NPM rpm from F24?  Node.js RPM already provides npm that installs cleanly, no?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9493773</commentid>
    <comment_count>8</comment_count>
    <who name="Tom Hughes">tom</who>
    <bug_when>2016-07-09 19:01:28 -0400</bug_when>
    <thetext>Packages can&apos;t be retired from released versions.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9494006</commentid>
    <comment_count>9</comment_count>
    <who name="Satoshi Yagi">marseille07</who>
    <bug_when>2016-07-09 23:35:44 -0400</bug_when>
    <thetext>In that case, I agree that the option 3 suggested by Stephen Gallagher is the best option going forward.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9494008</commentid>
    <comment_count>10</comment_count>
    <who name="Sergio Monteiro Basto">sergio</who>
    <bug_when>2016-07-09 23:49:09 -0400</bug_when>
    <thetext>(In reply to Stephen Gallagher from comment #2)
&gt; I suspect the problem may actually be the virtual &apos;Provides: npm(npm)&apos; since
&gt; we had to drop the epoch on that for other reasons. 

https://pkgs.fedoraproject.org/cgit/rpms/nodejs.git/tree/nodejs.spec?h=f24 
says:

# Do not add epoch to the virtual NPM provides or it will break
# the automatic dependency-generation script.
Provides: npm(npm) = %{npm_version}

why or how Provides: npm(npm) = %{epoch}:%{npm_version} breaks things ? I&apos;m not seeing the problem</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9494189</commentid>
    <comment_count>11</comment_count>
    <who name="Satoshi Yagi">marseille07</who>
    <bug_when>2016-07-10 02:10:39 -0400</bug_when>
    <thetext>&gt; why or how Provides: npm(npm) = %{epoch}:%{npm_version} breaks things ? I&apos;m
&gt; not seeing the problem

I don&apos;t think it does.  The real issue here is more of this:

&gt; bericote [~] % rpm -q --obsoletes nodejs
&gt; npm &lt; 0:3.5.4-6

As of this writing, my attempt to install npm tries 0:3.5.4-5, which is obsoleted by the spec above.  I wonder what happens when npm RPM gets past 0:3.5.4-6 and it would no longer be obsoleted by nodejs.

In any event, npm being provided by two packages is confusing and I&apos;d still suggest npm be ripped out of nodejs RPM so that nodejs and npm RPMs can both be installed side-by-side.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604083</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-10 14:51:47 -0400</bug_when>
    <thetext>nodejs-4.4.7-3.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4bdfc3814d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604195</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-10 15:08:54 -0400</bug_when>
    <thetext>nodejs-6.3.1-100.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4c2ba7374b</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9608117</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-11 12:56:57 -0400</bug_when>
    <thetext>nodejs-6.3.1-100.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-4c2ba7374b</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9609488</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-11 23:03:27 -0400</bug_when>
    <thetext>nodejs-4.4.7-3.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-4bdfc3814d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9620169</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-16 15:05:52 -0400</bug_when>
    <thetext>nodejs-6.3.1-101.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-1dbf4ecb44</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9620171</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-16 15:06:14 -0400</bug_when>
    <thetext>nodejs-4.4.7-4.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-320d68efc7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9624129</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-17 15:54:14 -0400</bug_when>
    <thetext>nodejs-6.3.1-101.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-1dbf4ecb44</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9624814</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-17 21:52:28 -0400</bug_when>
    <thetext>nodejs-4.4.7-4.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-320d68efc7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9626432</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-18 09:39:48 -0400</bug_when>
    <thetext>nodejs-4.5.0-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-d77212291e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9626518</commentid>
    <comment_count>21</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-18 10:00:50 -0400</bug_when>
    <thetext>nodejs-6.4.0-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-3e93f6e67a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9627301</commentid>
    <comment_count>22</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-18 12:53:52 -0400</bug_when>
    <thetext>nodejs-6.4.0-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-3e93f6e67a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9628688</commentid>
    <comment_count>23</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-18 20:59:04 -0400</bug_when>
    <thetext>nodejs-4.5.0-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-d77212291e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9644510</commentid>
    <comment_count>24</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-24 02:44:47 -0400</bug_when>
    <thetext>nodejs-6.4.0-102.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-da53dbccd6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9644690</commentid>
    <comment_count>25</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-24 03:53:33 -0400</bug_when>
    <thetext>nodejs-6.4.0-102.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-da53dbccd6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9645881</commentid>
    <comment_count>26</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-24 09:50:28 -0400</bug_when>
    <thetext>nodejs-4.5.0-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9664689</commentid>
    <comment_count>27</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-30 14:18:46 -0400</bug_when>
    <thetext>nodejs-6.4.0-102.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
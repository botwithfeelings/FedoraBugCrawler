<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1303117</bug_id>
          
          <creation_ts>2016-01-29 10:31:00 -0500</creation_ts>
          <short_desc>hy_package_get_requires should return also &quot;Requires(pre)&quot;</short_desc>
          <delta_ts>2017-03-02 04:58:10 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>hawkey</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Triaged</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Harald Hoyer">harald</reporter>
          <assigned_to>rpm-software-management</assigned_to>
          <cc>jmracek</cc>
    
    
    <cc>mdomonko</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>RadekHolyPublic</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-02 04:58:10</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9021494</commentid>
    <comment_count>0</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-01-29 10:31:16 -0500</bug_when>
    <thetext>$ sudo dnf repoquery  --disablerepo=* --enablerepo=rawhide --requires kernel-core
/bin/sh
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(FileDigests) &lt;= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
rpmlib(PayloadIsXz) &lt;= 5.2-1
systemd &gt;= 200

compared to:

$ repoquery  --disablerepo=* --enablerepo=rawhide --requires kernel-core

Yum-utils package has been deprecated, use dnf instead.
See &apos;man yum2dnf&apos; for more information.


/bin/sh
dracut &gt;= 027
fileutils
linux-firmware &gt;= 20150904-56.git6ebf5d57
systemd &gt;= 200
systemd &gt;= 203-2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9021495</commentid>
    <comment_count>1</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-01-29 10:31:46 -0500</bug_when>
    <thetext>Basically it&apos;s missing &quot;Requires(pre)&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9026065</commentid>
    <comment_count>2</comment_count>
    <who name="Michal Domonkos">mdomonko</who>
    <bug_when>2016-02-01 08:28:53 -0500</bug_when>
    <thetext>We should definitely fix this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9029659</commentid>
    <comment_count>3</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-02-02 11:19:58 -0500</bug_when>
    <thetext>(In reply to Michal Domonkos from comment #2)
&gt; We should definitely fix this.

Yes :) Do you have a quick fix in mind, so I can continue with my research?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9072671</commentid>
    <comment_count>4</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-02-17 11:49:39 -0500</bug_when>
    <thetext>(In reply to Harald Hoyer from comment #3)
&gt; (In reply to Michal Domonkos from comment #2)
&gt; &gt; We should definitely fix this.
&gt; 
&gt; Yes :) Do you have a quick fix in mind, so I can continue with my research?

ping?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9072706</commentid>
    <comment_count>5</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2016-02-17 12:03:04 -0500</bug_when>
    <thetext>we&apos;ll introduce a new repoquery option to list these requirements. It should be separated from the `--requires` as these are more like BuildRequires not necessary needed for package to run.

I am sorry but there is currently no quick fix but we have it on agenda.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9072726</commentid>
    <comment_count>6</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-02-17 12:11:29 -0500</bug_when>
    <thetext>might be a hawkey problem

&gt;&gt;&gt; import dnf
&gt;&gt;&gt; b = dnf.Base()
&gt;&gt;&gt; b.conf.cachedir = dnf.yum.misc.getCacheDir()
&gt;&gt;&gt; b.fill_sack()
&lt;dnf.sack.Sack object at 0x7f2a981b9940&gt;
&gt;&gt;&gt; b.add_remote_rpm(&quot;/home/harald/Downloads/kernel-core-4.5.0-0.rc4.git0.1.fc24.x86_64.rpm&quot;)
&lt;hawkey.Package object id 4241, kernel-core-4.5.0-0.rc4.git0.1.fc24.x86_64, @commandline&gt;
&gt;&gt;&gt; pkgs = b.sack.query().available().run()
&gt;&gt;&gt; [str(x) for x in pkgs[0].requires]
[&apos;/bin/sh&apos;, &apos;rpmlib(CompressedFileNames) &lt;= 3.0.4-1&apos;, &apos;rpmlib(FileDigests) &lt;= 4.6.0-1&apos;, &apos;rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1&apos;, &apos;rpmlib(PayloadIsXz) &lt;= 5.2-1&apos;]
&gt;&gt;&gt; str(pkgs[0].name)
&apos;kernel-core&apos;


~$ rpm -qp --requires /home/harald/Downloads/kernel-core-4.5.0-0.rc4.git0.1.fc24.x86_64.rpm
/bin/sh
/bin/sh
/bin/sh
dracut &gt;= 027
fileutils
linux-firmware &gt;= 20150904-56.git6ebf5d57
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(FileDigests) &lt;= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
rpmlib(PayloadIsXz) &lt;= 5.2-1
systemd &gt;= 200
systemd &gt;= 203-2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9072728</commentid>
    <comment_count>7</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-02-17 12:12:03 -0500</bug_when>
    <thetext>(In reply to Jan Silhan from comment #5)
&gt; we&apos;ll introduce a new repoquery option to list these requirements. It should
&gt; be separated from the `--requires` as these are more like BuildRequires not
&gt; necessary needed for package to run.
&gt; 
&gt; I am sorry but there is currently no quick fix but we have it on agenda.

Huh? Requires(pre) is absolutely needed!!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9075471</commentid>
    <comment_count>8</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-02-18 09:24:29 -0500</bug_when>
    <thetext>This makes it work for me

~/git/hawkey (master)$ git diff
diff --git a/src/package.c b/src/package.c
index 5c7a637..781d39b 100644
--- a/src/package.c
+++ b/src/package.c
@@ -26,6 +26,7 @@
 #include &lt;solv/pool.h&gt;
 #include &lt;solv/repo.h&gt;
 #include &lt;solv/util.h&gt;
+#include &lt;solv/queue.h&gt;
 
 // hawkey
 #include &quot;advisory_internal.h&quot;
@@ -65,9 +66,22 @@ reldeps_for(HyPackage pkg, Id type)
     Solvable *s = get_solvable(pkg);
     HyReldepList reldeplist;
     Queue q;
+    Id marker = -1;
+    int i;
 
+    if (type == SOLVABLE_REQUIRES)
+            marker = 0;
     queue_init(&amp;q);
-    solvable_lookup_deparray(s, type, &amp;q, -1);
+    solvable_lookup_deparray(s, type, &amp;q, marker);
+    if (type == SOLVABLE_REQUIRES) {
+            for (i = 0; i &lt; q.count; i++) {
+                    if (q.elements[i] == SOLVABLE_PREREQMARKER) {
+                            queue_delete(&amp;q, i);
+                            break;
+                    }
+            }
+    }
+
     reldeplist = reldeplist_from_queue(pool, q);</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9092969</commentid>
    <comment_count>9</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 09:21:52 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9139316</commentid>
    <comment_count>10</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-03-10 13:07:21 -0500</bug_when>
    <thetext>ping???</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9268393</commentid>
    <comment_count>11</comment_count>
    <who name="Michal Luscon">mluscon</who>
    <bug_when>2016-04-26 04:48:43 -0400</bug_when>
    <thetext>Hi Harald,

we decided to implement a --requires-pre switch. PR is available at https://github.com/rpm-software-management/libhif/pull/95 .</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9288081</commentid>
    <comment_count>12</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-05-03 08:21:17 -0400</bug_when>
    <thetext>(In reply to Michal Luscon from comment #11)
&gt; Hi Harald,
&gt; 
&gt; we decided to implement a --requires-pre switch. PR is available at
&gt; https://github.com/rpm-software-management/libhif/pull/95 .

Thanks!

Although, I don&apos;t need the patch anymore.
I thought, that Requires(pre) implies a normal Requires, which is apparently not the case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9490135</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-07-08 05:25:03 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10201182</commentid>
    <comment_count>14</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-03-02 04:58:10 -0500</bug_when>
    <thetext>Released in libdnf-0.7.4 in fedora rawhide.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1317623</bug_id>
          
          <creation_ts>2016-03-14 13:15:00 -0400</creation_ts>
          <short_desc>ostree fails to install into installer iso</short_desc>
          <delta_ts>2016-03-18 13:54:38 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>ostree</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Patch</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dennis Gilmore">dennis</reporter>
          <assigned_to name="Colin Walters">walters</assigned_to>
          <cc>acarter</cc>
    
    
    <cc>dennis</cc>
    
    
    <cc>pfrields</cc>
    
    
    <cc>walters</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-18 13:54:38</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9147045</commentid>
    <comment_count>0</comment_count>
    <who name="Dennis Gilmore">dennis</who>
    <bug_when>2016-03-14 13:15:01 -0400</bug_when>
    <thetext>Description of problem:
2016-03-14 02:34:30,898: running /spin-kickstarts/atomic-installer/lorax-embed-repo.tmpl
running /spin-kickstarts/atomic-installer/lorax-embed-repo.tmpl
2016-03-14 02:34:31,126: template command error in /spin-kickstarts/atomic-installer/lorax-embed-repo.tmpl:
template command error in /spin-kickstarts/atomic-installer/lorax-embed-repo.tmpl:
2016-03-14 02:34:31,127:   runcmd ostree --repo=/tmp/lorax.valebh9x/iso-graft/content/repo pull --mirror ostree-mirror fedora-atomic/24/x86_64/docker-host
  runcmd ostree --repo=/tmp/lorax.valebh9x/iso-graft/content/repo pull --mirror ostree-mirror fedora-atomic/24/x86_64/docker-host
2016-03-14 02:34:31,129:   subprocess.CalledProcessError: Command &apos;[&apos;ostree&apos;, &apos;--repo=/tmp/lorax.valebh9x/iso-graft/content/repo&apos;, &apos;pull&apos;, &apos;--mirror&apos;, &apos;ostree-mirror&apos;, &apos;fedora-atomic/24/x86_64/docker-host&apos;]&apos; returned non-zero exit 
status 1
  subprocess.CalledProcessError: Command &apos;[&apos;ostree&apos;, &apos;--repo=/tmp/lorax.valebh9x/iso-graft/content/repo&apos;, &apos;pull&apos;, &apos;--mirror&apos;, &apos;ostree-mirror&apos;, &apos;fedora-atomic/24/x86_64/docker-host&apos;]&apos; returned non-zero exit status 1
Traceback (most recent call last):
  File &quot;/usr/sbin/lorax&quot;, line 353, in &lt;module&gt;
    main(sys.argv)
  File &quot;/usr/sbin/lorax&quot;, line 209, in main
    remove_temp=True, verify=opts.verify)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/__init__.py&quot;, line 355, in run
    treebuilder.build()
  File &quot;/usr/lib/python3.5/site-packages/pylorax/treebuilder.py&quot;, line 300, in build
    self._runner.run(tmpl, **self.add_template_vars)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/ltmpl.py&quot;, line 219, in run
    self._run(commands)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/ltmpl.py&quot;, line 238, in _run
    f(*args)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/ltmpl.py&quot;, line 484, in runcmd
    stdout = runcmd_output(cmd)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/executils.py&quot;, line 345, in runcmd_output
    return execWithCapture(cmd[0], cmd[1:], **kwargs)
  File &quot;/usr/lib/python3.5/site-packages/pylorax/executils.py&quot;, line 247, in execWithCapture
    reset_handlers=reset_handlers, reset_lang=reset_lang)[1]
  File &quot;/usr/lib/python3.5/site-packages/pylorax/executils.py&quot;, line 199, in _run_program
    raise subprocess.CalledProcessError(proc.returncode, argv, output)
subprocess.CalledProcessError: Command &apos;[&apos;ostree&apos;, &apos;--repo=/tmp/lorax.valebh9x/iso-graft/content/repo&apos;, &apos;pull&apos;, &apos;--mirror&apos;, &apos;ostree-mirror&apos;, &apos;fedora-atomic/24/x86_64/docker-host&apos;]&apos; returned non-zero exit status 1
Finish: shell


Version-Release number of selected component (if applicable):


How reproducible:


Steps to Reproduce:
1.
2.
3.

Actual results:


Expected results:


Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9147219</commentid>
    <comment_count>1</comment_count>
    <who name="Colin Walters">walters</who>
    <bug_when>2016-03-14 14:10:31 -0400</bug_when>
    <thetext>I don&apos;t like it much, but lorax puts subprocess output in `program.log`, so we&apos;ll need that to debug.

If one is implementing a CI/CD system, I&apos;d export `program.log` as an artifact.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9147726</commentid>
    <comment_count>2</comment_count>
    <who name="Dennis Gilmore">dennis</who>
    <bug_when>2016-03-14 18:39:11 -0400</bug_when>
    <thetext>The full log is at 
https://kojipkgs.fedoraproject.org/compose/branched/Fedora-24-20160314.n.0/logs/x86_64/atomic  it does look like it is getting a 404 error, but why I am not sure</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9147736</commentid>
    <comment_count>3</comment_count>
    <who name="Dennis Gilmore">dennis</who>
    <bug_when>2016-03-14 18:55:16 -0400</bug_when>
    <thetext>https://git.fedorahosted.org/cgit/fedora-atomic.git/tree/fedora-atomic-docker-host.json?h=f24

&quot;ref&quot;: &quot;fedora-atomic/rawhide/x86_64/docker-host&quot;,

    &quot;repos&quot;: [&quot;fedora-rawhide&quot;],

    &quot;selinux&quot;: true,

    &quot;documentation&quot;: false,

    &quot;automatic_version_prefix&quot;: &quot;23&quot;,


the ref, repos and automatic_version_prefix are wrong. please fix.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150665</commentid>
    <comment_count>4</comment_count>
      <attachid>1136748</attachid>
    <who name="Paul W. Frields">pfrields</who>
    <bug_when>2016-03-15 16:12:23 -0400</bug_when>
    <thetext>Created attachment 1136748
patch locations for F24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150692</commentid>
    <comment_count>5</comment_count>
    <who name="Paul W. Frields">pfrields</who>
    <bug_when>2016-03-15 16:25:36 -0400</bug_when>
    <thetext>Sorry, that&apos;s only half the fix. Dennis tells me the fedora.repo file also needs to exist in the tree, rather than fedora-rawhide.repo, with corrected content.

Dennis can let us know if any of this is wrong, but I lifted straight from the f23 branch:

https://demo.modernpaste.com/paste/Kr4YrsELQcbAIUl-cotn9RQDRB9BZ42MRHb4Tt8RGHY=/raw</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150810</commentid>
    <comment_count>6</comment_count>
      <attachid>1136763</attachid>
    <who name="Paul W. Frields">pfrields</who>
    <bug_when>2016-03-15 17:08:25 -0400</bug_when>
    <thetext>Created attachment 1136763
Fixed - patch locations for F24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9160609</commentid>
    <comment_count>7</comment_count>
    <who name="Colin Walters">walters</who>
    <bug_when>2016-03-18 13:54:38 -0400</bug_when>
    <thetext>Sorry about the delay, the bugzilla mail here got lost in a deluge of other stuff.

Thanks a ton for patching this!  It almost worked, I just had to set gpgverify=0 due to:

https://github.com/projectatomic/rpm-ostree/issues/237

Committed as:

https://git.fedorahosted.org/cgit/fedora-atomic.git/commit/?h=f24

And sorry about not having tested the branching.  I filed
https://github.com/projectatomic/rpm-ostree/issues/236

which would also help, although my original intention with the JSON was that other higher level tools (e.g. pungi) would generate parts of the JSON.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1136748</attachid>
            <date>2016-03-15 16:12:00 -0400</date>
            <delta_ts>2016-03-15 17:08:25 -0400</delta_ts>
            <desc>patch locations for F24</desc>
            <filename>fedora-atomic-docker-host.json-f24.patch</filename>
            <type>text/plain</type>
            <size>570</size>
            <attacher name="Paul W. Frields">pfrields</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2ZlZG9yYS1hdG9taWMtZG9ja2VyLWhvc3QuanNvbiBiL2ZlZG9yYS1hdG9t
aWMtZG9ja2VyLWhvc3QuanNvbgppbmRleCBiOWYwMzQyLi44ODcyZWE1IDEwMDY0NAotLS0gYS9m
ZWRvcmEtYXRvbWljLWRvY2tlci1ob3N0Lmpzb24KKysrIGIvZmVkb3JhLWF0b21pYy1kb2NrZXIt
aG9zdC5qc29uCkBAIC0xLDEzICsxLDEzIEBACiB7Ci0gICAgInJlZiI6ICJmZWRvcmEtYXRvbWlj
L3Jhd2hpZGUveDg2XzY0L2RvY2tlci1ob3N0IiwKKyAgICAicmVmIjogImZlZG9yYS1hdG9taWMv
MjQveDg2XzY0L2RvY2tlci1ob3N0IiwKIAotICAgICJyZXBvcyI6IFsiZmVkb3JhLXJhd2hpZGUi
XSwKKyAgICAicmVwb3MiOiBbImZlZG9yYSJdLAogCiAgICAgInNlbGludXgiOiB0cnVlLAogCiAg
ICAgImRvY3VtZW50YXRpb24iOiBmYWxzZSwKIAotICAgICJhdXRvbWF0aWNfdmVyc2lvbl9wcmVm
aXgiOiAiMjMiLAorICAgICJhdXRvbWF0aWNfdmVyc2lvbl9wcmVmaXgiOiAiMjQiLAogCiAgICAg
ImluaXRyYW1mcy1hcmdzIjogWyItLW5vLWhvc3Rvbmx5IiwgIi0tYWRkIiwgImlzY3NpIl0sCiAK
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1136763</attachid>
            <date>2016-03-15 17:08:00 -0400</date>
            <delta_ts>2016-03-15 17:08:25 -0400</delta_ts>
            <desc>Fixed - patch locations for F24</desc>
            <filename>fedora-atomic-docker-host.json-f24.patch</filename>
            <type>text/plain</type>
            <size>573</size>
            <attacher name="Paul W. Frields">pfrields</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2ZlZG9yYS1hdG9taWMtZG9ja2VyLWhvc3QuanNvbiBiL2ZlZG9yYS1hdG9t
aWMtZG9ja2VyLWhvc3QuanNvbgppbmRleCBiOWYwMzQyLi5mNWUyOTY4IDEwMDY0NAotLS0gYS9m
ZWRvcmEtYXRvbWljLWRvY2tlci1ob3N0Lmpzb24KKysrIGIvZmVkb3JhLWF0b21pYy1kb2NrZXIt
aG9zdC5qc29uCkBAIC0xLDEzICsxLDEzIEBACiB7Ci0gICAgInJlZiI6ICJmZWRvcmEtYXRvbWlj
L3Jhd2hpZGUveDg2XzY0L2RvY2tlci1ob3N0IiwKKyAgICAicmVmIjogImZlZG9yYS1hdG9taWMv
MjQveDg2XzY0L2RvY2tlci1ob3N0IiwKIAotICAgICJyZXBvcyI6IFsiZmVkb3JhLXJhd2hpZGUi
XSwKKyAgICAicmVwb3MiOiBbImZlZG9yYS0yNCJdLAogCiAgICAgInNlbGludXgiOiB0cnVlLAog
CiAgICAgImRvY3VtZW50YXRpb24iOiBmYWxzZSwKIAotICAgICJhdXRvbWF0aWNfdmVyc2lvbl9w
cmVmaXgiOiAiMjMiLAorICAgICJhdXRvbWF0aWNfdmVyc2lvbl9wcmVmaXgiOiAiMjQiLAogCiAg
ICAgImluaXRyYW1mcy1hcmdzIjogWyItLW5vLWhvc3Rvbmx5IiwgIi0tYWRkIiwgImlzY3NpIl0s
CiAK
</data>

          </attachment>
      

    </bug>

</bugzilla>
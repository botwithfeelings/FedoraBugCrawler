<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1249572</bug_id>
          
          <creation_ts>2015-08-03 06:40:00 -0400</creation_ts>
          <short_desc>pcp-iostat exception at the end of an archive</short_desc>
          <delta_ts>2016-04-06 10:55:17 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>pcp</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>low</priority>
          <bug_severity>low</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mark Goodwin">mgoodwin</reporter>
          <assigned_to name="Nathan Scott">nathans</assigned_to>
          <cc>brolley</cc>
    
    
    <cc>fche</cc>
    
    
    <cc>lberk</cc>
    
    
    <cc>mgoodwin</cc>
    
    
    <cc>nathans</cc>
    
    
    <cc>scox</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>pcp-3.10.9-1.fc23 pcp-3.10.9-1.fc22 pcp-3.11.1-1.el5</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-04-06 10:55:17</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8504905</commentid>
    <comment_count>0</comment_count>
    <who name="Mark Goodwin">mgoodwin</who>
    <bug_when>2015-08-03 06:40:06 -0400</bug_when>
    <thetext>Description of problem: pcp-iostat exception at end of archive

Version-Release number of selected component (if applicable): 3.10.6-1

How reproducible: easily

Steps to Reproduce:
1. systemctl enable pmlogger; systemctl start pmlogger
2. sleep 600  (to wait for some data to be written to archive)
3. pcp -a /var/log/pcp/pmlogger/&lt;hostname&gt;/&lt;archive&gt; -t 10s iostat
   (for some &lt;hostname&gt; and &lt;archive&gt;

Actual results:

python exception (KeyError) on last fetch at the end of the archive :

Traceback (most recent call last):
  File &quot;/usr/libexec/pcp/bin/pcp-iostat&quot;, line 202, in &lt;module&gt;
    sts = manager.run()
  File &quot;/usr/lib64/python3.3/site-packages/pcp/pmcc.py&quot;, line 623, in run
    self._printer.report(self)
  File &quot;/usr/libexec/pcp/bin/pcp-iostat&quot;, line 116, in report
    rrqm = (c_rrqm[inst] - p_rrqm[inst]) / dt
KeyError: &apos;sda&apos;


Expected results: no exception at end of archive

Additional info: will be a trivial fix, but felt I should report it.
Here&apos;s an example :

[root]# pcp -a /var/log/pcp/pmlogger/fletch/20150803.20.10 -t 10 iostat

# Device      rrqm/s  wrqm/s    r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await %util
...
sda              0.1     2.8    0.1    5.6      1.0     35.8     6.46     0.06    10.9    61.0    10.0   5.5
sdb              0.0     0.0    0.0    0.0      0.0      0.0     0.00     0.00     0.0     0.0     0.0   0.0
...
Traceback (most recent call last):
  File &quot;/usr/libexec/pcp/bin/pcp-iostat&quot;, line 202, in &lt;module&gt;
    sts = manager.run()
  File &quot;/usr/lib64/python3.3/site-packages/pcp/pmcc.py&quot;, line 623, in run
    self._printer.report(self)
  File &quot;/usr/libexec/pcp/bin/pcp-iostat&quot;, line 116, in report
    rrqm = (c_rrqm[inst] - p_rrqm[inst]) / dt
KeyError: &apos;sda&apos;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8608527</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Goodwin">mgoodwin</who>
    <bug_when>2015-09-05 21:27:53 -0400</bug_when>
    <thetext>testing a fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8793182</commentid>
    <comment_count>2</comment_count>
    <who name="Nathan Scott">nathans</who>
    <bug_when>2015-11-04 18:05:56 -0500</bug_when>
    <thetext>Mark, can you confirm if this problem still exists?  Working fine for me, so I&apos;m wondering if some other python API / pcp-iostat fix has resolved this one also.

thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8858091</commentid>
    <comment_count>3</comment_count>
    <who name="Nathan Scott">nathans</who>
    <bug_when>2015-11-24 22:32:24 -0500</bug_when>
    <thetext>(In reply to Nathan Scott from comment #2)
&gt; Mark, can you confirm if this problem still exists?  Working fine for me, so
&gt; I&apos;m wondering if some other python API / pcp-iostat fix has resolved this
&gt; one also.

I think I understand the problem here now - I suspect there&apos;s a bit more to it than your initial recipe, Mark, which is why I didn&apos;t hit this before.  It looks like this issue would be triggered if a disk (instance) was missing/added between samples ... but not if the set of disks is in steady state for the duration of the archive recording (hence my earlier comment, I still haven&apos;t reproduced it so far).

I have a potential fix, but need a reproducer archive now - do you still have that original archive handy, Mark?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8858155</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Goodwin">mgoodwin</who>
    <bug_when>2015-11-24 23:13:12 -0500</bug_when>
    <thetext>hmm, that archive was from August 3 on a system that has since been reloaded. Sorry ... 

I just ran some experiments on the current archive on a difference machine, whilst adding then removing a disk randomly over a few minutes. pmiostat doesn&apos;t fail any more .. and the indom being reported at the end of the archive seems to reflect reality (i.e. that disk is either present or not). So I don&apos;t know how to reproduce it now.

I&apos;d be happy to RV your potential fix though.

Cheers</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8858220</commentid>
    <comment_count>5</comment_count>
    <who name="Nathan Scott">nathans</who>
    <bug_when>2015-11-25 00:14:15 -0500</bug_when>
    <thetext>Thanks Mark (and for the RV already) - will test a bit more here &amp; merge soon.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8924878</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-16 20:54:19 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc22 has been submitted as an update to Fedora 22. https://bodhi.fedoraproject.org/updates/FEDORA-2015-d08245c076</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8924889</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-16 20:55:09 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2015-2b40815137</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8924977</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-16 21:17:57 -0500</bug_when>
    <thetext>pcp-3.10.9-1.el5 has been submitted as an update to Fedora EPEL 5. https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2015-2ac90519bc</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8925855</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-17 05:26:24 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc23 has been pushed to the Fedora 23 testing repository. If problems still persist, please make note of it in this bug report.
If you want to test the update, you can install it with
$ su -c &apos;dnf --enablerepo=updates-testing update pcp&apos;
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2015-2b40815137</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8925862</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-17 05:26:43 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc22 has been pushed to the Fedora 22 testing repository. If problems still persist, please make note of it in this bug report.
If you want to test the update, you can install it with
$ su -c &apos;dnf --enablerepo=updates-testing update pcp&apos;
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2015-d08245c076</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8926335</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2015-12-17 07:48:48 -0500</bug_when>
    <thetext>pcp-3.10.9-1.el5 has been pushed to the Fedora EPEL 5 testing repository. If problems still persist, please make note of it in this bug report.
If you want to test the update, you can install it with
$ su -c &apos;yum --enablerepo=epel-testing update pcp&apos;
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2015-2ac90519bc</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8956361</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-01-05 16:57:41 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8956484</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-01-05 17:54:16 -0500</bug_when>
    <thetext>pcp-3.10.9-1.fc22 has been pushed to the Fedora 22 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9031128</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-02-02 22:56:33 -0500</bug_when>
    <thetext>pcp-3.11.0-1.el5 has been submitted as an update to Fedora EPEL 5. https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2016-57b7efb2d7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9034097</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-02-03 17:17:10 -0500</bug_when>
    <thetext>pcp-3.11.0-1.el5 has been pushed to the Fedora EPEL 5 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2016-57b7efb2d7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9094659</commentid>
    <comment_count>16</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 10:54:31 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9166952</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-21 20:17:32 -0400</bug_when>
    <thetext>pcp-3.11.1-1.el5 has been pushed to the Fedora EPEL 5 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-EPEL-2016-5b519318e0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9212524</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-06 10:53:46 -0400</bug_when>
    <thetext>pcp-3.11.1-1.el5 has been pushed to the Fedora EPEL 5 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
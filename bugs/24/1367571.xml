<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1367571</bug_id>
          
          <creation_ts>2016-08-16 15:58:00 -0400</creation_ts>
          <short_desc>gmp-ecm FTBFS on aarch64</short_desc>
          <delta_ts>2016-10-22 03:55:13 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gmp-ecm</component>
          <version>24</version>
          <rep_platform>aarch64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>922257</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Yaakov Selkowitz">yselkowi</reporter>
          <assigned_to name="Jerry James">loganjerry</assigned_to>
          <cc>loganjerry</cc>
    
    
    <cc>rjones</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>gmp-ecm-7.0.3-2.fc26 gmp-ecm-7.0.4-1.fc25 gmp-ecm-7.0.4-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-19 13:27:36</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9620355</commentid>
    <comment_count>0</comment_count>
    <who name="Yaakov Selkowitz">yselkowi</who>
    <bug_when>2016-08-16 15:58:54 -0400</bug_when>
    <thetext>The testsuite of gmp-ecm 7.x fails on aarch64 in test.pm1:

GMP-ECM 7.0.3 [configured with GMP 6.1.1, --enable-openmp] [P-1]
Input number is (2^1009-1)/3454817 (298 digits)
Using B1=5000, B2=9972-1389888, polynomial x^1, x0=4284271689
Step 1 took 7ms
./test.pm1: line 166: 28518 Done                    echo &quot;(2^1009-1)/3454817&quot;
     28519 Segmentation fault      | $PM1 -no-ntt 5e3 1e4-1e6
############### ERROR ###############
Expected return code 6 but got 139

Where the expected result appears to be:

********** Factor found in step 2: 198582684439
Found prime factor of 12 digits: 198582684439
Composite cofactor ((2^1009-1)/3454817)/198582684439 has 286 digits</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9620633</commentid>
    <comment_count>1</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2016-08-16 18:18:48 -0400</bug_when>
    <thetext>Are there any aarch64 machines I could do mock builds on, to debug this issue?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9635250</commentid>
    <comment_count>2</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-08-22 05:47:36 -0400</bug_when>
    <thetext>I cannot install the debuginfo packages because mirrormanager is
broken somehow.

However here is a stack trace and other info:

Core was generated by `/home/rjones/d/fedora/gmp-ecm/master/ecm-7.0.3/.libs/lt-ecm -pm1 -no-ntt 5e3 1e&apos;.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x000003ff9a6b4e48 in __gmpn_add_n () from /lib64/libgmp.so.10
[Current thread is 1 (Thread 0x3ff9735f180 (LWP 4615))]
Missing separate debuginfos, use: dnf debuginfo-install glibc-2.23.1-8.fc24.aarch64 gmp-6.1.1-1.fc24.aarch64 libgcc-6.1.1-3.fc24.aarch64 libgomp-6.1.1-3.fc24.aarch64
(gdb) t a a bt

Thread 8 (Thread 0x3ff98b5f180 (LWP 4612)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 7 (Thread 0x3ff9a35f180 (LWP 4609)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 6 (Thread 0x3ff9935f180 (LWP 4611)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 5 (Thread 0x3ff97b5f180 (LWP 4614)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 4 (Thread 0x3ff9835f180 (LWP 4613)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 3 (Thread 0x3ff99b5f180 (LWP 4610)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b5ddc in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#4  0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

Thread 2 (Thread 0x3ff9a855f40 (LWP 4595)):
#0  0x000003ff9a497ac0 in syscall () from /lib64/libc.so.6
#1  0x000003ff9a7b8934 in ?? () from /lib64/libgomp.so.1
#2  0x000003ff9a7b6e3c in ?? () from /lib64/libgomp.so.1
#3  0x000003ff9a736dc8 in pm1_sequence_g (g_mpz=0x363af20509876f00, 
    g_mpz@entry=0x2aaff74db10, g_ntt=g_ntt@entry=0x0, b_1=0x3ffc3291d18, 
    b_1@entry=0x1, P=1155, M_param=M_param@entry=839, l_param=1080, 
    m_1=m_1@entry=0x3ffc3291d58, k_2=0, modulus_param=&lt;optimized out&gt;, 
    modulus_param@entry=0x3ffc3291de0, ntt_context=&lt;optimized out&gt;, 
    ntt_context@entry=0x0) at pm1fs2.c:1976
#4  0x000003ff9a73b3ec in __ecm_pm1fs2 (f=0x363af20509876f00, f@entry=0x1, 
    X=0x1, X@entry=0x3ffc3291d18, modulus=modulus@entry=0x3ffc3291de0, 
    params=0x3ffc3291d38) at pm1fs2.c:2717
#5  0x000003ff9a71dfe8 in pm1 (f=0x1, f@entry=0x3ffc32922c8, p=0x2aaff742540, 
    N=N@entry=0x3ffc32923e0, go=&lt;optimized out&gt;, B1done=&lt;optimized out&gt;, 
    B1=B1@entry=5000, B2min_parm=0x44, B2_parm=&lt;optimized out&gt;, 
    k=&lt;optimized out&gt;, verbose=1, repr=0, use_ntt=0, os=&lt;optimized out&gt;, 
    es=0x3ff9a5413b8 &lt;_IO_2_1_stderr_&gt;, chkfilename=0x0, TreeFilename=0x0, 
    maxmem=&lt;optimized out&gt;, rng=0x1303, stop_asap=0x0) at pm1.c:587
#6  0x000003ff9a72edf8 in ecm_factor (f=0x3ffc32922c8, n=0x3ffc32923e0, 
    B1=5000, p0=0x3ffc3292440) at factor.c:172
#7  0x000002aadd4b3e54 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;)
    at main.c:1458

Thread 1 (Thread 0x3ff9735f180 (LWP 4615)):
#0  0x000003ff9a6b4e48 in __gmpn_add_n () from /lib64/libgmp.so.10
#1  0x000003ff9a6d228c in __gmpn_toom_eval_dgr3_pm1 () from /lib64/libgmp.so.10
#2  0x000003ff9a6c9344 in __gmpn_toom42_mul () from /lib64/libgmp.so.10
#3  0x000003ff9a6b850c in __gmpn_mul () from /lib64/libgmp.so.10
#4  0x000003ff9a6ac170 in __gmpz_mul () from /lib64/libgmp.so.10
#5  0x000003ff9a724974 in mpres_pow_mul (modulus=0x3ff9735e880, 
    c=0x3ff9735e8f8, b=0x3ff9735e840, a=0x3ff9735e8f8) at mpmod.c:1100
#6  __ecm_mpres_pow (R=0x3ffc3291d58, BASE=&lt;optimized out&gt;, EXP=0x3ff9735e820, 
    modulus=0x3ff9735e880) at mpmod.c:1216
#7  0x000003ff9a735bdc in pm1_sequence_g._omp_fn.5 () at pm1fs2.c:2066
#8  0x000003ff9a7b5dd4 in ?? () from /lib64/libgomp.so.1
#9  0x000003ff9a55708c in start_thread () from /lib64/libpthread.so.0
#10 0x000003ff9a49cce0 in thread_start () from /lib64/libc.so.6

(gdb) frame 5
#5  0x000003ff9a724974 in mpres_pow_mul (modulus=0x3ff9735e880, 
    c=0x3ff9735e8f8, b=0x3ff9735e840, a=0x3ff9735e8f8) at mpmod.c:1100
1100	      mpz_mul (modulus-&gt;temp1, b, c);
(gdb) frame 6
#6  __ecm_mpres_pow (R=0x3ffc3291d58, BASE=&lt;optimized out&gt;, EXP=0x3ff9735e820, 
    modulus=0x3ff9735e880) at mpmod.c:1216
1216	        mpres_pow_mul (modulus-&gt;temp2, (w == 1) ? BASE : B[w/2],</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9638539</commentid>
    <comment_count>3</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2016-08-22 22:56:51 -0400</bug_when>
    <thetext>Thanks, Richard.  Is there any chance you could run that again, but under valgrind instead of gdb?  I wonder if we&apos;re trying to operate on gmp objects that have already been freed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9639929</commentid>
    <comment_count>4</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-08-23 07:35:02 -0400</bug_when>
    <thetext>$ echo &quot;(2^1009-1)/3454817&quot; | LD_LIBRARY_PATH=. valgrind ./lt-ecm -pm1 -no-ntt 5e3 1e4-1e6 
==1505== Memcheck, a memory error detector
==1505== Copyright (C) 2002-2015, and GNU GPL&apos;d, by Julian Seward et al.
==1505== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
==1505== Command: ./lt-ecm -pm1 -no-ntt 5e3 1e4-1e6
==1505== 
GMP-ECM 7.0.3 [configured with GMP 6.1.1, --enable-openmp] [P-1]
Input number is (2^1009-1)/3454817 (298 digits)
Using B1=5000, B2=9972-1389888, polynomial x^1, x0=1943729787
Step 1 took 317ms
==1505== Thread 8:
==1505== Invalid read of size 4
==1505==    at 0x49AC068: __gmpz_mul (in /usr/lib64/libgmp.so.10.3.1)
==1505==    by 0x4914973: mpres_pow_mul (mpmod.c:1100)
==1505==    by 0x4914973: __ecm_mpres_pow (mpmod.c:1216)
==1505==    by 0x4925BDB: pm1_sequence_g._omp_fn.5 (pm1fs2.c:2066)
==1505==    by 0x48D5DD3: ??? (in /usr/lib64/libgomp.so.1.0.0)
==1505==    by 0x4B1708B: start_thread (in /usr/lib64/libpthread-2.23.so)
==1505==    by 0x4C2CCDF: thread_start (in /usr/lib64/libc-2.23.so)
==1505==  Address 0x509ab04 is 4 bytes after a block of size 16 alloc&apos;d
==1505==    at 0x4873D4C: malloc (vg_replace_malloc.c:299)
==1505==    by 0x4914533: __ecm_mpres_pow (mpmod.c:1159)
==1505==    by 0x4925BDB: pm1_sequence_g._omp_fn.5 (pm1fs2.c:2066)
==1505==    by 0x48D5DD3: ??? (in /usr/lib64/libgomp.so.1.0.0)
==1505==    by 0x4B1708B: start_thread (in /usr/lib64/libpthread-2.23.so)
==1505==    by 0x4C2CCDF: thread_start (in /usr/lib64/libc-2.23.so)
==1505== 
Step 2 took 2077ms
********** Factor found in step 2: 198582684439
Found prime factor of 12 digits: 198582684439
Composite cofactor ((2^1009-1)/3454817)/198582684439 has 286 digits
==1505== 
==1505== HEAP SUMMARY:
==1505==     in use at exit: 5,360 bytes in 11 blocks
==1505==   total heap usage: 19,763 allocs, 19,752 frees, 3,506,632 bytes allocated
==1505== 
==1505== LEAK SUMMARY:
==1505==    definitely lost: 0 bytes in 0 blocks
==1505==    indirectly lost: 0 bytes in 0 blocks
==1505==      possibly lost: 2,016 bytes in 7 blocks
==1505==    still reachable: 3,344 bytes in 4 blocks
==1505==         suppressed: 0 bytes in 0 blocks
==1505== Rerun with --leak-check=full to see details of leaked memory
==1505== 
==1505== For counts of detected and suppressed errors, rerun with: -v
==1505== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
rjones@mustang:~/d/fedora/gmp-ecm/master/ecm-7.0.3/.libs$</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9643316</commentid>
    <comment_count>5</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2016-08-23 22:50:01 -0400</bug_when>
    <thetext>Aha, that&apos;s a great clue!  Thanks, Richard.  I appreciate the help.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9643354</commentid>
    <comment_count>6</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2016-08-23 23:09:20 -0400</bug_when>
    <thetext>Upstream bug filed: https://gforge.inria.fr/tracker/index.php?func=detail&amp;aid=20712&amp;group_id=135&amp;atid=623</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9661040</commentid>
    <comment_count>7</comment_count>
    <who name="Yaakov Selkowitz">yselkowi</who>
    <bug_when>2016-08-29 17:34:01 -0400</bug_when>
    <thetext>Upstream supposed fix: https://gforge.inria.fr/scm/viewvc.php/ecm/trunk/mpmod.c?view=patch&amp;r1=2979&amp;r2=2978&amp;pathrev=2979</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9662207</commentid>
    <comment_count>8</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-08-30 03:50:39 -0400</bug_when>
    <thetext>The patch fixes the problem for me locally, and for that reason
I pushed it to Rawhide.  The primary arch build is:
http://koji.fedoraproject.org/koji/taskinfo?taskID=15435760

Hopefully it will also build OK on arm.koji.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9664695</commentid>
    <comment_count>9</comment_count>
    <who name="Yaakov Selkowitz">yselkowi</who>
    <bug_when>2016-08-30 14:20:19 -0400</bug_when>
    <thetext>(In reply to Richard W.M. Jones from comment #8)
&gt; The patch fixes the problem for me locally, and for that reason
&gt; I pushed it to Rawhide.  The primary arch build is:
&gt; http://koji.fedoraproject.org/koji/taskinfo?taskID=15435760
&gt; 
&gt; Hopefully it will also build OK on arm.koji.

It did: http://arm.koji.fedoraproject.org/koji/buildinfo?buildID=398799

Can we get this into at least F25 as well?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9664978</commentid>
    <comment_count>10</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-08-30 16:08:39 -0400</bug_when>
    <thetext>For sure.  I also did F24 since that contains the same new release.
http://koji.fedoraproject.org/koji/taskinfo?taskID=15439500
http://koji.fedoraproject.org/koji/taskinfo?taskID=15439502</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9665014</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-30 16:31:47 -0400</bug_when>
    <thetext>gmp-ecm-7.0.3-2.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-10fe5e7412</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9665015</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-30 16:32:07 -0400</bug_when>
    <thetext>gmp-ecm-7.0.3-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-14ada97cdd</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9665556</commentid>
    <comment_count>13</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2016-08-30 22:33:39 -0400</bug_when>
    <thetext>Thanks for doing those builds, Richard.  Much appreciated.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9668281</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-31 12:23:29 -0400</bug_when>
    <thetext>gmp-ecm-7.0.3-2.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-10fe5e7412</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9786976</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-13 00:52:21 -0400</bug_when>
    <thetext>gmp-ecm-7.0.4-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-7c407e0ffc</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9787079</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-13 01:52:45 -0400</bug_when>
    <thetext>gmp-ecm-7.0.4-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-b25a63cc73</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805516</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-19 13:27:36 -0400</bug_when>
    <thetext>gmp-ecm-7.0.4-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9812877</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-22 03:55:13 -0400</bug_when>
    <thetext>gmp-ecm-7.0.4-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
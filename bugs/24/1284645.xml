<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1284645</bug_id>
          
          <creation_ts>2015-11-23 13:12:00 -0500</creation_ts>
          <short_desc>rpm %transfiletriggerpostun is not called</short_desc>
          <delta_ts>2016-11-20 03:29:22 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>rpm</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1282115</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1288081</blocked>
    
    
    <blocked>1343357</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Zbigniew Jędrzejewski-Szmek">zbyszek</reporter>
          <assigned_to>packaging-team-maint</assigned_to>
          <cc>jorton</cc>
    
    
    <cc>jzeleny</cc>
    
    
    <cc>klember</cc>
    
    
    <cc>novyjindrich</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pknirsch</cc>
    
    
    <cc>pmatilai</cc>
    
    
    <cc>rdieter</cc>
    
    
    <cc>tibbs</cc>
    
    
    <cc>vondruch</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>rpm-4.13.0-3.fc26</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-20 03:29:22</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8853104</commentid>
    <comment_count>0</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2015-11-23 13:12:28 -0500</bug_when>
    <thetext>Description of problem:
I have the following test packages:

$ rpm -q --filetriggers transfiletriggers
filetriggerin scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers filetriggerin $*: $(head|xargs echo)
filetriggerun scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers filetriggerun $*: $(head|xargs echo)
filetriggerpostun scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers filetriggerpostun $*: $(head|xargs echo)
transfiletriggerin scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers transfiletriggerin $*: $(head|xargs echo)
transfiletriggerun scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers transfiletriggerun $*: $(head|xargs echo)
transfiletriggerpostun scriptlet (using /bin/sh) -- /usr/share/doc
logger transfiletriggers transfiletriggerpostun $*: $(head|xargs echo)

$ rpm -q -l transfiletriggers-a
/usr/share/doc/transfiletriggers-a
/usr/share/doc/transfiletriggers-a/README

As in $subject, I don&apos;t see %transfiletriggerpostun called.

- installation calls: filetriggerin, transfiletriggerin
- removal calls: transfiletriggerun, filetriggerun, filetriggerpostun
- reinstall calls: transfiletriggerun, filetriggerin, filetriggerun, filetriggerpostun, transfiletriggerin

Version-Release number of selected component (if applicable):
rpm-4.13.0-0.rc1.13.fc24.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8858957</commentid>
    <comment_count>1</comment_count>
    <who name="Ľuboš Kardoš">lkardos</who>
    <bug_when>2015-11-25 05:00:39 -0500</bug_when>
    <thetext>There is a different problem. %(trans)filetriggerpostun should be called only for packages that fire a trigger. It shouldn&apos;t be called for a package containing
that trigger because the trigger is executed after the package is uninstalled so the trigger is also uninstalled and probably commands called in the trigger are uninstalled as well.

I need to look deeper into this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8859765</commentid>
    <comment_count>2</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2015-11-25 08:21:02 -0500</bug_when>
    <thetext>My report wasn&apos;t very clear: I was talking about installing/uninstalling/upgrading package transfiletriggers-a.rpm while the triggers were in package transfiletriggers.rpm. Whether %(trans)filetriggerpostun will be called after transfiletriggers.rpm itself is uninstalled is an orthogonal issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8881767</commentid>
    <comment_count>3</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2015-12-02 08:05:49 -0500</bug_when>
    <thetext>I facing the same issues. I wanted to propose following patch for vim:

From c8e3818f88c5bdb3bb6055b0cc1f38e74657db66 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?V=C3=ADt=20Ondruch?= &lt;vondruch@redhat.com&gt;
Date: Tue, 1 Dec 2015 15:51:39 +0100
Subject: [PATCH] Add RPM file triggers support.

---
 vim.spec | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/vim.spec b/vim.spec
index 98175e9..6c4183b 100644
--- a/vim.spec
+++ b/vim.spec
@@ -542,6 +542,14 @@ if [ -x /%{_bindir}/gtk-update-icon-cache ]; then
 fi
 update-desktop-database &amp;&gt; /dev/null ||:
 
+# Refresh documentation helptags
+%transfiletriggerin common -- %{_datadir}/%{name}/vimfiles/doc
+vim -c &quot;:helptags %{_datadir}/%{name}/vimfiles/doc&quot; -c :q &amp;&gt; /dev/null
+
+%transfiletriggerpostun common -- %{_datadir}/%{name}/vimfiles/doc
+&gt; %{_datadir}/%{name}/vimfiles/doc/tags
+vim -c &quot;:helptags %{_datadir}/%{name}/vimfiles/doc&quot; -c :q &amp;&gt; /dev/null
+
 %clean
 rm -rf %{buildroot}
 
@@ -756,6 +764,9 @@ rm -rf %{buildroot}
 %{_datadir}/icons/hicolor/*/apps/*
 
 %changelog
+* Tue Dec 01 2015 Vít Ondruch &lt;vondruch@redhat.com&gt; 7.4.945-1
+- Add RPM file triggers support.
+
 * Tue Dec 01 2015 Karsten Hopp &lt;karsten@redhat.com&gt; 7.4.945-1
 - patchlevel 945
 
-- 
2.6.3



Later trying with vim-commentary modified as follows:


diff --git a/vim-commentary.spec b/vim-commentary.spec
index dff1e65..a420639 100644
--- a/vim-commentary.spec
+++ b/vim-commentary.spec
@@ -48,12 +48,12 @@ install -m 644 %{SOURCE1} %{buildroot}%{appdata_dir}
 # Check the AppData add-on to comply with guidelines.
 appstream-util validate-relax --nonet %{buildroot}/%{_datadir}/appdata/*.metainfo.xml
 
-%post
-vim -c &quot;:helptags %{vimfiles}/doc&quot; -c :q &amp;&gt; /dev/null
-
-%postun
-&gt; %{vimfiles}/doc/tags
-vim -c &quot;:helptags %{vimfiles}/doc&quot; -c :q &amp;&gt; /dev/null
+#%post
+#vim -c &quot;:helptags %{vimfiles}/doc&quot; -c :q &amp;&gt; /dev/null
+#
+#%postun
+#&gt; %{vimfiles}/doc/tags
+#vim -c &quot;:helptags %{vimfiles}/doc&quot; -c :q &amp;&gt; /dev/null
 
 %files
 %doc CONTRIBUTING.markdown README.markdown


No matter what I do, the &quot;%{vimfiles}/doc/tags&quot; is never updated during uninstallation of vim-commentary.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8881972</commentid>
    <comment_count>4</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2015-12-02 08:25:12 -0500</bug_when>
    <thetext>Just for the sake of completeness, this is what RPM says about the triggers:

$ rpm -q -p --filetriggers ./vim-common-7.4.945-1.fc24.x86_64.rpm 
transfiletriggerin scriptlet (using /bin/sh) -- /usr/share/vim/vimfiles/doc
vim -c &quot;:helptags /usr/share/vim/vimfiles/doc&quot; -c :q &amp;&gt; /dev/null
transfiletriggerpostun scriptlet (using /bin/sh) -- /usr/share/vim/vimfiles/doc
&gt; /usr/share/vim/vimfiles/doc/tags
vim -c &quot;:helptags /usr/share/vim/vimfiles/doc&quot; -c :q &amp;&gt; /dev/null</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9092571</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 09:01:14 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9866281</commentid>
    <comment_count>6</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2016-11-07 06:50:53 -0500</bug_when>
    <thetext>It&apos;s an upstream bug, fixed now:
https://github.com/rpm-software-management/rpm/commit/f6521c50f6836374a0f7995f8f393aaf36e178ea

I&apos;ll push updates for this later, right now we need to get the 4.13.0 update through to people.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9866708</commentid>
    <comment_count>7</comment_count>
    <who name="Panu Matilainen">pmatilai</who>
    <bug_when>2016-11-07 08:37:22 -0500</bug_when>
    <thetext>Fixed in rawhide as of rpm-4.13.0-3.fc26, stable version to be done later.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9867364</commentid>
    <comment_count>8</comment_count>
    <who name="Vít Ondruch">vondruch</who>
    <bug_when>2016-11-07 10:37:03 -0500</bug_when>
    <thetext>Thx, it works for the case above. Going to implement the triggers for vim (bug 1343357) right away ;)</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
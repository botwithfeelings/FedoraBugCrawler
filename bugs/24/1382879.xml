<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1382879</bug_id>
          
          <creation_ts>2016-10-07 21:07:00 -0400</creation_ts>
          <short_desc>evolution refuses sending emails and keeps asking for google authorization.</short_desc>
          <delta_ts>2016-10-13 17:53:37 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>evolution</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Feng Yu">rainwoodman</reporter>
          <assigned_to name="Milan Crha">mcrha</assigned_to>
          <cc>lucilanga</cc>
    
    
    <cc>mbarnes</cc>
    
    
    <cc>mcrha</cc>
    
    
    <cc>tpopela</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-13 17:53:37</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9774656</commentid>
    <comment_count>0</comment_count>
    <who name="Feng Yu">rainwoodman</who>
    <bug_when>2016-10-07 21:07:23 -0400</bug_when>
    <thetext>Description of problem:

When using an institution gmail account (ending with berkeley.edu but served by gmail.com)

A few days after the initial authorization, evolution refuses sending emails. After closing and restarting it keeps asking for google authorization on emails, contacts, calenders and everything in a loop, with errors like this in the console:

** Message: received an invalid or unencryptable secret
** Message: received an invalid or unencryptable secret
** Message: received an invalid or unencryptable secret
** Message: Remote error from secret service: org.freedesktop.DBus.Error.Failed: Couldn&apos;t create item: The secret was transferred or encrypted in an invalid way.

(evolution:12414): e-data-server-ui-WARNING **: credentials_prompter_store_credentials_cb: Failed to store source credentials: Couldn&apos;t create item: The secret was transferred or encrypted in an invalid way.
** Message: received an invalid or unencryptable secret
** Message: received an invalid or unencryptable secret
** Message: received an invalid or unencryptable secret


Version-Release number of selected component (if applicable):

3.20.5

How reproducible:

I haven&apos;t reproduced this. It occured two days after my initial upgrade to F24. I shall be able to observe this again next monday.

Steps to Reproduce:
1. Set up evolution with a gmail account.
2. authorize for the first time.
3. Keep evolution running and wait for two days.
4. try to send an email. It hangs.
5. close evolution and relaunch
6. prompt to authorize evolution inspite it is already authroized on google&apos;s management console.

Actual results:


Expected results:

It shall work. This is a very disruptive bug. It essentially makes Evolution unusable.

Additional info:

If I remove the entry on &apos;Evolution Data Source[Google]&apos; in Gnome keyring manually, and relaunch evolution, it asks me to authorize and I am able to send emails.

Looks like the old authorization has expired, yet it is not correctly renewed by evolution data server. (I suspect this because there is an expiration time in the keyring entry) How is the authorization token renewed? How long does evolution request for the entry? Which library does evolution use to handle google authentication? Could it be a bug over there?

Is there a way to reenable the old password based authentication?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9774661</commentid>
    <comment_count>1</comment_count>
    <who name="Feng Yu">rainwoodman</who>
    <bug_when>2016-10-07 21:21:08 -0400</bug_when>
    <thetext>This could be:

https://bugzilla.gnome.org/show_bug.cgi?id=771547

I will installed the -4.4 version of RPM and test.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9777792</commentid>
    <comment_count>2</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-10-10 06:10:41 -0400</bug_when>
    <thetext>Thanks for a bug report. You can face two things, one is the upstream bug report which you referenced, for which I&apos;m currently building F24 official update, the other is related to these messages:
&gt; Message: received an invalid or unencryptable secret
which comes from libsecret or gnome-keyring-daemon. 
It&apos;s https://bugzilla.gnome.org/show_bug.cgi?id=681815 and eventually also
https://bugzilla.gnome.org/show_bug.cgi?id=714128, which points to 
https://bugzilla.gnome.org/show_bug.cgi?id=769666.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9779291</commentid>
    <comment_count>3</comment_count>
    <who name="Feng Yu">rainwoodman</who>
    <bug_when>2016-10-10 14:38:13 -0400</bug_when>
    <thetext>Thanks for the information. I will resume email hoarding tomorrow, so I&apos;ll report back how bad the keyring bug affects evolution.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9780139</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-10 23:22:33 -0400</bug_when>
    <thetext>evolution-data-server-3.20.5-5.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-2c3c63bada</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9789993</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-13 17:53:37 -0400</bug_when>
    <thetext>evolution-data-server-3.20.5-5.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1337731</bug_id>
          
          <creation_ts>2016-05-19 20:18:00 -0400</creation_ts>
          <short_desc>Live image compose fails with dnf 1.1.9</short_desc>
          <delta_ts>2017-02-10 10:53:47 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>anaconda</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>RejectedBlocker</status_whiteboard>
          <keywords></keywords>
          <priority>urgent</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1339742</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to name="Brian Lane">bcl</assigned_to>
          <cc>anaconda-maint-list</cc>
    
    
    <cc>awilliam</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>dennis</cc>
    
    
    <cc>dsavov</cc>
    
    
    <cc>g.kaviyarasu</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>ignatenko</cc>
    
    
    <cc>jmracek</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>jsilhan</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>petersen</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>rdieter</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>anaconda-24.13.5-1 anaconda-24.13.6-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-09 10:09:10</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9343030</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-19 20:18:10 -0400</bug_when>
    <thetext>F24 live images all failed to compose on 2016-05-19. Looking at the logs, I see a lot of errors like this:

  File &quot;/usr/lib/python3.5/site-packages/dnf/base.py&quot;, line 1204, in _add_comps_trans
    raise dnf.exceptions.MarkingError(it)

dnf.exceptions.MarkingError: s390utils

  File &quot;/usr/lib/python3.5/site-packages/dnf/base.py&quot;, line 1204, in _add_comps_trans
    raise dnf.exceptions.MarkingError(it)

dnf.exceptions.MarkingError: extlinux-bootloader

These seem to be a result of this change in DNF:

https://github.com/rpm-software-management/dnf/commit/91f9ce98dbb630800017f44180d636af395435cd

which was made to address http://bugzilla.redhat.com/show_bug.cgi?id=1292892 . But it&apos;s breaking this. The relevant packages mostly seem to be in anaconda-tools. s390utils will of course not be available on non-s390 arches; extlinux-bootloader is available only on arm.

I&apos;m not sure what the appropriate resolution here would be, whether it&apos;s a change in dnf or in comps (or even in anaconda?)

You can find all the relevant logs from here:

https://kojipkgs.fedoraproject.org/compose/branched/Fedora-24-20160519.n.0/logs/i386-x86_64/

each of those logs links to a Koji task, and you can see the actual compose logs there. e.g. the Workstation task is http://koji.fedoraproject.org/koji/taskinfo?taskID=14167034 , the KDE task is http://koji.fedoraproject.org/koji/taskinfo?taskID=14166955 , and you can see the errors in anaconda.log in each task.

This didn&apos;t affect the Rawhide compose, oddly enough; perhaps the dnf build didn&apos;t quite make it into the Rawhide compose but it did make F24...

This would be an automatic Final blocker, except that the dnf in question is not in stable yet, only updates-testing. I believe it&apos;s affecting the live compose because it&apos;s been given a buildroot override?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9343054</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-19 20:22:16 -0400</bug_when>
    <thetext>Proposing as a Final blocker, just to keep it on the radar in case the update gets pushed out or anything.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9343486</commentid>
    <comment_count>2</comment_count>
    <who name="Igor Gnatenko">ignatenko</who>
    <bug_when>2016-05-20 02:26:16 -0400</bug_when>
    <thetext>Hi Adam, new DNF built for f23+ including rawhide and was added to build root override for building dnf-plugins-core.

Do we have different comps for each arch? If yes, it&apos;s probably good idea to remove non-existing packages from there (s390xutils from x86_64).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9343581</commentid>
    <comment_count>3</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-20 03:07:56 -0400</bug_when>
    <thetext>There is a &apos;basearchonly&apos; thing that some comps entries use:

&lt;packagereq basearchonly=&quot;true&quot; type=&quot;default&quot;&gt;compat-gcc-34&lt;/packagereq&gt;

I&apos;m not at all sure what that does. But I don&apos;t see any entries that specify something like &apos;include this package only for these specific arches&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9343616</commentid>
    <comment_count>4</comment_count>
    <who name="Michal Luscon">mluscon</who>
    <bug_when>2016-05-20 03:24:05 -0400</bug_when>
    <thetext>Hi Adam,

the group operation install takes optional parameter strict that was previously ignored and I fixed this by the referenced commit. I think the most straightforward solution would be to use strict=False in live image composer and prepare a joint upgrade of dnf and composer. Is this suitable for you?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9343626</commentid>
    <comment_count>5</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-20 03:31:40 -0400</bug_when>
    <thetext>on the face of it that sounds reasonable, sure.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9345284</commentid>
    <comment_count>6</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-20 12:36:12 -0400</bug_when>
    <thetext>well, no, actually that may not be possible, as it&apos;s anaconda that&apos;s doing this. bcl, any thoughts?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9345293</commentid>
    <comment_count>7</comment_count>
    <who name="Dennis Gilmore">dennis</who>
    <bug_when>2016-05-20 12:38:29 -0400</bug_when>
    <thetext>anaconda would have to set strict=False always as this will likely effect some installs, as pungi gains the ability to use dnf to make installer trees and resolve deps we will hit it there, also, I think this is a case where dnf needs to follow yums behaviour. If not we will likely hit corner cases all the time. and need to find workarounds</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346062</commentid>
    <comment_count>8</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-20 20:31:31 -0400</bug_when>
    <thetext>I think we&apos;re better off catching missing packages than we are silently ignoring it. comps for the various arches should be updated with the correct packages.

Anaconda also needs to start catching this:

https://github.com/rhinstaller/anaconda/pull/640</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346064</commentid>
    <comment_count>9</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-20 20:33:48 -0400</bug_when>
    <thetext>The problem is that we don&apos;t have &apos;comps for various arches&apos;, so we can&apos;t &quot;fix&quot; comps.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346079</commentid>
    <comment_count>10</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-20 20:55:21 -0400</bug_when>
    <thetext>Ok, well then maybe we need that? There&apos;s certainly a different file for each arch&apos;s repo. Still seems wrong to silently ignore these.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346084</commentid>
    <comment_count>11</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-20 21:02:15 -0400</bug_when>
    <thetext>well maybe, but we don&apos;t have unlimited time for this: it&apos;s breaking live composes in Rawhide already, and F24 for now; it&apos;ll stop breaking F24 when the override expires, I think, but the update shouldn&apos;t go stable until it&apos;s fixed. so...I don&apos;t know, but we don&apos;t really have weeks to sit around and kibbitz about it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9350126</commentid>
    <comment_count>12</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2016-05-23 09:14:41 -0400</bug_when>
    <thetext>If we don&apos;t have the enough time, then setting the `strict=False` in Anaconda is way to go until we find better solution. DNF does should not skip the mandatory packages by default. Otherwise we would have to deal again with the issues like why some package from group is not installed in the buildroot from koji. Reassigning...

We&apos;re glad to help with designing proper solution that would differentiate comps for different architectures. Either by
1) adding the new tag into comps + support in libcomps
2) replacing comps by metapackages with requirements and weak deps + specifying different packages for different archs by if statements in the spec file.
3) adding the new tag into comps + support into createrepo that would modify the comps according to target architecture</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9351312</commentid>
    <comment_count>13</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-05-23 12:10:13 -0400</bug_when>
    <thetext>I&apos;m frankly not sure any of those changes is appropriate for F24. I&apos;m not arguing against your general line of reasoning, but this does not seem to be being handled particularly well in practical terms: when a change has a significant and unexpected negative consequence on something else, surely the appropriate thing to do is loop in all concerned parties and come up with a co-ordinated plan to address that problem, rather than just pushing your own change regardless and leaving the bits all over the floor for someone else to clean up?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9351603</commentid>
    <comment_count>14</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-05-23 14:01:53 -0400</bug_when>
    <thetext>Discussed during the 2016-05-23 blocker review meeting: [1]

Decision to classify this as a conditional AcceptedBlocker has been made, the condition being that if the update is pushed stable without a fix, the bug will be filed as AcceptedBlocker.

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-05-23/f24-blocker-review.2016-05-23-16.00.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9355311</commentid>
    <comment_count>15</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-24 14:15:38 -0400</bug_when>
    <thetext>I&apos;ve proposed adding string=False for F24 even though I really think dnf should revert this.

For rawhide a better solution needs to be found for arch-specific packages in groups.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9361754</commentid>
    <comment_count>16</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-05-26 09:20:51 -0400</bug_when>
    <thetext>*** Bug 1339869 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9364369</commentid>
    <comment_count>17</comment_count>
    <who name="">dsavov</who>
    <bug_when>2016-05-27 00:49:34 -0400</bug_when>
    <thetext>Similar problem has been detected:

I tried to install Fedora 25 rawhide from Fedora-Everything-netinst-x86_64-Rawhide-20160523.n.0.iso.
When I tried to select &apos;Fedora Workstation&apos;, I got the following error.

addons:         com_redhat_kdump, com_redhat_docker
cmdline:        /usr/bin/python3  /sbin/anaconda
cmdline_file:   BOOT_IMAGE=vmlinuz initrd=initrd.img inst.stage2=hd:LABEL=Fedora-E-dvd-x86_64-rawh quiet
dnf.rpm.log:    May 27 04:37:35 INFO --- logging initialized ---
hashmarkername: anaconda
kernel:         4.7.0-0.rc0.git5.1.fc25.x86_64
package:        anaconda-25.14-1
product:        Fedora
reason:         dnf.exceptions.MarkingError: xorg-x11-drv-armsoc
release:        Cannot get release name.
reproducible:   Not sure how to reproduce the problem
version:        rawhide</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9369758</commentid>
    <comment_count>18</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-05-30 14:08:20 -0400</bug_when>
    <thetext>Discussed during the 2016-05-30 blocker review meeting: [1]

Decision to classify this as a non-blocker was made, as the update has not been pushed and freeze is tomorrow so there is no longer a need to track this as a blocker.

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-05-30/f24-blocker-review.2016-05-30-16.01.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9391548</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-06-06 15:41:40 -0400</bug_when>
    <thetext>anaconda-24.13.6-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-b0494cdc04</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9395452</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-06-07 14:54:16 -0400</bug_when>
    <thetext>anaconda-24.13.6-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-b0494cdc04</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9401278</commentid>
    <comment_count>21</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-06-09 10:08:53 -0400</bug_when>
    <thetext>anaconda-24.13.6-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9618795</commentid>
    <comment_count>22</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2016-08-16 08:56:53 -0400</bug_when>
    <thetext>I have created PR https://github.com/rpm-software-management/dnf/pull/558 that can solve release problems. Now basearchonly will be honored by dnf. And for packages, that are only available for certain archs, arch flag can be used and only on listed arch package will be installed like in example:

&lt;packagereq arch arch=&quot;x86_64 s390&quot;&gt;pkg3&lt;/packagereq&gt;

Then the package &apos;pkg3&apos; will be installed or listed with group only on machine with arch &apos;x86_64&apos; or &apos;s390&apos;.

Please can you react to proposed changes if they are according to your needs?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138607</commentid>
    <comment_count>23</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-02-10 10:53:47 -0500</bug_when>
    <thetext>Bugs fixed in version of dnf-2.0.1-1 in rawhide.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
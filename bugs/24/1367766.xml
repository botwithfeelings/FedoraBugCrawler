<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1367766</bug_id>
          
          <creation_ts>2016-08-17 08:21:00 -0400</creation_ts>
          <short_desc>systemctl daemon-reexec causes Xorg to panic</short_desc>
          <delta_ts>2016-09-06 14:22:31 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ray Holme">rayholme</reporter>
          <assigned_to>systemd-maint</assigned_to>
          <cc>johannbg</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>muadda</cc>
    
    
    <cc>ssahani</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>systemd-231-4.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-09-06 14:22:31</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9622358</commentid>
    <comment_count>0</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-17 08:21:08 -0400</bug_when>
    <thetext>Description of problem: After clean install of Fedora 24 (64 bit) on a computer with a graphics accelerator, dnf update looks like it is succeeding normally and then I am &quot;thrown back&quot; to a login prompt with words like &quot;Xorg failure - tell development&quot;.


Version-Release number of selected component (if applicable):


How reproducible: Completely - did three times (last time I did the updates manually after getting a &quot;dnf check-update&quot; list into a file. All components updated fine except for &quot;dnf update systemd&quot; which throws me back to a login prompt. This did NOT happen on another computer which does NOT have a graphics processor.


Steps to Reproduce:
1. Install from DVD.
2. run &quot;dnf update -y&quot;  (better yet &quot;dnf update systemd&quot;)
3.

Actual results: If you have a graphics processor (sorry I cannot figure out how to tell you which one - this refurb. just came with one), you will be back to the login screen. If you are doing a full update as I was the first two times, the new kernel will not be installed and probably a lot of other things don&apos;t happen. As it is now, I am not sure what has been done with &quot;systemd&quot;. DNF tells me all things are up to date, but I highly suspect that systemd is not right. Please tell me how to fix this if possible (downgrade?) and how to send you the core dump (wherever it is) to help you find the problem.


Expected results: Normally no error and I reboot to get a new kernel if built (and it would have been in this case - was on 4.5.5, current 4.6.6 after my manual update commands).


Additional info: I built a non GPI machine and it worked fine. I did full &quot;dnf update -y&quot; twice to be sure, final time used &quot;dnf check-update &gt; /tmp/dnf_list&quot;; then manually ran dnf commands till I broke it with systemd, after that I did the rest - dnf says NOTHING TO DO but systemd is probably hosed. I tried to find the core file, but was not successful.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9623437</commentid>
    <comment_count>1</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-17 12:22:22 -0400</bug_when>
    <thetext>Yeah, there&apos;s some issue. The problem happens when &apos;systemctl daemon-reexec&apos; is invoked. On my F24 machine there is no crash, but the screen is completely messed up. After switching to a different tty and back everything goes back to normal. I&apos;m not sure what exactly is the reason for this, but I think it might be related to the recent changes to vconsole setup.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9623550</commentid>
    <comment_count>2</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-17 12:55:27 -0400</bug_when>
    <thetext>As I suspected: the &quot;crash&quot; happens when make_console_stdio() is invoked.

Debugging this is a bit tricky, because the issue only happens during the first daemon-reexec. Subsequent ones happen without any issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9624401</commentid>
    <comment_count>3</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-17 18:15:53 -0400</bug_when>
    <thetext>OK, you know what it is. Great. I assume you need nothing more from me

 BUT

 a) if you do, let me know what

 b) do I need to do anything to &quot;fix&quot; the state that dnf left my computer in
    - The only thing that may not be complete is the update of systemd
    I have no idea what physical status it is left in.

Best of luck finding the problem. I understand tricky and am glad that I am retired from all this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9624894</commentid>
    <comment_count>4</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-17 22:43:52 -0400</bug_when>
    <thetext>This is tracked upstream in https://github.com/systemd/systemd/issues/3842.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9632533</commentid>
    <comment_count>5</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-20 07:45:19 -0400</bug_when>
    <thetext>Track it any way you want. It happened again with &quot;dnf update -y&quot;

I watched closely and on step 93 of 109 - cleanup of systemd ...
I watched the black screen of death then finally got a login screen.

I sure hope you get it - I have no idea what state my system is in anymore.
There is no new kernel installed (not sure if one should be).

will try dnf update -y again after this post but expect it to say nothing to do and be fine even thought it did a half-baked job.

do I have to manually install dnf updates in the future leaving systemd as the last thing to install? PLEASE let me know!!!!!!!!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9632595</commentid>
    <comment_count>6</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-20 09:35:25 -0400</bug_when>
    <thetext>And for the record, not sure this was caused by a failed update, but

the system was dog slow, I had to reboot

top showed: gdm using 82-97% and gnome-console using 80-90%
  there goes two cpus (my quota)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9632675</commentid>
    <comment_count>7</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-20 10:02:53 -0400</bug_when>
    <thetext>The bug is fixed upstream, but not yet in Fedora. There will be an automatic comment in this bug when an update that fixes the bug is created. For now, you should exclude systemd from the upgrade (dnf upgrade --exclude=systemd).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9633674</commentid>
    <comment_count>8</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-21 12:05:08 -0400</bug_when>
    <thetext>I have noticed a new problem - http and apache are not happy anymore after reboot.

Online notes say this may be related to a bad systemd installation.

I can get them going, but I am wondering if the systemd problem I have has caused this. It did abort the last 20 cleanup steps when it flashed me out.

systemctl status httpd.service yields:

● httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disable
   Active: failed (Result: exit-code) since Sun 2016-08-21 11:33:40 EDT; 26min ago
  Process: 1061 ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND (code=exited, status=1/FA
 Main PID: 1061 (code=exited, status=1/FAILURE)

Aug 21 11:33:38 rainbow systemd[1]: Starting The Apache HTTP Server...
Aug 21 11:33:40 rainbow httpd[1061]: (99)Cannot assign requested address: AH00072: make_s
Aug 21 11:33:40 rainbow httpd[1061]: no listening sockets available, shutting down
Aug 21 11:33:40 rainbow httpd[1061]: AH00015: Unable to open logs
Aug 21 11:33:40 rainbow systemd[1]: httpd.service: Main process exited, code=exited, stat
Aug 21 11:33:40 rainbow systemd[1]: Failed to start The Apache HTTP Server.
Aug 21 11:33:40 rainbow systemd[1]: httpd.service: Unit entered failed state.
Aug 21 11:33:40 rainbow systemd[1]: httpd.service: Failed with result &apos;exit-code&apos;.

To fix things, I run 3 commands

httpd
apachectl start
systemctl start httpd.service

I can do this every time I reboot until the fix hits the world. Just wanted to make sure the cause was this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9650128</commentid>
    <comment_count>9</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-25 15:52:59 -0400</bug_when>
    <thetext>It turns out that https://github.com/systemd/systemd/issues/3842 must have a different underlying reason.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652747</commentid>
    <comment_count>10</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-08-26 08:23:27 -0400</bug_when>
    <thetext>OK, someone solved the other issue I posted and was worried was related.

Right now, my weekly updates look like.
   dnf update --exclude=systemd
   dnf update systemd

This seems to work for now. If I need to provide you any more information, please let me know - be explicit as I am no longer intimate with all the things I once was.

I do know my systems without a graphics processor has NO problems, but this one has suffered full window crashes with two systemd updates. The first three times till you told me how to separate the updates, the second update was a week later and I am assuming that the problem is not fatal as
  a) the system comes back after I login
  b) the problem happens in the dnf cleanup stage

Good luck.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9672184</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-01 11:32:16 -0400</bug_when>
    <thetext>systemd-231-4.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-c1271b0fee</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9672795</commentid>
    <comment_count>12</comment_count>
    <who name="Ray Holme">rayholme</who>
    <bug_when>2016-09-01 14:28:38 -0400</bug_when>
    <thetext>Sure hope you can fix fedora 24 too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9676707</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-02 23:54:48 -0400</bug_when>
    <thetext>systemd-231-4.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-c1271b0fee</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9683832</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-06 14:22:23 -0400</bug_when>
    <thetext>systemd-231-4.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1343136</bug_id>
          
          <creation_ts>2016-06-06 11:17:00 -0400</creation_ts>
          <short_desc>The fedora:23 base image ships service configuration in /etc/systemd/system</short_desc>
          <delta_ts>2016-11-27 08:26:58 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>spin-kickstarts</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Pazdziora">jpazdziora</reporter>
          <assigned_to name="Jeroen van Meeuwen">vanmeeuwen+fedora</assigned_to>
          <cc>admiller</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>dustymabe</cc>
    
    
    <cc>jpazdziora</cc>
    
    
    <cc>kevin</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
    
    
    <cc>vpavlin</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-26 13:15:15</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9390702</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-06-06 11:17:42 -0400</bug_when>
    <thetext>Description of problem:

The fedora:23 image contains /etc/systemd/system/dbus.service. Since the image is a vendor content, it should not contain such modifications that are reserved for admin&apos;s local changes.

Version-Release number of selected component (if applicable):

fedora:23
fedora:rawhide

How reproducible:

Deterministic.

Steps to Reproduce:
1. $ docker run --rm -ti fedora:23 cat /etc/systemd/system/dbus.service

Actual results:

[Unit]
Description=D-Bus System Message Bus
Documentation=man:dbus-daemon(1)
Requires=dbus.socket

[Service]
ExecStart=/usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation
ExecReload=/usr/bin/dbus-send --print-reply --system --type=method_call --dest=org.freedesktop.DBus / org.freedesktop.DBus.ReloadConfig

Expected results:

cat: /etc/systemd/system/dbus.service: No such file or directory

Additional info:

 The man systemd.unit(5) says

       Along with a unit file foo.service, a directory foo.service.d/ may
       exist. All files with the suffix &quot;.conf&quot; from this directory will be
       parsed after the file itself is parsed. This is useful to alter or add
       configuration settings to a unit, without having to modify their unit
       files.

and also includes

       │/etc/systemd/system     │ Local configuration │
       ├────────────────────────┼─────────────────────┤
       │/run/systemd/system     │ Runtime units       │
       ├────────────────────────┼─────────────────────┤
       │/usr/lib/systemd/system │ Units of installed  │
       │                        │ packages            │

 The file seems to be generated by

+#Make it easier for systemd to run in Docker container
+cp /usr/lib/systemd/system/dbus.service /etc/systemd/system/
+sed -i &apos;s/OOMScoreAdjust=-900//&apos; /etc/systemd/system/dbus.service

I recommend putting the OOMScoreAdjust reset to /usr, using something like

( echo &apos;[Service]&apos; ; echo OOMScoreAdjust=0 ) &gt; /usr/lib/systemd/system/dbus.service.d/nooomscoreadjust.conf

Alternatively just removing those lines that create /etc/systemd/system/dbus.service altogether might work -- I did not see any issues running systemd with dbus on Fedora 23 with fedora:23 image with /etc/systemd/system/dbus.service removed. 

This is a copy of https://fedorahosted.org/spin-kickstarts/ticket/61.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9391918</commentid>
    <comment_count>1</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-06-06 18:04:11 -0400</bug_when>
    <thetext>Would you be willing to submit a PR on this? 

Is this change ok with the cloud sig?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9393049</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-06-07 03:55:13 -0400</bug_when>
    <thetext>Filed https://pagure.io/fedora-kickstarts/pull-request/28.

I did not talk to the cloud sig.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9726979</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-09-20 12:28:18 -0400</bug_when>
    <thetext>On fedora:rawhide, things seem fixed now:

$ docker images fedora:rawhide
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
docker.io/fedora    rawhide             3bcdeb6ee43b        5 weeks ago         174 MB
$ docker run --rm -ti fedora:rawhide cat /etc/systemd/system/dbus.service
cat: /etc/systemd/system/dbus.service: No such file or directory
$</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9726987</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-09-20 12:29:59 -0400</bug_when>
    <thetext>Filed another pull request for fedora:24:

https://pagure.io/fedora-kickstarts/pull-request/62</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9928169</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-25 04:13:35 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9930118</commentid>
    <comment_count>6</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-11-25 09:15:44 -0500</bug_when>
    <thetext>Issue still present on fedora:24 image:

# docker run --rm -ti fedora:24 cat /etc/systemd/system/dbus.service
[Unit]
Description=D-Bus System Message Bus
Documentation=man:dbus-daemon(1)
Requires=dbus.socket

[Service]
ExecStart=/usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation
ExecReload=/usr/bin/dbus-send --print-reply --system --type=method_call --dest=org.freedesktop.DBus / org.freedesktop.DBus.ReloadConfig</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9930925</commentid>
    <comment_count>7</comment_count>
    <who name="Dusty Mabe">dustymabe</who>
    <bug_when>2016-11-25 21:55:41 -0500</bug_when>
    <thetext>
Not a problem in F25:

-bash-4.3# docker run --rm -ti fedora:25 cat /etc/systemd/system/dbus.service
cat: /etc/systemd/system/dbus.service: No such file or directory</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9931364</commentid>
    <comment_count>8</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-11-26 13:15:15 -0500</bug_when>
    <thetext>Yeah, will close this now... if we need f24 images fixed, I think we need a releng ticket to ask for a new compose there (as we don&apos;t usually do regular composes after release).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932091</commentid>
    <comment_count>9</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-11-27 08:26:58 -0500</bug_when>
    <thetext>(In reply to Kevin Fenzi from comment #8)
&gt; Yeah, will close this now... if we need f24 images fixed, I think we need a
&gt; releng ticket to ask for a new compose there (as we don&apos;t usually do regular
&gt; composes after release).

Well, the latest fedora:24 image was built 11 days ago (f623aaef07f0). The https://pagure.io/fedora-kickstarts/pull-request/62 was merged two months ago.

I&apos;m really concerned about the process, that while merged, it was not used with the latest respin.

Also, I thought the plan was to do image repins every two weeks or so ...</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
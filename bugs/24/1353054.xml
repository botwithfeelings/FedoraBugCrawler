<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1353054</bug_id>
          
          <creation_ts>2016-07-05 20:10:00 -0400</creation_ts>
          <short_desc>FreeIPA server deployment fails due to pki-core dangling symlinks (one from non-installed &apos;scannotation&apos; package, one formerly in resteasy-jaxrs-api but now lost)</short_desc>
          <delta_ts>2016-09-29 12:47:31 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>pki-core</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to name="Endi Sukma Dewata">edewata</assigned_to>
          <cc>alee</cc>
    
    
    <cc>blipton</cc>
    
    
    <cc>edewata</cc>
    
    
    <cc>ftweedal</cc>
    
    
    <cc>jpazdziora</cc>
    
    
    <cc>kwright</cc>
    
    
    <cc>mharmsen</cc>
    
    
    <cc>nkinder</cc>
    
    
    <cc>pschindl</cc>
    
    
    <cc>robatino</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-09-29 12:47:31</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9482720</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-07-05 20:10:04 -0400</bug_when>
    <thetext>https://bugzilla.redhat.com/show_bug.cgi?id=1348946 seems to have been fixed in current Rawhide, but FreeIPA server deployment is still failing. Here&apos;s today&apos;s openQA attempt:

https://openqa.fedoraproject.org/tests/24638

You can find the contents of /var/log here:

https://openqa.fedoraproject.org/tests/24638/file/role_deploy_domain_controller-var_log.tar.gz

Looking through the logs, I see this in ipaserver-install.log:

2016-07-04T12:42:14Z DEBUG stdout=Log file: /var/log/pki/pki-ca-spawn.20160704084213.log
Loading deployment configuration from /tmp/tmp1X2EK4.
Installing CA into /var/lib/pki/pki-tomcat.
Storing deployment configuration into /etc/sysconfig/pki/tomcat/pki-tomcat/ca/deployment.cfg.

Installation failed: Dangling symlink /var/lib/pki/pki-tomcat/common/lib/scannotation.jar not allowed


2016-07-04T12:42:14Z DEBUG stderr=pkispawn    : WARNING  ....... Dangling symlink &apos;/var/lib/pki/pki-tomcat/common/lib/scannotation.jar&apos;--&gt;&apos;/usr/share/java/scannotation.jar&apos;

2016-07-04T12:42:14Z CRITICAL Failed to configure CA instance: Command &apos;/usr/sbin/pkispawn -s CA -f /tmp/tmp1X2EK4&apos; returned non-zero exit status 1
2016-07-04T12:42:14Z CRITICAL See the installation logs and the following files/directories for more information:
2016-07-04T12:42:14Z CRITICAL   /var/log/pki/pki-tomcat
2016-07-04T12:42:14Z DEBUG Traceback (most recent call last):
  File &quot;/usr/lib/python2.7/site-packages/ipaserver/install/service.py&quot;, line 447, in start_creation
    run_step(full_msg, method)
  File &quot;/usr/lib/python2.7/site-packages/ipaserver/install/service.py&quot;, line 437, in run_step
    method()
  File &quot;/usr/lib/python2.7/site-packages/ipaserver/install/cainstance.py&quot;, line 579, in __spawn_instance
    DogtagInstance.spawn_instance(self, cfg_file)
  File &quot;/usr/lib/python2.7/site-packages/ipaserver/install/dogtaginstance.py&quot;, line 181, in spawn_instance
    self.handle_setup_error(e)
  File &quot;/usr/lib/python2.7/site-packages/ipaserver/install/dogtaginstance.py&quot;, line 421, in handle_setup_error
    raise RuntimeError(&quot;%s configuration failed.&quot; % self.subsystem)
RuntimeError: CA configuration failed.

/usr/share/java/scannotation.jar appears to be part of the &apos;scannotation&apos; package. Looking at /var/log/dnf.rpm.log from the test I don&apos;t see any indication that this package was installed, which may be the problem.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9485667</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-07-06 20:23:25 -0400</bug_when>
    <thetext>proposing as an F25 Alpha blocker - &quot;Release-blocking roles and the supported role configuration interfaces must meet the core functional Role Definition Requirements to the extent that supported roles can be successfully deployed, started, stopped, brought to a working configuration, and queried.&quot; (you can&apos;t deploy the domain controller role because of this).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9485698</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-07-06 20:38:26 -0400</bug_when>
    <thetext>If I install scannotation package manually before attempting the role deployment, I get a different dangling symlink:

Installation failed: Dangling symlink /var/lib/pki/pki-tomcat/common/lib/jaxrs-api.jar not allowed
2016-07-07T00:32:41Z DEBUG stderr=pkispawn    : WARNING  ....... Dangling symlink &apos;/var/lib/pki/pki-tomcat/common/lib/
jaxrs-api.jar&apos;--&gt;&apos;/usr/share/java/resteasy/jaxrs-api.jar&apos;

In F24, this file is part of the package resteasy-jaxrs-api . In F25, it apparently is not - it doesn&apos;t seem to be part of anything, according to repoquery -f on a Rawhide box.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9497364</commentid>
    <comment_count>3</comment_count>
    <who name="Matthew Harmsen">mharmsen</who>
    <bug_when>2016-07-11 12:35:56 -0400</bug_when>
    <thetext>Upstream ticket:
https://fedorahosted.org/pki/ticket/2403</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9536037</commentid>
    <comment_count>4</comment_count>
    <who name="Petr Schindler">pschindl</who>
    <bug_when>2016-07-21 05:37:27 -0400</bug_when>
    <thetext>Discussed at 2016-07-20 blocker review meeting: [1]. 

This bug was accepted as Alpha blocker: This bug violates the criterion: &quot;Release-blocking roles and the supported role configuration interfaces must meet the core functional Role Definition Requirements to the extent that supported roles can be successfully deployed, started, stopped, brought to a working configuration, and queried.&quot; The domain controller role can&apos;t be deployed because of this bug.

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2016-07-20/f25-blocker-review.2016-07-20-16.00.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9548684</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 00:03:31 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9560904</commentid>
    <comment_count>6</comment_count>
    <who name="Endi Sukma Dewata">edewata</who>
    <bug_when>2016-07-27 18:08:17 -0400</bug_when>
    <thetext>Fixed in master:

* 3f4c9e4e7946f3f330b71cfe36a00ae933de2575
* 9e77b42d88da07e91a42966bc2d1ea9237e62f47
* ecbf1cded60cec973316584baf272ae4c7bae1dd
* bc28cfc1916c080c01cc453e43cae2db646bc2db
* 4926aace5cf0be65ddddf51c031e6cac6646a1dd
* 4ab5af20bf0914a484a2434f65a0f0643e5a92c5 
* f990cb0dee46df211c2c7212ca0165465b5f3531</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9585683</commentid>
    <comment_count>7</comment_count>
    <who name="Matthew Harmsen">mharmsen</who>
    <bug_when>2016-08-04 11:38:54 -0400</bug_when>
    <thetext>Endi made these additional changes to the master:

* cb72f5b562e33875a2144c00ea93c7c017138141 
* e6c426eb69e294207a657897fdce0a7b07e4c41d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9585689</commentid>
    <comment_count>8</comment_count>
    <who name="Matthew Harmsen">mharmsen</who>
    <bug_when>2016-08-04 11:40:41 -0400</bug_when>
    <thetext>On August 4, 2016, gil wrote:

hi

/usr/share/java/resteasy/jaxrs-api.jar is no more available.

please, use instead jboss-jaxrs-2.0-api

soon should be available also in F24 â€‹https://bodhi.fedoraproject.org/updates/FEDORA-2016-3aee3bf66c

regards</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9595799</commentid>
    <comment_count>9</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-08-08 19:54:19 -0400</bug_when>
    <thetext>Can we please have Fedora 25 and Rawhide builds with the fix? The Fedora 25 Alpha freeze kicks in very soon, and the go/no-go date is 2016-08-18, and there could well be all kinds of *other* bugs lurking behind this one - since we cannot complete a deployment due to this bug, we have done no testing of anything beyond this point yet. So we really need this bug fixed ASAP. Thank you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9600750</commentid>
    <comment_count>10</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-08-09 19:39:45 -0400</bug_when>
    <thetext>10.3.5-1 seems to have been built for F24 but not F25 or Rawhide...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604819</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-10 18:43:33 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4d226a5f7e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604820</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-10 18:44:07 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-0a384ead60</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9610358</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-12 05:49:14 -0400</bug_when>
    <thetext>resteasy-3.0.17-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-5e7ddb8249</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9612212</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-12 15:22:04 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24 resteasy-3.0.17-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4d226a5f7e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9613143</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-13 20:22:59 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24, resteasy-3.0.17-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-4d226a5f7e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9617039</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-15 23:19:41 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9620554</commentid>
    <comment_count>17</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-08-16 17:28:00 -0400</bug_when>
    <thetext>This is pushed stable and the fix is tested, so we can close it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9637781</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-22 18:28:36 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24 resteasy-3.0.17-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-4d226a5f7e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9641337</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-23 12:22:20 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24, resteasy-3.0.17-3.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-4d226a5f7e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9669595</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-31 23:20:38 -0400</bug_when>
    <thetext>pki-core-10.3.5-1.fc24, resteasy-3.0.17-3.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9754708</commentid>
    <comment_count>21</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-09-29 12:47:31 -0400</bug_when>
    <thetext>Closing again.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
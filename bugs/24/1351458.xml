<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1351458</bug_id>
          
          <creation_ts>2016-06-30 02:48:00 -0400</creation_ts>
          <short_desc>[vsftpd] 500 OOPS: 421 Service not available, when ls a dir that include more than 31 files</short_desc>
          <delta_ts>2016-07-11 04:48:11 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>vsftpd</component>
          <version>24</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Regression</keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yin.JianHong">jiyin</reporter>
          <assigned_to name="Martin Sehnoutka">msehnout</assigned_to>
          <cc>jaskalnik</cc>
    
    
    <cc>jiyin</cc>
    
    
    <cc>mnagy</cc>
    
    
    <cc>mosvald</cc>
    
    
    <cc>msehnout</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>vsftpd-3.0.3-2.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-07-11 04:48:11</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9467139</commentid>
    <comment_count>0</comment_count>
    <who name="Yin.JianHong">jiyin</who>
    <bug_when>2016-06-30 02:48:12 -0400</bug_when>
    <thetext>Description of problem:
[vsftpd] 500 OOPS: 421 Service not available, when ls a dir that include more than 31 files

Version-Release number of selected component (if applicable):
Fedora 24
vsftpd-3.0.2-15.fc24.x86_64

How reproducible:
always in my host

Steps to Reproduce:
Terminal1
1. start vsftpd service
2. mkdir $ftphome/test
3. touch $ftphome/test/{1..31}

Terminal2
4. ftp localhost  localhost # or ftp $IP from another host
ls test  # success

Terminal1
5. touch $ftphome/test/32

Terminal2
ls test  # get 500 OOPS:  fail


Actual results:
ftp&gt; ls test
227 Entering Passive Mode (10,66,13,9,53,232).
150 Here comes the directory listing.
-rw-r--r--    1 0        0               0 Jun 30 06:27 1
-rw-r--r--    1 0        0               0 Jun 30 06:27 10
-rw-r--r--    1 0        0               0 Jun 30 06:27 11
-rw-r--r--    1 0        0               0 Jun 30 06:27 12
-rw-r--r--    1 0        0               0 Jun 30 06:27 13
-rw-r--r--    1 0        0               0 Jun 30 06:27 14
-rw-r--r--    1 0        0               0 Jun 30 06:27 15
-rw-r--r--    1 0        0               0 Jun 30 06:27 16
-rw-r--r--    1 0        0               0 Jun 30 06:27 17
-rw-r--r--    1 0        0               0 Jun 30 06:27 18
-rw-r--r--    1 0        0               0 Jun 30 06:27 19
-rw-r--r--    1 0        0               0 Jun 30 06:27 2
-rw-r--r--    1 0        0               0 Jun 30 06:27 20
-rw-r--r--    1 0        0               0 Jun 30 06:27 21
-rw-r--r--    1 0        0               0 Jun 30 06:27 22
-rw-r--r--    1 0        0               0 Jun 30 06:27 23
-rw-r--r--    1 0        0               0 Jun 30 06:27 24
-rw-r--r--    1 0        0               0 Jun 30 06:27 25
-rw-r--r--    1 0        0               0 Jun 30 06:27 26
-rw-r--r--    1 0        0               0 Jun 30 06:27 27
-rw-r--r--    1 0        0               0 Jun 30 06:27 28
-rw-r--r--    1 0        0               0 Jun 30 06:27 29
-rw-r--r--    1 0        0               0 Jun 30 06:27 3
-rw-r--r--    1 0        0               0 Jun 30 06:27 30
-rw-r--r--    1 0        0               0 Jun 30 06:27 31
-rw-r--r--    1 0        0               0 Jun 30 06:27 4
-rw-r--r--    1 0        0               0 Jun 30 06:27 5
-rw-r--r--    1 0        0               0 Jun 30 06:27 6
-rw-r--r--    1 0        0               0 Jun 30 06:27 7
-rw-r--r--    1 0        0               0 Jun 30 06:27 8
-rw-r--r--    1 0        0               0 Jun 30 06:27 9
226 Directory send OK.
ftp&gt; ls test
227 Entering Passive Mode (10,66,13,9,43,2).
150 Here comes the directory listing.
500 OOPS: 421 Service not available, remote server has closed connection
ftp&gt; by
[yjh@dhcp-12-116 share]$ ftp  localhost
Trying ::1...
Connected to localhost (::1).
220 (vsFTPd 3.0.2)
Name (localhost:yjh): ftp
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; cd share
250 Directory successfully changed.
ftp&gt; ls test
229 Entering Extended Passive Mode (|||7412|).
150 Here comes the directory listing.
500 OOPS: 421 Service not available, remote server has closed connection


Expected results:
no 500 OOPS: fail

Additional info:
  use firefox as client, get similar result: can not get file list</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9471263</commentid>
    <comment_count>1</comment_count>
    <who name="Martin Sehnoutka">msehnout</who>
    <bug_when>2016-07-01 03:17:41 -0400</bug_when>
    <thetext>You have old version of vsftpd package. Please update your system and try again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9480020</commentid>
    <comment_count>2</comment_count>
    <who name="Yin.JianHong">jiyin</who>
    <bug_when>2016-07-05 02:31:58 -0400</bug_when>
    <thetext>(In reply to Martin Sehnoutka from comment #1)
&gt; You have old version of vsftpd package. Please update your system and try
&gt; again.

I have upgrade the system(Fedora 24). the vsftpd package has been the latest version in F24.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9480089</commentid>
    <comment_count>3</comment_count>
    <who name="Yin.JianHong">jiyin</who>
    <bug_when>2016-07-05 03:06:28 -0400</bug_when>
    <thetext>[yjh@dhcp-12-116 share]$ rpm -q vsftpd
vsftpd-3.0.2-15.fc24.x86_64
[yjh@dhcp-12-116 share]$ LANG=C sudo dnf update vsftpd
Last metadata expiration check: 2:14:15 ago on Tue Jul  5 12:35:00 2016.
Dependencies resolved.
Nothing to do.
Complete!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9480118</commentid>
    <comment_count>4</comment_count>
    <who name="Yin.JianHong">jiyin</who>
    <bug_when>2016-07-05 03:19:47 -0400</bug_when>
    <thetext>According https://apps.fedoraproject.org/packages/vsftpd
  The default version is vsftpd-3.0.2-15.fc24  in F24


* And vsftpd-3.0.2-16.el7 works fine</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9495671</commentid>
    <comment_count>5</comment_count>
    <who name="Yin.JianHong">jiyin</who>
    <bug_when>2016-07-11 04:48:11 -0400</bug_when>
    <thetext>The package in https://apps.fedoraproject.org/packages/vsftpd has updated to 3.0.3-2.fc24

Test ok. close.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
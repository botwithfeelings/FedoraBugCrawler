<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1380474</bug_id>
          
          <creation_ts>2016-09-29 13:14:00 -0400</creation_ts>
          <short_desc>Image pull fails with &quot;Cannot overwrite digest sha256:hash&quot;</short_desc>
          <delta_ts>2016-10-20 17:11:55 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>docker</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1387435</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Seth Jennings">sjenning</reporter>
          <assigned_to name="Antonio Murdaca">amurdaca</assigned_to>
          <cc>adimania</cc>
    
    
    <cc>admiller</cc>
    
    
    <cc>agoldste</cc>
    
    
    <cc>amurdaca</cc>
    
    
    <cc>ccoleman</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>jcajka</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>lsm5</cc>
    
    
    <cc>marianne</cc>
    
    
    <cc>me</cc>
    
    
    <cc>miminar</cc>
    
    
    <cc>nalin</cc>
    
    
    <cc>riek</cc>
    
    
    <cc>vbatts</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>docker-1.10.3-53.gite03ddb8.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-11 15:54:40</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9754758</commentid>
    <comment_count>0</comment_count>
    <who name="Seth Jennings">sjenning</who>
    <bug_when>2016-09-29 13:14:44 -0400</bug_when>
    <thetext>Description of problem:

Image pull w/ digest fails when already exists with error &quot;Cannot overwrite digest sha256:&lt;hash&gt;&quot;

Version-Release number of selected component (if applicable):

# docker version
Client:
 Version:         1.10.3
 API version:     1.22
 Package version: docker-1.10.3-52.git8b7fa4a.fc24.x86_64
 Go version:      go1.6.3
 Git commit:      8b7fa4a/1.10.3
 Built:           
 OS/Arch:         linux/amd64

Server:
 Version:         1.10.3
 API version:     1.22
 Package version: docker-1.10.3-52.git8b7fa4a.fc24.x86_64
 Go version:      go1.6.3
 Git commit:      8b7fa4a/1.10.3
 Built:           
 OS/Arch:         linux/amd64

How reproducible:

Always

Steps to Reproduce:

1. oc cluster up
2. oc new-app openshift/ruby-20-centos7~https://github.com/openshift/ruby-ex.git
3. built container pushes successfully but pull fails

Actual results:

# docker pull 172.30.127.214:5000/myproject/ruby-ex@sha256:a57ba614a14e61474849800060434a3dac2d363cd0725bc65a95336b0e90d983
Trying to pull repository 172.30.127.214:5000/myproject/ruby-ex ...
sha256:a57ba614a14e61474849800060434a3dac2d363cd0725bc65a95336b0e90d983: Pulling from 172.30.127.214:5000/myproject/ruby-ex
 
8d30e94188e7: Already exists
a3ed95caeb02: Already exists
2b72055030a2: Already exists
e20c3dd7e3a6: Already exists
006f4b559f92: Already exists
9604ab814ad2: Already exists
eeb1317c455f: Already exists
e43d85361c1f: Already exists
ccffafc28655: Already exists
b49da86489c0: Already exists
Digest: sha256:a57ba614a14e61474849800060434a3dac2d363cd0725bc65a95336b0e90d983
Cannot overwrite digest sha256:a57ba614a14e61474849800060434a3dac2d363cd0725bc65a95336b0e90d983

Expected results:

docker recognizes the image with the digest already exists and does nothing.

Additional info:

Old docker builds based on a612434 work fine.

Seems that one of these commits in the culprit.  I&apos;m thinking 34771e8.

$ git log --no-merges --oneline a612434.. | grep -i digest
6c0bb14 Do not show empty tags for digest references in output
a216b04 Treat digest only images as dangling
34771e8 Always store the image digest when pulling and pushing an image.

Full openshift debug session:
https://paste.fedoraproject.org/438222/51651371/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9756364</commentid>
    <comment_count>3</comment_count>
    <who name="Gerard Braad">me</who>
    <bug_when>2016-09-30 04:13:58 -0400</bug_when>
    <thetext>thanks for reporting this on Bugzilla. I thought I made a mistake during deployment (as image pushed), but noticed it succeeds on CentOS 7 with the same configuration. It is consistently reproducible:

Output of tests:
  https://gist.github.com/gbraad/e82edffb671a5dd154a939491514f7f8/

  Fedora 24 fails, also on Atomic
  CentOS 7 succeeds

Initial report at:
  http://lists.openshift.redhat.com/openshift-archives/users/2016-September/msg00198.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9777960</commentid>
    <comment_count>7</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-10-10 07:31:28 -0400</bug_when>
    <thetext>Fixed by https://github.com/projectatomic/docker/commit/e03ddb80cc2e3244b70052ec38d29cf526444c59

I&apos;m rebuilding docker (+ update) for F24 shortly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9778398</commentid>
    <comment_count>8</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-10-10 09:20:42 -0400</bug_when>
    <thetext>update here https://bodhi.fedoraproject.org/updates/FEDORA-2016-dfc4d2e82a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9780136</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-10 23:22:23 -0400</bug_when>
    <thetext>docker-1.10.3-53.gite03ddb8.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-dfc4d2e82a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9782463</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-11 15:54:40 -0400</bug_when>
    <thetext>docker-1.10.3-53.gite03ddb8.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
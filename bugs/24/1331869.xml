<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1331869</bug_id>
          
          <creation_ts>2016-04-29 17:03:00 -0400</creation_ts>
          <short_desc>i686 images are about 400MB larger than x86_64 images</short_desc>
          <delta_ts>2016-06-15 20:13:33 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>lorax</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedFreezeException</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>low</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1230436</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Bruno Wolff III">bruno</reporter>
          <assigned_to name="Brian Lane">bcl</assigned_to>
          <cc>anaconda-maint-list</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>bugzilla</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>pschindl</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-15 20:13:33</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9281158</commentid>
    <comment_count>0</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-04-29 17:03:32 -0400</bug_when>
    <thetext>User-Agent:       
Build Identifier: 

While i686 images have an extra set of kernel packages installed, I don&apos;t think that accounts for 400MB of size difference.

Reproducible: Always</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9281184</commentid>
    <comment_count>1</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-04-29 17:15:18 -0400</bug_when>
    <thetext>Do you mean 40MB? Right now, http://dl.fedoraproject.org/pub/fedora/linux/development/rawhide/Everything/x86_64/os/images/boot.iso is 426MB, and http://dl.fedoraproject.org/pub/fedora/linux/development/rawhide/Everything/i386/os/images/boot.iso is 474MB. kernel-PAE plus modules is about 40MB, so that&apos;s why.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9281290</commentid>
    <comment_count>2</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-04-29 19:26:37 -0400</bug_when>
    <thetext>No I mean 400. With livecd-creator there was a much smaller difference, so I suspect that livemedia-creator has something to do with the change, but it could be a recent change in the base for live images or some i686 dependency difference.

Index of /pub/alt/stage/24_Beta-1.2/Labs/i386/iso

Icon  Name                                            Last modified      Size  Description[PARENTDIR] Parent Directory                                                     -   
[   ] Fedora-Astronomy_KDE-Live-i386-24_Beta-1.2.iso  2016-04-28 16:05  2.9G  
[   ] Fedora-Jam_KDE-Live-i386-24_Beta-1.2.iso        2016-04-28 15:51  2.3G  
[   ] Fedora-Labs-24_Beta-1.2-CHECKSUM                2016-04-28 17:32  482   
[   ] Fedora-Robotics-Live-i386-24_Beta-1.2.iso       2016-04-28 15:59  2.8G  
[   ] Fedora-Scientific_KDE-Live-i386-24_Beta-1.2.iso 2016-04-28 16:10  3.2G  

Index of /pub/alt/stage/24_Beta-1.2/Labs/x86_64/iso

Icon  Name                                              Last modified      Size  Description[PARENTDIR] Parent Directory                                                       -   
[   ] Fedora-Astronomy_KDE-Live-x86_64-24_Beta-1.2.iso  2016-04-28 15:41  2.4G  
[   ] Fedora-Jam_KDE-Live-x86_64-24_Beta-1.2.iso        2016-04-28 15:29  1.9G  
[   ] Fedora-Labs-24_Beta-1.2-CHECKSUM                  2016-04-28 17:34  490   
[   ] Fedora-Robotics-Live-x86_64-24_Beta-1.2.iso       2016-04-28 15:43  2.4G  
[   ] Fedora-Scientific_KDE-Live-x86_64-24_Beta-1.2.iso 2016-04-28 15:58  2.8G</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9282245</commentid>
    <comment_count>3</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-04-30 23:00:52 -0400</bug_when>
    <thetext>Do we need the initramfs images on the live image? I don&apos;t think they are used when booting live images. Host only versions should be rebuilt during installs from a live image, but I don&apos;t know if they are.
It looks like doing this would save abot 50MB on x86_64 and 100MB on i686.
Actually removal would probably be done in the live base post install script. But install to hard drive would need to work even if the initramfs images are missing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285351</commentid>
    <comment_count>4</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-05-02 10:55:57 -0400</bug_when>
    <thetext>(In reply to Bruno Wolff III from comment #3)
&gt; Do we need the initramfs images on the live image? I don&apos;t think they are
&gt; used when booting live images. Host only versions should be rebuilt during
&gt; installs from a live image, but I don&apos;t know if they are.

They are not needed for boot, but not having an initramfs messes up the bootloader installation in some cases. They were added to the liveimg for bug 1214441.


Anyway, in the case of Fedora-Astronomy_KDE-Live x86_64 vs. i686, it looks like the same amount of space is used in the ext4 rootfs.img filesystems, but the one for i686 is an 8.3GB file while x86_64 is 7.6GB, and the squashfs.img file for i686 is similarly larger on i686. I&apos;m not sure why that would be, though.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285577</commentid>
    <comment_count>5</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-02 12:16:12 -0400</bug_when>
    <thetext>That explains why live images suddenly got a lot larger a while back. I work on the games spin, which is size is a significant constraint. There is probably a better long term fix than including an extra 100 MB.

I&apos;m not sure if livemedia-creator tries to shrink the ext4 filesystem, like livecd-creator used to. At one time I asked about getting rid of the ext4 file system as squashfs file systems can now have special files. I think that would cause a problem with using dd to install from live images quickly.

If the ext4 file system has deleted files in it, the deleted files might not compress well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9289216</commentid>
    <comment_count>6</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-03 12:58:06 -0400</bug_when>
    <thetext>Depending on the way lmc is run it either makes a clean filesystem and copies everything over, or runs a ext4 discard pass on it to make sure deleted blocks are really zero.

The initramfs inside the squashfs is currently needed by the lmc nohost run of dracut. But there may be some way to change that.

There have also been problems with xz compression and i686, we have to limit the amount of ram used so it&apos;s possible it isn&apos;t compressing as well as on x86_64.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9296228</commentid>
    <comment_count>7</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-05 11:44:36 -0400</bug_when>
    <thetext>This patch will eliminate the need for the initramfs inside the squashfs.img, saving 40M or so:

https://github.com/rhinstaller/lorax/pull/119</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9296235</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2016-05-05 11:45:55 -0400</bug_when>
    <thetext>Proposed as a Freeze Exception for 24-final by Fedora user bcl using the blocker tracking app because:

 Would be nice to have the live iso&apos;s 40M smaller.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346593</commentid>
    <comment_count>9</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-21 10:58:46 -0400</bug_when>
    <thetext>Is this likely to make it into final before the freeze? Something made the image bigger again and the i686 image is over its target size and I want to know if I need to drop another game to fix things.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346594</commentid>
    <comment_count>10</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-21 11:00:02 -0400</bug_when>
    <thetext>(I am refering to the Games spin.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346648</commentid>
    <comment_count>11</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-21 12:20:12 -0400</bug_when>
    <thetext>I looked at the uncompressed ext4 images and i686 is only about 100 MB larger there. I wonder if the memory size limit is causing problems. I&apos;m going to run some test compresses to see.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9347732</commentid>
    <comment_count>12</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-22 08:08:24 -0400</bug_when>
    <thetext>I tested the compression and the x86_64 filesystem compressed a lot better with the same options on the same machine. So I suspect, that other than the ramfs image change, we aren&apos;t going to get much more out of lorax. I&apos;ll need to look at the package level and see if there is something other than needing two kernels for the i686 version bloating things.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9351600</commentid>
    <comment_count>13</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-23 14:01:14 -0400</bug_when>
    <thetext>(In reply to Bruno Wolff III from comment #9)
&gt; Is this likely to make it into final before the freeze? Something made the
&gt; image bigger again and the i686 image is over its target size and I want to
&gt; know if I need to drop another game to fix things.

Only if this is accepted as a freeze exception. I&apos;m trying to be fairly conservative with the changes at this point.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9351672</commentid>
    <comment_count>14</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-23 14:31:30 -0400</bug_when>
    <thetext>Thanks for the update.
They didn&apos;t go over freeze exceptions today and might not until a blocker review meeting next week. So I&apos;ll figure I need to make another cut this week.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9369777</commentid>
    <comment_count>15</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-05-30 14:42:35 -0400</bug_when>
    <thetext>Discussed during the 2016-05-30 blocker review meeting: [1]

Decision was made to delay a decision on classification of this bug as a blocker or freeze exception until the appropriate parties can weigh in on the benefits of a fix and the invasiveness of said fix. 

Bruno, Brian, what are the benefits of fixing this bug and how invasive will the fix be?

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-05-30/f24-blocker-review.2016-05-30-16.01.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9370588</commentid>
    <comment_count>16</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-30 23:35:14 -0400</bug_when>
    <thetext>Right now the advantage would be that the i386 Games spin is within about 50 megabytes of the target size of 4 GiB. And a late change may put it over size with little time to adjust. The spin will still work over that size, but it might cause problems for some people trying to download it. Though probably not many people would have a problem with that limit these days. The x86_64 image is 400MB smaller and is in no danger of going over size.
I believe that is the only time sensitive call for this change.
I am not in a good position to evaluate the risk. But this is something I would have rather seen go in before final freeze which is upon us now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9373267</commentid>
    <comment_count>17</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-05-31 12:22:35 -0400</bug_when>
    <thetext>The associated anaconda change is:

https://github.com/rhinstaller/anaconda/pull/617

which just means that the initrd will always be regenerated for btrfs not just when /boot is on btrfs.

I&apos;d call it a minimal risk patch, it has been running in rawhide for a few weeks now.

The benefit is that all lmc created live iso&apos;s will be about 40M smaller because they don&apos;t need to carry the initrd on the squashfs.img, just in the iso.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9386770</commentid>
    <comment_count>18</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-06-03 20:39:45 -0400</bug_when>
    <thetext>+1FE, seems safe, minor improvement on space savings but I guess it helps and the work is done with some testing as well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9390038</commentid>
    <comment_count>19</comment_count>
    <who name="Petr Schindler">pschindl</who>
    <bug_when>2016-06-06 08:25:39 -0400</bug_when>
    <thetext>+1 FE</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9391551</commentid>
    <comment_count>20</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-06-06 15:41:45 -0400</bug_when>
    <thetext>This bug was discussed at the 2016-06-06 blocker review meeting [1] and determined to be an AcceptedFreezeException only if Fedora slips this next release. This will give the appropriate time to fix this bug and to test it. We plan to do the first post-slip build with these changes, if we slip.

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2016-06-06/f24-blocker-review.2016-06-06-16.00.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9413164</commentid>
    <comment_count>21</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-06-14 05:08:01 -0400</bug_when>
    <thetext>The difference has dropped to about 250MB even without the initramfs/lorax change. It looks like it is mostly a reduction in the size of i686 images. I don&apos;t know what caused it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9420817</commentid>
    <comment_count>22</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-06-15 20:13:33 -0400</bug_when>
    <thetext>Not going to push this change to f24. It is already in rawhide.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
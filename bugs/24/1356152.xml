<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1356152</bug_id>
          
          <creation_ts>2016-07-13 09:46:00 -0400</creation_ts>
          <short_desc>undefined references to omp_* when building openblas</short_desc>
          <delta_ts>2016-07-13 18:32:13 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>openblas</component>
          <version>24</version>
          <rep_platform>ppc64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1071880</blocked>
    
    
    <blocked>1356189</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Dan Horák">dan</reporter>
          <assigned_to name="Susi Lehtola">susi.lehtola</assigned_to>
          <cc>dan</cc>
    
    
    <cc>davejohansen</cc>
    
    
    <cc>jakub</cc>
    
    
    <cc>jwakely</cc>
    
    
    <cc>law</cc>
    
    
    <cc>mpolacek</cc>
    
    
    <cc>susi.lehtola</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-07-13 18:32:13</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9505182</commentid>
    <comment_count>0</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-07-13 09:46:00 -0400</bug_when>
    <thetext>I&apos;m getting undefined reference errors when building openblas (https://admin.fedoraproject.org/pkgdb/package/rpms/openblas/) for ppc64. If I&apos;m correct they are from gcc&apos;s libgomp.

...
make[1]: *** [cblat1] Error 1
../libopenblaso_power8-r0.2.18.a(zaxpy.o): In function `num_cpu_avail&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:141: undefined reference to `omp_in_parallel&apos;
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:146: undefined reference to `omp_get_max_threads&apos;
../libopenblaso_power8-r0.2.18.a(zswap.o): In function `num_cpu_avail&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:141: undefined reference to `omp_in_parallel&apos;
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:146: undefined reference to `omp_get_max_threads&apos;
../libopenblaso_power8-r0.2.18.a(zscal.o): In function `num_cpu_avail&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:141: undefined reference to `omp_in_parallel&apos;
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:146: undefined reference to `omp_get_max_threads&apos;
../libopenblaso_power8-r0.2.18.a(zdscal.o): In function `num_cpu_avail&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:141: undefined reference to `omp_in_parallel&apos;
/home/sharkcz/openblas/openblas-0.2.18/openmp/interface/../common_thread.h:146: undefined reference to `omp_get_max_threads&apos;
../libopenblaso_power8-r0.2.18.a(blas_server.o): In function `exec_blas._omp_fn.0&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/driver/others/blas_server_omp.c:305: undefined reference to `omp_get_num_threads&apos;
/home/sharkcz/openblas/openblas-0.2.18/openmp/driver/others/blas_server_omp.c:305: undefined reference to `omp_get_thread_num&apos;
../libopenblaso_power8-r0.2.18.a(blas_server.o): In function `exec_threads&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/driver/others/blas_server_omp.c:225: undefined reference to `omp_get_thread_num&apos;
../libopenblaso_power8-r0.2.18.a(blas_server.o): In function `goto_set_num_threads&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/driver/others/blas_server_omp.c:68: undefined reference to `omp_set_num_threads&apos;
../libopenblaso_power8-r0.2.18.a(blas_server.o): In function `exec_blas&apos;:
/home/sharkcz/openblas/openblas-0.2.18/openmp/driver/others/blas_server_omp.c:305: undefined reference to `GOMP_parallel&apos;
collect2: error: ld returned 1 exit status
Makefile:133: recipe for target &apos;zblat1&apos; failed
...

tested locally on F-24, but http://ppc.koji.fedoraproject.org/koji/taskinfo?taskID=3535680 is a rawhide scratch build

Version-Release number of selected component (if applicable):
gcc-6.1.1-3.fc24.ppc64
libgomp-6.1.1-3.fc24.ppc64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9505376</commentid>
    <comment_count>1</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2016-07-13 10:13:48 -0400</bug_when>
    <thetext>Do you use -fopenmp on the link line?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9505477</commentid>
    <comment_count>2</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-07-13 10:29:01 -0400</bug_when>
    <thetext>seems not, below should be the corresponding command line leading to the error, going to check the openblas buildsystem ...

gfortran -frecursive   -o zblat1 zblat1.o ../libopenblaso_power8-r0.2.18.a -lm -lpthread -lgfortran -lm -lpthread -lgfortran</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9505530</commentid>
    <comment_count>3</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2016-07-13 10:43:08 -0400</bug_when>
    <thetext>If anything in ../libopenblaso_power8-r0.2.18.a or zblat1.o is compiled with -fopenmp, then that is the bug, -fopenmp should be used not just during compilation, but also during linking if there is any object compiled with -fopenmp.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9505593</commentid>
    <comment_count>4</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-07-13 10:53:53 -0400</bug_when>
    <thetext>yep, and I think I at least see where is the difference between ppc64 and other arches - the other arches don&apos;t build the tests (in our rpm builds), thus don&apos;t call the wrong link command ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9505957</commentid>
    <comment_count>5</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-07-13 12:49:34 -0400</bug_when>
    <thetext>switching to openblas, because the root cause is there</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9506590</commentid>
    <comment_count>6</comment_count>
    <who name="Susi Lehtola">susi.lehtola</who>
    <bug_when>2016-07-13 15:32:13 -0400</bug_when>
    <thetext>Looks like a simple problem of the make flags not getting passed to the recursive processes.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1347442</bug_id>
          
          <creation_ts>2016-06-16 17:40:00 -0400</creation_ts>
          <short_desc>qemu-img in Fedora 23 generates different VHD image than in RHEL 7.2</short_desc>
          <delta_ts>2016-12-12 16:26:06 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>qemu</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>low</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Mulford">dmulford</reporter>
          <assigned_to name="Fedora Virtualization Maintainers">virt-maint</assigned_to>
          <cc>amit.shah</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>cmilsted</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-12 16:26:06</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9425527</commentid>
    <comment_count>0</comment_count>
    <who name="David Mulford">dmulford</who>
    <bug_when>2016-06-16 17:40:42 -0400</bug_when>
    <thetext>Description of problem:
I&apos;m unable to create a VHD image for use in Microsoft Azure. I&apos;m using the RHEL 6.8 KVM Image available on the Customer Portal, and following instructions listed in this KCS: https://access.redhat.com/articles/uploading-rhel-image-to-azure

When following the instructions on Fedora 23, the image is rejected by Azure and the virtual machine refuses to run. When following the same instructions on RHEL 7.2 to convert the qcow2 image to VHD, the image is valid and runs on Azure.

Version-Release number of selected component (if applicable):
qemu-img version 2.4.0.1 (qemu-2.4.0.1-1.fc23)
qemu-img version 1.5.3 (RHEL 7.2)


How reproducible:
Always


Steps to Reproduce:
1. Prep the image for Azure as described in the KCS linked above.
2. qemu-img convert -f qcow2 -o subformat=fixed -O vpc VM_DISK_NAME.qcow2 VM_DISK_NAME.vhd


Actual results:
Image created in Fedora is rejected and refuses to run in Azure.


Expected results:
The virtual machine starts and runs as intended.


Additional info:
I&apos;ve tried the following methods of converting from qcow2 to VHD:
1. Converting to a raw image, resizing, then converting from raw to VHD.
2. Converting directly from qcow2 to VHD (since the KVM Guest Image is already aligned to the 1 MB boundary).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9497046</commentid>
    <comment_count>1</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-07-11 11:03:47 -0400</bug_when>
    <thetext>I don&apos;t think anyone has any clue about this bug.  Suggest contacting
Microsoft and/or upstream qemu, or trying another format (&quot;raw&quot; is
basically interoperable everywhere and has the least chance of messing up).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9531589</commentid>
    <comment_count>2</comment_count>
    <who name="Paolo Bonzini">pbonzini</who>
    <bug_when>2016-07-20 06:30:16 -0400</bug_when>
    <thetext>You can use VHDX instead.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9534036</commentid>
    <comment_count>3</comment_count>
    <who name="David Mulford">dmulford</who>
    <bug_when>2016-07-20 15:12:10 -0400</bug_when>
    <thetext>VHDX is not supported in Microsoft Azure -- only VHD is for now. I&apos;ll go ahead and file a bug with upstream qemu.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9680467</commentid>
    <comment_count>5</comment_count>
    <who name="">cmilsted</who>
    <bug_when>2016-09-05 17:43:28 -0400</bug_when>
    <thetext>I think this may be worked around on F24 with the new options as below:

Allow QEMU to create images similar to how Hyper-V creates images, by
setting current_size to the specified virtual disk size.  This
introduces an option, force_size, to be passed to the vpc format during
image creation, e.g.:

    qemu-img convert -f raw -o force_size -O vpc test.img test.vhd

When using the &quot;force_size&quot; option, the creator app field used by
QEMU will be &quot;qem2&quot; instead of &quot;qemu&quot;, to indicate the difference.
In light of this, we also add parsing of the &quot;qem2&quot; field during
vpc_open.

So I suspect this can be closed and a doc bug opened to update the manuals.

Thanks

Chris</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9849067</commentid>
    <comment_count>6</comment_count>
    <who name="David Mulford">dmulford</who>
    <bug_when>2016-11-02 14:34:23 -0400</bug_when>
    <thetext>Sorry for the delayed response. I can confirm that using the force_size option creates a valid image for Azure.

Here is an upstream bug that validates what was said here:
https://bugs.launchpad.net/qemu/+bug/1490611</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9928391</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-25 04:19:07 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9978437</commentid>
    <comment_count>8</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-12-12 16:26:06 -0500</bug_when>
    <thetext>Sounds like f24+ has the force_size commit referenced in the launchpad message, so closing as CURRENTRELEASE</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
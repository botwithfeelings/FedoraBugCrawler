<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1315076</bug_id>

    <creation_ts>2016-03-06 08:02:00 -0500</creation_ts>
    <short_desc>RFE: option to skip unsigned packages</short_desc>
    <delta_ts>2017-05-23 14:44:26 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>dnf</component>
    <version>24</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>WONTFIX</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened, Triaged</keywords>
    <priority>low</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Stas Sergeev">stsp</reporter>
    <assigned_to>rpm-software-management</assigned_to>
    <cc>bene</cc>

    <cc>dennis</cc>

    <cc>jdisnard</cc>

    <cc>jmracek</cc>

    <cc>kellin</cc>

    <cc>kevin</cc>

    <cc>mboddu</cc>

    <cc>mluscon</cc>

    <cc>packaging-team-maint</cc>

    <cc>pbrobinson</cc>

    <cc>pwouters</cc>

    <cc>rpm-software-management</cc>

    <cc>sgallagh</cc>

    <cc>vmukhame</cc>

    <cc>zbyszek</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-05-23 14:44:26</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9123623</commentid>
<comment_count>0</comment_count>
<who name="Stas Sergeev">stsp</who>
<bug_when>2016-03-06 08:02:00 -0500</bug_when>
<thetext>Description of problem: Currently many packages in F24 are not signed. As the result, dnf refuses to update, unless you disable the gpg check. Of course disabling the gpg check is not what I want. How about adding an option to skip the
unsigned packages?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9146168</commentid>
<comment_count>1</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2016-03-14 08:56:22 -0400</bug_when>
<thetext>I thing you just hit the f24 repository during development before release. The fedora rawhide repository (f25) is with unsigned packages, fedora-23 repository is with signed packages. Fedora 24 is just in progress between this 2 stages. We
would prefer that repositories behave in one way with no exceptions. Probably if more user will request same RFE with good user cases, we will add the feature, but at the time I have to close it.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9146186</commentid>
<comment_count>2</comment_count>
<who name="Stas Sergeev">stsp</who>
<bug_when>2016-03-14 08:59:19 -0400</bug_when>
<thetext>What if some 3rd-party repo will start having the unsigned packages? The upgrade process will be broken just by that.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9146510</commentid>
<comment_count>3</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2016-03-14 10:31:56 -0400</bug_when>
<thetext>No, gpgcheck option can be used in dnf.conf file, .repo file or from command line. The logic is like this: the option in dnf.conf file is overwritten by option from .repo if is defined. The option gpgcheck in dnf.conf and .repo is
overwritten by command line option --nogpgcheck . As you can see it is complex multilevel setting that can be easily tuned. It is possible to use repository with signed packages and repository with unsigned packages in single transaction. Only it is
impossible to apply different gpg-check rules for a packages inside certain repository.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9146518</commentid>
<comment_count>4</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2016-03-14 10:33:39 -0400</bug_when>
<thetext>Note: dnf.conf - applied to all repositories .repo - applied to this repository</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9146524</commentid>
<comment_count>5</comment_count>
<who name="Stas Sergeev">stsp</who>
<bug_when>2016-03-14 10:37:52 -0400</bug_when>
<thetext>Yes, I mean exactly if the 3-rd party repo will release some unsigned packages by mistake, even when you fix all the official repos to not do such a mix. Say, the 3-rd party repo releases just 1 unsigned package with the rest are still
signed. If it does so, the upgrade will be broken for all repos at once, until you either disable the offending repo or disable the gpgcheck for it (you may not want to do either).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9148469</commentid>
<comment_count>6</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2016-03-15 04:20:46 -0400</bug_when>
<thetext>Yes, it will be like it. But think in other direction, if some unauthorized person manipulate a repository by adding some unsigned packages, they can be easily hidden. But if no one will be able to install them, they receive an attention. We
really think that current behavior is correct and more secure that proposed changes.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9613544</commentid>
<comment_count>7</comment_count>
<who name="Paul Wouters">pwouters</who>
<bug_when>2016-08-14 17:09:22 -0400</bug_when>
<thetext>I just hit this problem and I&apos;m sad to see this as a closed bug. I have one package missing a signature. I dont even know what repository it is in. Yet, I want my system to be updated as best as possible. It is currently preventing 250+
packages to get updated for no good reason other than me not knowing how to say &quot;skip the one bad package&quot;. One has to be a fedora developer to get this system updated, and that is wrong. This should work for mortals too.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10372259</commentid>
<comment_count>8</comment_count>
<who name="Benjamin Erridge">bene</who>
<bug_when>2017-04-28 09:28:33 -0400</bug_when>
<thetext>This should be reconsidered. I understand Stas&apos;s view but I think in reality it does not work very well. In reality people will probably just turn off that repository and not turn it back on thus never get bug and security fixes. Which
could be a bigger problem. With a flag at least they could skip it for the current update and then they would be reminded each time they had to update because they had to continue to add the flag.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10438485</commentid>
<comment_count>9</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2017-05-23 03:47:53 -0400</bug_when>
<thetext>I think the problem should be solved at the right place. The problem is that after branching from rawhide the new repository contains signed and unsigned packages but it use policy to verify gpgkeys. The best solution would be to release
that repo at the state that all packages will be signed. Also question is if packages in rawhide can be also signed, therefore the problem will not appear later on. What does DNF: 1. Every time it checks checksums 2. According to setting of
repository we check gpg keys for each package (rpm does). GPG check confirms the origin of the package and enabling hybrid behavior could result in security problem. But if you don&apos;t care about origin of packages and you trust the content of all
Fedora mirrors, just use --nogpgcheck because there is no difference between the requested feature and nogpgcheck option. I think the problem should be solved by infrastructure level and not on DNF level, therefore I am changing the component.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10439070</commentid>
<comment_count>10</comment_count>
<who name="Stas Sergeev">stsp</who>
<bug_when>2017-05-23 06:11:59 -0400</bug_when>
<thetext>(In reply to Jaroslav Mracek from comment #9) &gt; (rpm does). GPG check confirms the origin of the package and enabling hybrid &gt; behavior could result in security problem. But if you don&apos;t care about &gt; origin of packages and you
trust the content of all Fedora mirrors, just use &gt; --nogpgcheck because there is no difference between the requested feature &gt; and nogpgcheck option. The requested feature was to skip the unsigned packages, not to install them. So the
similarity to --nogpgcheck looks moot. Your original argument was in comment #6 with the point being to get the user&apos;s attention to the problem. This is a valid argument, but there are better ways to get user&apos;s attention than to break the
upgrade completely. Namely, with a loud warning suggesting to disable the repo in question, asking his confirmation to continue, etc. At the very least you can add an option to do that thing if you don&apos;t want this by default. There is already a
--nogpgcheck option, so why a much less dangerous option --skip-unsigned can not exist?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10440950</commentid>
<comment_count>11</comment_count>
<who name="Kevin Fenzi">kevin</who>
<bug_when>2017-05-23 13:03:29 -0400</bug_when>
<thetext>(In reply to Jaroslav Mracek from comment #9) &gt; I think the problem should be solved at the right place. The problem is that &gt; after branching from rawhide the new repository contains signed and unsigned &gt; packages but it use policy
to verify gpgkeys. The best solution would be to &gt; release that repo at the state that all packages will be signed. Also &gt; question is if packages in rawhide can be also signed, therefore the problem &gt; will not appear later on. This has
already been done as of F26. When we branched f26 from rawhide, both repos were fully signed when pushed out. &gt; What does DNF: &gt; 1. Every time it checks checksums &gt; 2. According to setting of repository we check gpg keys for each package
&gt; (rpm does). GPG check confirms the origin of the package and enabling hybrid &gt; behavior could result in security problem. But if you don&apos;t care about &gt; origin of packages and you trust the content of all Fedora mirrors, just use &gt;
--nogpgcheck because there is no difference between the requested feature &gt; and nogpgcheck option. I have no horse in this race, but thats not true. --nogpgcheck will install all the packages, signed or not. The reporter is asking for a way to
only installed signed packages and remove the unsigned ones from the transaction (and I assume any signed ones that depend on those. So if you have foo-1.0-1, bar-1.0-1 and baz-1.0-1 in your update set and bar depends on baz and baz is not signed,
you get: with --nogpgcheck: foo, bar and baz are all updated. with --skip-unsigned: only foo is updated and there&apos;s a message about baz not being signed and bar not being upgradable because it needs baz upgraded. In any case it&apos;s up to you
if you want to implement this... &gt; &gt; I think the problem should be solved by infrastructure level and not on DNF &gt; level, therefore I am changing the component. There&apos;s nothing more to do on the infrastructure end.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10441196</commentid>
<comment_count>12</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2017-05-23 14:44:26 -0400</bug_when>
<thetext>I am sorry for misunderstanding of this request. I am really happy to hear that all packages are signed. This is really perfect. Anyway I do not support the request due to we check gpg keys during transaction and skipping unsigned packages
can produce broken dependency or only fail at the same place - transaction check. We don&apos;t know if the package is signet or not before downloading, but any problem here is fatal for dnf due to that we have to ensure that all dependency will be
fulfill. Thanks once more to release engineers for solving the primary cause of the problem.</thetext>
</long_desc>

</bug>

</bugzilla>

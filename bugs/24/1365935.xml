<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1365935</bug_id>
          
          <creation_ts>2016-08-10 10:31:00 -0400</creation_ts>
          <short_desc>TransmitHashPolicy=802.3ad not working with bonding and systemd-networkd</short_desc>
          <delta_ts>2016-08-10 11:17:26 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>NEXTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="ArcFi">arcfi</reporter>
          <assigned_to>systemd-maint</assigned_to>
          <cc>arcfi</cc>
    
    
    <cc>johannbg</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>muadda</cc>
    
    
    <cc>ssahani</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-10 10:52:30</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9603111</commentid>
    <comment_count>0</comment_count>
    <who name="ArcFi">arcfi</who>
    <bug_when>2016-08-10 10:31:47 -0400</bug_when>
    <thetext>Description of problem:
TransmitHashPolicy=802.3ad not working with bonding and systemd-networkd.

Version-Release number of selected component (if applicable):
systemd-229-9.fc24.x86_64

How reproducible:
Always.

Steps to Reproduce:
1. echo &quot;options bonding max_bonds=0&quot; &gt; /etc/modprobe.d/bonding.conf
2. Configure bond0 interface (see additional info).
3. systemctl reboot

Actual results:
systemd-networkd[1189]: [/etc/systemd/network/00-bond0.netdev:8] Failed to parse bond transmit hash policy, ignoring: 802.3ad

Additional info:
# cat /etc/systemd/network/00-bond0.netdev 
[NetDev]
Description=lan.kola.fad.ru
Name=bond0
Kind=bond

[Bond]
Mode=802.3ad
TransmitHashPolicy=802.3ad

# man systemd.netdev | grep -A3 &quot;TransmitHashPolicy=$&quot;
       TransmitHashPolicy=
           Selects the transmit hash policy to use for slave selection in
           balance-xor, 802.3ad, and tlb modes. Possible values are &quot;layer2&quot;,
           &quot;layer3+4&quot;, &quot;layer2+3&quot;, &quot;encap2+3&quot;, &quot;802.3ad&quot;, and &quot;encap3+4&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9603237</commentid>
    <comment_count>1</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-10 10:52:30 -0400</bug_when>
    <thetext>It&apos;s not there. The man page got fixed later on, see https://github.com/systemd/systemd/commit/4d89618a4eb048704b37fec37eaa7b4cef66e6e9.

(I have no idea what TransmitHashPolicy is… If you think 802.3ad should be supported, open an RFE bug upstream at https://github.com/systemd/systemd/issues, better chances of this getting handled there.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9603333</commentid>
    <comment_count>2</comment_count>
    <who name="Jóhann B. Guðmundsson">johannbg</who>
    <bug_when>2016-08-10 11:17:26 -0400</bug_when>
    <thetext>The man page was wrong ( hence the fix ) and it&apos;s usually configured like so

[Bond]
Mode=802.3ad
TransmitHashPolicy=layer3+4
...

And it has prerequisites to work as in an switch that supports IEEE 802.3ad Dynamic link aggregation as well as those switches been configuration to enable 802.3ad mode.

Misconfiguration can result in traffic going through only one NIC or slower than expected performance.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
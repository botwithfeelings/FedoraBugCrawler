<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1280318</bug_id>
          
          <creation_ts>2015-11-11 08:20:00 -0500</creation_ts>
          <short_desc>Please build iPXE roms for QEMU with IPv6 support</short_desc>
          <delta_ts>2016-08-03 13:08:53 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>ipxe</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>883152</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Tore Anderson">tore</reporter>
          <assigned_to name="Fedora Virtualization Maintainers">virt-maint</assigned_to>
          <cc>berrange</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>kraxel</cc>
    
    
    <cc>lersek</cc>
    
    
    <cc>lprosek</cc>
    
    
    <cc>mrezanin</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>psimerda</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-03 13:08:53</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8810701</commentid>
    <comment_count>0</comment_count>
    <who name="Tore Anderson">tore</who>
    <bug_when>2015-11-11 08:20:07 -0500</bug_when>
    <thetext>Description of problem:

The images in ipxe-roms-qemu.rpm are built without support for IPv6. This makes it impossible to boot virtual machines over IPv6.

Version-Release number of selected component (if applicable):

ipxe-roms-qemu-20150407-1.gitdc795b9f.fc22.noarch

How reproducible:

100%

Steps to Reproduce:
1. Attempt to network boot a virtual machine on an IPv6 network that supports network boot according to RFC 5970

Actual results:

The boot fails.

Expected results:

The boot succeeds.

Additional info:

All that is necessary to make iPXE support IPV6 is to enable (#define) NET_PROTO_IPV6 in src/config/general.h.

The current default IPv4-only behaviour is a violation of BCP-177 (RFC 6540), see http://tools.ietf.org/html/rfc6540.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8814433</commentid>
    <comment_count>1</comment_count>
      <attachid>1093141</attachid>
    <who name="Tore Anderson">tore</who>
    <bug_when>2015-11-12 05:49:52 -0500</bug_when>
    <thetext>Created attachment 1093141
Patch to enable IPv6

FYI, rebuilding ipxe-20150407-1.gitdc795b9f.fc22.src.rpm with the attached patch included in the .spec file produces a set of iPXE ROMs that allowed me to successfully network boot a QEMU/KVM virtual machine over an IPv6-only network. (The hypervisor in question was running RHEL7 but the built RPM installed fine there without any dependency problems.)

Tore</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8814841</commentid>
    <comment_count>2</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-11-12 07:46:25 -0500</bug_when>
    <thetext>Thanks for the report and the patch.

I wonder why this isn&apos;t enabled by default in ipxe... Gerd or Paolo, any idea? I assume this is fine to enable but we tend to just mirror the qemu ipxe config for fedora, so maybe it should be changed at the qemu level as well</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8814878</commentid>
    <comment_count>3</comment_count>
    <who name="Tore Anderson">tore</who>
    <bug_when>2015-11-12 07:55:12 -0500</bug_when>
    <thetext>AFAIK it&apos;s due to space constraints. IPv6 supports adds a few KiBs. In some cases you can&apos;t program more than 64k onto the firmware area in some types of hardware. I don&apos;t think that&apos;s relevant for KVM though. At least it worked fine when I tested it, and I note that at least one of the .rom files in the RPM already exceeds 64K (10ec8139.rom).

Also for UEFI builds space is less of an issue as I understand it.

Tore</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8817460</commentid>
    <comment_count>4</comment_count>
    <who name="Gerd Hoffmann">kraxel</who>
    <bug_when>2015-11-13 03:20:19 -0500</bug_when>
    <thetext>qemu roms are 256k anyway (pci rom bar size is power of two).
ipv6 seems to add ~15k:

[ current qemu git master ]
-rw-rw-r--. 1 kraxel kraxel 196608 Nov 13 09:13 ../pc-bios/efi-e1000.rom
-rw-rw-r--. 1 kraxel kraxel 197120 Nov 13 09:13 ../pc-bios/efi-eepro100.rom
-rw-rw-r--. 1 kraxel kraxel 195584 Nov 13 09:13 ../pc-bios/efi-ne2k_pci.rom
-rw-rw-r--. 1 kraxel kraxel 195584 Nov 13 09:13 ../pc-bios/efi-pcnet.rom
-rw-rw-r--. 1 kraxel kraxel 199168 Nov 13 09:13 ../pc-bios/efi-rtl8139.rom
-rw-rw-r--. 1 kraxel kraxel 193024 Nov 13 09:13 ../pc-bios/efi-virtio.rom

[ rebuilt with ipv6 enabled ]
-rw-rw-r--. 1 kraxel kraxel 210944 Nov 13 07:46 ../pc-bios/efi-e1000.rom
-rw-rw-r--. 1 kraxel kraxel 211456 Nov 13 07:46 ../pc-bios/efi-eepro100.rom
-rw-rw-r--. 1 kraxel kraxel 209408 Nov 13 07:46 ../pc-bios/efi-ne2k_pci.rom
-rw-rw-r--. 1 kraxel kraxel 209920 Nov 13 07:46 ../pc-bios/efi-pcnet.rom
-rw-rw-r--. 1 kraxel kraxel 214016 Nov 13 07:46 ../pc-bios/efi-rtl8139.rom
-rw-rw-r--. 1 kraxel kraxel 207360 Nov 13 07:46 ../pc-bios/efi-virtio.rom

Can&apos;t see any reasons why we shouldn&apos;t flip the switch ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8828750</commentid>
    <comment_count>5</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-11-17 13:47:39 -0500</bug_when>
    <thetext>I pushed a newer ipxe to rawhide, with ipv6 enabled, and sent a patch to upstream ipxe enabling it for the qemu build profile:

http://lists.ipxe.org/pipermail/ipxe-devel/2015-November/004494.html

Provided there isn&apos;t any controversy on the patch I&apos;ll push the newer ipxe to f22 and f23 as well</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9582386</commentid>
    <comment_count>9</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-08-03 13:08:53 -0400</bug_when>
    <thetext>This is in f24, so just closing against that version</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1093141</attachid>
            <date>2015-11-12 05:49:00 -0500</date>
            <delta_ts>2015-11-12 05:49:52 -0500</delta_ts>
            <desc>Patch to enable IPv6</desc>
            <filename>ipxe-enable-ipv6.patch</filename>
            <type>text/plain</type>
            <size>520</size>
            <attacher name="Tore Anderson">tore</attacher>
            
              <data encoding="base64">ZGlmZiAtcnVOIGlweGUtMjAxNTA0MDctZ2l0ZGM3OTViOWYub3JpZy9zcmMvY29uZmlnL2dlbmVy
YWwuaCBpcHhlLTIwMTUwNDA3LWdpdGRjNzk1YjlmL3NyYy9jb25maWcvZ2VuZXJhbC5oCi0tLSBp
cHhlLTIwMTUwNDA3LWdpdGRjNzk1YjlmLm9yaWcvc3JjL2NvbmZpZy9nZW5lcmFsLmgJMjAxNS0x
MS0xMiAwOTozMToyMC44ODc0NDQxMzYgKzAxMDAKKysrIGlweGUtMjAxNTA0MDctZ2l0ZGM3OTVi
OWYvc3JjL2NvbmZpZy9nZW5lcmFsLmgJMjAxNS0xMS0xMiAwOTozMTozOC45MTAxMTkyNzAgKzAx
MDAKQEAgLTM1LDcgKzM1LDcgQEAKICAqLwogCiAjZGVmaW5lCU5FVF9QUk9UT19JUFY0CQkvKiBJ
UHY0IHByb3RvY29sICovCi0jdW5kZWYJTkVUX1BST1RPX0lQVjYJCS8qIElQdjYgcHJvdG9jb2wg
Ki8KKyNkZWZpbmUgTkVUX1BST1RPX0lQVjYJCS8qIElQdjYgcHJvdG9jb2wgKi8KICN1bmRlZglO
RVRfUFJPVE9fRkNPRQkJLyogRmlicmUgQ2hhbm5lbCBvdmVyIEV0aGVybmV0IHByb3RvY29sICov
CiAKIC8qCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>
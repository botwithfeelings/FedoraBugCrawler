<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1306559</bug_id>
          
          <creation_ts>2016-02-11 05:00:00 -0500</creation_ts>
          <short_desc>incorrect auto requires for a library packaged with RemovePathPostfixes</short_desc>
          <delta_ts>2016-02-26 11:56:30 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>rpm</component>
          <version>24</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1312435</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Kamil Dudka">kdudka</reporter>
          <assigned_to>packaging-team-maint</assigned_to>
          <cc>ffesti</cc>
    
    
    <cc>jzeleny</cc>
    
    
    <cc>kdudka</cc>
    
    
    <cc>lkardos</cc>
    
    
    <cc>novyjindrich</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pknirsch</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>rpm-4.13.0-0.rc1.25.fc25</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-02-26 02:55:25</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9052026</commentid>
    <comment_count>0</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2016-02-11 05:00:09 -0500</bug_when>
    <thetext>Description of problem:
I wanted to create the libcurl-minimal subpackage with a conservatively configured build of libcurl to reduce footprint of a minimal installation of Fedora.  The RemovePathPostfixes tag helped me to package the correct files into the libcurl-minimal subpackage.  The problem is that the automatically detected requirements of the libcurl-minimal subpackage do not describe the actually packaged library.  In fact, the requirements are the same as for the libcurl subpackage, which defeats the only purpose of the libcurl-minimal subpackage.


Version-Release number of selected component (if applicable):
rpm-4.13.0-0.rc1.11.fc23.x86_64


How reproducible:
Easily.


Steps to Reproduce:
$ fedpkg clone curl
$ cd curl
$ git checkout private-kdudka-libcurl-minimal
$ fedpkg --dist=master srpm
$ rpmbuild --nocheck --rebuild ./*.src.rpm
$ rpmdev-extract $HOME/rpmbuild/RPMS/*/libcurl-minimal-*.rpm
$ ldd libcurl-minimal-*/usr/*/libcurl.so.4.4.0              
libcurl-minimal-7.47.1-2.1.fc23.x86_64/usr/lib64/libcurl.so.4.4.0:
        linux-vdso.so.1 (0x00007ffd0d534000)
        libssl3.so =&gt; /lib64/libssl3.so (0x00007f58ffd7b000)
        libsmime3.so =&gt; /lib64/libsmime3.so (0x00007f58ffb54000)
        libnss3.so =&gt; /lib64/libnss3.so (0x00007f58ff82c000)
        libnssutil3.so =&gt; /lib64/libnssutil3.so (0x00007f58ff5ff000)
        libplds4.so =&gt; /lib64/libplds4.so (0x00007f58ff3fb000)
        libplc4.so =&gt; /lib64/libplc4.so (0x00007f58ff1f5000)
        libnspr4.so =&gt; /lib64/libnspr4.so (0x00007f58fefb6000)
        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f58fed99000)
        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f58feb94000)
        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f58fe97e000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f58fe5bd000)
        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f58fe3b4000)
        /lib64/ld-linux-x86-64.so.2 (0x000055d9b8ab1000)


Actual results:
$ rpm -pq --requires $HOME/rpmbuild/RPMS/*/libcurl-minimal-*.rpm       
libc.so.6()(64bit)
libc.so.6(GLIBC_2.14)(64bit)
libc.so.6(GLIBC_2.15)(64bit)
libc.so.6(GLIBC_2.16)(64bit)
libc.so.6(GLIBC_2.17)(64bit)
libc.so.6(GLIBC_2.2.5)(64bit)
libc.so.6(GLIBC_2.3)(64bit)
libc.so.6(GLIBC_2.3.4)(64bit)
libc.so.6(GLIBC_2.4)(64bit)
libc.so.6(GLIBC_2.7)(64bit)
libcom_err.so.2()(64bit)
libdl.so.2()(64bit)
libgssapi_krb5.so.2()(64bit)
libgssapi_krb5.so.2(gssapi_krb5_2_MIT)(64bit)
libidn.so.11()(64bit)
libidn.so.11(LIBIDN_1.0)(64bit)
libk5crypto.so.3()(64bit)
libkrb5.so.3()(64bit)
liblber-2.4.so.2()(64bit)
libldap-2.4.so.2()(64bit)
libnghttp2.so.14()(64bit)
libnspr4.so()(64bit)
libnss3.so()(64bit)
libnss3.so(NSS_3.10)(64bit)
libnss3.so(NSS_3.12)(64bit)
libnss3.so(NSS_3.12.1)(64bit)
libnss3.so(NSS_3.12.5)(64bit)
libnss3.so(NSS_3.12.6)(64bit)
libnss3.so(NSS_3.2)(64bit)
libnss3.so(NSS_3.3)(64bit)
libnss3.so(NSS_3.4)(64bit)
libnss3.so(NSS_3.5)(64bit)
libnss3.so(NSS_3.9.2)(64bit)
libnss3.so(NSS_3.9.3)(64bit)
libnssutil3.so()(64bit)
libplc4.so()(64bit)
libplds4.so()(64bit)
libpsl.so.0()(64bit)
libpthread.so.0()(64bit)
libpthread.so.0(GLIBC_2.2.5)(64bit)
libsmime3.so()(64bit)
libssh2.so.1()(64bit)
libssl3.so()(64bit)
libssl3.so(NSS_3.11.4)(64bit)
libssl3.so(NSS_3.12.6)(64bit)
libssl3.so(NSS_3.13.2)(64bit)
libssl3.so(NSS_3.14)(64bit)
libssl3.so(NSS_3.15)(64bit)
libssl3.so(NSS_3.15.4)(64bit)
libssl3.so(NSS_3.2)(64bit)
libssl3.so(NSS_3.4)(64bit)
libz.so.1()(64bit)
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(FileDigests) &lt;= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
rpmlib(PayloadIsXz) &lt;= 5.2-1
rtld(GNU_HASH)


Expected results:
$ rpm -pq --requires $HOME/rpmbuild/RPMS/*/libcurl-minimal-*.rpm     
libc.so.6()(64bit)
libc.so.6(GLIBC_2.14)(64bit)
libc.so.6(GLIBC_2.15)(64bit)
libc.so.6(GLIBC_2.16)(64bit)
libc.so.6(GLIBC_2.17)(64bit)
libc.so.6(GLIBC_2.2.5)(64bit)
libc.so.6(GLIBC_2.3)(64bit)
libc.so.6(GLIBC_2.3.4)(64bit)
libc.so.6(GLIBC_2.4)(64bit)
libc.so.6(GLIBC_2.7)(64bit)
libdl.so.2()(64bit)
libnspr4.so()(64bit)
libnss3.so()(64bit)
libnss3.so(NSS_3.10)(64bit)
libnss3.so(NSS_3.12)(64bit)
libnss3.so(NSS_3.12.1)(64bit)
libnss3.so(NSS_3.12.5)(64bit)
libnss3.so(NSS_3.12.6)(64bit)
libnss3.so(NSS_3.2)(64bit)
libnss3.so(NSS_3.3)(64bit)
libnss3.so(NSS_3.4)(64bit)
libnss3.so(NSS_3.5)(64bit)
libnss3.so(NSS_3.9.2)(64bit)
libnss3.so(NSS_3.9.3)(64bit)
libnssutil3.so()(64bit)
libplc4.so()(64bit)
libplds4.so()(64bit)
libpthread.so.0()(64bit)
libpthread.so.0(GLIBC_2.2.5)(64bit)
libsmime3.so()(64bit)
libssl3.so()(64bit)
libssl3.so(NSS_3.11.4)(64bit)
libssl3.so(NSS_3.12.6)(64bit)
libssl3.so(NSS_3.13.2)(64bit)
libssl3.so(NSS_3.14)(64bit)
libssl3.so(NSS_3.15)(64bit)
libssl3.so(NSS_3.15.4)(64bit)
libssl3.so(NSS_3.2)(64bit)
libssl3.so(NSS_3.4)(64bit)
libz.so.1()(64bit)
rpmlib(CompressedFileNames) &lt;= 3.0.4-1
rpmlib(FileDigests) &lt;= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1
rpmlib(PayloadIsXz) &lt;= 5.2-1
rtld(GNU_HASH)


Additional info:
The bug is reported to the upstream mailing list since December with no reply from upstream so far:

http://lists.rpm.org/pipermail/rpm-maint/2015-December/004046.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9097973</commentid>
    <comment_count>1</comment_count>
    <who name="Florian Festi">ffesti</who>
    <bug_when>2016-02-25 10:18:38 -0500</bug_when>
    <thetext>Can you please add the spec file somewhere?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9098121</commentid>
    <comment_count>2</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2016-02-25 10:54:48 -0500</bug_when>
    <thetext>(In reply to Florian Festi from comment #1)
&gt; Can you please add the spec file somewhere?

It is in the private-kdudka-libcurl-minimal branch of curl in Fedora dist-git (comment #0 explains how to checkout the specfile):

http://pkgs.fedoraproject.org/cgit/rpms/curl.git/tree/curl.spec?h=private-kdudka-libcurl-minimal</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9098208</commentid>
    <comment_count>3</comment_count>
    <who name="Florian Festi">ffesti</who>
    <bug_when>2016-02-25 11:22:40 -0500</bug_when>
    <thetext>Ok, I think I fixed it. Can you please test rpm-4.13.0-0.rc1.25.fc25 ? If this works out for you I&apos;ll put the patch in F24, too. Do you also need it in F23 (which this bug is reported against)?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9098344</commentid>
    <comment_count>4</comment_count>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2016-02-25 12:09:52 -0500</bug_when>
    <thetext>Looks good.  I am getting the expected results with rpm-4.13.0-0.rc1.25.fc25.  It is fine for me to have it fixed in f24+ only.  Thank you for fixing it!</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
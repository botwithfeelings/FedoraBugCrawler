<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1305391</bug_id>
          
          <creation_ts>2016-02-07 18:08:00 -0500</creation_ts>
          <short_desc>profiledbootstrap ICE in reg_save_code at ../../gcc/caller-save.c:141</short_desc>
          <delta_ts>2016-02-27 03:42:19 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gcc</component>
          <version>24</version>
          <rep_platform>ppc64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Sebor">msebor</reporter>
          <assigned_to name="Jakub Jelinek">jakub</assigned_to>
          <cc>davejohansen</cc>
    
    
    <cc>jakub</cc>
    
    
    <cc>jwakely</cc>
    
    
    <cc>law</cc>
    
    
    <cc>mpolacek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-02-27 03:42:19</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="GNU Compiler Collection">69727</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9041732</commentid>
    <comment_count>0</comment_count>
      <attachid>1122043</attachid>
    <who name="Martin Sebor">msebor</who>
    <bug_when>2016-02-07 18:08:17 -0500</bug_when>
    <thetext>Created attachment 1122043
Test case reduced from libgcc2.c.

The following build of GCC 6.0 failed while building libgcc with the error below
http://ppc.koji.fedoraproject.org/koji/taskinfo?taskID=3121923

../../../libgcc/libgcc2.c: In function &apos;__multc3&apos;:
../../../libgcc/libgcc2.c:1992:1: internal compiler error: Segmentation fault
 }
 ^
0x10324b07 crash_signal
        ../../gcc/toplev.c:335
0x10ea4c14 reg_save_code
        ../../gcc/caller-save.c:141
0x1064c76f insert_save
        ../../gcc/caller-save.c:1316
0x1064c76f save_call_clobbered_regs()
        ../../gcc/caller-save.c:863
0x1096843f reload(rtx_insn*, int)
        ../../gcc/reload1.c:990
0x10867447 do_reload
        ../../gcc/ira.c:5407
0x10867447 execute
        ../../gcc/ira.c:5566
Please submit a full bug report,
with preprocessed source if appropriate.
Please include the complete backtrace with any bug report.
See &lt;http://bugzilla.redhat.com/bugzilla&gt; for instructions.

The affected file can be reduced the attached test case.  The full stack trace with the test case is below

% /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/./gcc/xgcc -B/builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/./gcc -O2 -mlong-double-128 -c libgcc2.c -wrapper gdb,-q,--args
Reading symbols from /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/./gcc/cc1...done.
(gdb) r
Starting program: /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/gcc/cc1 -quiet -iprefix /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/gcc/../lib/gcc/ppc64-redhat-linux/6.0.0/ -isystem /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/./gcc/include -isystem /builddir/build/BUILD/gcc-6.0.0-20160205/obj-ppc64-redhat-linux/./gcc/include-fixed -D__unix__ -D__gnu_linux__ -D__linux__ -Dunix -D__unix -Dlinux -D__linux -Asystem=linux -Asystem=unix -Asystem=posix libgcc2.c -msecure-plt -quiet -dumpbase libgcc2.c -mlong-double-128 -auxbase libgcc2 -O2 -o /tmp/ccc9M8r8.s
Missing separate debuginfos, use: dnf debuginfo-install glibc-2.22.90-31.fc24.ppc64p7

Program received signal SIGSEGV, Segmentation fault.
0x0000000010ea4c14 in reg_save_code (reg=&lt;optimized out&gt;, mode=&lt;optimized out&gt;)
    at ../../gcc/caller-save.c:141
141		&amp;&amp; cached_reg_restore_code[reg][mode] != -1);
Missing separate debuginfos, use: dnf debuginfo-install gmp-6.1.0-1.fc24.ppc64 libmpc-1.0.2-4.fc23.ppc64 mpfr-3.1.3-3.fc24.ppc64 zlib-1.2.8-9.fc24.ppc64
(gdb) bt
#0  0x0000000010ea4c14 in reg_save_code (reg=&lt;optimized out&gt;, 
    mode=&lt;optimized out&gt;) at ../../gcc/caller-save.c:141
#1  0x000000001064c770 in insert_save (before_p=1, save_mode=0x3fffffffe1b4, 
    to_save=0x3fffffffe180, regno=44, chain=&lt;optimized out&gt;)
    at ../../gcc/caller-save.c:1316
#2  save_call_clobbered_regs () at ../../gcc/caller-save.c:863
#3  0x0000000010968440 in reload (first=0x3fffaf182e28, global=&lt;optimized out&gt;)
    at ../../gcc/reload1.c:990
#4  0x0000000010867448 in do_reload () at ../../gcc/ira.c:5407
#5  (anonymous namespace)::pass_reload::execute (this=&lt;optimized out&gt;)
    at ../../gcc/ira.c:5566
#6  0x00000000108d9bfc in execute_one_pass (pass=0x11793590)
    at ../../gcc/passes.c:2336
#7  0x00000000108de1fc in execute_pass_list_1 (pass=0x11793590)
    at ../../gcc/passes.c:2410
#8  execute_pass_list_1 (pass=0x11792510) at ../../gcc/passes.c:2411
#9  execute_pass_list (fn=0x3fffaf03a4b8, pass=&lt;optimized out&gt;)
    at ../../gcc/passes.c:2421
#10 0x0000000010eb3f78 in cgraph_node::expand (this=0x3fffaefe1700)
    at ../../gcc/cgraphunit.c:1974
#11 expand_all_functions () at ../../gcc/cgraphunit.c:2110
#12 symbol_table::compile (this=this@entry=0x3fffaef80000)
    at ../../gcc/cgraphunit.c:2466
#13 0x00000000106b09c0 in symbol_table::finalize_compilation_unit (
    this=0x3fffaef80000) at ../../gcc/cgraphunit.c:2556
#14 0x0000000010f4c028 in compile_file () at ../../gcc/toplev.c:490
#15 0x00000000105974a8 in do_compile () at ../../gcc/toplev.c:1988
#16 toplev::main (this=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, 
    argv=&lt;optimized out&gt;) at ../../gcc/toplev.c:2096
#17 0x000000001059973c in main (argc=&lt;optimized out&gt;, argv=0x3ffffffff198)
    at ../../gcc/main.c:39</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9041750</commentid>
    <comment_count>1</comment_count>
    <who name="Martin Sebor">msebor</who>
    <bug_when>2016-02-07 18:21:00 -0500</bug_when>
    <thetext>I haven&apos;t been able to reproduce it on trunk because of the problems mentioned in upstream bug 65313 (https://gcc.gnu.org/bugzilla/show_bug.cgi?id=65313) but a search through Bugzilla returns bug 68404 (https://gcc.gnu.org/bugzilla/show_bug.cgi?id=68404) which describes an ICE similar to this one seen on powerpc64le.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9044596</commentid>
    <comment_count>2</comment_count>
    <who name="Martin Sebor">msebor</who>
    <bug_when>2016-02-08 17:20:09 -0500</bug_when>
    <thetext>A few additional details after initial investigation:

1) Based on the -fprofile-generate command line option and the contents of the stage_current file in the build director y the ICE occurs during the stagefeedback stage.  Stage 1 gcc doesn&apos;t ICE on the test case.
2) According to Jakub, the 6.0.0-0.9 version of GCC builds fine, so problem was introduced among the changes brought over from trunk in 6.0.0-0.10 (i.e., in one of the patches or between r233052, last working revision of trunk, and r233185, the first broken revision).
3) After reviewing the changes referenced in the changelog entry corresponding to 6.0.0-0.10, the patch committed in to fix tl-optimization/69567 - PowerPC64: cstore optimisation produces bad code seemed like it could be responsible.  However, the ICE can still be reproduced even with that patched backed out, so the problem must be somewhere else.

As an aside, the successful 6.0.0-0.10 build subsequent to the failed task mentioned in the Description was that of an ordinary bootstrap, not profiledbootstrap:
http://ppc.koji.fedoraproject.org/koji/buildinfo?buildID=368892.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9045040</commentid>
    <comment_count>3</comment_count>
    <who name="Martin Sebor">msebor</who>
    <bug_when>2016-02-09 00:01:32 -0500</bug_when>
    <thetext>Reproduced on trunk and raised bootstrap/69727:
https://gcc.gnu.org/bugzilla/show_bug.cgi?id=69727</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9093060</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 09:26:07 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9102556</commentid>
    <comment_count>5</comment_count>
    <who name="Jakub Jelinek">jakub</who>
    <bug_when>2016-02-27 03:42:19 -0500</bug_when>
    <thetext>Should be fixed in gcc-6.0.0-0.12.fc24.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1122043</attachid>
            <date>2016-02-07 18:08:00 -0500</date>
            <delta_ts>2016-02-07 18:08:17 -0500</delta_ts>
            <desc>Test case reduced from libgcc2.c.</desc>
            <filename>libgcc2.c</filename>
            <type>text/plain</type>
            <size>2787</size>
            <attacher name="Martin Sebor">msebor</attacher>
            
              <data encoding="base64">dHlwZWRlZiBfQ29tcGxleCBmbG9hdCBUQ3R5cGUgX19hdHRyaWJ1dGVfXyAoKG1vZGUgKFRDKSkp
Owp0eXBlZGVmIGZsb2F0IFRGdHlwZSBfX2F0dHJpYnV0ZV9fICgobW9kZSAoVEYpKSk7CgojZGVm
aW5lIGNwc2lnbihhLCBiKSBfX2J1aWx0aW5fY29weXNpZ25sKGEsIGIpCiNkZWZpbmUgRXhwZWN0
KGEsIGIpIF9fYnVpbHRpbl9leHBlY3QoYSwgYikKClRDdHlwZQpfX211bHRjMyAoVEZ0eXBlIGEs
IFRGdHlwZSBiLCBURnR5cGUgYywgVEZ0eXBlIGQpCnsKICBURnR5cGUgYWMsIGJkLCBhZCwgYmMs
IHgsIHk7CiAgVEN0eXBlIHJlczsKCiAgYWMgPSBhICogYzsKICBiZCA9IGIgKiBkOwogIGFkID0g
YSAqIGQ7CiAgYmMgPSBiICogYzsKCiAgX19hc21fXyAoIiIgOiAiPW0iKGFjKSA6ICJtIihhYykp
OwogIF9fYXNtX18gKCIiIDogIj1tIihiZCkgOiAibSIoYmQpKTsKICBfX2FzbV9fICgiIiA6ICI9
bSIoYWQpIDogIm0iKGFkKSk7CiAgX19hc21fXyAoIiIgOiAiPW0iKGJjKSA6ICJtIihiYykpOwoK
ICB4ID0gYWMgLSBiZDsKICB5ID0gYWQgKyBiYzsKCiAgaWYgKEV4cGVjdCAoKHgpICE9ICh4KSwg
MCkgJiYgRXhwZWN0ICgoeSkgIT0gKHkpLCAwKSkKICAgIHsKCiAgICAgIF9Cb29sIHJlY2FsYyA9
IDA7CiAgICAgIGlmIChFeHBlY3QgKCFFeHBlY3QgKChhKSAhPSAoYSksIDApICYgIUV4cGVjdCAo
IUV4cGVjdCAoKChhKSAtIChhKSkgIT0gKChhKSAtIChhKSksIDApLCAxKSwgMCkgfHwgRXhwZWN0
ICghRXhwZWN0ICgoYikgIT0gKGIpLCAwKSAmICFFeHBlY3QgKCFFeHBlY3QgKCgoYikgLSAoYikp
ICE9ICgoYikgLSAoYikpLCAwKSwgMSksIDApKQogICAgICAgIHsKCgogICAgICAgICAgYSA9IGNw
c2lnbiAoRXhwZWN0ICghRXhwZWN0ICgoYSkgIT0gKGEpLCAwKSAmICFFeHBlY3QgKCFFeHBlY3Qg
KCgoYSkgLSAoYSkpICE9ICgoYSkgLSAoYSkpLCAwKSwgMSksIDApID8gMSA6IDAsIGEpOwogICAg
ICAgICAgYiA9IGNwc2lnbiAoRXhwZWN0ICghRXhwZWN0ICgoYikgIT0gKGIpLCAwKSAmICFFeHBl
Y3QgKCFFeHBlY3QgKCgoYikgLSAoYikpICE9ICgoYikgLSAoYikpLCAwKSwgMSksIDApID8gMSA6
IDAsIGIpOwogICAgICAgICAgaWYgKEV4cGVjdCAoKGMpICE9IChjKSwgMCkpIGMgPSBjcHNpZ24g
KDAsIGMpOwogICAgICAgICAgaWYgKEV4cGVjdCAoKGQpICE9IChkKSwgMCkpIGQgPSBjcHNpZ24g
KDAsIGQpOwogICAgICAgICAgcmVjYWxjID0gMTsKICAgICAgICB9CgogICAgICBpZiAoRXhwZWN0
ICghRXhwZWN0ICgoYykgIT0gKGMpLCAwKSAmICFFeHBlY3QgKCFFeHBlY3QgKCgoYykgLSAoYykp
ICE9ICgoYykgLSAoYykpLCAwKSwgMSksIDApIHx8IEV4cGVjdCAoIUV4cGVjdCAoKGQpICE9IChk
KSwgMCkgJiAhRXhwZWN0ICghRXhwZWN0ICgoKGQpIC0gKGQpKSAhPSAoKGQpIC0gKGQpKSwgMCks
IDEpLCAwKSkKICAgICAgICB7CiAgICAgICAgICBjID0gY3BzaWduIChFeHBlY3QgKCFFeHBlY3Qg
KChjKSAhPSAoYyksIDApICYgIUV4cGVjdCAoIUV4cGVjdCAoKChjKSAtIChjKSkgIT0gKChjKSAt
IChjKSksIDApLCAxKSwgMCkgPyAxIDogMCwgYyk7CiAgICAgICAgICBkID0gY3BzaWduIChFeHBl
Y3QgKCFFeHBlY3QgKChkKSAhPSAoZCksIDApICYgIUV4cGVjdCAoIUV4cGVjdCAoKChkKSAtIChk
KSkgIT0gKChkKSAtIChkKSksIDApLCAxKSwgMCkgPyAxIDogMCwgZCk7CiAgICAgICAgICBpZiAo
RXhwZWN0ICgoYSkgIT0gKGEpLCAwKSkgYSA9IGNwc2lnbiAoMCwgYSk7CiAgICAgICAgICBpZiAo
RXhwZWN0ICgoYikgIT0gKGIpLCAwKSkgYiA9IGNwc2lnbiAoMCwgYik7CiAgICAgICAgICByZWNh
bGMgPSAxOwogICAgICAgIH0KCiAgICAgIGlmICghcmVjYWxjCiAgICAgICAgICAmJiAoRXhwZWN0
ICghRXhwZWN0ICgoYWMpICE9IChhYyksIDApICYgIUV4cGVjdCAoIUV4cGVjdCAoKChhYykgLSAo
YWMpKSAhPSAoKGFjKSAtIChhYykpLCAwKSwgMSksIDApIHx8IEV4cGVjdCAoIUV4cGVjdCAoKGJk
KSAhPSAoYmQpLCAwKSAmICFFeHBlY3QgKCFFeHBlY3QgKCgoYmQpIC0gKGJkKSkgIT0gKChiZCkg
LSAoYmQpKSwgMCksIDEpLCAwKQogICAgICAgICAgICAgIHx8IEV4cGVjdCAoIUV4cGVjdCAoKGFk
KSAhPSAoYWQpLCAwKSAmICFFeHBlY3QgKCFFeHBlY3QgKCgoYWQpIC0gKGFkKSkgIT0gKChhZCkg
LSAoYWQpKSwgMCksIDEpLCAwKSB8fCBFeHBlY3QgKCFFeHBlY3QgKChiYykgIT0gKGJjKSwgMCkg
JiAhRXhwZWN0ICghRXhwZWN0ICgoKGJjKSAtIChiYykpICE9ICgoYmMpIC0gKGJjKSksIDApLCAx
KSwgMCkpKQogICAgICAgIHsKICAgICAgICAgIGlmIChFeHBlY3QgKChhKSAhPSAoYSksIDApKSBh
ID0gY3BzaWduICgwLCBhKTsKICAgICAgICAgIGlmIChFeHBlY3QgKChiKSAhPSAoYiksIDApKSBi
ID0gY3BzaWduICgwLCBiKTsKICAgICAgICAgIGlmIChFeHBlY3QgKChjKSAhPSAoYyksIDApKSBj
ID0gY3BzaWduICgwLCBjKTsKICAgICAgICAgIGlmIChFeHBlY3QgKChkKSAhPSAoZCksIDApKSBk
ID0gY3BzaWduICgwLCBkKTsKICAgICAgICAgIHJlY2FsYyA9IDE7CiAgICAgICAgfQogICAgICBp
ZiAocmVjYWxjKQogICAgICAgIHsKICAgICAgICAgIHggPSBfX2J1aWx0aW5faHVnZV92YWxsICgp
ICogKGEgKiBjIC0gYiAqIGQpOwogICAgICAgICAgeSA9IF9fYnVpbHRpbl9odWdlX3ZhbGwgKCkg
KiAoYSAqIGQgKyBiICogYyk7CiAgICAgICAgfQogICAgfQoKICAgICAgX19yZWFsX18gcmVzID0g
eDsKICAgICAgX19pbWFnX18gcmVzID0geTsKICAgICAgcmV0dXJuIHJlczsKICAgIH0K
</data>

          </attachment>
      

    </bug>

</bugzilla>
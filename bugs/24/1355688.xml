<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1355688</bug_id>
          
          <creation_ts>2016-07-12 05:09:00 -0400</creation_ts>
          <short_desc>Openvpn wont connect nm-openvpn[1963]: Bad LZO decompression header byte: 42</short_desc>
          <delta_ts>2016-08-27 06:39:23 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>NetworkManager-openvpn</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1365663</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dr. David Alan Gilbert">dgilbert</reporter>
          <assigned_to name="Lubomir Rintel">lkundrak</assigned_to>
          <cc>blueowl</cc>
    
    
    <cc>choeger</cc>
    
    
    <cc>dcbw</cc>
    
    
    <cc>hmlnarik</cc>
    
    
    <cc>huzaifas</cc>
    
    
    <cc>lkundrak</cc>
    
    
    <cc>ncross</cc>
    
    
    <cc>psimerda</cc>
    
    
    <cc>randy</cc>
    
    
    <cc>steve</cc>
    
    
    <cc>tcarlin</cc>
    
    
    <cc>thaller</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>NetworkManager-openvpn-1.2.4-2.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-13 16:21:24</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9500661</commentid>
    <comment_count>0</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-12 05:09:01 -0400</bug_when>
    <thetext>Description of problem:
I can&apos;t connect this morning to our normal corporate OpenVPN (tried two different endpoints) and noticed that yesterday I&apos;d had a NetworkManager-openvpn update.
I&apos;m using the nm-applet (from an xfce desktop) to connect.

Version-Release number of selected component (if applicable):
NetworkManager-openvpn-1.2.4-1.fc24.x86_64
NetworkManager-1.2.2-2.fc24.x86_64


How reproducible:
Seems 100%

Steps to Reproduce:
1. Connect to preconfigured OpenVPN

Actual results:
Apparently connects; lock shown on the icon; but no traffic passes; noticed:
   nm-openvpn[1963]: Bad LZO decompression header byte: 42
  repeatedly in logs

Expected results:
A working connection.

Additional info:
I&apos;ve not tried rolling back yet.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9502573</commentid>
    <comment_count>1</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-12 14:54:13 -0400</bug_when>
    <thetext>OK, a bit more debugging.

1) My logs have the warning:
Jul 12 08:56:32 dgilbert-t530 nm-openvpn[1963]: WARNING: &apos;comp-lzo&apos; is present in local config but missing in remote config, local=&apos;comp-lzo&apos;

that wasn&apos;t in yesterday&apos;s logs (journalctl -b-1 -u NetworkManager | grep -i lzo)
The nm-applet didn&apos;t show it as being on; so I tried turning it on and it didn&apos;t help - so I turned it back *off* and both that comp-lzo warning and the Bad LZO decompression warning have gone.

But I still don&apos;t get connectivity.

2) It looks like I&apos;m not getting the route added that the server sent over;
I can see the IP Config Get reply, and see it has a Static Route entry (and that looks the same as yesterdays that worked), but &apos;ip route&apos; doesn&apos;t show the route; if I add it manually it&apos;s working.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9504551</commentid>
    <comment_count>2</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-13 06:50:37 -0400</bug_when>
    <thetext>The routing fixed itself after a reboot; so I think the only problem was that it was incorrectly turning lzo on even when I didn&apos;t originally have it enabled and which cleared when I turned it off on the gui and back on.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9511900</commentid>
    <comment_count>3</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-15 04:17:27 -0400</bug_when>
    <thetext>For reference, I am seeing this as well. I can confirm that I see 

Jul 11 10:53:41 atlantis nm-openvpn[3941]: WARNING: &apos;comp-lzo&apos; is present in local config but missing in remote config, local=&apos;comp-lzo&apos;

followed by 

Jul 11 10:57:49 atlantis nm-openvpn[3941]: Bad LZO decompression header byte: 42

And although it states it has connected to the corporate vpn it has not. Downgrading to NetworkManager-openvpn-1:1.2.2-1.fc24.x86_64 from NetworkManager-openvpn-1:1.2.4-1.fc24.x86_64 fixed it.

I haven&apos;t (yet) tried the turning compression off/on again in the gui.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516631</commentid>
    <comment_count>4</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-18 04:41:56 -0400</bug_when>
    <thetext>Tried compression on/off and a reboot and it still doesn&apos;t connect for me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516672</commentid>
    <comment_count>5</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-18 04:51:34 -0400</bug_when>
    <thetext>(In reply to Nick Cross from comment #4)
&gt; Tried compression on/off and a reboot and it still doesn&apos;t connect for me.

Has the &apos;comp-lzo&apos; warning and &apos;Bad LZO decompression header&apos; warning gone for you or is it still there?


Dave</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516700</commentid>
    <comment_count>6</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-18 04:56:24 -0400</bug_when>
    <thetext>Annoyingly its still there. I thought the recent Fed update might resolve it as well as there were bugs that might related to this? (bug 1327284)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516715</commentid>
    <comment_count>7</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-18 05:00:52 -0400</bug_when>
    <thetext>(In reply to Nick Cross from comment #6)
&gt; Annoyingly its still there. I thought the recent Fed update might resolve it
&gt; as well as there were bugs that might related to this? (bug 1327284)


Hmm if you&apos;ve got those warnings then it sounds like it&apos;s not turned the compression off for you.  It&apos;s a bit difficult to know exactly which bit of fiddling did it for me; I think I tried turning it on and reconnecting, then when that failed turning it off and reconnecting.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516828</commentid>
    <comment_count>8</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-18 05:40:37 -0400</bug_when>
    <thetext>I believe you&apos;re right. I think I&apos;ll have to have extended play with it at home when I have more time :-(</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9519240</commentid>
    <comment_count>9</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-18 17:54:53 -0400</bug_when>
    <thetext>Are you using Gnome or KDE to connect?

I have

openvpn-2.3.11-1.fc24.x86_64
plasma-nm-openvpn-5.6.5-2.fc24.x86_64
NetworkManager-openvpn-1.2.2-1.fc24.x86_64

and that works fine. But with later NetworkManager-openvpn it fails (even after further attempts with different comp-lzo settings etc).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9520550</commentid>
    <comment_count>10</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-19 04:19:51 -0400</bug_when>
    <thetext>(In reply to Nick Cross from comment #9)
&gt; Are you using Gnome or KDE to connect?

xfce :-)

&gt; I have
&gt; 
&gt; openvpn-2.3.11-1.fc24.x86_64
&gt; plasma-nm-openvpn-5.6.5-2.fc24.x86_64
&gt; NetworkManager-openvpn-1.2.2-1.fc24.x86_64
&gt; 
&gt; and that works fine. But with later NetworkManager-openvpn it fails (even
&gt; after further attempts with different comp-lzo settings etc).


NetworkManager-openvpn-gnome-1.2.4-1.fc24.x86_64
NetworkManager-openvpn-1.2.4-1.fc24.x86_64
openvpn-2.3.11-1.fc24.x86_64
network-manager-applet-1.2.0-1.fc24.x86_64
nm-connection-editor-1.2.0-1.fc24.x86_64

I start the VPN using the nm-applet widget, which seems to come from network-manager-applet.
Editing seems to be done by nm-connection-editor.

Dave</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9520846</commentid>
    <comment_count>11</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-19 05:24:05 -0400</bug_when>
    <thetext>Thanks for that! 

I installed NetworkManager-openvpn-gnome network-manager-applet and configured using them my VPN targets as per your instructions. Interestingly &quot;comp-lzo=no&quot; then disappeared from  /etc/NetworkManager/system-connections/ovpn-*

And now I have a successful connection. 

My guess is while the network-manager-applet correctly edited the connection to remove the option the kde version didn&apos;t?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9520924</commentid>
    <comment_count>12</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-19 05:52:51 -0400</bug_when>
    <thetext>(In reply to Nick Cross from comment #11)
&gt; Thanks for that! 
&gt; 
&gt; I installed NetworkManager-openvpn-gnome network-manager-applet and
&gt; configured using them my VPN targets as per your instructions. Interestingly
&gt; &quot;comp-lzo=no&quot; then disappeared from 
&gt; /etc/NetworkManager/system-connections/ovpn-*
&gt; 
&gt; And now I have a successful connection. 
&gt; 
&gt; My guess is while the network-manager-applet correctly edited the connection
&gt; to remove the option the kde version didn&apos;t?

Possibly; now I used to use KDE as well (back in f22 days) which makes me wonder if I used to have the &apos;comp-lzo=no&apos; and that&apos;s the problem, perhaps this new nm-openvpn doesn&apos;t understand that?

There&apos;s this comment in the source (properties/auth-helpers.c) but I don&apos;t know the details;

        if (NM_IN_STRSET (value, &quot;yes&quot;, &quot;adaptive&quot;)) {
                /* the UI currently only supports &quot;--comp-lzo yes&quot; or omitting the &quot;--comp-lzo&quot;
                 * flag.
                 *
                 * Internally, we also support &quot;--comp-lzo [adaptive]&quot; and &quot;--comp-lzo no&quot;
                 * which have different meaning for openvpn. */
                widget = GTK_WIDGET (gtk_builder_get_object (builder, &quot;lzo_checkbutton&quot;));
                gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), TRUE);
        }</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9520950</commentid>
    <comment_count>13</comment_count>
    <who name="Dr. David Alan Gilbert">dgilbert</who>
    <bug_when>2016-07-19 06:00:39 -0400</bug_when>
    <thetext>That comment comes from Thomas&apos;s b37fda commit;  Thomas what do you reckon? Is this a behaviour with a comp-lzo=no - perhaps the KDE setup was setting that and then breaks on this upgrade?

Dave</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9521023</commentid>
    <comment_count>14</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-19 06:08:38 -0400</bug_when>
    <thetext>Is this related? : https://bugs.kde.org/show_bug.cgi?id=365816</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9529742</commentid>
    <comment_count>15</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-07-19 18:31:08 -0400</bug_when>
    <thetext>I am also experiencing this issue on KDE (using the KDE applet). I tried to manually remove comp-lzo=no in my /etc/NetworkManager/system-connections/ file, but when I used the KDE applet to connect I guess it changed it back to the way it used to be. I then tried to edit it by hand and use the nmcli tool to bring the VPN up, and it came back again. Any ideas for alternative workarounds to using the Gnome applet?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9530222</commentid>
    <comment_count>16</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-07-19 20:49:21 -0400</bug_when>
    <thetext>I downgraded to NetworkManager-openvpn-1.2.2-1.fc24 and that resolved the issue for me.

https://bodhi.fedoraproject.org/updates/FEDORA-2016-73f517cf1a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9530825</commentid>
    <comment_count>17</comment_count>
    <who name="Nick Cross">ncross</who>
    <bug_when>2016-07-20 02:56:44 -0400</bug_when>
    <thetext>@Randy : as per comment 11 I reconfigured my connections using the gnome applet. I then removed NetworkManager-openvpn-gnome network-manager-applet and have since been able to connect successfully using KDE. Although I daren&apos;t touch the KDE configuration as I suspect its not handling the options correctly. Possibly this commit http://commits.kde.org/plasma-nm/31bcd5f2cffd1c19fbd10ab0f4172f2d82eff194 from the bug referenced on comment 14 might help</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9563205</commentid>
    <comment_count>18</comment_count>
    <who name="Thom Carlin">tcarlin</who>
    <bug_when>2016-07-28 08:19:17 -0400</bug_when>
    <thetext>Comment 11 also worked for me.

Some diagnostic tips if it connects but doesn&apos;t route:
1) ip address show dev tun0
   Get the IP address
2) ping &lt;&lt;tun_ip_address&gt;&gt;
   The pings worked for me
3) ip route | grep tun0
   Get the gateway (the &quot;via &quot; argument)
4) ping &lt;&lt;tun_gateway_ip_address&gt;&gt;
   The pings failed for me
5) Try: openvpn --config &lt;&lt;openvpn_config_file&gt;&gt;
   If it works, the interaction is with NetworkManager and OpenVPN</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9577949</commentid>
    <comment_count>19</comment_count>
    <who name="Hynek Mlnarik">hmlnarik</who>
    <bug_when>2016-08-02 14:10:34 -0400</bug_when>
    <thetext>I have same experience, workaround from comment 11 solved the issue for me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9588488</commentid>
    <comment_count>20</comment_count>
    <who name="Thom Carlin">tcarlin</who>
    <bug_when>2016-08-05 07:48:03 -0400</bug_when>
    <thetext>I also removed plasma-nm</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9599116</commentid>
    <comment_count>21</comment_count>
    <who name="Blueowl">blueowl</who>
    <bug_when>2016-08-09 12:33:11 -0400</bug_when>
    <thetext>plasma-nm used to put comp-lzo=no if the checkbox was not checked (opposed to nm-connection-editor that sets nothing). But networkmanager-openvpn worked with that because it was only interested in comp-lzo=yes.
However, with https://git.gnome.org/browse/network-manager-openvpn/commit/?id=2ecf18c25a7bee7f0122d9d666a7e11cd8b55ea3 commit, networkmanager-openvpn pays attention to all comp-lzo values and thus comp-lzo=no setting added with plasma-nm really became &quot;--comp-lzo no&quot; passed to openvpn.

Nevertheless, the mentioned plasma-nm commit https://quickgit.kde.org/?p=plasma-nm.git&amp;a=commit&amp;h=31bcd5f2cffd1c19fbd10ab0f4172f2d82eff194 should fix the issue, because it adds a combobox to the checkbox, and puts comp-lzo=something to the configuration only if the checkbox is checked.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9600330</commentid>
    <comment_count>22</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-08-09 15:20:25 -0400</bug_when>
    <thetext>I filed an issue against plasma-nm (for KDE) to ask for that patch to be backported. Perhaps we each need to report this problem against the specific NM widgets we use and mark them each as blocking this issue?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604504</commentid>
    <comment_count>23</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-08-10 16:18:32 -0400</bug_when>
    <thetext>plasma-nm users: please test the plasma-nm updates in Bodhi from https://bugzilla.redhat.com/show_bug.cgi?id=1365663 and report on Bodhi if they work for you. Jan Grulich was kind enough to backport the patch that Blueowl mentioned for us to try out!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9606209</commentid>
    <comment_count>24</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2016-08-11 05:26:17 -0400</bug_when>
    <thetext>I agree with the analysis of comment 21. Together with a new nm-openvpn, an explicit comp-lzo=no setting is now interpreted differently from an absent comp-lzo setting.

plasma-nm UI should be updated [1], to either support all 4 options that openvpn support [2].
Alternativly, it should behave like nm-connection-editor which only supports 2 options a boolean checkbox, but where an unchecked comp-lzo option means not &quot;comp-lzo=no&quot; but ~no comp-lzo~.


[1] https://quickgit.kde.org/?p=plasma-nm.git&amp;a=commit&amp;h=31bcd5f2cffd1c19fbd10ab0f4172f2d82eff194
[2] https://git.gnome.org/browse/network-manager-openvpn/commit/?id=2ecf18c25a7bee7f0122d9d666a7e11cd8b55ea3
[3] https://git.gnome.org/browse/network-manager-openvpn/diff/properties/auth-helpers.c?id=2ecf18c25a7bee7f0122d9d666a7e11cd8b55ea3



This only affects users who used plasma-nm to create a connection and now have in their connection wrongly &quot;comp-lzo=no&quot;. See the output of `nmcli connection show $OVPN_CONNECTION`.
I think the fix here is to edit the connection and remove the comp-lzo setting -- for example by editing the connection in nm-connection-editor.

It&apos;s bad to break existing connections, but IMO it is really caused by a subtle bug in plasma-nm. So I think the acceptable fix is to require the user to fix the wrongly created connection.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9607553</commentid>
    <comment_count>25</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2016-08-11 10:23:20 -0400</bug_when>
    <thetext>this is now fixed in upstream nm-openvpn: https://bugzilla.gnome.org/show_bug.cgi?id=769177#c7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9607786</commentid>
    <comment_count>26</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-11 11:13:39 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-9565d84a71</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9607810</commentid>
    <comment_count>27</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-11 11:16:21 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-645466c626</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9609467</commentid>
    <comment_count>28</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-11 23:02:15 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-9565d84a71</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9611315</commentid>
    <comment_count>29</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-12 10:28:45 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-645466c626</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9613025</commentid>
    <comment_count>30</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-13 16:21:17 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9655632</commentid>
    <comment_count>31</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-27 06:39:23 -0400</bug_when>
    <thetext>NetworkManager-openvpn-1.2.4-2.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
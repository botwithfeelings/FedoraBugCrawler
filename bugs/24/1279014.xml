<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1279014</bug_id>
          
          <creation_ts>2015-11-07 00:57:00 -0500</creation_ts>
          <short_desc>Crash in _nc_init_acs_sp</short_desc>
          <delta_ts>2016-04-14 23:19:30 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gap-pkg-browse</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jerry James">loganjerry</reporter>
          <assigned_to name="Jerry James">loganjerry</assigned_to>
          <cc>dickey</cc>
    
    
    <cc>loganjerry</cc>
    
    
    <cc>mlichvar</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>gap-pkg-browse-1.8.6-6.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-04-14 23:19:30</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8799801</commentid>
    <comment_count>0</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2015-11-07 00:57:10 -0500</bug_when>
    <thetext>Description of problem:
GAP occasionally crashes while running in a mock environment.  I have never seen it happen under normal circumstances, so maybe something about the mock environment is triggering it.  Anyway, I finally managed to catch it happening in GDB.  Here is what I got:

Program received signal SIGSEGV, Segmentation fault.
_nc_init_acs_sp (sp=0x555555dae5d0) at ../../ncurses/tinfo/lib_acs.c:95
95		    real_map[j] = 0;
(gdb) bt
#0  _nc_init_acs_sp (sp=0x555555dae5d0) at ../../ncurses/tinfo/lib_acs.c:95
#1  0x00007ffff6c0bfff in _nc_init_acs () at ../../ncurses/tinfo/lib_acs.c:249
#2  0x00007ffff63c58ca in _nc_setupscreen (slines=50, scolumns=80, 
    output=output@entry=0x7ffff71eb640 &lt;_IO_2_1_stdout_&gt;, 
    filtered=&lt;optimized out&gt;, slk_format=slk_format@entry=0)
    at ../../ncurses/base/lib_set_term.c:581
#3  0x00007ffff63c276e in newterm (name=name@entry=0x7fffffffe8e6 &quot;vt100&quot;, 
    ofp=&lt;optimized out&gt;, ifp=&lt;optimized out&gt;)
    at ../../ncurses/base/lib_newterm.c:223
#4  0x00007ffff63beb33 in initscr () at ../../ncurses/base/lib_initscr.c:87
#5  0x00007ffff67e21ec in PostRestore ()
   from /usr/lib/gap/pkg/Browse/bin/x86_64-redhat-linux-gnu-gcc-default64/ncurses.so
#6  0x00007ffff67e23e9 in InitLibrary ()
   from /usr/lib/gap/pkg/Browse/bin/x86_64-redhat-linux-gnu-gcc-default64/ncurses.so
...

(gdb) print real_map
$1 = (chtype *) 0x0

So apparently it is possible that SP_PARM != 0, but SP_PARM-&gt;_acs_map == 0.  If this means that GAP is somehow misusing the interface, please let me know and I will attempt to fix this from the GAP side.

Version-Release number of selected component (if applicable):
ncurses-6.0-1.20150810.fc24.x86_64

How reproducible:
Sometimes, probably having something to do with the phase of the moon.

Steps to Reproduce:
1. Install one of the gap-pkg-* packages.  Sometimes you&apos;ll see a segfault when GAP runs to generate the workspace.  Sometimes you won&apos;t.
2.
3.

Actual results:


Expected results:


Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8803704</commentid>
    <comment_count>1</comment_count>
    <who name="Miroslav Lichvar">mlichvar</who>
    <bug_when>2015-11-09 09:32:56 -0500</bug_when>
    <thetext>I tried building gap-pkg-io in mock in a loop for an hour and running update-gap-workspace couple times, but it didn&apos;t seem to trigger the crash.
From the backtrace it&apos;s not obvious to me what&apos;s happening.

I&apos;m CCing the upstream maintainer.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8805536</commentid>
    <comment_count>2</comment_count>
    <who name="Thomas E. Dickey">dickey</who>
    <bug_when>2015-11-09 20:34:08 -0500</bug_when>
    <thetext>I don&apos;t see a cause.

The _acs_map data should be nonzero at that point,
because it is allocated earlier in _nc_setupscreen,
on line 309 of lib_set_term.c

There might be some faulty error-return which corrupts
the sp-parameter.  Are we talking about this

https://admin.fedoraproject.org/pkgdb/package/gap-pkg-io/

or some other component (so I could read the source...)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8813848</commentid>
    <comment_count>3</comment_count>
    <who name="Miroslav Lichvar">mlichvar</who>
    <bug_when>2015-11-12 02:51:23 -0500</bug_when>
    <thetext>The cause of the crash seems to be mixing incompatible ncurses/tinfo libraries in the same process. The gap binary is linked with libncurses6/libtinfo6, but the ncurses.so module from the gap-pkg-browse package is still linked with libncurses5/libtinfo5, which is now provided by the ncurses-compat-libs subpackage of ncurses.

Rebuild of the gap-pkg-browse package should fix it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9094274</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 10:31:52 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9222879</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-10 00:46:51 -0400</bug_when>
    <thetext>sagemath-6.8-8.fc24 gap-pkg-gpd-1.43-1.fc24 gap-pkg-semigroups-2.7.4-1.fc24 gap-pkg-genss-1.6.4-1.fc24 gap-pkg-spinsym-1.5-5.fc24 gap-pkg-orb-4.7.6-1.fc24 gap-pkg-ctbllib-1.2.2-7.fc24 gap-pkg-tomlib-1.2.5-7.fc24 gap-pkg-radiroot-2.7-5.fc24 gap-pkg-atlasrep-1.5.1-1.fc24 gap-pkg-nq-2.5.3-1.fc24 gap-pkg-browse-1.8.6-6.fc24 gap-pkg-alnuth-3.0.0-6.fc24 gap-pkg-polycyclic-2.11-6.fc24 gap-pkg-io-4.4.6-1.fc24 gap-pkg-crystcat-1.1.6-4.fc24 xgap-4.23-13.fc24 libgap-4.8.3-1.fc24 gap-pkg-sonata-2.8-4.fc24 gap-pkg-smallsemi-0.6.10-1.fc24 gap-pkg-polymaking-0.8.1-5.fc24 gap-pkg-grape-4.7-3.fc24 gap-pkg-fga-1.3.1-1.fc24 gap-pkg-edim-1.3.2-5.fc24 gap-pkg-cryst-4.1.12-4.fc24 gap-pkg-congruence-1.1.1-4.fc24 gap-pkg-carat-2.1.4-4.fc24 gap-pkg-autpgrp-1.6-5.fc24 gap-pkg-autodoc-2016.03.08-1.fc24 gap-pkg-aclib-1.2-5.fc24 GAPDoc-1.5.1-10.fc24 tth-4.08-4.fc24 gap-4.8.3-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-204ca75c8d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9223360</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-10 11:51:11 -0400</bug_when>
    <thetext>GAPDoc-1.5.1-10.fc24, gap-4.8.3-1.fc24, gap-pkg-aclib-1.2-5.fc24, gap-pkg-alnuth-3.0.0-6.fc24, gap-pkg-atlasrep-1.5.1-1.fc24, gap-pkg-autodoc-2016.03.08-1.fc24, gap-pkg-autpgrp-1.6-5.fc24, gap-pkg-browse-1.8.6-6.fc24, gap-pkg-carat-2.1.4-4.fc24, gap-pkg-congruence-1.1.1-4.fc24, gap-pkg-cryst-4.1.12-4.fc24, gap-pkg-crystcat-1.1.6-4.fc24, gap-pkg-ctbllib-1.2.2-7.fc24, gap-pkg-edim-1.3.2-5.fc24, gap-pkg-fga-1.3.1-1.fc24, gap-pkg-genss-1.6.4-1.fc24, gap-pkg-gpd-1.43-1.fc24, gap-pkg-grape-4.7-3.fc24, gap-pkg-io-4.4.6-1.fc24, gap-pkg-nq-2.5.3-1.fc24, gap-pkg-orb-4.7.6-1.fc24, gap-pkg-polycyclic-2.11-6.fc24, gap-pkg-polymaking-0.8.1-5.fc24, gap-pkg-radiroot-2.7-5.fc24, gap-pkg-semigroups-2.7.4-1.fc24, gap-pkg-smallsemi-0.6.10-1.fc24, gap-pkg-sonata-2.8-4.fc24, gap-pkg-spinsym-1.5-5.fc24, gap-pkg-tomlib-1.2.5-7.fc24, libgap-4.8.3-1.fc24, sagemath-6.8-8.fc24, tth-4.08-4.fc24, xgap-4.23-13.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-204ca75c8d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9238778</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-14 23:19:12 -0400</bug_when>
    <thetext>GAPDoc-1.5.1-10.fc24, gap-4.8.3-1.fc24, gap-pkg-aclib-1.2-5.fc24, gap-pkg-alnuth-3.0.0-6.fc24, gap-pkg-atlasrep-1.5.1-1.fc24, gap-pkg-autodoc-2016.03.08-1.fc24, gap-pkg-autpgrp-1.6-5.fc24, gap-pkg-browse-1.8.6-6.fc24, gap-pkg-carat-2.1.4-4.fc24, gap-pkg-congruence-1.1.1-4.fc24, gap-pkg-cryst-4.1.12-4.fc24, gap-pkg-crystcat-1.1.6-4.fc24, gap-pkg-ctbllib-1.2.2-7.fc24, gap-pkg-edim-1.3.2-5.fc24, gap-pkg-fga-1.3.1-1.fc24, gap-pkg-genss-1.6.4-1.fc24, gap-pkg-gpd-1.43-1.fc24, gap-pkg-grape-4.7-3.fc24, gap-pkg-io-4.4.6-1.fc24, gap-pkg-nq-2.5.3-1.fc24, gap-pkg-orb-4.7.6-1.fc24, gap-pkg-polycyclic-2.11-6.fc24, gap-pkg-polymaking-0.8.1-5.fc24, gap-pkg-radiroot-2.7-5.fc24, gap-pkg-semigroups-2.7.4-1.fc24, gap-pkg-smallsemi-0.6.10-1.fc24, gap-pkg-sonata-2.8-4.fc24, gap-pkg-spinsym-1.5-5.fc24, gap-pkg-tomlib-1.2.5-7.fc24, libgap-4.8.3-1.fc24, sagemath-6.8-8.fc24, tth-4.08-4.fc24, xgap-4.23-13.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
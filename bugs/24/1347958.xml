<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1347958</bug_id>
          
          <creation_ts>2016-06-19 03:09:00 -0400</creation_ts>
          <short_desc>initscripts should tell NetworkManger to ifcfg file even for NM_CONTROLLED=no</short_desc>
          <delta_ts>2016-07-11 04:56:38 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>initscripts</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>NEXTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>ZStream</keywords>
          <priority>urgent</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1345919</dependson>
          <blocked>1304509</blocked>
    
    
    <blocked>1326798</blocked>
    
    
    <blocked>1344411</blocked>
    
    
    <blocked>1346947</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Dan Kenigsberg">danken</reporter>
          <assigned_to name="Lukáš Nykrýn">lnykryn</assigned_to>
          <cc>atragler</cc>
    
    
    <cc>bgalvani</cc>
    
    
    <cc>bmcclain</cc>
    
    
    <cc>danken</cc>
    
    
    <cc>desktop-qa-list</cc>
    
    
    <cc>fdeutsch</cc>
    
    
    <cc>initscripts-maint-list</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>jscotka</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>lrintel</cc>
    
    
    <cc>mburman</cc>
    
    
    <cc>mkolaja</cc>
    
    
    <cc>ovasik</cc>
    
    
    <cc>qe-baseos-daemons</cc>
    
    
    <cc>rkhan</cc>
    
    
    <cc>thaller</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          <cf_clone_of>1345919</cf_clone_of>
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-22 09:19:56</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9430552</commentid>
    <comment_count>0</comment_count>
    <who name="Dan Kenigsberg">danken</who>
    <bug_when>2016-06-19 03:09:11 -0400</bug_when>
    <thetext>+++ This bug was initially created as a clone of Bug #1345919 +++

+++ This bug was initially created as a clone of Bug #1344411 +++


Scenario:

- NetworkManager is running, with monitor-connection-files=no (which is the default). Currently NetworkManager is managing the interface &quot;eth0&quot;, for example because there is no ifcfg file with NM_CONTROLLED=no.

- user creates a new ifcfg-eth0, with NM_CONTROLLED=no

- user calls `ifup eth0`


Result:

NetworkManager does not learn that it should not manage the configuration. Instead, ifup will activate eth0 without using nmcli, and NetworkManager continues to interfere.

That is due to:

    if ! is_false $NM_CONTROLLED &amp;&amp; is_nm_running; then
        nmcli con load &quot;/etc/sysconfig/network-scripts/$CONFIG&quot;
        UUID=$(get_uuid_by_config $CONFIG)
        [ -n &quot;$UUID&quot; ] &amp;&amp; _use_nm=true
    fi



Expected Behavior:

ifup should notify NetworkManager to reload the file. Like:

    if is_nm_running; then
        nmcli con load &quot;/etc/sysconfig/network-scripts/$CONFIG&quot;
        if ! is_false $NM_CONTROLLED; then
            UUID=$(get_uuid_by_config $CONFIG)
            [ -n &quot;$UUID&quot; ] &amp;&amp; _use_nm=true
        fi
    fi

--- Additional comment from Lukáš Nykrýn on 2016-06-13 15:48:42 IDT ---

Change looks sane to me -&gt; devel_ack.

--- Additional comment from Thomas Haller on 2016-06-13 15:59:33 IDT ---

Maybe we should also replace

  nmcli con load &quot;/etc/sysconfig/network-scripts/$CONFIG&quot;

with

  dbus-send --system --print-reply \
      --dest=org.freedesktop.NetworkManager \
      /org/freedesktop/NetworkManager/Settings \
      org.freedesktop.NetworkManager.Settings.LoadConnections \
      array:string:&quot;/etc/sysconfig/network-scripts/$CONFIG&quot;




On a quick test (on my particular machine), the dbus-send call takes about 4ms, while the nmcli call takes 215ms.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9440992</commentid>
    <comment_count>1</comment_count>
    <who name="Lukáš Nykrýn">lnykryn</who>
    <bug_when>2016-06-22 09:19:56 -0400</bug_when>
    <thetext>Fixed in upstream https://git.fedorahosted.org/cgit/initscripts.git/commit/?id=61fb1cb4efd62120ffbc021d7fdee1cd25059c08 will ne in next version of initscripts.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9441360</commentid>
    <comment_count>2</comment_count>
    <who name="Dan Kenigsberg">danken</who>
    <bug_when>2016-06-22 10:37:26 -0400</bug_when>
    <thetext>I&apos;m requesting to have it in currently-supported Fedora versions. Would it be available in f24?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9495701</commentid>
    <comment_count>3</comment_count>
    <who name="Lukáš Nykrýn">lnykryn</who>
    <bug_when>2016-07-11 04:56:38 -0400</bug_when>
    <thetext>Just one more patch and I will do a new release of initscripts and include it in fedora.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
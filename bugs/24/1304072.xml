<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1304072</bug_id>
          
          <creation_ts>2016-02-02 14:36:00 -0500</creation_ts>
          <short_desc>SELinux is preventing /usr/sbin/nmbd from using the &apos;net_admin&apos; capabilities.</short_desc>
          <delta_ts>2016-12-05 04:38:06 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>samba</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:354974a907a8b45b4f3ab199210145fe8f30a673361422886513f7f52034f12d;</status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Laine Stump">laine</reporter>
          <assigned_to name="Guenther Deschner">gdeschner</assigned_to>
          <cc>abokovoy</cc>
    
    
    <cc>andrew.kavalov</cc>
    
    
    <cc>anoopcs</cc>
    
    
    <cc>asn</cc>
    
    
    <cc>caochitam</cc>
    
    
    <cc>cutnioff</cc>
    
    
    <cc>dan</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>error</cc>
    
    
    <cc>gdeschner</cc>
    
    
    <cc>hx</cc>
    
    
    <cc>ian</cc>
    
    
    <cc>j.orti.alcaine</cc>
    
    
    <cc>jrivera</cc>
    
    
    <cc>karl+rhbugzilla</cc>
    
    
    <cc>lists</cc>
    
    
    <cc>lmohanty</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>madam</cc>
    
    
    <cc>me</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>mike</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>prasadpatil252</cc>
    
    
    <cc>sbose</cc>
    
    
    <cc>secondary</cc>
    
    
    <cc>ssorce</cc>
    
    
    <cc>temlakos</cc>
    
    
    <cc>thebeardedhermit</cc>
    
    
    <cc>trevor</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>selinux-policy-3.13.1-191.21.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-05 04:38:06</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9030225</commentid>
    <comment_count>0</comment_count>
    <who name="Laine Stump">laine</who>
    <bug_when>2016-02-02 14:36:28 -0500</bug_when>
    <thetext>Description of problem:
rebooted after dnf update of a ton of packages. I have nmbd configured to run on my system, but no special config for it.
SELinux is preventing /usr/sbin/nmbd from using the &apos;net_admin&apos; capabilities.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that nmbd should have the net_admin capability by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# grep nmbd /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp

Additional Information:
Source Context                system_u:system_r:nmbd_t:s0
Target Context                system_u:system_r:nmbd_t:s0
Target Objects                Unknown [ capability ]
Source                        nmbd
Source Path                   /usr/sbin/nmbd
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           samba-4.3.4-1.fc23.x86_64
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-158.2.fc23.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Permissive
Host Name                     (removed)
Platform                      Linux (removed) 4.5.0-rc2 #20 SMP Mon Feb 1
                              17:47:36 EST 2016 x86_64 x86_64
Alert Count                   17
First Seen                    2015-12-19 21:02:27 EST
Last Seen                     2016-02-02 14:32:13 EST
Local ID                      24b444da-921b-4967-91bb-214052ca27ea

Raw Audit Messages
type=AVC msg=audit(1454441533.869:758): avc:  denied  { net_admin } for  pid=3343 comm=&quot;nmbd&quot; capability=12  scontext=system_u:system_r:nmbd_t:s0 tcontext=system_u:system_r:nmbd_t:s0 tclass=capability permissive=1


type=SYSCALL msg=audit(1454441533.869:758): arch=x86_64 syscall=recvmsg success=yes exit=3560 a0=25 a1=7ffec9443ca0 a2=0 a3=7f4789e3c2d8 items=0 ppid=1 pid=3343 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=nmbd exe=/usr/sbin/nmbd subj=system_u:system_r:nmbd_t:s0 key=(null)

Hash: nmbd,nmbd_t,nmbd_t,capability,net_admin

Version-Release number of selected component:
selinux-policy-3.13.1-158.2.fc23.noarch

Additional info:
reporter:       libreport-2.6.3
hashmarkername: setroubleshoot
kernel:         4.5.0-rc2
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9380541</commentid>
    <comment_count>1</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-06-02 06:26:07 -0400</bug_when>
    <thetext>*** Bug 1341722 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9380562</commentid>
    <comment_count>2</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-06-02 06:34:08 -0400</bug_when>
    <thetext>Samba folks, 

Do we need allow net_admin capability for nmbd?

 
CAP_NET_ADMIN
              Perform various network-related operations:
              * interface configuration;
              * administration of IP firewall, masquerading, and accounting;
              * modify routing tables;
              * bind to any address for transparent proxying;
              * set type-of-service (TOS)
              * clear driver statistics;
              * set promiscuous mode;
              * enabling multicasting;
              * use  setsockopt(2) to set the following socket options: SO_DEBUG, SO_MARK, SO_PRIORITY (for a pri‚Äê
                ority outside the range 0 to 6), SO_RCVBUFFORCE, and SO_SNDBUFFORCE.

Thank you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9568693</commentid>
    <comment_count>3</comment_count>
    <who name="Michael Hampton">error</who>
    <bug_when>2016-07-30 00:41:17 -0400</bug_when>
    <thetext>Description of problem:
Started nmb.service

Version-Release number of selected component:
selinux-policy-3.13.1-191.5.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.6.4-301.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9604548</commentid>
    <comment_count>4</comment_count>
    <who name="">dan</who>
    <bug_when>2016-08-10 16:35:50 -0400</bug_when>
    <thetext>Also seeing this after upgrade from FC23 to FC24.

SELinux is preventing nmbd from using the net_admin capability.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that nmbd should have the net_admin capability by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# ausearch -c &apos;nmbd&apos; --raw | audit2allow -M my-nmbd
# semodule -X 300 -i my-nmbd.pp

Additional Information:
Source Context                system_u:system_r:nmbd_t:s0
Target Context                system_u:system_r:nmbd_t:s0
Target Objects                Unknown [ capability ]
Source                        nmbd
Source Path                   nmbd
Port                          &lt;Unknown&gt;
Host                          zzzz.private
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-191.8.fc24.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     ears.private
Platform                      Linux zzzz.private 4.6.4-301.fc24.x86_64 #1 SMP
                              Tue Jul 12 11:50:00 UTC 2016 x86_64 x86_64
Alert Count                   2
First Seen                    2016-08-10 16:31:59 EDT
Last Seen                     2016-08-10 16:31:59 EDT
Local ID                      4d9b6d02-2521-40c1-a682-414fa707a947

Raw Audit Messages
type=AVC msg=audit(1470861119.219:59792): avc:  denied  { net_admin } for  pid=20381 comm=&quot;nmbd&quot; capability=12  scontext=system_u:system_r:nmbd_t:s0 tcontext=system_u:system_r:nmbd_t:s0 tclass=capability permissive=0


Hash: nmbd,nmbd_t,nmbd_t,capability,net_admin</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9606480</commentid>
    <comment_count>5</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-08-11 06:58:52 -0400</bug_when>
    <thetext>Could anybody answer comment#2? 

Thank you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9635411</commentid>
    <comment_count>6</comment_count>
    <who name="Cao Chi Tam">caochitam</who>
    <bug_when>2016-08-22 06:43:59 -0400</bug_when>
    <thetext>To fix this bug, you can run recommended commands below &quot;Do
allow this access for now by executing:&quot;
It&apos;s work for me, and you?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9636510</commentid>
    <comment_count>7</comment_count>
    <who name="">dan</who>
    <bug_when>2016-08-22 11:36:14 -0400</bug_when>
    <thetext>Agree with Lukas in comment #5, someone from the Samba team should respond to comment #2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9636601</commentid>
    <comment_count>8</comment_count>
    <who name="Alexander Bokovoy">abokovoy</who>
    <bug_when>2016-08-22 11:57:48 -0400</bug_when>
    <thetext>I tried to find out what it could be, but nmbd is using generic Samba routines for opening sockets so the same policy that applies to smbd would need to apply to nmbd.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9676982</commentid>
    <comment_count>9</comment_count>
    <who name="Terry A. Hurlbut">temlakos</who>
    <bug_when>2016-09-03 09:33:04 -0400</bug_when>
    <thetext>Description of problem:
An attempt to access Samba shares on Dolphin produced this error.


Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.2-201.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9812406</commentid>
    <comment_count>10</comment_count>
    <who name="Shaun Assam">thebeardedhermit</who>
    <bug_when>2016-10-21 16:09:53 -0400</bug_when>
    <thetext>Description of problem:
- Installed samba package via CLI.
- Entered command: systemctl start nmb.service smb.service.

Version-Release number of selected component:
selinux-policy-3.13.1-191.18.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.9-200.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9869017</commentid>
    <comment_count>11</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-11-07 16:37:53 -0500</bug_when>
    <thetext>*** Bug 1386933 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9889381</commentid>
    <comment_count>12</comment_count>
    <who name="">secondary</who>
    <bug_when>2016-11-14 13:41:13 -0500</bug_when>
    <thetext>I think this capability is necessary. Without which nmbd fails to respond to broadcast queries. That is, everything but network browsing works.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9924773</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-24 10:21:26 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9930563</commentid>
    <comment_count>14</comment_count>
    <who name="">dan</who>
    <bug_when>2016-11-25 12:55:20 -0500</bug_when>
    <thetext>Version in bug report should be bumped to at least FC24 as this but occurs there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9943720</commentid>
    <comment_count>15</comment_count>
    <who name="Laine Stump">laine</who>
    <bug_when>2016-11-30 10:58:33 -0500</bug_when>
    <thetext>Lukas - you changed the status of this to POST, but didn&apos;t include any information about where the fix was posted to. Is it fixed in a particular upstream version of the package? What about F24/25/rawhide - do they have a new enough version of the package (is it samba that&apos;s been / will be modified?)

In the meantime, I&apos;m moving to F24 at Dan&apos;s request.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9955375</commentid>
    <comment_count>16</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-12-05 04:38:06 -0500</bug_when>
    <thetext>Hi Laine, 

$ rpm -q selinux-policy 
selinux-policy-3.13.1-191.21.fc24.noarch

$ sesearch -A -s nmbd_t -t nmbd_t -c capability -p net_admin
Found 1 semantic av rules:
   allow nmbd_t nmbd_t : capability { net_bind_service net_admin } ;

Issue is fixed in current stable release.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
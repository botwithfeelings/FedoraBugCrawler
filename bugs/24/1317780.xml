<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1317780</bug_id>
          
          <creation_ts>2016-03-15 04:20:00 -0400</creation_ts>
          <short_desc>Fedora 23 distribution ISOs cannot PXE boot</short_desc>
          <delta_ts>2016-05-11 10:29:57 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dracut</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="patpat">masottaus</reporter>
          <assigned_to>dracut-maint-list</assigned_to>
          <cc>adam.stokes</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>dhuff</cc>
    
    
    <cc>dracut-maint-list</cc>
    
    
    <cc>harald</cc>
    
    
    <cc>igeorgex</cc>
    
    
    <cc>Jasper.Hartline</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>katzj</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-18 06:15:30</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9148467</commentid>
    <comment_count>0</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-15 04:20:18 -0400</bug_when>
    <thetext>Description of problem:
Fedora 23 distribution ISOs include a new initrd style.
The new (dracut made) initrds do not include CIFS/HTML/NFS support then we cannot PXE boot Fedora ISOs (not even the &quot;netinst&quot; flavors!) therefore we are forced to burn ISOs or to prepare USB pendrives.

Version-Release number of selected component (if applicable):
All the Fedora 23 distribution ISOs present this problem
Red Hat distros are always rock solid when it comes to PXE boot;
why Fedora 23 changes on this point now.

How reproducible:
Always when trying to PXE boot any Fedora 23 ISO,

Steps to Reproduce:
Fedora 22 PXE boots with (i.e. using Serva)
kernel_bios   = /NWA_PXE/$HEAD_DIR$/isolinux/vmlinuz
append_bios   = initrd=/NWA_PXE/$HEAD_DIR$/isolinux/initrd.img root=live:http://$IP_BSRV$/NWA_PXE/$HEAD_DIR$/LiveOS/squashfs.img ksdevice=bootif repo=http://$IP_BSRV$/NWA_PXE/$HEAD_DIR$/ rootfstype=auto ro rd.live.image rhgb rd.luks=0 rd.md=0 rd.dm=0


Actual results:
Fedora 23 says it cannot handle root=live:http:

Expected results:
initrd should contain code to deal with HTTP/CIFS etc in order to PXE boot as Red-Hat perfectly does

Additional info:
-

Best,
Patrick</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9149858</commentid>
    <comment_count>1</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-03-15 11:32:26 -0400</bug_when>
    <thetext>reassigning to livecd to question why the &quot;livenet&quot; dracut module is not included in the LiveCD initrd&apos;s.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150121</commentid>
    <comment_count>2</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-03-15 12:56:05 -0400</bug_when>
    <thetext>I don&apos;t think there were any big changes between f22 and f23. Live images have, as far as I can tell, never included livenet. I checked f22 and f23 workstation and neither have it. I think the normal way people have been PXE booting live images is to use the livecd-iso-to-pxeboot tool which appends the squashfs.img to the initrd and uses the loop driver to access it.

On the other hand the  netinst iso&apos;s do include livenet, and for F24 live will also include it. F24 *is* changing how live images are created, using a process that is closer to how netinst is made (livemedia-creator uses parts of lorax for this).

But be aware that only live should use live: for netinst and DVD images you should PXE boot with inst.stage2 so that the anaconda-dracut module works properly.

I&apos;m not sure why live:http worked for you previously, unless something else in dracut was handling the http part.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150243</commentid>
    <comment_count>3</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-15 13:43:34 -0400</bug_when>
    <thetext>ok if you see here:
http://vercot.com/~serva/an/NonWindowsPXE3.html
you can see how to PXE boot Fedora 22 and older while 23 is not possible.

People want to get the distribution (live or not) ISO, put it on a PXE server and boot from it; what you describe (please don&apos;t be mad at me) is some guesswork that tells me you probably do not PXE boot very often.

&gt;I don&apos;t think there were any big changes between f22 and f23.
you are guessing. They changed; they used to be similar to Red Hat now they include dracut created initrds w/o net support.

&gt;Live images have, as far as I can tell, never included livenet.
guesswork plus livenet has nothing to do with having Fedora distros including initrds able to retrieve the distro components from a network after the kernel was PXE booted.

&gt;I think the normal way people have been PXE booting live images is to 
&gt;use the livecd-iso-to-pxeboot tool which appends the squashfs.img 
&gt;to the initrd and uses the loop driver to access it.
guesswork, this is not how people PXE boot a Fedora or any other distribution ISOs.

&gt;On the other hand the  netinst iso&apos;s do include livenet, 
You still cannot see it. Even including &quot;livenet&quot; the new netinst ISOs &quot;cannot&quot; be PXE booted what is really &quot;ironic&quot;. Please understand, the objective is network retrieving the distro componets with the code included within the &quot;initrd&quot; file no the one that later on will be added by the squashfs or some other img or component. It is the early initrd the one that has to now how to deal with the network in order to retrieve components.

I encourage you to see how Red Hat initrds are made; their ISOs are always being able to PXE boot w/o changing anything. PXE should not be a feature only available on certain flavors of a distro. Please follow Red Hat on this. you can also see how RHEL ISOs and Centos are easily PXE booted here:
http://vercot.com/~serva/an/NonWindowsPXE3.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9150718</commentid>
    <comment_count>4</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-15 16:32:39 -0400</bug_when>
    <thetext>&gt;reassigning to livecd to question why the &quot;livenet&quot; 
&gt;dracut module is not included in the LiveCD initrd&apos;s.

This does not make much sense, what I&apos;m reporting here affects not only live distributions and it is not related to &quot;livenet&quot;

When an ISO boots loads a kernel + initrd,
the init script maps stuff, starts things and then loads a squashfs with a live distro or starts a discrete install process.
If the ISO is booted from a DVD or pendrive the components are just loaded from the corresponding drive but in a PXE boot situation the booted initrd must have net support and also the init script must know how to retrieve stuff using HTML or mapping a drive using CIFS or NFS in order to net retrieve the squashfs. Therefore it doesn&apos;t matter if the squashfs has all the net supportbells &amp; whistles if it cannot be transferred because the initrd does not know how... got it?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9155440</commentid>
    <comment_count>5</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-17 04:28:48 -0400</bug_when>
    <thetext>The problem is solved here by Antony Messerli.
https://bugzilla.redhat.com/show_bug.cgi?id=1280103

I&apos;ve just created a complementary initrd injecting 
/usr/lib/systemd/system-generators/dracut-livenet-generator
with the code from here 
https://github.com/antonym/dracut/blob/a455ad1c272170664022b4cc0a160fe9c737d993/modules.d/90livenet/livenet-generator.sh
and now Fedora 23 PXE boots retrieving stuff by HTTP...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9157232</commentid>
    <comment_count>6</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-17 13:12:40 -0400</bug_when>
    <thetext>NOT A BUG?? you guys are AWESOME...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9159096</commentid>
    <comment_count>7</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-03-18 06:12:58 -0400</bug_when>
    <thetext>(In reply to patpat from comment #5)
&gt; The problem is solved here by Antony Messerli.
&gt; https://bugzilla.redhat.com/show_bug.cgi?id=1280103
&gt; 
&gt; I&apos;ve just created a complementary initrd injecting 
&gt; /usr/lib/systemd/system-generators/dracut-livenet-generator
&gt; with the code from here 
&gt; https://github.com/antonym/dracut/blob/
&gt; a455ad1c272170664022b4cc0a160fe9c737d993/modules.d/90livenet/livenet-
&gt; generator.sh
&gt; and now Fedora 23 PXE boots retrieving stuff by HTTP...

This would mean a respin of the ISOs, which is probably not going to happen.
And of course, this is a bug. A change in systemd required the &quot;dracut-livenet-generator&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9159102</commentid>
    <comment_count>8</comment_count>
    <who name="Harald Hoyer">harald</who>
    <bug_when>2016-03-18 06:15:30 -0400</bug_when>
    <thetext>This should be fixed with Fedora 24 and because this bug is for F24, I am closing this as &quot;CURRENTRELEASE&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9159138</commentid>
    <comment_count>9</comment_count>
    <who name="patpat">masottaus</who>
    <bug_when>2016-03-18 06:36:03 -0400</bug_when>
    <thetext>Everything OK.
Thanks guys.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1313085</bug_id>
          
          <creation_ts>2016-02-29 17:18:00 -0500</creation_ts>
          <short_desc>Name resolution fails (resolv.conf is a broken systemd symlink) on livemedia-creator live image</short_desc>
          <delta_ts>2016-09-16 16:40:16 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1268974</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1264364</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1116651</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1376928</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedBlocker</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1230431</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to>systemd-maint</assigned_to>
          <cc>admiller</cc>
    
    
    <cc>anaconda-maint-list</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>bugzilla</cc>
    
    
    <cc>dcbw</cc>
    
    
    <cc>dustymabe</cc>
    
    
    <cc>jdulaney</cc>
    
    
    <cc>jfrieben</cc>
    
    
    <cc>johannbg</cc>
    
    
    <cc>juliux.pigface</cc>
    
    
    <cc>kevin</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>lkundrak</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>muadda</cc>
    
    
    <cc>pbrobinson</cc>
    
    
    <cc>projects.rg</cc>
    
    
    <cc>psimerda</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>satellitgo</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
    
    
    <cc>vpavlin</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>systemd-229-6.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-13 12:33:08</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9107362</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 17:18:27 -0500</bug_when>
    <thetext>I booted the 2016-02-25 Rawhide Workstation live (which was before branching, so this is for F24) on a real laptop. It doesn&apos;t have an ethernet connection, so on boot there was no network.

I connected to my wifi network in the usual way (from the Shell network menu, entering the passphrase when asked) and that appeared to work fine, but name resolution does not work. Basic connectivity is there - I can ping 8.8.8.8.

There is no /etc/resolv.conf . /var/run/NetworkManager/resolv.conf does exist and looks correct. In the journal I see:

&lt;warn&gt; dns-mgr: could not commit DNS changes: Could not stat /etc/resolv.conf: No such file or directory

this is with NetworkManager-1.2.0-0.6.beta1.fc24 .

Proposing as an Alpha blocker, as a conditional violation of all network-related criteria (web browser &apos;working&apos;, for e.g.) at least with wireless networking on the Workstation live.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107395</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 17:22:43 -0500</bug_when>
    <thetext>Just noticed this is the old systemd symlink issue again; /etc/resolv.conf is a dangling symlink to ..//run/systemd/resolv/resolv.conf .

So this is like https://bugzilla.redhat.com/show_bug.cgi?id=1268974 and https://bugzilla.redhat.com/show_bug.cgi?id=1264364 , only affecting a live environment, not anaconda.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107416</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 17:30:10 -0500</bug_when>
    <thetext>This does indeed also affect a boot in a VM, so the wireless stuff has nothing to do with it, it&apos;s just systemd nerfing /etc/resolv.conf.

This was not broken in the 2016-02-15 Rawhide nightly, networking worked there. Neither systemd nor NetworkManager has changed significantly in the mean time, so my suspect here is livemedia-creator; the 2016-02-25 nightly is a livemedia-creator product, 2016-02-15 was produced by livecd-creator.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107444</commentid>
    <comment_count>3</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-02-29 17:37:45 -0500</bug_when>
    <thetext>lorax does not define what&apos;s in the live environment.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107451</commentid>
    <comment_count>4</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 17:40:26 -0500</bug_when>
    <thetext>I thought lorax was the appropriate component for livemedia-creator issues, since livemedia-creator is a part of lorax.

This is not really a &apos;what&apos;s in the live image&apos; issue, unless you&apos;re suggesting we remove either systemd or NetworkManager? Neither of which seems entirely viable. We can&apos;t really hack up systemd-tmpfiles in the kickstart, I don&apos;t think.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107488</commentid>
    <comment_count>5</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 17:55:55 -0500</bug_when>
    <thetext>So FWIW it seems like this works with livecd-creator lives because those appear to have a zero-length /etc/resolv.conf in them. That would prevent systemd-tmpfiles from creating the dangling symlink, and I guess NM is OK with replacing a regular file /etc/resolv.conf with its own symlink whereas it won&apos;t replace a dangling symlink.

By contrast there is no /etc/resolv.conf in a livemedia-creator produced live image at all; that means systemd-tmpfiles feels free to create its stupid dangling symlink, which NM then refuses to overwrite.

I don&apos;t know whether to say this bug is systemd&apos;s fault or NM&apos;s or livemedia-creator&apos;s, but it&apos;s definitely not the fault of the kickstarts.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9107499</commentid>
    <comment_count>6</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 18:01:19 -0500</bug_when>
    <thetext>Possibly relevant, https://bugzilla.redhat.com/show_bug.cgi?id=1116651 - there is a note in livecd-tools `imgcreate/kickstart.py` in the `write_resolv` function which links out to that bug, it seems like we made livecd-creator try harder to create resolv.conf when this whole systemd crap originally showed up. https://github.com/rhinstaller/livecd-tools/pull/1 was the pull request.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9126573</commentid>
    <comment_count>7</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-03-07 12:29:34 -0500</bug_when>
    <thetext>Discussed at today&apos;s blocker review meeting [1]. Accepted as an Alpha blocker -  it&apos;s a clear violation of &quot;It must be possible to run the default web browser and a terminal application from all release-blocking desktop environments.&quot; and any other network-related criterion for both KDE and Workstation lives.

[1] https://meetbot-raw.fedoraproject.org/fedora-blocker-review/2016-03-07/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9130523</commentid>
    <comment_count>8</comment_count>
    <who name="John Dulaney">jdulaney</who>
    <bug_when>2016-03-08 17:25:26 -0500</bug_when>
    <thetext>Seems to me that if systemd-resolvd is not used, systemd ought to be smart enough to not try to symlink things around ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9131457</commentid>
    <comment_count>9</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-03-08 23:43:07 -0500</bug_when>
    <thetext>So... I think it makes sense to not create the symlink in Fedora (upstream is a different issue).

There seem to be two possible scenarios for systemd-resolved: if it becomes widely accepted, nss-resolve will be used, which does not require /etc/resolv.conf. If it does not gain acceptance, something else will have to provide /etc/resolv.conf. In neither scenario is the link needed. So while I think that NM could behave smarter wrt. to a dangling symlink, it&apos;s just a waste of time to discuss a symlink that is going to go away anyway.

There is a small, I think, group which falls outside of those two possibilities: people who are using systemd-networkd and systemd-resolved with nss-dns. To cater to those users, the symlink could be created when resolved is started.

I&apos;ll try to make a patch to this effect.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9138355</commentid>
    <comment_count>10</comment_count>
    <who name="Raphael Groner">projects.rg</who>
    <bug_when>2016-03-10 09:23:02 -0500</bug_when>
    <thetext>Does not work:
# rm -f /etc/resolv.conf ; echo 192.168.1.1 &gt;/etc/resolv.conf
# cat /etc/resolv.conf
192.168.1.1
# ping fedoraproject.org
ping: fedoraproject.org: Temporary failure in name resolution

192.168.1.1 is the local DNS that&apos;s also assigned to the host machine via DHCP. Setting it via NetworkManager GUI does not help either.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9138413</commentid>
    <comment_count>11</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-03-10 09:36:59 -0500</bug_when>
    <thetext>&gt; # cat /etc/resolv.conf
&gt; 192.168.1.1
That&apos;s invalid syntax.
I&apos;m not sure what you&apos;re trying to say here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9138520</commentid>
    <comment_count>12</comment_count>
    <who name="Raphael Groner">projects.rg</who>
    <bug_when>2016-03-10 09:51:17 -0500</bug_when>
    <thetext>(In reply to Zbigniew Jędrzejewski-Szmek from comment #11)
&gt; &gt; # cat /etc/resolv.conf
&gt; &gt; 192.168.1.1
&gt; That&apos;s invalid syntax.
&gt; I&apos;m not sure what you&apos;re trying to say here.

Oh, I tried to find a workaround and confused the syntax:
# cat /etc/resolv.conf
nameserver 192.168.1.1
# ping -c1 fedoraproject.org &gt;/dev/null &amp;&amp; echo works!
works!

Sorry for the noise.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9138891</commentid>
    <comment_count>13</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-10 11:15:03 -0500</bug_when>
    <thetext>The workaround is just `rm -f /etc/resolv.conf; ln -s /var/run/NetworkManager/resolv.conf /etc`</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9139624</commentid>
    <comment_count>14</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-10 15:03:28 -0500</bug_when>
    <thetext>*** Bug 1312778 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9140072</commentid>
    <comment_count>15</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-03-10 20:07:23 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #13)
As pointed out in https://bugzilla.redhat.com/show_bug.cgi?id=1312778#c6 it is even sufficient to remove the stub link by executing &apos;rm -f /etc/resolv.conf&apos; and then deactivate and activate the network device again in the GNOME panel. Then the correct symlink is created automatically.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9143079</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-11 22:59:36 -0500</bug_when>
    <thetext>systemd-229-6.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-64146d940c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9143160</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-12 02:49:39 -0500</bug_when>
    <thetext>systemd-229-6.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-64146d940c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9144375</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-03-13 12:32:55 -0400</bug_when>
    <thetext>systemd-229-6.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
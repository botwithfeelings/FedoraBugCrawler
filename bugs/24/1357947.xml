<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1357947</bug_id>
          
          <creation_ts>2016-07-19 12:11:00 -0400</creation_ts>
          <short_desc>[dhclient] option -R is broken</short_desc>
          <delta_ts>2016-08-04 16:52:54 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dhcp</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Harald Reindl">h.reindl</reporter>
          <assigned_to name="Jiri Popelka">jpopelka</assigned_to>
          <cc>jpopelka</cc>
    
    
    <cc>thozza</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>dhcp-4.3.4-3.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-04 16:52:54</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9525847</commentid>
    <comment_count>0</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-07-19 12:11:26 -0400</bug_when>
    <thetext>how is &quot;dhclient&quot; in F24 is supposed to work without touching /etc/resilv.conf which is a *absolute no-go* in case of having dns-server on the same host which points to hosts behind vpn-tunnels including the default forwarding-resolvers

well, i can now create a &quot;resolv.conf.my&quot; and add another ExecStartPost to copy that over the generated one but this is a terrible solution and the manpage states cleary that all is fine

frankly i have enough of all this idiotic defaults touching resolv.conf and fear in case of &quot;chattr +i&quot; it the command fails also
_____________________________________________

[root@srv-rhsoft:~]$ /usr/sbin/dhclient -4 -H srv-rhsoft -q -R subnet-mask,broadcast-address,routers,interface-mtu br-wan
Internet Systems Consortium DHCP Client 4.3.4
Copyright 2004-2016 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/
Command not used for DHCPv4: -R
Usage: dhclient [-4|-6] [-SNTPRI1dvrxi] [-nw] [-p &lt;port&gt;] [-D LL|LLT]
                [-s server-addr] [-cf config-file]
                [-df duid-file] [-lf lease-file]
                [-pf pid-file] [--no-pid] [-e VAR=val]
                [-sf script-file] [interface]*
                [-C &lt;dhcp-client-identifier&gt;] [-B]
                [-H &lt;host-name&gt; | -F &lt;fqdn.fqdn&gt;] [-timeout &lt;timeout&gt;]
                [-V &lt;vendor-class-identifier&gt;]
                [-R &lt;request option list&gt;]
_____________________________________________

/usr/sbin/dhclient -4 -H srv-rhsoft

[root@srv-rhsoft:~]$ cat /etc/resolv.conf 
options timeout:3 attempts:3 rotate
; generated by /usr/sbin/dhclient-script
search upc.at rhsoft.net
nameserver 195.34.133.21
nameserver 212.186.211.21
_____________________________________________

expected result is don&apos;t change this in any way:
[root@srv-rhsoft:~]$ cat /etc/resolv.conf
domain rhsoft.net
search rhsoft.net thelounge.net vmware.local test.rh

nameserver 127.0.0.1

options timeout:3 attempts:3 rotate
_____________________________________________

[root@srv-rhsoft:~]$ systemctl status network-wan-bridge.service
● network-wan-bridge.service - Network Internet Bridge
   Loaded: loaded (/etc/systemd/system/network-wan-bridge.service; enabled; vendor preset: disabled)
   Active: inactive (dead) (Result: exit-code) since Di 2016-07-19 17:54:44 CEST; 14min ago
  Process: 4665 ExecStopPost=/usr/sbin/brctl delbr br-wan (code=exited, status=0/SUCCESS)
  Process: 4662 ExecStopPost=/usr/sbin/ifconfig br-wan down (code=exited, status=0/SUCCESS)
  Process: 15376 ExecStart=/usr/sbin/dhclient -4 -H srv-rhsoft -q -R subnet-mask,broadcast-address,routers,interface-mtu br-wan (code=exited, status=1/FAILURE)
  Process: 15372 ExecStartPre=/usr/sbin/ifconfig br-wan hw ether 00:50:8D:B5:CC:DE up (code=exited, status=0/SUCCESS)
  Process: 15369 ExecStartPre=/usr/sbin/brctl addif br-wan vmnet1 (code=exited, status=1/FAILURE)
  Process: 15366 ExecStartPre=/usr/sbin/brctl addif br-wan wan (code=exited, status=1/FAILURE)
  Process: 15363 ExecStartPre=/usr/sbin/brctl setfd br-wan 5 (code=exited, status=0/SUCCESS)
  Process: 15360 ExecStartPre=/usr/sbin/brctl setageing br-wan 600 (code=exited, status=0/SUCCESS)
  Process: 15357 ExecStartPre=/usr/sbin/brctl stp br-wan off (code=exited, status=0/SUCCESS)
  Process: 15355 ExecStartPre=/usr/sbin/brctl addbr br-wan (code=exited, status=1/FAILURE)

Jul 19 17:54:43 srv-rhsoft.rhsoft.net systemd[1]: Failed to start Network Internet Bridge.
Jul 19 17:54:43 srv-rhsoft.rhsoft.net systemd[1]: network-wan-bridge.service: Unit entered failed state.
Jul 19 17:54:43 srv-rhsoft.rhsoft.net systemd[1]: network-wan-bridge.service: Failed with result &apos;exit-code&apos;.
Jul 19 17:54:44 srv-rhsoft.rhsoft.net systemd[1]: network-wan-bridge.service: Service hold-off time over, scheduling restart.
Jul 19 17:54:44 srv-rhsoft.rhsoft.net systemd[1]: Stopped Network Internet Bridge.
Jul 19 17:54:44 srv-rhsoft.rhsoft.net systemd[1]: network-wan-bridge.service: Start request repeated too quickly.
Jul 19 17:54:44 srv-rhsoft.rhsoft.net systemd[1]: Failed to start Network Internet Bridge.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9525855</commentid>
    <comment_count>1</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-07-19 12:14:53 -0400</bug_when>
    <thetext>ok, at least &quot;chattr +i /etc/resolv.conf&quot; don&apos;t end in a error but still a terrible regression (which in my case had the result driving to the machine after upgrade which lost it&apos;s internet and vpn-connectivity)

[root@srv-rhsoft:~]$ systemctl status network-wan-bridge.service
● network-wan-bridge.service - Network Internet Bridge
   Loaded: loaded (/etc/systemd/system/network-wan-bridge.service; enabled; vendor preset: disabled)
   Active: active (running) since Di 2016-07-19 18:12:53 CEST; 6s ago
  Process: 13950 ExecStopPost=/usr/sbin/brctl delbr br-wan (code=exited, status=0/SUCCESS)
  Process: 13948 ExecStopPost=/usr/sbin/ifconfig br-wan down (code=exited, status=0/SUCCESS)
  Process: 14162 ExecStartPost=/usr/sbin/ifconfig vmnet1 0.0.0.0 -multicast -allmulti up (code=exited, status=0/SUCCESS)
  Process: 14096 ExecStartPost=/usr/sbin/ifconfig br-wan -multicast -allmulti (code=exited, status=0/SUCCESS)
  Process: 14002 ExecStart=/usr/sbin/dhclient -4 -H srv-rhsoft -q br-wan (code=exited, status=0/SUCCESS)
  Process: 13978 ExecStartPre=/usr/sbin/ifconfig br-wan hw ether 00:50:8D:B5:CC:DE up (code=exited, status=0/SUCCESS)
  Process: 13975 ExecStartPre=/usr/sbin/brctl addif br-wan vmnet1 (code=exited, status=0/SUCCESS)
  Process: 13973 ExecStartPre=/usr/sbin/brctl addif br-wan wan (code=exited, status=0/SUCCESS)
  Process: 13969 ExecStartPre=/usr/sbin/brctl setfd br-wan 5 (code=exited, status=0/SUCCESS)
  Process: 13966 ExecStartPre=/usr/sbin/brctl setageing br-wan 600 (code=exited, status=0/SUCCESS)
  Process: 13964 ExecStartPre=/usr/sbin/brctl stp br-wan off (code=exited, status=0/SUCCESS)
  Process: 13957 ExecStartPre=/usr/sbin/brctl addbr br-wan (code=exited, status=0/SUCCESS)
 Main PID: 14095 (dhclient)
    Tasks: 1 (limit: 512)
   CGroup: /system.slice/network-wan-bridge.service
           └─14095 /usr/sbin/dhclient -4 -H srv-rhsoft -q br-wan</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9580989</commentid>
    <comment_count>2</comment_count>
    <who name="Jiri Popelka">jpopelka</who>
    <bug_when>2016-08-03 07:08:43 -0400</bug_when>
    <thetext>Sorry for the delay Harald, I was on holiday.
I see what&apos;s going on - we&apos;ve always had this patch [1] for adding several options to dhclient and &apos;-R&apos; being on of them.
But in latest dhcp-4.3.4 upstream also added [2] a dhcpv6-only &apos;-R&apos; option to dhclient.
This already happened once, when upstream added &apos;-I&apos; and I had to rename our &apos;-I&apos; to &apos;-C&apos;.

The question is what letter/name to use instead of &apos;-R&apos;.
I&apos;d probably go with something like long &apos;--request-options&apos; rather then choosing a short one letter option to avoid renaming again later.
What do you think ?

[1] http://pkgs.fedoraproject.org/cgit/rpms/dhcp.git/tree/dhcp-dhclient-options.patch
[2] https://source.isc.org/cgi-bin/gitweb.cgi?p=dhcp.git;a=commitdiff;h=c88dfebddd766d40dc29b50ede355ec3ecf2a463</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9580996</commentid>
    <comment_count>3</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-08-03 07:11:46 -0400</bug_when>
    <thetext>i don&apos;t care much how i tell dhclient to leave my resolvers in peace and just get IP, gateway and in doubt MTU form the ISP - but such breakage leaves remote systems which in fact are the router/firewall itself offline and require you in doubt to drive some hundret kilometers</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9581159</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-03 08:04:42 -0400</bug_when>
    <thetext>dhcp-4.3.4-3.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-5789f83769</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9581934</commentid>
    <comment_count>5</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-08-03 10:59:18 -0400</bug_when>
    <thetext>don&apos;t look like it works as expected :-(

- [dhclient] rename -R option to --request-options (#1357947)

[root@srv-rhsoft:~]$ /usr/sbin/dhclient -4 -H srv-rhsoft -q --request-options=subnet-mask,broadcast-address,routers,interface-mtu br-wan
Internet Systems Consortium DHCP Client 4.3.4
Copyright 2004-2016 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/
Unknown command: --request-options=subnet-mask,broadcast-address,routers,interface-mtu
Usage: dhclient [-4|-6] [-SNTPRI1dvrxi] [-nw] [-p &lt;port&gt;] [-D LL|LLT]
                [-s server-addr] [-cf config-file]
                [-df duid-file] [-lf lease-file]
                [-pf pid-file] [--no-pid] [-e VAR=val]
                [-sf script-file] [interface]*
                [-C &lt;dhcp-client-identifier&gt;] [-B]
                [-H &lt;host-name&gt; | -F &lt;fqdn.fqdn&gt;] [--timeout &lt;timeout&gt;]
                [-V &lt;vendor-class-identifier&gt;]
                [--request-options &lt;request option list&gt;]

This version of ISC DHCP is based on the release available
on ftp.isc.org.  Features have been added and other changes
have been made to the base software release in order to make
it work better with this distribution.

Please report for this software via the Red Hat Bugzilla site:
    http://bugzilla.redhat.com

exiting.
[root@srv-rhsoft:~]$ rpm -qa | grep dhcp
dhcp-libs-4.3.4-3.fc24.x86_64
dhcp-client-4.3.4-3.fc24.x86_64
dhcp-common-4.3.4-3.fc24.noarch
dhcp-server-4.3.4-3.fc24.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9581955</commentid>
    <comment_count>6</comment_count>
    <who name="Harald Reindl">h.reindl</who>
    <bug_when>2016-08-03 11:03:05 -0400</bug_when>
    <thetext>ok, it works without the = but are normally long-params not supposed to work with &quot;--param=value&quot; and short-params like &quot;-p value&quot;?


[root@srv-rhsoft:~]$ systemctl status network-wan-bridge.service
? network-wan-bridge.service - Network Internet Bridge
   Loaded: loaded (/etc/systemd/system/network-wan-bridge.service; enabled; vendor preset: disabled)
   Active: active (running) since Mi 2016-08-03 17:01:25 CEST; 33s ago
  Process: 7050 ExecStopPost=/usr/sbin/brctl delbr br-wan (code=exited, status=0/SUCCESS)
  Process: 7048 ExecStopPost=/usr/sbin/ifconfig br-wan down (code=exited, status=0/SUCCESS)
  Process: 8027 ExecStartPost=/usr/sbin/ifconfig vmnet1 0.0.0.0 -multicast -allmulti up (code=exited, status=0/SUCCESS)
  Process: 8025 ExecStartPost=/usr/sbin/ifconfig br-wan -multicast -allmulti (code=exited, status=0/SUCCESS)
  Process: 7084 ExecStart=/usr/sbin/dhclient -4 -H srv-rhsoft -q --request-options subnet-mask,broadcast-address,routers,interface-mtu br-wan (code=exited, status=0/SUCCESS)
  Process: 7080 ExecStartPre=/usr/sbin/ifconfig br-wan hw ether 00:50:8D:B5:CC:DE up (code=exited, status=0/SUCCESS)
  Process: 7077 ExecStartPre=/usr/sbin/brctl addif br-wan vmnet1 (code=exited, status=0/SUCCESS)
  Process: 7074 ExecStartPre=/usr/sbin/brctl addif br-wan wan (code=exited, status=0/SUCCESS)
  Process: 7071 ExecStartPre=/usr/sbin/brctl setfd br-wan 5 (code=exited, status=0/SUCCESS)
  Process: 7068 ExecStartPre=/usr/sbin/brctl setageing br-wan 600 (code=exited, status=0/SUCCESS)
  Process: 7064 ExecStartPre=/usr/sbin/brctl stp br-wan off (code=exited, status=0/SUCCESS)
  Process: 7060 ExecStartPre=/usr/sbin/brctl addbr br-wan (code=exited, status=0/SUCCESS)
 Main PID: 8024 (dhclient)
    Tasks: 1 (limit: 512)
   CGroup: /system.slice/network-wan-bridge.service
           ??8024 /usr/sbin/dhclient -4 -H srv-rhsoft -q --request-options subnet-mask,broadcast-address,routers,interface-mtu br-wan

Aug 03 17:01:21 srv-rhsoft.rhsoft.net systemd[1]: Starting Network Internet Bridge...
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPREQUEST on br-wan to 255.255.255.255 port 67 (xid=0xae4a4503)
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPNAK from 10.34.112.57 (xid=0xae4a4503)
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPDISCOVER on br-wan to 255.255.255.255 port 67 interval 5 (xid=0xc175b301)
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPREQUEST on br-wan to 255.255.255.255 port 67 (xid=0xc175b301)
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPOFFER from 10.34.112.57
Aug 03 17:01:22 srv-rhsoft.rhsoft.net dhclient[7084]: DHCPACK from 10.34.112.57 (xid=0xc175b301)
Aug 03 17:01:25 srv-rhsoft.rhsoft.net dhclient[7084]: bound to 62.178.103.85 -- renewal in 78866 seconds.
Aug 03 17:01:25 srv-rhsoft.rhsoft.net systemd[1]: Started Network Internet Bridge.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9583368</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-03 21:54:46 -0400</bug_when>
    <thetext>dhcp-4.3.4-3.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-5789f83769</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9586766</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-04 16:52:52 -0400</bug_when>
    <thetext>dhcp-4.3.4-3.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
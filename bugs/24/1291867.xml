<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1291867</bug_id>
          
          <creation_ts>2015-12-15 13:47:00 -0500</creation_ts>
          <short_desc>[conn] show progress when repo has metalink</short_desc>
          <delta_ts>2017-06-16 09:18:42 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Triaged</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Stadelmann">rhbz2</reporter>
          <assigned_to>rpm-software-management</assigned_to>
          <cc>jmracek</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>rhbz2</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>dnf-2.5.1-1.fc26</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-16 09:18:42</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8920812</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2015-12-15 13:47:59 -0500</bug_when>
    <thetext>Description of problem:
Right now mirrors of rpmfusion seem to be suffering a high load. They barely respond to HTTP requests. When using dnf it freezes for minutes.

Version-Release number of selected component (if applicable):
dnf-1.1.4-2.fc23.noarch
hawkey-0.6.2-3.fc23.x86_64
libsolv-0.6.14-7.fc23.x86_64
rpm-4.13.0-0.rc1.7.fc23.x86_64

How reproducible:
I don&apos;t really know. Right now (with mirror offline) I can permanently reproduce this issue.

Steps to Reproduce:
1. start dnf with any action causing mirror refresh, e.g. `dnf upgrade`
2. wait.

Actual results:
For a very long time (~10 minutes) there is no response by dnf.

Expected results:
If a mirror is offline (and skip_if_unavailable is False, which is the case here) dnf should skip the mirror after some seconds (e.g. 5000 milliseconds). It should not blocking wait for minutes to connect to the mirror.

Additional info:
This issue also makes yumex-dnf (using dnf api) freeze on start in such cases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8939726</commentid>
    <comment_count>1</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2015-12-23 09:32:58 -0500</bug_when>
    <thetext>(In reply to Christian Stadelmann from comment #0)
&gt; If a mirror is offline and skip_if_unavailable is False
You probably meant True

Do you still have such problems? I believe these were temporary rpmfusion server issues. Can you try it again and set `timeout` dnf config value /etc/dnf/dnf.conf to lower value than default and post result, please?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8939727</commentid>
    <comment_count>2</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2015-12-23 09:33:52 -0500</bug_when>
    <thetext>+ attach the data described here [1], please.

[1] https://github.com/rpm-software-management/dnf/wiki/Bug-Reporting#connection-issue</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8993455</commentid>
    <comment_count>3</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-01-19 17:34:10 -0500</bug_when>
    <thetext>&gt; &gt; If a mirror is offline and skip_if_unavailable is False
&gt; You probably meant True

Yes, I meant True.

&gt; 
&gt; Do you still have such problems? I believe these were temporary rpmfusion
&gt; server issues. Can you try it again and set `timeout` dnf config value
&gt; /etc/dnf/dnf.conf to lower value than default and post result, please?
&gt; + attach the data described here [1], please.
&gt; 
&gt; [1]
&gt; https://github.com/rpm-software-management/dnf/wiki/Bug-Reporting#connection-
&gt; issue

$ rpm -q librepo curl dnf
librepo-1.7.16-2.fc23.x86_64
curl-7.43.0-4.fc23.x86_64
dnf-1.1.5-1.fc23.noarch

I wasn&apos;t able to reproduce and the /var/log/dnf.librepo.log file doesn&apos;t have timestamps and has gone already.

Is it possible that the timeout (default: 30seconds) was just applied to each repo successively, maybe even two or three times per repo when retrying?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9007053</commentid>
    <comment_count>4</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2016-01-25 07:14:39 -0500</bug_when>
    <thetext>(In reply to Christian Stadelmann from comment #3)

&gt; Is it possible that the timeout (default: 30seconds) was just applied to
&gt; each repo successively, maybe even two or three times per repo when retrying?

The timeout is for one repo.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9007474</commentid>
    <comment_count>5</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-01-25 09:14:51 -0500</bug_when>
    <thetext>Ok, that probably has been the cause then. With 6 rpmfusion repos enabled it waited at least 3 minutes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9490410</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-07-08 05:35:37 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10440511</commentid>
    <comment_count>7</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-05-23 11:04:10 -0400</bug_when>
    <thetext>Ok, a have found that timeout in dnf is set to 120 s and it differs from yum. I create PR that changed it to 30 s like in yum (https://github.com/rpm-software-management/dnf/pull/824). Probably it helps. The showing a progress if used metalink it would be tricky, because we use at the same time 3 downloads in parallel and each of downloads could be handled from different server. But probably we will improve that also in future.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10498387</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-12 11:29:51 -0400</bug_when>
    <thetext>dnf-plugins-core-2.1.1-1.fc26 libdnf-0.9.1-1.fc26 dnf-2.5.1-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-c87c47dccb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10503184</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-13 21:35:41 -0400</bug_when>
    <thetext>dnf-2.5.1-1.fc26, dnf-plugins-core-2.1.1-1.fc26, libdnf-0.9.1-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-c87c47dccb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10503664</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-14 01:33:46 -0400</bug_when>
    <thetext>dnf-2.5.1-1.fc26 dnf-plugins-core-2.1.1-1.fc26 dnfdaemon-0.3.18-3.fc26 libdnf-0.9.1-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-c87c47dccb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10509741</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 09:55:52 -0400</bug_when>
    <thetext>dnf-2.5.1-1.fc26, dnf-plugins-core-2.1.1-1.fc26, dnfdaemon-0.3.18-3.fc26, libdnf-0.9.1-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-c87c47dccb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10513078</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-16 09:18:42 -0400</bug_when>
    <thetext>dnf-2.5.1-1.fc26, dnf-plugins-core-2.1.1-1.fc26, dnfdaemon-0.3.18-3.fc26, libdnf-0.9.1-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
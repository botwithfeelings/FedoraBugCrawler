<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1309425</bug_id>
          
          <creation_ts>2016-02-17 13:54:00 -0500</creation_ts>
          <short_desc>Setup or shadow-utils package should provide /etc/subuid and /etc/subgid</short_desc>
          <delta_ts>2016-03-01 08:33:06 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>setup</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1311278</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Daniel Walsh">dwalsh</reporter>
          <assigned_to name="Ondrej Vasik">ovasik</assigned_to>
          <cc>amurdaca</cc>
    
    
    <cc>dennis</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>ebiederm</cc>
    
    
    <cc>mattdm</cc>
    
    
    <cc>mitr</cc>
    
    
    <cc>ovasik</cc>
    
    
    <cc>pknirsch</cc>
    
    
    <cc>pvrabec</cc>
    
    
    <cc>tmraz</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>setup-2.10.1-1.fc23</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-02-29 00:24:33</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9072939</commentid>
    <comment_count>0</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-02-17 13:54:37 -0500</bug_when>
    <thetext>Currently docker expects these files to exist is user namespace is turned on.
On Ubuntu the passwd package creates these files.  But since shadow has newmapuid it might also have this file.

Another choice would be the setup package.

Not sure which is best but we need these files to be created by default installs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9073035</commentid>
    <comment_count>1</comment_count>
    <who name="Matthew Miller">mattdm</who>
    <bug_when>2016-02-17 14:29:34 -0500</bug_when>
    <thetext>I notice that the man pages for these files are in shadow-utils.... but then, that&apos;s also true for several other files owned by &quot;setup&quot;. I guess I don&apos;t have a strong opinion either. :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9074512</commentid>
    <comment_count>2</comment_count>
    <who name="Tomas Mraz">tmraz</who>
    <bug_when>2016-02-18 03:23:53 -0500</bug_when>
    <thetext>As the other mapping files are in setup, I&apos;d say that these two files should be there as well for consistency. I&apos;d add them to shadow-utils only in case there is some particular reason why they should not be in setup.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9077103</commentid>
    <comment_count>3</comment_count>
    <who name="Ondrej Vasik">ovasik</who>
    <bug_when>2016-02-18 17:18:24 -0500</bug_when>
    <thetext>I agree with setup ownership here, as it already owns the other mapping files as Tomas mentioned. What content is expected in these files? Should they be just empty or should they contain some basic content?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9080466</commentid>
    <comment_count>4</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-02-20 06:35:50 -0500</bug_when>
    <thetext>No idea, I guess we can steal what ubuntu has done.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9080468</commentid>
    <comment_count>5</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-02-20 06:36:34 -0500</bug_when>
    <thetext>Eric do you have any opinion on the content?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9080732</commentid>
    <comment_count>6</comment_count>
    <who name="Ondrej Vasik">ovasik</who>
    <bug_when>2016-02-20 13:43:05 -0500</bug_when>
    <thetext>$ cat /etc/subuid
# empty default subuid/subgid file
$ cat /etc/subgid
# empty default subuid/subgid file

That&apos;s probably the default content there. I&apos;ll use it as well if nobody objects.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9080881</commentid>
    <comment_count>7</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-02-20 18:12:47 -0500</bug_when>
    <thetext>Yes empty files will work just fine (docker will write to then when needed)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9084489</commentid>
    <comment_count>8</comment_count>
    <who name="Ondrej Vasik">ovasik</who>
    <bug_when>2016-02-22 09:17:35 -0500</bug_when>
    <thetext>Built as setup-2.10.1-1.fc24 ... do you need that for F22/F23 as well ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9086066</commentid>
    <comment_count>10</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-02-22 17:07:36 -0500</bug_when>
    <thetext>I would say this is needed for f23 and rhel7 only.  We don&apos;t plan on updating to docker-1.10 in f22 or in rhel6.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9091326</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-02-24 06:52:15 -0500</bug_when>
    <thetext>setup-2.10.1-1.fc23 has been submitted as an update to Fedora 23. https://bodhi.fedoraproject.org/updates/FEDORA-2016-7d3f9038c7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9094166</commentid>
    <comment_count>12</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 10:25:29 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9099288</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-02-25 21:25:15 -0500</bug_when>
    <thetext>setup-2.10.1-1.fc23 has been pushed to the Fedora 23 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-7d3f9038c7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9100401</commentid>
    <comment_count>14</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-02-26 07:58:13 -0500</bug_when>
    <thetext>I expected those files to be empty on a fresh rawhide install, instead I get:

[root@2-rawhide-userns ~]# cat /etc/sub{uid,gid}
# empty default subuid/subgid file
tss:100000:65536
# empty default subuid/subgid file
tss:100000:65536

There are also &quot;dash-postfixed&quot; files there:

[root@2-rawhide-userns ~]# ll /etc/sub*
-rw-r--r--. 1 root root 52 Feb 26 06:57 /etc/subgid
-rw-r--r--. 1 root root 35 Feb 22 09:11 /etc/subgid-
-rw-r--r--. 1 root root 52 Feb 26 06:57 /etc/subuid
-rw-r--r--. 1 root root 35 Feb 22 09:11 /etc/subuid-

[root@2-rawhide-userns ~]# cat /etc/sub{uid,gid}-
# empty default subuid/subgid file
# empty default subuid/subgid file

I don&apos;t have any clue about who&apos;s adding those there but nvm.

[root@2-rawhide-userns ~]# rpm -qf /etc/subuid
setup-2.10.1-1.fc24.noarch
[root@2-rawhide-userns ~]# rpm -qf /etc/subgid
setup-2.10.1-1.fc24.noarch
[root@2-rawhide-userns ~]# rpm -qf /etc/subgid-
file /etc/subgid- is not owned by any package
[root@2-rawhide-userns ~]# rpm -qf /etc/subuid-
file /etc/subuid- is not owned by any package

Also docker installation is adding dockerroot user (which is totally wrong afaict and conflicts with docker userns implementation, I&apos;ve removed its creation from docker dist-git):

[root@2-rawhide-userns ~]# cat /etc/sub{uid,gid}
tss:100000:65536
# empty default subuid/subgid file
dockerroot:165536:65536
tss:100000:65536
# empty default subuid/subgid file
dockerroot:165536:65536

[root@2-rawhide-userns ~]# cat /etc/sub{uid,gid}-
# empty default subuid/subgid file
tss:100000:65536
# empty default subuid/subgid file
tss:100000:65536

Also note docker startup fails because it&apos;s incorrectly parsing the comment line as a valid line - I can create a PR upstream but is it correct to have comments in those files? if yes, I&apos;ll update docker - otherwise we should remove the commented line.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9100451</commentid>
    <comment_count>15</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-02-26 08:27:59 -0500</bug_when>
    <thetext>alright, I&apos;ve noticed files such as /etc/passwd ignore commented out lines - I&apos;ll go ahead and fix docker to ignore them as well</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9100528</commentid>
    <comment_count>16</comment_count>
    <who name="Miloslav Trmač">mitr</who>
    <bug_when>2016-02-26 09:08:59 -0500</bug_when>
    <thetext>(In reply to Antonio Murdaca from comment #15)
&gt; alright, I&apos;ve noticed files such as /etc/passwd ignore commented out lines -
&gt; I&apos;ll go ahead and fix docker to ignore them as well

No, there is no documented comment format in /etc/passwd. #-starting lines in /etc/passwd is just creating users with name &apos;# Hello this is a comment&apos;, or perhaps such lines are being silently ignored as malformed because they lack mandatory fields like an UID.

If the official documentation of /etc/subuid is shadow-utils’ subuid(5) (is it?), that does not mention any comments, so none are supported.  In that case  we should not be shipping any nor patching other software to treat #-starting lines in such non-standard ways.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9100539</commentid>
    <comment_count>17</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-02-26 09:11:29 -0500</bug_when>
    <thetext>Ack, thanks Miloslav. We should remove the comment from those files then.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9104344</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-02-29 00:24:29 -0500</bug_when>
    <thetext>setup-2.10.1-1.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9109237</commentid>
    <comment_count>19</comment_count>
    <who name="Ondrej Vasik">ovasik</who>
    <bug_when>2016-03-01 03:43:13 -0500</bug_when>
    <thetext>This comment was added based on the https://github.com/lxc/lxd/issues/314 ... where ubuntu uses exactly same comment there...
They either removed it later or have docker &quot;broken&quot; the same way.

I&apos;m fine with removal of these lines, though... intention was to keep the files same as (probably) on Ubuntu - based on the comments in this github issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9110174</commentid>
    <comment_count>20</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-03-01 08:33:06 -0500</bug_when>
    <thetext>Sounds like removing the lines is the safest thing to do.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
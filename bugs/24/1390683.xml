<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1390683</bug_id>
          
          <creation_ts>2016-11-01 12:34:00 -0400</creation_ts>
          <short_desc>glibc: incorrect argument reduction for cos</short_desc>
          <delta_ts>2016-11-05 20:23:54 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>glibc</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alfredo Ferrari">alfredo.ferrari</reporter>
          <assigned_to name="Florian Weimer">fweimer</assigned_to>
          <cc>alfredo.ferrari</cc>
    
    
    <cc>arjun.is</cc>
    
    
    <cc>codonell</cc>
    
    
    <cc>dj</cc>
    
    
    <cc>fweimer</cc>
    
    
    <cc>jakub</cc>
    
    
    <cc>law</cc>
    
    
    <cc>mfabian</cc>
    
    
    <cc>pfrankli</cc>
    
    
    <cc>sid</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>glibc-2.23.1-11.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-05 20:23:54</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="Sourceware">20357</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9837995</commentid>
    <comment_count>0</comment_count>
      <attachid>1216166</attachid>
    <who name="Alfredo Ferrari">alfredo.ferrari</who>
    <bug_when>2016-11-01 12:34:14 -0400</bug_when>
    <thetext>Created attachment 1216166
small c code to show the problem

Description of problem:
The cosine computed for a specific value is completely wrong, actually the system libraries return the sine!

Version-Release number of selected component (if applicable):
Fedora 24 fully up to date

How reproducible:
Always on whichever Fedora 24 system using gcc, gfortran or g77

Steps to Reproduce:
1.take the short c code (bugcos.c) in attachment...
2... compile and link with gcc -o bugcos -lbsd -lm bugcos.c
3... run bugcos observe the results on the screen

Actual results:
0.9941004006194649

Expected results:
-0.1084637888339666, 0.9941004006194649 is the sine of that angle not the cosine

Additional info:
I could not stress more how serious is this bug. Indeed we found it because it was crashing some complex simulations for LHC here at CERN, however I am afraid that other argument values and not only this one (which is already a big problem if you meet it) could run into similar issues. Please note that fedora 23 is immune, and that moving slightly outside from that argument value makes the cosine suddenly become ok (as you can check printing all 2000 values computed in the attached c code). The problem can be reproduced with g77 (actually we found it initially with g77), gfortran and gcc, ergo it is a system library problem. Again, the consequences of such macroscopic bug are hard to imagine, we were lucky our calculations were full of checks and crashed detecting the anomaly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9838890</commentid>
    <comment_count>1</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-11-01 19:16:58 -0400</bug_when>
    <thetext>I can reproduce this on F24.

I can _not_ reproduce this on F25.

So something was changed, either compiler, binutils, glibc, combination.

Are you able to upgrade to F25?

Are you able to help us narrow down exactly when this changed for you? It would help us narrow down the area we have to look at for changes.

Otherwise I&apos;ll have to start a bisect pass between 2.23 and 2.24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9838987</commentid>
    <comment_count>2</comment_count>
    <who name="Siddhesh Poyarekar">sid</who>
    <bug_when>2016-11-01 20:17:20 -0400</bug_when>
    <thetext>I fixed this upstream a couple of months ago, which is how f25 got it:

https://sourceware.org/bugzilla/show_bug.cgi?id=20357</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9839832</commentid>
    <comment_count>3</comment_count>
    <who name="Alfredo Ferrari">alfredo.ferrari</who>
    <bug_when>2016-11-02 03:13:02 -0400</bug_when>
    <thetext>Hi

I see that the issue has been fixed upstream already. Would it be possible to backport the patch to Fedora 24 or upgrade the F24 glibc ?
To move all out machines to F25 which is still in beta test is not an attractive option, rather are there aby expected drawbacks if we just install the Fedora 25 glibc on Fedora 24 (which anyway will solve the issue for us only)?
Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9840013</commentid>
    <comment_count>4</comment_count>
    <who name="Florian Weimer">fweimer</who>
    <bug_when>2016-11-02 04:24:52 -0400</bug_when>
    <thetext>(In reply to Siddhesh Poyarekar from comment #2)
&gt; I fixed this upstream a couple of months ago, which is how f25 got it:
&gt; 
&gt; https://sourceware.org/bugzilla/show_bug.cgi?id=20357

Thanks, I&apos;ll backport this to the 2.23 stable branch upstream and Fedora 24.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9841907</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-02 06:38:39 -0400</bug_when>
    <thetext>glibc-2.23.1-11.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-055349b681</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9863734</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-04 23:32:20 -0400</bug_when>
    <thetext>glibc-2.23.1-11.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-055349b681</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9864379</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-05 20:23:54 -0400</bug_when>
    <thetext>glibc-2.23.1-11.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1216166</attachid>
            <date>2016-11-01 12:34:00 -0400</date>
            <delta_ts>2016-11-01 12:34:14 -0400</delta_ts>
            <desc>small c code to show the problem</desc>
            <filename>bugcos.c</filename>
            <type>text/x-csrc</type>
            <size>357</size>
            <attacher name="Alfredo Ferrari">alfredo.ferrari</attacher>
            
              <data encoding="base64">I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxtYXRoLmg+CgppbnQKbWFpbiAoaW50IGFyZ2Ms
IGNoYXIgKmFyZ3ZbXSkKewoKICAgICAgICBjaGFyICAgIGFyZ3NbMjU2XTsKCWRvdWJsZQljb3N0
aGUsdGhldGEsdGhldDA9MS42Nzk0NzM5MTc4ODY5MTUxOwoJaW50CWk7CgoJZm9yIChpPS0xMDAw
OyBpPDEwMDE7ICsraSkgewoJICB0aGV0YT10aGV0MCsoZG91YmxlKShpKSoxLmUtMTc7CgkgIGNv
c3RoZT1jb3ModGhldGEpOwoJICBpZiAoY29zdGhlPiAwLjkpIHsKCSAgICBwcmludGYoImkgJWQg
dGhldGEgJTE5LjE2ZiBjb3ModGhldGEpICUxOS4xNmYgXG4iLAoJCSAgIGksIHRoZXRhLCBjb3N0
aGUpOwoJICB9Cgl9Cn0K
</data>

          </attachment>
      

    </bug>

</bugzilla>
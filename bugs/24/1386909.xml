<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1386909</bug_id>
          
          <creation_ts>2016-10-19 15:24:00 -0400</creation_ts>
          <short_desc>crash 7.1.6 doesn&apos;t handle kernel 4.7.7-200.fc24 when relocated past ~400MB</short_desc>
          <delta_ts>2016-12-15 22:53:25 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>crash</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1402108</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominique Martinet">g.fhnrunznrqeqf</reporter>
          <assigned_to name="Dave Anderson">anderson</assigned_to>
          <cc>anderson</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>crash-7.1.7-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-15 22:53:25</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9805856</commentid>
    <comment_count>0</comment_count>
    <who name="Dominique Martinet">g.fhnrunznrqeqf</who>
    <bug_when>2016-10-19 15:24:15 -0400</bug_when>
    <thetext>Description of problem:

latest crash crashes when running live analysis

Version-Release number of selected component (if applicable):

Latest crash (recompiled from https://people.redhat.com/anderson/ - nothing interesting in the git since the 7.1.6 release last week)


How reproducible:

It seems to depend on the kernel relocation offset maybe?
After rebooting it wouldn&apos;t crash (had offset 304MB), re-rebooted (496MB) crashed; next reboot (80MB) worked.. 944MB failed... etc.
tested on a VM with 2GB of ram.

Steps to Reproduce:
1. run crash

Actual results:

# crash

crash 7.1.6
Copyright (C) 2002-2016  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005, 2011  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter &quot;help copying&quot; to see the conditions.
This program has absolutely no warranty.  Enter &quot;help warranty&quot; for details.
 
GNU gdb (GDB) 7.6
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-unknown-linux-gnu&quot;...

WARNING: kernel relocated [736MB]: patching 82381 gdb minimal_symbol values

please wait... (patching 82381 gdb minimal_symbol values) Segmentation fault (core dumped)


---- 
gdb gives a huge backtrace that&apos;s obviously wrong;
#0  convert_time (count=18446744072363204608, buf=0x0) at tools.c:5606
#1  0x0000000000000001 in ?? ()
#2  0x0000000002bc8fa0 in ?? ()
#3  0x0000000000001000 in ?? ()
#4  0x0000000000000001 in ?? ()
#5  0x0000000000478c04 in please_wait (s=0xd00e20 &lt;vm_table+320&gt; &quot;&quot;)
    at tools.c:5741
#6  0x0000000000001000 in ?? ()
#7  0x0000000000000001 in ?? ()
#8  0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#9  0x0000000000001000 in ?? ()
#10 0x0000000000000001 in ?? ()
#11 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
...
#16347 0x0000000000001000 in ?? ()
#16348 0x0000000000000001 in ?? ()
#16349 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16350 0x0000000000001000 in ?? ()
#16351 0x0000000000000001 in ?? ()
#16352 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16353 0x0000000000001000 in ?? ()
#16354 0x0000000000000001 in ?? ()
#16355 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16356 0x0000000000001000 in ?? ()
#16357 0x0000000000000001 in ?? ()
#16358 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16359 0x0000000000001000 in ?? ()
#16360 0x0000000000000001 in ?? ()
#16361 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16362 0x0000000000001000 in ?? ()
#16363 0x0000000000000001 in ?? ()
#16364 0x0000000000478c04 in please_wait (s=0x2bc8fa0 &quot;&quot;) at tools.c:5741
#16365 0x0000000000463318 in xen_hyper_dump_xen_hyper_offset_table (
    makestruct=&lt;optimized out&gt;, spec=&lt;optimized out&gt;)
    at xen_hyper_dump_tables.c:825
#16366 0x00007ffd0da3ee25 in ?? ()
#16367 0x00007ffd0da3ee2f in ?? ()
#16368 0x00007ffd0da3ee43 in ?? ()
#16369 0x00007ffd0da3ee4e in ?? ()
#16370 0x00007ffd0da3ee5e in ?? ()
#16371 0x00007ffd0da3eec3 in ?? ()
#16372 0x00007ffd0da3eed7 in ?? ()
#16373 0x00007ffd0da3eeee in ?? ()
#16374 0x00007ffd0da3eef6 in ?? ()
#16375 0x00007ffd0da3ef01 in ?? ()
#16376 0x00007ffd0da3ef0f in ?? ()
#16377 0x00007ffd0da3ef1c in ?? ()
#16378 0x00007ffd0da3ef4f in ?? ()
#16379 0x00007ffd0da3ef7f in ?? ()
#16380 0x00007ffd0da3efa2 in ?? ()
#16381 0x00007ffd0da3efbc in ?? ()
#16382 0x00007ffd0da3efd8 in ?? ()
#16383 0x0000000000000000 in ?? ()


Expected results:

get a crash prompt

Additional info:

Haven&apos;t checked actual kdump analysis as that looks broken as well, will look into that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805897</commentid>
    <comment_count>1</comment_count>
    <who name="Dave Anderson">anderson</who>
    <bug_when>2016-10-19 15:43:29 -0400</bug_when>
    <thetext>FWIW, I&apos;m working on a 4.9.0-0.rc1.git0.2.fc26 live kernel which
was relocated 544MB.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805924</commentid>
    <comment_count>2</comment_count>
    <who name="Dominique Martinet">g.fhnrunznrqeqf</who>
    <bug_when>2016-10-19 15:55:24 -0400</bug_when>
    <thetext>Okay so might be something else... Basically have a pristine fedora 24 except for the crash utility and extlinux boot.

Here&apos;s my /proc/cmdline:
BOOT_IMAGE=/boot/vmlinuz-4.7.7-200.fc24.x86_64 initrd=/boot/initramfs-4.7.7-200.fc24.x86_64.img root=/dev/vda selinux=0 nomodeset ro crashkernel=128M console=tty0 console=ttyS0



I upgraded kexec-tools to rawhide version and got kdump to work, I have the same problem with a 37MB vmcore file, that might help if you can&apos;t reproduce.
You can find it here:

http://asmadeus.notk.org/crash/vmcore

# rpm -qa|grep `uname -r`
kernel-core-4.7.7-200.fc24.x86_64
kernel-debuginfo-4.7.7-200.fc24.x86_64
kernel-4.7.7-200.fc24.x86_64
kernel-modules-4.7.7-200.fc24.x86_64
kernel-debuginfo-common-x86_64-4.7.7-200.fc24.x86_64
kernel-headers-4.7.7-200.fc24.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9820538</commentid>
    <comment_count>3</comment_count>
    <who name="Dave Anderson">anderson</who>
    <bug_when>2016-10-25 13:46:18 -0400</bug_when>
    <thetext>I&apos;ve pushed a patch upstream that fixes this problem:

 https://github.com/crash-utility/crash/commit/774a92f48fabb0f98eb14875e54c6d5f573f074c
 
  Fix for a possible segmentation violation when analyzing Linux 4.7
  x86_64 kernels that are configured with CONFIG_RANDOMIZE_BASE.
  Depending upon the randomized starting address of the kernel text
  and static data, a segmentation violation may occur during session
  initialization, just after the patching of the gdb minimal_symbol
  values message.
  (anderson@redhat.com)


&gt; I upgraded kexec-tools to rawhide version and got kdump to work, I have
&gt; the same problem with a 37MB vmcore file, that might help if you can&apos;t
&gt; reproduce.
&gt; You can find it here:
&gt;
&gt; http://asmadeus.notk.org/crash/vmcore

Thanks for that -- here it is:

  # crash vmlinux-4.7.7-200.fc24 vmcore-4.7.7-200.fc24
  
  crash 7.1.6++
  Copyright (C) 2002-2016  Red Hat, Inc.
  Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
  Copyright (C) 1999-2006  Hewlett-Packard Co
  Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
  Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
  Copyright (C) 2005, 2011  NEC Corporation
  Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
  Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
  This program is free software, covered by the GNU General Public License,
  and you are welcome to change it and/or distribute copies of it under
  certain conditions.  Enter &quot;help copying&quot; to see the conditions.
  This program has absolutely no warranty.  Enter &quot;help warranty&quot; for details.
   
  GNU gdb (GDB) 7.6
  Copyright (C) 2013 Free Software Foundation, Inc.
  License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
  This is free software: you are free to change and redistribute it.
  There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
  and &quot;show warranty&quot; for details.
  This GDB was configured as &quot;x86_64-unknown-linux-gnu&quot;...
  
  WARNING: kernel relocated [784MB]: patching 82381 gdb minimal_symbol values
  
        KERNEL: vmlinux-4.7.7-200.fc24                                
      DUMPFILE: vmcore-4.7.7-200.fc24  [PARTIAL DUMP]
          CPUS: 4
          DATE: Wed Oct 19 21:49:33 2016
        UPTIME: 00:03:33
  LOAD AVERAGE: 0.36, 0.13, 0.04
         TASKS: 138
      NODENAME: f4
       RELEASE: 4.7.7-200.fc24.x86_64
       VERSION: #1 SMP Sat Oct 8 00:21:59 UTC 2016
       MACHINE: x86_64  (2591 Mhz)
        MEMORY: 2 GB
         PANIC: &quot;sysrq: SysRq : Trigger a crash&quot;
           PID: 1858
       COMMAND: &quot;bash&quot;
          TASK: ffff88007aa58000  [THREAD_INFO: ffff88007a5dc000]
           CPU: 2
         STATE: TASK_RUNNING (SYSRQ)
  
  crash&gt; 

It&apos;s queued for crash-7.1.7, but I don&apos;t have a target release date at
this time.

In the meantime, you can clone git://github.com/crash-utility/crash.git,
and build it with &quot;make lzo&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9822726</commentid>
    <comment_count>4</comment_count>
    <who name="Dominique Martinet">g.fhnrunznrqeqf</who>
    <bug_when>2016-10-26 07:47:36 -0400</bug_when>
    <thetext>I can confirm it works, thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9961143</commentid>
    <comment_count>5</comment_count>
    <who name="Dave Anderson">anderson</who>
    <bug_when>2016-12-06 11:33:20 -0500</bug_when>
    <thetext>Information for build crash-7.1.7-1.fc26
http://koji.fedoraproject.org/koji/buildinfo?buildID=823232</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9961856</commentid>
    <comment_count>6</comment_count>
    <who name="Dave Anderson">anderson</who>
    <bug_when>2016-12-06 14:53:21 -0500</bug_when>
    <thetext>Information for build crash-7.1.7-1.fc24
http://koji.fedoraproject.org/koji/buildinfo?buildID=823280</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9961978</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-06 16:03:27 -0500</bug_when>
    <thetext>crash-7.1.7-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-dbb90a7756</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9966775</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-07 23:51:30 -0500</bug_when>
    <thetext>crash-7.1.7-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-dbb90a7756</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9992087</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-15 22:53:25 -0500</bug_when>
    <thetext>crash-7.1.7-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
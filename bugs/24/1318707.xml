<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1318707</bug_id>
          
          <creation_ts>2016-03-17 10:42:00 -0400</creation_ts>
          <short_desc>QT apps do not use adwaita by default, nor it can be forced</short_desc>
          <delta_ts>2016-07-18 12:39:49 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>adwaita-qt</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kamil Páral">kparal</reporter>
          <assigned_to name="Martin Bříza">mbriza</assigned_to>
          <cc>jgrulich</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>massi.ergosum</cc>
    
    
    <cc>mbriza</cc>
    
    
    <cc>mclasen</cc>
    
    
    <cc>poncho</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-22 09:25:07</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9156609</commentid>
    <comment_count>0</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-03-17 10:42:14 -0400</bug_when>
    <thetext>Description of problem:
I tried doing https://fedoraproject.org/wiki/Test_Day:2016-03-17_Qt_Gtk_Integration . However, all QT apps I run look like using a default gtk theme, not adwaita.

This is fedora-gooey-karma in F24:
http://i.imgur.com/IoxkBC9.png
and in F23:
http://i.imgur.com/EofVGnb.png

This is goldendict in F24:
http://i.imgur.com/CzwkYJQ.png

This is krename in F24:
http://i.imgur.com/7l0gYUv.png
and how it is supposed to look with adwaita (screenshot provided by mbriza):
http://i.imgur.com/kmcFsrG.png

So, by default, adwaita doesn&apos;t seem to be used.

But even more, I can&apos;t seem to be able to force it. When I try:
$ QT_STYLE_OVERRIDE=adwaita krename 
or 
$ krename -style adwaita
it does not change anything, still the same look.


Version-Release number of selected component (if applicable):
installed Workstation Live image from here http://dl.fedoraproject.org/pub/alt/stage/24_Alpha-1.5/Workstation/x86_64/iso/
adwaita-cursor-theme-3.19.91-1.fc24.noarch
adwaita-gtk2-theme-3.19.91-1.fc24.x86_64
adwaita-icon-theme-3.19.91-1.fc24.noarch
adwaita-qt4-0.3-2.fc24.x86_64
adwaita-qt5-0.3-2.fc24.x86_64
adwaita-qt-common-0.3-2.fc24.noarch
krename-4.0.9-15.fc23.x86_64
fedora-gooey-karma-0.1-7.fc24.noarch
goldendict-1.5-0.10.RC2.fc24.x86_64


How reproducible:
100%

Steps to Reproduce:
1. install F24 Alpha 1.5 Workstation Live
2. install some of those apps
3. run them and compare their look
4. try to force the adwaita theme</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9440937</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Grulich">jgrulich</who>
    <bug_when>2016-06-22 09:07:15 -0400</bug_when>
    <thetext>Is this reproducible with final Fedora 24 release? When I run &quot;krename -style adwaita&quot; then it works perfectly for me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9441002</commentid>
    <comment_count>2</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-06-22 09:24:20 -0400</bug_when>
    <thetext>Yes, with final release of F24, I no longer see any problem with krename. Let&apos;s consider this fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9510767</commentid>
    <comment_count>3</comment_count>
    <who name="Massimiliano">massi.ergosum</who>
    <bug_when>2016-07-14 17:55:30 -0400</bug_when>
    <thetext>In Mate DE adwaita-qt is not currently the default theme (the fallback is GTK+), but it can be forced:
$ QT_STYLE_OVERRIDE=adwaita vlc

Installed packages:
$ rpm -qa *adwaita*
adwaita-gtk2-theme-3.20.2-1.fc24.x86_64
adwaita-qt-0.4-3.fc24.x86_64
adwaita-qt-common-0.4-3.fc24.noarch
adwaita-cursor-theme-3.20-1.fc24.noarch
adwaita-qt4-0.4-3.fc24.x86_64
adwaita-icon-theme-3.20-1.fc24.noarch
adwaita-qt5-0.4-3.fc24.x86_64

Obviuously I cannot install qgnomeplatform due its dependencies. Is there any other setting I&apos;m missing?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9511534</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Grulich">jgrulich</who>
    <bug_when>2016-07-15 02:46:51 -0400</bug_when>
    <thetext>Why you cannot install qgnomeplatform?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9512989</commentid>
    <comment_count>5</comment_count>
    <who name="Martin Bříza">mbriza</who>
    <bug_when>2016-07-15 09:59:10 -0400</bug_when>
    <thetext>In case you for some reason are not able or willing to use qgnomeplatform, I recommend going for the qt5ct platform plugin and configuration tool (packaged in Fedora under the same name).
It allows you to config a lot of Qt settings. The only thing you&apos;ll have to do would be to override the QT_QPA_PLATFORM environment variable.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9514040</commentid>
    <comment_count>6</comment_count>
    <who name="Massimiliano">massi.ergosum</who>
    <bug_when>2016-07-15 16:37:48 -0400</bug_when>
    <thetext>(In reply to Jan Grulich from comment #4)
&gt; Why you cannot install qgnomeplatform?
Well:

# dnf install qgnomeplatform
Ultima verifica della scadenza dei metadati: 0:00:29 fa il Fri Jul 15 21:37:22 2016.
Dipendenze risolte.
======================================================
 Package                                              
======================================================
Installazione in corso:
 accountsservice-libs                                 
 argyllcms                                            
 caribou                                              
 caribou-gtk2-module                                  
 caribou-gtk3-module                                  
 cheese-libs                                          
 clutter-gst3                                         
 colord-gtk                                           
 control-center                                       
 control-center-filesystem                            
 desktop-backgrounds-gnome                            
 evolution-data-server                                
 f24-backgrounds-gnome                                
 gdm                 &lt;-- Another display manager!
 geoclue2-libs                                        
 geocode-glib                                         
 gjs                                                  
 gnome-bluetooth                                      
 gnome-bluetooth-libs                                 
 gnome-color-manager                                  
 gnome-desktop3                                       
 gnome-online-accounts                                
 gnome-session                                        
 gnome-session-wayland-session                        
 gnome-session-xsession                               
 gnome-settings-daemon                                
 gnome-shell         &lt;-- Another shell!
 gupnp-av                                             
 gupnp-dlna                                           
 ibus-libs                                            
 iio-sensor-proxy                                     
 libgdata                                             
 libgsystem                                           
 libgweather                                          
 libical                                              
 mozjs24                                              
 mutter             &lt;-- Another composite manager!                     
 pulseaudio-gdm-hooks                                 
 python3-caribou                                      
 python3-pyatspi                                      
 qgnomeplatform                                       
 rygel                                                
 telepathy-filesystem                                 
 telepathy-glib                                       
 telepathy-logger                                     
 vino                                                 
 webkitgtk3                                           
 xorg-x11-server-Xwayland         

Riepilogo della transazione
======================================================
Installati  48 pacchetti

Dimensione totale dello scaricamento: 41 M
Dimensione installata: 164 M  &lt;-- Total space lost! 

I believe that one half gnome and 164 Mb are too expensive for a consistent L&amp;F.

(In reply to Martin Bříza from comment #5)
&gt; In case you for some reason are not able or willing to use qgnomeplatform, I
&gt; recommend going for the qt5ct platform plugin and configuration tool
&gt; (packaged in Fedora under the same name).

This package costs only 551 k. It appears under the menu: System -&gt; Preferences -&gt; Appearance (good place!). 

&gt; It allows you to config a lot of Qt settings. The only thing you&apos;ll have to
&gt; do would be to override the QT_QPA_PLATFORM environment variable.

Reading the /usr/share/doc/qt5ct/README file, it seems that the right environment variable to set is:

$ QT_QPA_PLATFORMTHEME=qt5ct vlc

Now vlc has adwaita as theme.

Thank you all for the suggestions.

But... from this bug it seems that only gnome (apart KDE) will have a consistent L&amp;F for Qt5 (without some manually configuration), right?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516240</commentid>
    <comment_count>7</comment_count>
    <who name="Jan Grulich">jgrulich</who>
    <bug_when>2016-07-18 02:01:45 -0400</bug_when>
    <thetext>I think that all these are pulled in due to dependency on GDM which I removed already and that updated package should be in updates-testing repository.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9518320</commentid>
    <comment_count>8</comment_count>
    <who name="Massimiliano">massi.ergosum</who>
    <bug_when>2016-07-18 12:39:49 -0400</bug_when>
    <thetext>(In reply to Jan Grulich from comment #7)
&gt; I think that all these are pulled in due to dependency on GDM which I
&gt; removed already and that updated package should be in updates-testing
&gt; repository.

# dnf --enablerepo=updates-testing install qgnomeplatform

===============================================
 Package                                 Arch  
===============================================
Installazione in corso:
 qgnomeplatform                          x86_64

Riepilogo della transazione
===============================================
Installati  1 pacchetto

Dimensione totale dello scaricamento: 45 k
Dimensione installata: 102 k  &lt;-- Reasonable cost

Following [1] I have to set the QT_QPA_PLATFORMTHEME to get the theme working.
Theme is ok, but the font is wrong: it is inherited from the key org.gnome.desktop.interface.font-name of dconf and not from current environment (i.e. org.mate.interface.font-name). The font shown is Cantarell in my case, while the system default is Droid Sans.

To summarize, for MATE DE:
* both libraries (qt5ct and qgnomeplatform) can set adwaita as default theme
* both are cheap (small space)
* both require manual setup by setting the QT_QPA_PLATFORMTHEME variable
* qt5ct is more flexible, while qgnomeplatform tries to inherit from gnome settings

IMHO:
* For a simple fixed setup set the QT_STYLE_OVERRIDE variable (e.g. in your ~/.bash_profile). Override once and forget it. No further library is required.
* If you want a more flexible setup (with GUI) install qt5ct and then override QT_QPA_PLATFORMTHEME

Thanks
Massimiliano

[1] https://fedoraproject.org/wiki/Test_Day:2016-03-17_Qt_Gtk_Integration</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
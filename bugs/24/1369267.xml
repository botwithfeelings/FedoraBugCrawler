<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1369267</bug_id>
          
          <creation_ts>2016-08-22 18:08:00 -0400</creation_ts>
          <short_desc>Meeting invites shown in wrong time zone</short_desc>
          <delta_ts>2016-12-21 04:47:00 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>evolution</component>
          <version>24</version>
          <rep_platform>i686</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Bojan Smojver">bojan</reporter>
          <assigned_to name="Milan Crha">mcrha</assigned_to>
          <cc>lucilanga</cc>
    
    
    <cc>mbarnes</cc>
    
    
    <cc>mcrha</cc>
    
    
    <cc>tpopela</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>evolution-3.21.92, evolution-mapi-3.21.92</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-31 10:08:20</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9637717</commentid>
    <comment_count>0</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-22 18:08:03 -0400</bug_when>
    <thetext>Description of problem:
I have Evolution set up to use system time zone (Australia/Sydney). However, many of the meeting invites I receive are in US EST time zone. My other mail client (Good on Android) sees all those invites just fine and converts them to Sydney time zone. However, Evolution with MAPI back end (connected to Exchange) displays them using US EST time zone, so I have to manually convert time of each such invite.

Version-Release number of selected component (if applicable):
evolution-3.20.5-1.fc24.i686

How reproducible:
Always.

Steps to Reproduce:
1. Receive a meeting in another time zone.
2. Meeting time not showing in local time zone.

Actual results:
Local time zone ignored.

Expected results:
Meeting time should be displayed in local time zone.

Additional info:
I don&apos;t think it&apos;s just this particular version of Evo that&apos;s doing this. It&apos;s been like this for a while now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9638682</commentid>
    <comment_count>1</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-23 00:57:14 -0400</bug_when>
    <thetext>Thanks for a bug report. Would it be possible to attach here one such event saved from the evolution as an iCalendar file (context menu of the event), please?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9650387</commentid>
    <comment_count>2</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-25 19:41:46 -0400</bug_when>
    <thetext>(In reply to Milan Crha from comment #1)
&gt; Thanks for a bug report. Would it be possible to attach here one such event
&gt; saved from the evolution as an iCalendar file (context menu of the event),
&gt; please?

Did you receive the ICS file I sent privately? The data in it cannot be shared, so I cannot attach it here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652037</commentid>
    <comment_count>3</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-26 03:33:01 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #2)
&gt; Did you receive the ICS file I sent privately? The data in it cannot be
&gt; shared, so I cannot attach it here.

Sure, I did. It exhibited the issue in 3.20.5, I only didn&apos;t let you know. I&apos;m sorry. I was about to test it further, but then other things got before it in the priority queue, afterwards I forgot of it a bit.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652098</commentid>
    <comment_count>4</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-26 04:05:31 -0400</bug_when>
    <thetext>Thanks. Was just making sure that it didn&apos;t land in junk folder. :-)

No rush at all.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652146</commentid>
    <comment_count>5</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-26 04:27:22 -0400</bug_when>
    <thetext>The current development version doesn&apos;t show event details in your message at all, for some reason. That will be fixed first. Then I&apos;ll check the timezone thing, I hope I wasn&apos;t wrong with my previous findings.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652216</commentid>
    <comment_count>6</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-26 04:57:40 -0400</bug_when>
    <thetext>Hmm, I re-tried and it seems I&apos;m not able to reproduce this in 3.20.5. What I did:
a) I explicitly set my timezone to America/Sydney, not using &quot;Use system timezone&quot;
   checkbox in the Calendar and Tasks Preferences.
b) I opened your mail and it showed the event from 4:30 to 5:00 AM
c) when I saved the event and imported it into a local calendar it also showed
   it from 4:30 to 5:00 AM and the tooltip said &quot;14:30 America/New_York,
   for 30 minutes&quot;

From that I&apos;d say the the evolution failed to recognize your timezone in the settings for some reason. Can you see the meeting time difference in your Sent folder too, on the message you sent me? I can generate a similar message with an invitation which is not private, for easier testing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652342</commentid>
    <comment_count>7</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-26 05:45:29 -0400</bug_when>
    <thetext>For some reason only happens with inbox. Messages in sent folder show correct time.

Maybe I should force time zone settings in Evo and try again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652371</commentid>
    <comment_count>8</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-26 06:03:46 -0400</bug_when>
    <thetext>View the message source of one of the affected invitations and check what DTSTART/DTEND is shown there. In case the vent being base64 encoded, use
   $ base64 -d
to decode it and see the DTSTART/DTEND values. The event you sent me privately is base64 encoded and shows after the decode:

   DTSTART;TZID=/freeassociation.sourceforge.net/America/New_York:
    20160823T143000
   DTEND;TZID=/freeassociation.sourceforge.net/America/New_York:
    20160823T150000

The timezone is also included in the VCALENDAR part, at the top of the file:

   BEGIN:VTIMEZONE
   TZID:/freeassociation.sourceforge.net/America/New_York
   X-LIC-LOCATION:America/New_York
   ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9652410</commentid>
    <comment_count>9</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-26 06:18:17 -0400</bug_when>
    <thetext>Yeah, I did view the source one of them. Everything looked in order, just like in your analysis. Additionally, Good mail client correctly converts US time zones to mine with every invite, so I know source is not the problem.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9659090</commentid>
    <comment_count>10</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-29 08:16:05 -0400</bug_when>
    <thetext>If the Inbox messages show times wrong, but the message source shows correct data, then I cannot think of anythign else but that the timezone preference read failed in some way for some reason. Is it reliable reproducible with the messages in the MAPI Inbox? What if you copy the message to an On This Computer folder (drag&amp;drop, or right-click and &quot;Copy Messages to...&quot;), will the message still show a wrong time?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9662011</commentid>
    <comment_count>11</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-30 02:48:58 -0400</bug_when>
    <thetext>(In reply to Milan Crha from comment #10)
&gt; If the Inbox messages show times wrong, but the message source shows correct
&gt; data, then I cannot think of anythign else but that the timezone preference
&gt; read failed in some way for some reason. Is it reliable reproducible with
&gt; the messages in the MAPI Inbox?

Yes. Any invite emails that I receive (into any folder, not just inbox) show with the original timezone. Responses I send show with the correct (my own) time zone. Accepted events in the calendar view show correctly as well.

I tried forcing the time zone to Australia/Perth, for instance, in calendar preferences, but that made no difference at all.

&gt; What if you copy the message to an On This
&gt; Computer folder (drag&amp;drop, or right-click and &quot;Copy Messages to...&quot;), will
&gt; the message still show a wrong time?

Tried that. Still shows the same thing - invite is in the original time zone.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9662020</commentid>
    <comment_count>12</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-30 02:52:05 -0400</bug_when>
    <thetext>Side note, I&apos;m pretty sure access to anything at sourceforge.net is forbidden on the network where this problem occurs. Given that the timezone is encoded as /freeassociation.sourceforge.net/America/New_York, could that be related?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9662603</commentid>
    <comment_count>13</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-30 05:05:10 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #11)
&gt; &gt; What if you copy the message to an On This
&gt; &gt; Computer folder (drag&amp;drop, or right-click and &quot;Copy Messages to...&quot;), will
&gt; &gt; the message still show a wrong time?
&gt; 
&gt; Tried that. Still shows the same thing - invite is in the original time zone.

Weird. I&apos;ll create for a you a test build, which will print some valuable information on the console. I hope it&apos;ll help to figure out what&apos;s going wrong here.

(In reply to Bojan Smojver from comment #12)
&gt; Side note, I&apos;m pretty sure access to anything at sourceforge.net is
&gt; forbidden on the network where this problem occurs. Given that the timezone
&gt; is encoded as /freeassociation.sourceforge.net/America/New_York, could that
&gt; be related?

No no, that&apos;s okay, it&apos;s only a time zone ID, which happens to be prefixed with the URL-like text. It doesn&apos;t download anything from that site.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9663669</commentid>
    <comment_count>14</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-30 09:44:07 -0400</bug_when>
    <thetext>You can find the test build here:
http://koji.fedoraproject.org/koji/taskinfo?taskID=15436257

Click one of the builds (i686 for you), which will offer you respective packages. Download those you&apos;ve installed for the evolution and update them using:

   # dnf update ./evolution*.rpm

Then run the evolution from a console and select one of the messages with meeting invitation which shows incorrect start time. The console will contain some debugging information, which I&apos;d like to see. It also prints the raw component it uses for the view, which contains private information. I&apos;d like to see the DTSTART line and couple surrounding to it, not a whole component right now. It will be also interesting whether it contains any VTIMEZONE-s. it prints for the invite you sent me privately:

&gt; extract_itip_data: parsing ---BEGIN:VCALENDAR
&gt; PRODID:-//Ximian//NONSGML Evolution Calendar//EN
&gt; VERSION:2.0
&gt; METHOD:PUBLISH
&gt; BEGIN:VTIMEZONE
&gt; TZID:/freeassociation.sourceforge.net/America/New_York
&gt; X-LIC-LOCATION:America/New_York
&gt; BEGIN:STANDARD
&gt; ....
&gt; END:VTIMEZONE
&gt; BEGIN:VEVENT
&gt; ....
&gt; DTSTART;TZID=/freeassociation.sourceforge.net/America/New_York:
&gt;  20160823T143000
&gt; DTEND;TZID=/freeassociation.sourceforge.net/America/New_York:
&gt;  20160823T150000
&gt; ...
&gt; END:VEVENT
&gt; END:VCALENDAR
&gt; ---
&gt;    itip_view_init_view: location in settings: &apos;Australia/Sydney&apos; found:0x19d5a78 (id:/freeassociation.sourceforge.net/Australia/Sydney loc:Australia/Sydney)
&gt;    itip_view_init_view: dtstart has tzid:&apos;/freeassociation.sourceforge.net/America/New_York&apos;
&gt; itip_view_init_view: from:0x50d6360 (America/New_York|/freeassociation.sourceforge.net/America/New_York) to:0x19d5a78 (Australia/Sydney|/freeassociation.sourceforge.net/Australia/Sydney)
&gt;    itip_view_init_view: DTSTART is_date:0 time: 2016-08-24 4:30:00

Which looks correct.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9665215</commentid>
    <comment_count>15</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-30 18:35:42 -0400</bug_when>
    <thetext>Just sent the output that was generated by clicking on one such event privately. Hope it helps.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9665887</commentid>
    <comment_count>16</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-08-31 01:34:10 -0400</bug_when>
    <thetext>And looking at the output of what I got, the (nil) there seems to be what&apos;s happening:
---------------------
   itip_view_init_view: using system timezone as the target zone (0x822fee24 (id:/freeassociation.sourceforge.net/Australia/Sydney loc:Australia/Sydney))
   itip_view_init_view: dtstart has tzid:&apos;/freeassociation.sourceforge.net/America/New_York&apos;
itip_view_init_view: from:(nil) (|) to:0x822fee24 (Australia/Sydney|/freeassociation.sourceforge.net/Australia/Sydney)
   itip_view_init_view: DTSTART is_date:0 time: 2016-08-16 12:30:00
---------------------</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9666324</commentid>
    <comment_count>17</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-31 04:11:53 -0400</bug_when>
    <thetext>Yes, that&apos;s it. While the component snippet in comment #14 contains also VTIMEZONE sub-component, the one printed in your debug output doesn&apos;t have it, it has only the VEVENT subcomponent. That&apos;s the cause why the search for the &apos;from&apos; timezone failed. I think of two places to fix, one on the itip view side, to try harder to catch the &apos;from&apos; timezone and on the evolution-mapi side (maybe also on the evolution-ews side), to include also timezones in the generated components in the invitations.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9667747</commentid>
    <comment_count>18</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-08-31 10:08:20 -0400</bug_when>
    <thetext>Fix for the evolution [1] and for the evolution-mapi [2], both will be released in 3.21.92+ version of respective component. The chang eon the evolution side makes sure also the old meeting invitations are shown properly, otherwise the old mails should be re-downloaded to take the change into the effect.

[1] https://git.gnome.org/browse/evolution/commit/?id=761ac9f
[2] https://git.gnome.org/browse/evolution-mapi/commit/?id=96fd087</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9978519</commentid>
    <comment_count>19</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-12-12 16:52:38 -0500</bug_when>
    <thetext>I think this may have introduced something into the code that makes accepting meeting requests to be saved with the wrong time.

Example:

I&apos;m in AEDT time zone (Sydney) and I get meeting requests with EST (Boston) time zone. When I accept them in Good for Enterprise, they are correctly translated into AEDT time. If I do the same in Evolution, the meeting gets pushed 15 hours back, which happens to be the current time difference between AEDT and EST.

So, something is still not quite right here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9980308</commentid>
    <comment_count>20</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-12-13 05:36:48 -0500</bug_when>
    <thetext>Weird, I do not seem to be able to reproduce it. I made a meeting in a different timezone than I use in the evolution and sent it myself. Before it had been sent from an Outbox folder I moved it elsewhere, then I opened it from there and it showed me that the meeting could not be found and asked me what to do. I told it to add to a MAPI calendar, which it did. The meeting shows with the correct timezone for me. This is with an Exchange 2007 server.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9980332</commentid>
    <comment_count>21</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-12-13 05:50:13 -0500</bug_when>
    <thetext>(In reply to Milan Crha from comment #20)
&gt; This is with an Exchange 2007 server.

I think my guys are probably using 2010. Anyhow, the meetings I&apos;m receiving are created by other folks with Outlook (or maybe Good for Enterprise).

When I get another one, I&apos;ll try to figure out a bit more what&apos;s going on.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9982692</commentid>
    <comment_count>22</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-12-13 18:59:40 -0500</bug_when>
    <thetext>Here is what I did. I sent myself a meeting request form Outlook 2010, set for 13 Dec 2016 at 6 pm CST. I accepted this in Evo. Evo calendar shows the appointment at 14 Dec 2016 at 11 am AEDT, which is correct. Outlook shows the appointment at the correct time as well.

However, Good for Enterprise show this appointment at 15 Dec 2016 AEDT at 5 am. So, this may be a Good for Enterprise bug after all.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9984693</commentid>
    <comment_count>23</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-12-14 07:56:44 -0500</bug_when>
    <thetext>Could you verify what timezone is set on the event, please? Both the one you received by email (in the Message source [Ctrl+U]) and then when you right-click it in the Calendar view and will pick &apos;Save as iCalendar&apos;. The lines wit DTSTART and DTEND define the event time, possibly with TZID as the timezone ID.

If it&apos;ll show sane values, then I tend to agree with the bug being elsewhere.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9989980</commentid>
    <comment_count>24</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-12-15 09:17:45 -0500</bug_when>
    <thetext>Thanks for the files (sent to me privately). All of them show America/Chicago timezone being used for the event, which seems correct, from my point of view (and is considered a &quot;sane value&quot; from my point of view).

The two events you see in the UI have different unique identifier, even they both reference the same MAPI&apos;s GlobalID. I guess it&apos;s due to one event being added to the calendar by the evolution, the other being updated by the server, even it&apos;s only a guess. Issuing a Refresh on the calendar should remove one of them.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991524</commentid>
    <comment_count>25</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-12-15 17:16:52 -0500</bug_when>
    <thetext>(In reply to Milan Crha from comment #24)
&gt; Issuing a Refresh on the calendar should remove one of them.

Tried that, but it didn&apos;t work. If I do evolution --force-shutdown, the second event indeed disappears on restart.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10010347</commentid>
    <comment_count>26</comment_count>
    <who name="Milan Crha">mcrha</who>
    <bug_when>2016-12-21 04:47:00 -0500</bug_when>
    <thetext>That&apos;s because the evolution-calendar-factory process got restarted and the local in-memory-cache updated. It can be that the MAPI failed to pair the events, but as I said, they have a different UID, which is a unique identifier of the component. I know this is unrelated for the initial issue in this bug report, I&apos;m only mentioning it.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1376943</bug_id>
          
          <creation_ts>2016-09-16 18:01:00 -0400</creation_ts>
          <short_desc>Ocaml scripting not supported in spatch on F24</short_desc>
          <delta_ts>2016-09-30 11:52:29 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>coccinelle</component>
          <version>24</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mat Martineau">mathew.j.martineau</reporter>
          <assigned_to name="Richard W.M. Jones">rjones</assigned_to>
          <cc>rjones</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>coccinelle-1.0.5-2.fc25 coccinelle-1.0.5-2.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-09-26 20:37:21</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9715734</commentid>
    <comment_count>0</comment_count>
    <who name="Mat Martineau">mathew.j.martineau</who>
    <bug_when>2016-09-16 18:01:56 -0400</bug_when>
    <thetext>Description of problem:

Semantic patches using &quot;@script:ocaml@&quot; result in an execution error.

Version-Release number of selected component (if applicable):

coccinelle-1.0.4-4.fc24

How reproducible:

Always reproducible

Steps to Reproduce:
1. Get the &apos;badzero.cocci&apos; semantic patch file (https://github.com/torvalds/linux/blob/master/scripts/coccinelle/null/badzero.cocci), or any other valid .cocci file that uses ocaml scripting (contains &quot;@script:ocaml@&quot;).
2. Create a 0-length file called &apos;empty.c&apos; in the same directory
3. Run &apos;/usr/bin/spatch -D report --no-show-diff --very-quiet --cocci-file badzero.cocci empty.c&apos;

Actual results:

Exit code &apos;2&apos;, prints &quot;Fatal error: exception Failure(&quot;OCaml scripting is unsupported. Compile spatch with OCaml version &gt;= 3.11&quot;)&quot;

Expected results:

Exit code &apos;0&apos;, no output

Additional info:

It looks like ocamlfind was missing on the build system, despite ocaml-findlib-devel being listed as a build requirement in the .spec file. https://kojipkgs.fedoraproject.org//packages/coccinelle/1.0.4/4.fc24/data/logs/x86_64/build.log says &quot;configure: ocaml scripting is disabled because it depends on ocamlfind&quot;. The build log also shows ocaml 4.02.3 was used to build, which is &gt;= 3.11. Looks like the i686 and ARM build had a similar problem.

The coccinelle 1.0.1 fc23 and 1.0.5 fc25 builds do enable ocaml scripting.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9720546</commentid>
    <comment_count>1</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-09-19 05:36:19 -0400</bug_when>
    <thetext>ocaml-findlib was installed in the buildroot of the latest build:

https://kojipkgs.fedoraproject.org//packages/coccinelle/1.0.5/1.fc25/data/logs/x86_64/root.log

and scripting was enabled in that build too:

https://kojipkgs.fedoraproject.org//packages/coccinelle/1.0.5/1.fc25/data/logs/x86_64/build.log

For the latest F24 build, ocamlfind was also installed:

https://kojipkgs.fedoraproject.org//packages/coccinelle/1.0.4/4.fc24/data/logs/x86_64/root.log

but the build (wrongly) complained that scripting was disabled
because ocamlfind isn&apos;t installed:

https://kojipkgs.fedoraproject.org//packages/coccinelle/1.0.4/4.fc24/data/logs/x86_64/build.log</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9720566</commentid>
    <comment_count>2</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-09-19 05:44:37 -0400</bug_when>
    <thetext>Anyway I have updated the F24 branch to the latest Coccinelle, and
that seems to fix things:

http://koji.fedoraproject.org/koji/taskinfo?taskID=15704775</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9720613</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-19 05:59:17 -0400</bug_when>
    <thetext>coccinelle-1.0.5-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-feadc0e655</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722480</commentid>
    <comment_count>4</comment_count>
    <who name="Mat Martineau">mathew.j.martineau</who>
    <bug_when>2016-09-19 14:09:04 -0400</bug_when>
    <thetext>I tried the 1.0.5 rpm, and while it did resolve the scripting error message, now I get a different error:

$ /usr/bin/spatch -D report --no-show-diff --very-quiet --cocci-file badzero.cocci empty.c
Fatal error: exception Yes_prepare_ocamlcocci.CompileFailure(&quot;No coccilib.cmi in /usr/lib64/coccinelle/ocaml/coccilib.cmi or /usr/lib64/coccinelle/ocaml/coccilib/coccilib.cmi&quot;)

If I do a local coccinelle 1.0.5 build and &apos;cp ocaml/*.cmi /usr/lib64/coccinelle/ocaml/&apos;, then I can successfully run spatch with badzero.cocci</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722496</commentid>
    <comment_count>5</comment_count>
    <who name="Mat Martineau">mathew.j.martineau</who>
    <bug_when>2016-09-19 14:15:33 -0400</bug_when>
    <thetext>Regarding the .cmi files, &apos;make install-common&apos; does install them to /usr/lib64/coccinelle/ocaml/:

https://github.com/coccinelle/coccinelle/blob/1.0.5/Makefile#L341</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722550</commentid>
    <comment_count>6</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-09-19 14:45:33 -0400</bug_when>
    <thetext>Please try this one if it finishes building:

http://koji.fedoraproject.org/koji/taskinfo?taskID=15709195</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722616</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-19 15:09:59 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-298075b830</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722656</commentid>
    <comment_count>8</comment_count>
    <who name="Mat Martineau">mathew.j.martineau</who>
    <bug_when>2016-09-19 15:29:52 -0400</bug_when>
    <thetext>The 1.0.5-2.fc24 x86_64 build works for my test case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9722788</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-19 16:43:36 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-f0a035e115</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9727578</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-20 15:57:33 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-298075b830</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9732285</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-21 21:26:01 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-f0a035e115</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9744484</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-26 20:37:21 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9757925</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-30 11:52:29 -0400</bug_when>
    <thetext>coccinelle-1.0.5-2.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
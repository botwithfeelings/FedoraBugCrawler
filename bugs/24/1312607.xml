<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1312607</bug_id>
          
          <creation_ts>2016-02-27 15:39:00 -0500</creation_ts>
          <short_desc>anaconda fails to start up since glibc locale split (&apos;locale.Error: unsupported locale setting&apos;)</short_desc>
          <delta_ts>2016-03-08 14:05:46 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>lorax</component>
          <version>24</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1312951</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1312890</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedBlocker</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1230431</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to name="Brian Lane">bcl</assigned_to>
          <cc>anaconda-maint-list</cc>
    
    
    <cc>awilliam</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>codonell</cc>
    
    
    <cc>g.kaviyarasu</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>mfabian</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>stalinswag1</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>lorax-24.14-1</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-03-08 14:05:46</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9103077</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-27 15:39:02 -0500</bug_when>
    <thetext>In recent Rawhide and F24 nightlies, anaconda fails to start up at all, with a traceback ending in &apos;locale.Error: unsupported locale setting&apos;. e.g. https://openqa.fedoraproject.org/tests/6228/modules/_boot_to_anaconda/steps/7 . dgilmore believes this is due to the glibc locale split, and suggests adding Requires: glibc-all-langpacks to anaconda&apos;s deps for F24+.

This is an automatic F24 Alpha blocker, under both &quot;Complete failure of any release-blocking TC/RC image to boot at all under any circumstance - &quot;DOA&quot; image (conditional failure is not an automatic blocker)&quot; (as the installer images do not boot to anything useful) and &quot;Bugs which entirely prevent the composition of one or more of the release-blocking images required to be built for a currently-pending (pre-)release&quot; (because this breaks building, I believe, lives and Cloud images).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106135</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 10:26:47 -0500</bug_when>
    <thetext>As is currently being discussed in #anaconda, changing lorax may not be entirely sufficient. Live media creation will probably still fail as it does not use the lorax-generated environment.

I guess I&apos;ll file a new bug for that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106162</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 10:35:57 -0500</bug_when>
    <thetext>Filed https://bugzilla.redhat.com/show_bug.cgi?id=1312951 for the live media case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106307</commentid>
    <comment_count>3</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-02-29 11:05:55 -0500</bug_when>
    <thetext>The glibc team is working to put out an ASAP update that would use a slightly tweaked set of rpm dependencies to ensure glibc-all-lanpacks is pulled in by default in more cases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106319</commentid>
    <comment_count>4</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-02-29 11:07:42 -0500</bug_when>
    <thetext>Does Anaconda actually need *all* the locales?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106385</commentid>
    <comment_count>5</comment_count>
    <who name="David Shea">dshea</who>
    <bug_when>2016-02-29 11:27:36 -0500</bug_when>
    <thetext>https://github.com/rhinstaller/anaconda/pull/531 should make things behave a bit better on the anaconda side.

(In reply to Carlos O&apos;Donell from comment #4)
&gt; Does Anaconda actually need *all* the locales?

Are you saying we should pick and choose which locale data and languages we actually need? That sounds super annoying.

This isn&apos;t just about language. The locale chosen by the user affects the behavior of several aspects of the install, like text direction and time display, so yeah, it&apos;d be nice to have all of them.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9106627</commentid>
    <comment_count>6</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-02-29 12:27:36 -0500</bug_when>
    <thetext>I&apos;m guessing that in theory anaconda only needs the locales relevant to the languages it offers. However, as David says, I think trying to make the dependency that specific would be difficult in practice (the anaconda language support list, IIRC, is actually dynamically generated based on the translation status in Zanata).

If there&apos;s going to be some sort of &apos;all the remotely sane langpacks&apos; virtual package or something, that would probably work for anaconda in practice? But it&apos;s hard to be sure how to answer your question.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9109173</commentid>
    <comment_count>7</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-03-01 03:29:23 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #6)
&gt; I&apos;m guessing that in theory anaconda only needs the locales relevant to the
&gt; languages it offers. However, as David says, I think trying to make the
&gt; dependency that specific would be difficult in practice (the anaconda
&gt; language support list, IIRC, is actually dynamically generated based on the
&gt; translation status in Zanata).
&gt; 
&gt; If there&apos;s going to be some sort of &apos;all the remotely sane langpacks&apos;
&gt; virtual package or something, that would probably work for anaconda in
&gt; practice? But it&apos;s hard to be sure how to answer your question.

You answered my question. The `glibc-all-langpacks` is the virtual &quot;provide everything and the kitchen sink&quot;, and that&apos;s what Anaconda should use. It provides all the locales in a minimized form.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9109184</commentid>
    <comment_count>8</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-03-01 03:32:46 -0500</bug_when>
    <thetext>With glibc-2.23.90-3.fc25 and glibc-2.23.1-5.fc24 we have now fixed
the issue in several important ways.

See:
https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/WXOOUGA3YCB2O4O77JGLSJZ25BS4RFK5/

You should now always get glibc-all-langpacks by default.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9110653</commentid>
    <comment_count>9</comment_count>
    <who name="">stalinswag1</who>
    <bug_when>2016-03-01 10:14:10 -0500</bug_when>
    <thetext>(In reply to Carlos O&apos;Donell from comment #8)
&gt; With glibc-2.23.90-3.fc25 and glibc-2.23.1-5.fc24 we have now fixed
&gt; the issue in several important ways.
&gt; 
&gt; See:
&gt; https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/
&gt; message/WXOOUGA3YCB2O4O77JGLSJZ25BS4RFK5/
&gt; 
&gt; You should now always get glibc-all-langpacks by default.

When this bugfix be applied for Rawhide ISO image?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9110844</commentid>
    <comment_count>10</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-01 10:51:17 -0500</bug_when>
    <thetext>Bodhi is not enabled for F24 ATM, so the next F24 and Rawhide composes that happen should include it (in fact they may have happened since Carlos posted his comment)...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9113173</commentid>
    <comment_count>11</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-02 04:10:23 -0500</bug_when>
    <thetext>current Rawhide and Branched nightlies are still hitting this, so I don&apos;t think the changes to the glibc package help the anaconda environment case. bcl, could you please do F24 and Rawhide builds of lorax so we can get past this bug? until this is fixed we really can&apos;t tell what all else is still broken in F24/Rawhide with the compose process changes and so on, because all our tests blow up right away. thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9113840</commentid>
    <comment_count>12</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-03-02 07:08:35 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #11)
&gt; current Rawhide and Branched nightlies are still hitting this, so I don&apos;t
&gt; think the changes to the glibc package help the anaconda environment case.
&gt; bcl, could you please do F24 and Rawhide builds of lorax so we can get past
&gt; this bug? until this is fixed we really can&apos;t tell what all else is still
&gt; broken in F24/Rawhide with the compose process changes and so on, because
&gt; all our tests blow up right away. thanks!

The changes to f24 and f25 make it a requirement to install glibc with a langpack. The default langpack the dependency solver will use is glibc-all-langpacks because of the suggestion in glibc package.

Could you please verify you actually have glibc-2.23.90-3.fc25 or glibc-2.23.1-5.fc24? Until those two packages enter your builds you&apos;ll have problems.

Is there any way I reproduce this on my end to make sure we didn&apos;t miss anything?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9114841</commentid>
    <comment_count>13</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-03-02 11:04:11 -0500</bug_when>
    <thetext>I built lorax with the glibc-all-langpacks fix last night. So depending on timing of compose vs. build it may have used the old lorax. Check the compose logs to see if the new package was included.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9114922</commentid>
    <comment_count>14</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-02 11:29:17 -0500</bug_when>
    <thetext>MMMMMMMMM THIS HUMBLE PIE IS DELICIOUS

that&apos;ll teach me not to click on thumbnails. turns out the openQA tests for 2016-03-02 weren&apos;t failing on the anaconda bug, they were failing because they couldn&apos;t find the ISO, and they couldn&apos;t find the ISO because some idiot monkey forgot to restart the scheduler after changing the ISO download code...

excuse me while I put some salt on my hat to go with this pie!

now I fixed the scheduler, we have a Rawhide test actually running anaconda:

https://openqa.fedoraproject.org/tests/7016

so it does indeed look like one change or the other fixed this.

I&apos;ll just confirm that Branched works too, but this looks good.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9114932</commentid>
    <comment_count>15</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-02 11:32:55 -0500</bug_when>
    <thetext>For the record, the last tests that actually failed in anaconda were Fedora-24-20160301.n.0:

https://openqa.fedoraproject.org/tests/6634

that tree has lorax-24.13-1.fc25.x86_64.rpm and glibc-2.23.90-2.fc25.i686.rpm , so we can&apos;t tell for sure whether glibc change alone would&apos;ve fixed this from that. If bcl wants to know if he could drop the lorax change, I&apos;ll download some ISOs from the composes in the middle if I can find one with the glibc change but not the lorax change and check manually.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9114936</commentid>
    <comment_count>16</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-02 11:33:58 -0500</bug_when>
    <thetext>damnit, looked at the wrong tree, but same info - it has glibc-2.23.1-4.fc24.x86_64.rpm and lorax-24.13-1.fc24.x86_64.rpm , i.e. the non-fixed package in both cases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9114967</commentid>
    <comment_count>17</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-03-02 11:40:04 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #16)
&gt; damnit, looked at the wrong tree, but same info - it has
&gt; glibc-2.23.1-4.fc24.x86_64.rpm and lorax-24.13-1.fc24.x86_64.rpm , i.e. the
&gt; non-fixed package in both cases.

Right, those are the old glibc packages with the upgrade issues.

F24 compose includes the fixed version as of yesterday:
https://lists.fedoraproject.org/archives/list/test@lists.fedoraproject.org/thread/AKFL6K2HNWBY6W535OVQW3QIHC2OV2YN/

F25 compose includes the fixed version as of today:
https://lists.fedoraproject.org/archives/list/test@lists.fedoraproject.org/thread/SFVADLBHDFSXPV3UCQTEHDCTGUMLXEX3/

So you&apos;d have to use the latest composes to get the fix.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9115003</commentid>
    <comment_count>18</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-02 11:46:29 -0500</bug_when>
    <thetext>right, I&apos;ve already said the latest trees are fixed. But what I&apos;m trying to determine now is whether the glibc fix was sufficient or if the lorax fix was still needed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9115014</commentid>
    <comment_count>19</comment_count>
    <who name="Carlos O&apos;Donell">codonell</who>
    <bug_when>2016-03-02 11:48:29 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #18)
&gt; right, I&apos;ve already said the latest trees are fixed. But what I&apos;m trying to
&gt; determine now is whether the glibc fix was sufficient or if the lorax fix
&gt; was still needed.

OK, the glibc fix is sufficient to fix the locale.Error, if it isn&apos;t, then I&apos;d like to know and dig deeper. Other issues I can&apos;t comment on.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9130070</commentid>
    <comment_count>20</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-03-08 14:05:46 -0500</bug_when>
    <thetext>Welp, I&apos;ve got a ton of stuff on my plate and this is definitely fixed one way or the other, so let&apos;s just close it for now.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
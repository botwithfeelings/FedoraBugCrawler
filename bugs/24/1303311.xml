<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1303311</bug_id>
          
          <creation_ts>2016-01-30 11:35:00 -0500</creation_ts>
          <short_desc>[weakdeps] --whatsupplements not working</short_desc>
          <delta_ts>2017-03-15 05:04:10 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf-plugins-core</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>NEXTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Triaged</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1314406</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Parag Nemade">pnemade</reporter>
          <assigned_to>rpm-software-management</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>ffesti</cc>
    
    
    <cc>mfabian</cc>
    
    
    <cc>mls</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>mmraka</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>RadekHolyPublic</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-15 05:04:10</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9022736</commentid>
    <comment_count>0</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-01-30 11:35:21 -0500</bug_when>
    <thetext>Description of problem:
Please enable copr repository &quot;sudo dnf enable pnemade/weakdeps&quot;.
Then I can use following
$ sudo dnf repoquery --whatsupplements man-pages
Last metadata expiration check performed 3:46:26 ago on Sat Jan 30 15:59:27 2016.
man-pages-cs-0:0.18.20090209-20.fc23.noarch
man-pages-de-0:1.9-3.fc23.noarch
man-pages-es-0:1.55-24.fc23.noarch
man-pages-fr-0:3.70-3.fc23.noarch
man-pages-it-0:3.56-5.fc23.noarch
man-pages-ja-0:20151215-2.fc23.noarch
man-pages-ko-2:20050219-28.fc23.noarch
man-pages-pl-1:0.6-3.fc23.noarch
man-pages-ru-0:3.81-2.20151031.fc23.noarch
man-pages-zh-CN-0:1.5.2-10.fc23.noarch

but now I need whatsupplements any language using
$ sudo dnf repoquery --whatsupplements langpacks-ja
Last metadata expiration check performed 3:47:41 ago on Sat Jan 30 15:59:27 2016.

==&gt; No output

But I have packages that Supplements langpacks-ja. See
$ sudo dnf repoquery --supplements man-pages-ja
Last metadata expiration check performed 0:02:05 ago on Sat Jan 30 19:54:47 2016.
man-pages &amp; langpacks-ja


Version-Release number of selected component (if applicable):
dnf-plugins-core-0.1.16-1.fc23.noarch
dnf-1.1.6-1.fc23.noarch

Basically I want to find what packages supplements langpacks-ja.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9025132</commentid>
    <comment_count>1</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-02-01 02:36:14 -0500</bug_when>
    <thetext>I have few things to add here.

1) I wrote &quot;Supplements: man-pages and langpacks-ja&quot; in man-pages-ja.spec file. Is there any issue with &quot;and&quot; in it? I mean I can --whatsupplements for &quot;man-pages&quot; but I can&apos;t get result for &quot;langpacks-ja&quot;.

2) Why is it that when I wrote &quot;&quot;Supplements: man-pages and langpacks-ja&quot; in man-pages-ja.spec but dnf repoquery --supplements for man-pages returning &quot;man-pages &amp; langpacks-ja&quot;?
Please note here, I used &quot;and&quot; in spec file and repoquery returned &quot;&amp;&quot; in result.

Should there be some consistency of usage of &quot;and&quot; and &quot;&amp;&quot;?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9026103</commentid>
    <comment_count>2</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2016-02-01 08:41:23 -0500</bug_when>
    <thetext>1) there&apos;s probably a bug in repoquery
2) rpm (and so dnf) prints `&amp;` instead of &quot;and&quot;. we should make it consistent.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9028654</commentid>
    <comment_count>3</comment_count>
    <who name="Florian Festi">ffesti</who>
    <bug_when>2016-02-02 05:44:39 -0500</bug_when>
    <thetext>Hmm, there was a bug in rpmbuild that can cause this. Can you please rebuild the package with a current version of rpm and check if the issue goes away?

You can just check the resulting package with rpm -qp --supplements</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9029046</commentid>
    <comment_count>4</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-02-02 08:03:24 -0500</bug_when>
    <thetext>I don&apos;t think I am seeing any difference in output. 
With command &quot;rpm -q --supplements man-pages-ja&quot;, I previously got
==&gt; man-pages and langpacks-ja
and after rebuild of man-pages-ja, I am again getting same output
==&gt; man-pages and langpacks-ja

My question was either one should follow same. I think if rpm is using &quot;and&quot; string operator then dnf repoquery should also show &quot;and&quot; instead of &quot;&amp;&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9029071</commentid>
    <comment_count>5</comment_count>
    <who name="Mike FABIAN">mfabian</who>
    <bug_when>2016-02-02 08:17:12 -0500</bug_when>
    <thetext>(In reply to Florian Festi from comment #3)
&gt; Hmm, there was a bug in rpmbuild that can cause this. Can you please rebuild
&gt; the package with a current version of rpm and check if the issue goes away?
&gt; 
&gt; You can just check the resulting package with rpm -qp --supplements

I think this is not the reason because “rpm  -q supplements” (or -qp on the package file)
shows the correct results:

[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ rpm -q --supplements man-pages-de
(man-pages and langpacks-de)
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ rpm -q --supplements glibc-langpack-de
(glibc = 2.22.90-52.fc23 and (langpacks-de))
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ rpm -q --supplements langpacks-de
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$

This looks OK.

And “dnf repoquery --supplements” seems to work fine as well:

[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ sudo dnf repoquery --supplements man-pages-de
Last metadata expiration check performed 0:46:55 ago on Tue Feb  2 13:15:05 2016.
man-pages &amp; langpacks-de
man-pages &amp; langpacks-zh-CN
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ sudo dnf repoquery --supplements glibc-langpack-de
Last metadata expiration check performed 0:47:02 ago on Tue Feb  2 13:15:05 2016.
glibc = 2.22.90-50.fc23 &amp; langpacks-de
glibc = 2.22.90-52.fc23 &amp; langpacks-de
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ 

But “--whatsupplements” does not seem to work, neither using dnf nor rpm:

[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ sudo dnf repoquery --whatsupplements langpacks-de
Last metadata expiration check performed 0:47:08 ago on Tue Feb  2 13:15:05 2016.
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ 

[mfabian@Fedora-Workstation-netinst-x86_6 ~]$ rpm -q --whatsupplements langpacks-de
no package supplements langpacks-de
[mfabian@Fedora-Workstation-netinst-x86_6 ~]$</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9092978</commentid>
    <comment_count>6</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 09:22:24 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9190678</commentid>
    <comment_count>7</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-03-30 04:45:20 -0400</bug_when>
    <thetext>ping any update here?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9191345</commentid>
    <comment_count>8</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2016-03-30 08:14:11 -0400</bug_when>
    <thetext>(In reply to Mike FABIAN from comment #5)
&gt; But “--whatsupplements” does not seem to work, neither using dnf nor rpm:
&gt; 
&gt; [mfabian@Fedora-Workstation-netinst-x86_6 ~]$ sudo dnf repoquery
&gt; --whatsupplements langpacks-de

I am not sure whether it should match just part of rich dependency relation
Although it should work at least for whole expression inside tag:

# dnf repoquery --whatsupplements &quot;(glibc = 2.23.1-5.fc24 and (langpacks-de or langpacks-de_AT or langpacks-de_BE or langpacks-de_CH or langpacks-de_DE or langpacks-de_LU))&quot; --releasever=24

and

# sudo dnf repoquery --whatsupplements \*langpacks-de\* --releasever=24

which does not work currently.

BTW this does not work with current representation of boolean operands too (should not work anyway):
# dnf repoquery --whatsupplements &quot;(glibc = 2.23.1-5.fc24 &amp; (langpacks-de | langpacks-de_AT | langpacks-de_BE | langpacks-de_CH | langpacks-de_DE | langpacks-de_LU))&quot; --releasever=24



&apos;&amp;&apos;, &apos;|&apos; and &apos;&lt;-&apos; seems to be representation of operands in libsolv. We shoul be doing the conversion to &apos;and&apos;, &apos;or&apos; and &apos;if&apos; respectively in hawkey/libhif.

We&apos;ll fix it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9215312</commentid>
    <comment_count>9</comment_count>
    <who name="Michael Schröder">mls</who>
    <bug_when>2016-04-07 06:58:18 -0400</bug_when>
    <thetext>No, the representation should be fixed in libsolv. Please don&apos;t add conversion code to hawkey.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9220074</commentid>
    <comment_count>10</comment_count>
    <who name="Michael Schröder">mls</who>
    <bug_when>2016-04-08 08:50:13 -0400</bug_when>
    <thetext>Commit 79ec99e586fade65d2cbf0bb2cb4008ac7ec9634 makes libsolv use rpm-style complex dependencies in its output.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9227618</commentid>
    <comment_count>11</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-04-11 23:13:50 -0400</bug_when>
    <thetext>*** Bug 1326095 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9227642</commentid>
    <comment_count>12</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2016-04-11 23:27:58 -0400</bug_when>
    <thetext>I have libsolv-0.6.20 installed on F24 machine and I can see this bug is fixed now.

See $ sudo dnf repoquery --whatsupplements langpacks-ja
Last metadata expiration check: 0:12:50 ago on Tue Apr 12 08:37:39 2016.
calligra-l10n-ja-0:2.9.11-2.fc24.noarch
eclipse-nls-ja-0:4.5.0.v20150804081228-3.fc24.noarch
gimp-help-ja-0:2.8.2-5.fc24.noarch
glibc-langpack-ja-0:2.23.1-5.fc24.x86_64
kde-l10n-ja-0:15.12.3-3.fc24.noarch
libreoffice-langpack-ja-1:5.1.2.1-3.fc24.x86_64
man-pages-ja-0:20151215-3.fc24.noarch
nqc-doc-ja-0:3.1.7-18.fc24.x86_64
tesseract-langpack-jpn-0:3.04.01-1.fc24.noarch
tkgate-ja-0:2.0-24.beta10.fc24.noarch

and then both of these outputs are also consistent in using &quot;and&quot;
[parag@f24 master]$ rpm -q --supplements man-pages-ja
(man-pages and langpacks-ja)
[parag@f24 master]$ sudo dnf repoquery --supplements man-pages-ja
(man-pages and langpacks-ja)


Now next set of queries like
1) Do people need to use this kind of query
sudo dnf repoquery --whatsupplements \*langpacks-de\*
instead of
sudo dnf repoquery --whatsupplements langpacks-de

==&gt; The previous still does not work but later works fine now. So glob is not working..

2) if following query is valid to run then its still not working
dnf repoquery --whatsupplements &quot;(glibc = 2.23.1-5.fc24 &amp; (langpacks-de | langpacks-de_AT | langpacks-de_BE | langpacks-de_CH | langpacks-de_DE | langpacks-de_LU))&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9229051</commentid>
    <comment_count>13</comment_count>
    <who name="Michael Mráka">mmraka</who>
    <bug_when>2016-04-12 08:08:54 -0400</bug_when>
    <thetext>Partially (support for globs in --what&lt;weak_dep&gt;) fixed in
https://github.com/rpm-software-management/dnf-plugins-core/pull/157

It still does not return answer for complex rich deps.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9340341</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-05-19 07:07:45 -0400</bug_when>
    <thetext>dnf-plugins-core-0.1.21-1.fc24 dnf-1.1.9-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-1efd7bc386</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9346162</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-05-20 21:32:48 -0400</bug_when>
    <thetext>dnf-1.1.9-1.fc24, dnf-plugins-core-0.1.21-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-1efd7bc386</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9490177</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-07-08 05:26:14 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10240858</commentid>
    <comment_count>17</comment_count>
    <who name="Parag Nemade">pnemade</who>
    <bug_when>2017-03-15 05:04:10 -0400</bug_when>
    <thetext>This bug is fixed for me already. If anything comes, I will report new bug. Thanks.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
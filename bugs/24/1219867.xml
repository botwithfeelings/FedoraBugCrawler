<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1219867</bug_id>
          
          <creation_ts>2015-05-08 10:06:00 -0400</creation_ts>
          <short_desc>include option in repository should not effect the rest repos</short_desc>
          <delta_ts>2016-10-04 14:07:00 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Regression, Reopened, Triaged</keywords>
          <priority>urgent</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marco Giunta">giun7a</reporter>
          <assigned_to name="Michael Mráka">mmraka</assigned_to>
          <cc>bochecha</cc>
    
    
    <cc>btison</cc>
    
    
    <cc>edgar.hoch</cc>
    
    
    <cc>erik-fedora</cc>
    
    
    <cc>goeran</cc>
    
    
    <cc>guo888xiao</cc>
    
    
    <cc>ignatenko</cc>
    
    
    <cc>jsilhan</cc>
    
    
    <cc>jzeleny</cc>
    
    
    <cc>mluscon</cc>
    
    
    <cc>mmraka</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>paul</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>stephen.gowing</cc>
    
    
    <cc>thoger</cc>
    
    
    <cc>tla</cc>
    
    
    <cc>ville.skytta</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-07-21 10:09:36</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8216619</commentid>
    <comment_count>0</comment_count>
    <who name="Marco Giunta">giun7a</who>
    <bug_when>2015-05-08 10:06:51 -0400</bug_when>
    <thetext>Description of problem:

after a fedup upgrade, from F21 Workstation to F22 beta, &apos;includepks&apos; or the new &apos;include&apos; options in my yum repository configuration do not work anymore 

Version-Release number of selected component (if applicable):

dnf-1.0.0-1.fc22.noarch
dnf-plugins-core-0.1.7-1.fc22.noarch
dnf-yum-1.0.0-1.fc22.noarch
dnf-conf-1.0.0-1.fc22.noarch
yum-langpacks-0.4.5-1.fc22.noarch
yum-metadata-parser-1.1.4-14.fc22.x86_64
yum-3.4.3-505.fc22.noarch
yum-utils-1.1.31-505.fc22.noarch
libsolv-0.6.10-1.fc22.x86_64


How reproducible:

set an &apos;include&apos; or an &apos;includepkgs&apos; option in a yum repository section


Steps to Reproduce:

If I disable the repository, there is no rpm to upgrade:

$ sudo dnf update
Dependencies resolved.
Nothing to do.
Complete!

after enabling the repository, and set &apos;include&apos; option, only to install a specific rpm from it, &apos;dnf&apos; want to upgrade other rpms available from the repository just enabled:

$ cat /etc/yum.repos.d/russianfedora-nonfree-updates.repo
...
[russianfedora-nonfree-updates]
...
enabled=1
...
include=chromium-*
...
$ sudo dnf update
Last metadata expiration check performed 1:14:52 ago on Fri May  8 14:45:38 2015.
Dependencies resolved.
==========================================================================================================================
 Package                Arch             Version                            Repository                               Size
==========================================================================================================================
Installing:
 rar-docs               noarch           1:5.2.1-1.fc22.R                   russianfedora-nonfree-updates            47 k
Upgrading:
 flash-plugin           x86_64           7:11.2.202.451-1.fc22.R            russianfedora-nonfree-updates           5.5 M
 unrar                  x86_64           1:5.2.1-1.fc22.R                   russianfedora-nonfree-updates           134 k

Transaction Summary
==========================================================================================================================
Install  1 Package
Upgrade  2 Packages

Total download size: 5.7 M
Is this ok [y/N]: 



Same result if use the old option &apos;includepks=chromium-*&apos;



Actual results:

&apos;include&apos; or &apos;includepks&apos; options do not work


Expected results:

&apos;dnf&apos; must install only &apos;include&apos; packages from repository, like &apos;yum&apos; before the upgrade</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8218433</commentid>
    <comment_count>1</comment_count>
    <who name="Erik van Pienbroek">erik-fedora</who>
    <bug_when>2015-05-09 15:16:40 -0400</bug_when>
    <thetext>I&apos;m affected by this bug too.
Additionally I would like to mention that the configuration option &apos;include&apos; (as it is called according to the dnf.conf man-page) breaks the old yum as it has a different meaning there (include external configuration file). My preference would be to stick with the old yum option name &apos;includepkgs&apos; instead of &apos;include&apos; as it allows backwards compatibility with the old yum and doesn&apos;t force old yum users to change their configuration.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8218454</commentid>
    <comment_count>2</comment_count>
    <who name="Marco Giunta">giun7a</who>
    <bug_when>2015-05-09 15:46:00 -0400</bug_when>
    <thetext>if I move the repository configuration from yum file to &apos;/etc/dnf/dnf.conf&apos;, the result is the same: &apos;include&apos; options does not work at all !!!

$ cat /etc/dnf/dnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true

[russianfedora-nonfree-updates-dnf]
name=Russian Fedora for Fedora $releasever - Nonfree - Updates
#baseurl=http://mirror.yandex.ru/fedora/russianfedora/russianfedora/nonfree/fedora/updates/$releasever/$basearch
mirrorlist=http://mirrors.rfremix.ru/mirrorlist?repo=nonfree-fedora-updates-released-$releasever&amp;arch=$basearch
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-russianfedora-nonfree-fedora
include=chromium-*
skip_if_unavailable=1

$ dnf update
Last metadata expiration check performed 0:03:53 ago on Sat May  9 21:40:07 2015.
Dependencies resolved.
==========================================================================================================================
 Package               Arch            Version                           Repository                                  Size
==========================================================================================================================
Installing:
 rar-docs              noarch          1:5.2.1-1.fc22.R                  russianfedora-nonfree-updates-dnf           47 k
Upgrading:
 flash-plugin          x86_64          7:11.2.202.451-1.fc22.R           russianfedora-nonfree-updates-dnf          5.5 M
 unrar                 x86_64          1:5.2.1-1.fc22.R                  russianfedora-nonfree-updates-dnf          134 k

Transaction Summary
==========================================================================================================================
Install  1 Package
Upgrade  2 Packages

Total download size: 5.7 M
Is this ok [y/N]:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8289757</commentid>
    <comment_count>3</comment_count>
    <who name="Marco Giunta">giun7a</who>
    <bug_when>2015-05-30 18:27:50 -0400</bug_when>
    <thetext>After other tests, I&apos;ve found that if I have two or more repositories defined in &apos;/etc/dnf/dnf.conf&apos; with an &apos;include&apos; options, only the last works; the previous ones are turned in &apos;exclude=*&apos;.

If I have two or more repositories defined in &apos;/etc/yum.repos.d&apos; with an &apos;includepks&apos; options, all the options &apos;includepks&apos; are disabled (or turned in &apos;includepks=*&apos;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8360767</commentid>
    <comment_count>4</comment_count>
    <who name="Remi Collet">fedora</who>
    <bug_when>2015-06-22 13:56:51 -0400</bug_when>
    <thetext>Same issue, seems critical.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8360801</commentid>
    <comment_count>5</comment_count>
    <who name="Mathieu Bridon">bochecha</who>
    <bug_when>2015-06-22 14:08:47 -0400</bug_when>
    <thetext>Confirming as well.

Also, Erik is spot on in comment 1, the option shouldn&apos;t have been renamed in a way that breaks yum, at least as long as repo files are shared with yum in /etc/yum.repos.d/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8571954</commentid>
    <comment_count>6</comment_count>
    <who name="Remi Collet">fedora</who>
    <bug_when>2015-08-25 04:23:56 -0400</bug_when>
    <thetext>Because of this bug, DNF is mostly unusable (for me).

So, for now:
alias yum=&quot;yum-deprecated&quot;
alias dnf=&quot;echo DONT use this broken tools&quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8660627</commentid>
    <comment_count>7</comment_count>
    <who name="Paul Howarth">paul</who>
    <bug_when>2015-09-23 05:59:21 -0400</bug_when>
    <thetext>I would like to add that yum has an &quot;include&quot; directive as well as an &quot;includepkgs&quot; directive and they do different things. The &quot;include&quot; directive in yum behaves as &quot;#include&quot; in C.

I have a use case that uses both &quot;include&quot; and &quot;includepkgs&quot; in the same repo file. My aim is to create a local mirror of a subset of the updates repository, and I populate this using reposync with a repo file along these lines:

[local-updates-mirror-x86_64]
name=Local Updates Mirror - x86_64
baseurl=http://example.com/path/to/repo
includepkgs=
include=file:///path/to/package-list-file
enabled=0

/path/to/package-list-file is a file listing the packages I&apos;m interested in, one package per line, each line starting with a tab, so when it gets &quot;include&quot;d by yum, each line is treated as a continuation of the preceding &quot;includepkgs=&quot; line and hence yum sees the list of packages I want to sync. It&apos;s easy to generate a file in this format based on a list of packages on a machine or in another repository, but slightly less easy (and certainly less readable) to generate a .repo file that does the equivalent thing.

I am interested in opinions on the best way to handle my use case using dnf-based tooling.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8928983</commentid>
    <comment_count>8</comment_count>
    <who name="guoxiao">guo888xiao</who>
    <bug_when>2015-12-18 04:40:44 -0500</bug_when>
    <thetext> Installed: dnf-0:1.1.4-2.fc23.noarch at 2015-11-30 03:37
  Built    : Fedora Project at 2015-11-27 10:25

Still not fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9209746</commentid>
    <comment_count>9</comment_count>
    <who name="Tomas Hoger">thoger</who>
    <bug_when>2016-04-05 15:44:39 -0400</bug_when>
    <thetext>I&apos;m currently seeing a different behaviour to what&apos;s described in the comments above, but more consistent with the current bug summary.  It seems include now sort-of works, but instead of being applied to single repository, it&apos;s applied to all repos.  E.g. with no include= in any repo file:

# dnf upgrade fedpkg
Last metadata expiration check performed 1:23:51 ago on Tue Apr  5 20:14:06 2016.
Dependencies resolved.
================================================================================
 Package         Arch            Version                 Repository        Size
================================================================================
Upgrading:
 fedpkg          noarch          1.22-3.fc22             updates           45 k

Transaction Summary
================================================================================
Upgrade  1 Package

Total download size: 45 k
Is this ok [y/N]:

After adding include=somepackage to repo file for some unrelated repository:

# dnf upgrade fedpkg
Last metadata expiration check performed 1:25:41 ago on Tue Apr  5 20:14:06 2016.
Package fedpkg not installed, cannot update it.
No match for argument: fedpkg
Error: No packages marked for upgrade.

Not only include= setting is applied to unrelated repo, dnf also produces completely bogus and misleading error message (&quot;Package fedpkg not installed&quot;).  Running plain &apos;dnf upgrade&apos; only shows update for the &apos;somepackage&apos;.

Tested with:

dnf-1.1.6-2.fc22.noarch
dnf-conf-1.1.6-2.fc22.noarch
dnf-plugins-core-0.1.19-1.fc22.noarch
dnf-yum-1.1.6-2.fc22.noarch
hawkey-0.6.2-2.fc22.x86_64
libsolv-0.6.14-2.fc22.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9209769</commentid>
    <comment_count>10</comment_count>
    <who name="Tomas Hoger">thoger</who>
    <bug_when>2016-04-05 15:58:25 -0400</bug_when>
    <thetext>Is this correct summary of this bug and related / duplicate bug 1055910?

- includepkgs is silently ignored by dnf

- include is meant to be dnf equivalent of includepkgs, with the problem that yum uses include directive for different purpose and hence repo files with include can not be used by both yum and dnf

- dnf include does not actually work

- exclude seems to work, but is not really a good replacement where includepkgs was previously used and needed

Despite several requests, neither of the bugs had any response from dnf maintainers since July to indicate how this problem is planned to be resolved.  Can you please provide that information?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9409829</commentid>
    <comment_count>11</comment_count>
    <who name="Göran Uddeborg">goeran</who>
    <bug_when>2016-06-13 08:37:38 -0400</bug_when>
    <thetext>Yes, that is the behaviour I see using dnf-1.1.8-1.fc24.  (Well, it is hard to say if &quot;includepkgs&quot; is ignored, or if it just doesn&apos;t work in the same way &quot;include&quot; does not work.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9409891</commentid>
    <comment_count>12</comment_count>
    <who name="Tomas Hoger">thoger</who>
    <bug_when>2016-06-13 08:52:27 -0400</bug_when>
    <thetext>Request for information form package maintainer is still relevant and not answered by the previous comment, imo.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9409913</commentid>
    <comment_count>13</comment_count>
    <who name="Göran Uddeborg">goeran</who>
    <bug_when>2016-06-13 08:58:07 -0400</bug_when>
    <thetext>Sorry!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9426657</commentid>
    <comment_count>14</comment_count>
    <who name="Michael Mráka">mmraka</who>
    <bug_when>2016-06-17 03:39:28 -0400</bug_when>
    <thetext>&gt; Despite several requests, neither of the bugs had any response from dnf
&gt; maintainers since July to indicate how this problem is planned to be
&gt; resolved.  Can you please provide that information?

We&apos;re working to have it fixed in dnf 2.0 release (sometime this summer).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9426749</commentid>
    <comment_count>15</comment_count>
    <who name="Tomas Hoger">thoger</who>
    <bug_when>2016-06-17 04:08:10 -0400</bug_when>
    <thetext>Any comment on how include vs. includepkgs inconsistency between yum and dnf is expected to be resolved?  Given that the two are expected to share configuration files, it sounds like a rather unfortunate design decision to re-use &quot;include&quot; keyword for a completely different purpose.  Even if &quot;include&quot; is fixed in dnf (where fixed meaning: work as includepkgs in yum), there&apos;s still problem that you can&apos;t make one repo file with include/includepkgs that can be used on systems using either yum or dnf.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9427154</commentid>
    <comment_count>16</comment_count>
    <who name="Michael Mráka">mmraka</who>
    <bug_when>2016-06-17 05:43:14 -0400</bug_when>
    <thetext>Dnf 2.0 will use yum compatible options:

includepkgs - for including packages from repo
excludepkgs - for excluding packages (to make the name consistent with previous)
exclude     - an alias for excludepkgs to make it compatible with yum (expected to be removed in next version)
includeconf - for including other configs</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9430631</commentid>
    <comment_count>17</comment_count>
    <who name="Paul Howarth">paul</who>
    <bug_when>2016-06-19 04:31:52 -0400</bug_when>
    <thetext>(In reply to Michael Mráka from comment #16)
&gt; Dnf 2.0 will use yum compatible options:
&gt; 
&gt; includepkgs - for including packages from repo
&gt; excludepkgs - for excluding packages (to make the name consistent with
&gt; previous)
&gt; exclude     - an alias for excludepkgs to make it compatible with yum
&gt; (expected to be removed in next version)
&gt; includeconf - for including other configs

I don&apos;t see any mention of &quot;includeconf&quot; in yum.conf(5); yum used &quot;include=&quot; for this purpose, which is incompatible with the current dnf usage.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9432880</commentid>
    <comment_count>18</comment_count>
    <who name="Michael Mráka">mmraka</who>
    <bug_when>2016-06-20 08:22:44 -0400</bug_when>
    <thetext>&gt; I don&apos;t see any mention of &quot;includeconf&quot; in yum.conf(5); yum used &quot;include=&quot;
&gt; for this purpose, which is incompatible with the current dnf usage.

Oops, I meant 
include - for including other configs
includeconf - an alias for include to keep compatibility with dnf v1.

I&apos;m sorry for confusion.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9436587</commentid>
    <comment_count>19</comment_count>
    <who name="Michael Mráka">mmraka</who>
    <bug_when>2016-06-21 08:52:56 -0400</bug_when>
    <thetext>Fixed in
https://github.com/rpm-software-management/dnf/pull/518</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9529115</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-07-19 16:18:37 -0400</bug_when>
    <thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is
no longer maintained, which means that it will not receive any further
security or bug fix updates. As a result we are closing this bug.

If you can reproduce this bug against a currently maintained version of
Fedora please feel free to reopen this bug against that version. If you
are unable to reopen this bug, please file a new report against the
current release. If you experience problems, please add a comment to this
bug.

Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9537110</commentid>
    <comment_count>21</comment_count>
    <who name="Igor Gnatenko">ignatenko</who>
    <bug_when>2016-07-21 10:09:36 -0400</bug_when>
    <thetext>Fixed as part of DNF 2.0.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
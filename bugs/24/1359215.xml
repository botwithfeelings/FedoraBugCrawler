<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1359215</bug_id>
          
          <creation_ts>2016-07-22 10:07:00 -0400</creation_ts>
          <short_desc>Segfault when built with new gcc 6 optimizations</short_desc>
          <delta_ts>2016-08-08 16:28:00 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>lilypond</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Guido Aulisi">guido.aulisi</reporter>
          <assigned_to name="Gwyn Ciesla">limburgher</assigned_to>
          <cc>gmarr</cc>
    
    
    <cc>i</cc>
    
    
    <cc>limburgher</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>lilypond-2.19.46-2.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-08 16:28:00</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9541297</commentid>
    <comment_count>0</comment_count>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-22 10:07:40 -0400</bug_when>
    <thetext>Description of problem:
lilypond segfaults on Fedora 24 and gcc 6 with some input files.

Version-Release number of selected component (if applicable):
lilypond-2.19.45-1.fc24.x86_64

How reproducible:
Render a particular complex score (not really clear what input triggers the crash)

Steps to Reproduce:
1. Run lilypond a_score_file.ly


Actual results:
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x000055d912666faf in Grob::get_offset (this=this@entry=0x0, a=a@entry=X_AXIS) at grob.cc:400
400	  if (dim_cache_[a].offset_)


Expected results:
The score compiles and the pdf is generated

Additional info:
This is probably due to this recent gcc 6 new optimization:
Optimizations remove null pointer checks for this
The backtrace shows that the crash is in grob.cc:

#0  0x000055d912666faf in Grob::get_offset(Axis) const (this=this@entry=0x0, a=a@entry=X_AXIS) at grob.cc:400
#1  0x000055d9126670a8 in Grob::relative_coordinate(Grob const*, Axis) const (this=0x0, refp=0x55d914f179f0, a=X_AXIS) at grob.cc:341
#2  0x000055d9126670ce in Grob::relative_coordinate(Grob const*, Axis) const (this=0x55d914ee8600, refp=0x55d914f179f0, a=X_AXIS) at grob.cc:345
#3  0x000055d9126670ce in Grob::relative_coordinate(Grob const*, Axis) const (this=0x55d914936920, refp=0x55d914f179f0, a=X_AXIS) at grob.cc:345
#4  0x000055d9126670ce in Grob::relative_coordinate(Grob const*, Axis) const (this=0x55d9149371c0, refp=0x55d914f179f0, a=X_AXIS) at grob.cc:345
#5  0x000055d9126670ce in Grob::relative_coordinate(Grob const*, Axis) const (this=0x55d914936c40, refp=0x55d914f179f0, a=X_AXIS) at grob.cc:345
#6  0x000055d9126670ce in Grob::relative_coordinate(Grob const*, Axis) const (this=this@entry=0x55d914937360, refp=0x55d914f179f0, a=a@entry=X_AXIS)
    at grob.cc:345
#7  0x000055d9123bc194 in Slur_configuration::score_extra_encompass(Slur_score_state const&amp;) (this=0x55d914de9fb0, state=...)
    at slur-configuration.cc:341
#8  0x000055d9123bcae5 in Slur_configuration::run_next_scorer(Slur_score_state const&amp;) (this=0x55d914de9fb0, state=...) at slur-configuration.cc:522
#9  0x000055d9125088ab in Slur_score_state::get_best_curve() const (this=this@entry=0x7fffad986a00) at slur-scoring.cc:427
#10 0x000055d912508b0f in Slur::calc_control_points(scm_unused_struct*) (smob=&lt;optimized out&gt;) at slur-scoring.cc:363
#11 0x00007fcaaf894cf5 in scm_dapply () at /lib64/libguile.so.17

I made a patch that seems to solve this problem and a second one to solve a FTBFS problem with &apos;constexpr&apos; needed for in-class initialization of static data member.

I&apos;ll attach them here</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9541303</commentid>
    <comment_count>1</comment_count>
      <attachid>1182861</attachid>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-22 10:08:51 -0400</bug_when>
    <thetext>Created attachment 1182861
Patch to solve crash</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9541305</commentid>
    <comment_count>2</comment_count>
      <attachid>1182862</attachid>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-22 10:09:22 -0400</bug_when>
    <thetext>Created attachment 1182862
Patch to solve FTBFS with gcc 6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9541338</commentid>
    <comment_count>3</comment_count>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-22 10:15:53 -0400</bug_when>
    <thetext>*** Bug 1359213 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9541559</commentid>
    <comment_count>4</comment_count>
    <who name="Gwyn Ciesla">limburgher</who>
    <bug_when>2016-07-22 10:54:12 -0400</bug_when>
    <thetext>The crash patch applies, but the FTBFS patch doesn&apos;t, as it looks like it was derived from code other than 2.19.45.  Can you double-check?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9542096</commentid>
    <comment_count>5</comment_count>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-22 13:45:40 -0400</bug_when>
    <thetext>Sorry, the second patch is against lilypond current git master branch (commit 445bf3bb2fbd1f2), that problem is not present in version 2.19.45.
Please do not apply the second patch to version 2.19.45, maybe it will be useful for the next version.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9542188</commentid>
    <comment_count>6</comment_count>
    <who name="Gwyn Ciesla">limburgher</who>
    <bug_when>2016-07-22 14:09:53 -0400</bug_when>
    <thetext>I wondered if that might be the case.  Thanks, I&apos;ll get the first patch out ASAP.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9542452</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-22 15:45:14 -0400</bug_when>
    <thetext>lilypond-2.19.45-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-d34b2bff27</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9543195</commentid>
    <comment_count>8</comment_count>
    <who name="Guido Aulisi">guido.aulisi</who>
    <bug_when>2016-07-23 13:34:04 -0400</bug_when>
    <thetext>These 2 issues have been corrected upstream too, version 2.19.46 will contain the fixes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9543380</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-23 18:21:41 -0400</bug_when>
    <thetext>lilypond-2.19.45-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-d34b2bff27</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9544252</commentid>
    <comment_count>10</comment_count>
    <who name="Gwyn Ciesla">limburgher</who>
    <bug_when>2016-07-24 12:29:00 -0400</bug_when>
    <thetext>Excellent, thank you!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9560614</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-27 16:34:15 -0400</bug_when>
    <thetext>lilypond-doc-2.19.46-1.fc24 lilypond-2.19.46-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-7937127a2d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9561624</commentid>
    <comment_count>12</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-07-28 01:40:30 -0400</bug_when>
    <thetext>Checks out OK for me!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9565467</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-28 23:56:27 -0400</bug_when>
    <thetext>lilypond-2.19.46-2.fc24, lilypond-doc-2.19.46-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-7937127a2d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9595391</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-08 16:27:58 -0400</bug_when>
    <thetext>lilypond-2.19.46-2.fc24, lilypond-doc-2.19.46-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1182861</attachid>
            <date>2016-07-22 10:08:00 -0400</date>
            <delta_ts>2016-07-22 10:08:51 -0400</delta_ts>
            <desc>Patch to solve crash</desc>
            <filename>0001-Avoid-segfault-in-grob.cc-with-gcc-6-see-issue-4814.txt</filename>
            <type>text/plain</type>
            <size>1382</size>
            <attacher name="Guido Aulisi">guido.aulisi</attacher>
            
              <data encoding="base64">RnJvbSA2ODJmNzUzMTVlNjgyMDIyMGVjZjQ1NzE3NjY0ZjZkMzJmNDgwYzk4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBHdWlkbyBBdWxpc2kgPGd1aWRvLmF1bGlzaUBnbWFpbC5jb20+
CkRhdGU6IEZyaSwgMjIgSnVsIDIwMTYgMTU6MjY6MjkgKzAyMDAKU3ViamVjdDogW1BBVENIIDEv
Ml0gQXZvaWQgc2VnZmF1bHQgaW4gZ3JvYi5jYyB3aXRoIGdjYyA2IChzZWUgaXNzdWUgIzQ4MTQp
CgpXaGVuIG9wdGltaXppbmcsIEdDQyA2IG5vdyBhc3N1bWVzIHRoZSAidGhpcyIgcG9pbnRlciBj
YW4gbmV2ZXIgYmUgbnVsbCwKd2hpY2ggaXMgZ3VhcmFudGVlZCBieSB0aGUgbGFuZ3VhZ2UgcnVs
ZXMuClByb2dyYW1zIHdoaWNoIGFzc3VtZSBpdCBpcyBPSyB0byBpbnZva2UgYSBtZW1iZXIgZnVu
Y3Rpb24gdGhyb3VnaCBhIG51bGwgcG9pbnRlcgoocG9zc2libHkgcmVseWluZyBvbiBjaGVja3Mg
bGlrZSB0aGlzICE9IE5VTEwpIG1heSBjcmFzaCBvciBvdGhlcndpc2UgZmFpbCBhdCBydW4gdGlt
ZQppZiBudWxsIHBvaW50ZXIgY2hlY2tzIGFyZSBvcHRpbWl6ZWQgYXdheS4KLS0tCiBsaWx5L2dy
b2IuY2MgfCA1ICsrKy0tCiAxIGZpbGUgY2hhbmdlZCwgMyBpbnNlcnRpb25zKCspLCAyIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2xpbHkvZ3JvYi5jYyBiL2xpbHkvZ3JvYi5jYwppbmRleCA3
Y2U4OWQ1Li5lYWZhNjYyIDEwMDY0NAotLS0gYS9saWx5L2dyb2IuY2MKKysrIGIvbGlseS9ncm9i
LmNjCkBAIC0zMzMsNyArMzMzLDcgQEAgUmVhbAogR3JvYjo6cmVsYXRpdmVfY29vcmRpbmF0ZSAo
R3JvYiBjb25zdCAqcmVmcCwgQXhpcyBhKSBjb25zdAogewogICAvKiBlYWEgLSBobW1tLCBzaG91
bGQgd2UgZG8gYSBwcm9ncmFtbWluZ19lcnJvcigpIGhlcmU/ICovCi0gIGlmICgodGhpcyA9PSBO
VUxMKSB8fCAocmVmcCA9PSB0aGlzKSkKKyAgaWYgKHJlZnAgPT0gdGhpcykKICAgICByZXR1cm4g
MC4wOwogCiAgIC8qIFdlIGNhdGNoIFBBUkVOVF9MXyA9PSBuaWwgY2FzZSB3aXRoIHRoaXMsIGJ1
dCB3ZSBjcmFzaCBpZiB3ZSBkaWQKQEAgLTM0Miw3ICszNDIsOCBAQCBHcm9iOjpyZWxhdGl2ZV9j
b29yZGluYXRlIChHcm9iIGNvbnN0ICpyZWZwLCBBeGlzIGEpIGNvbnN0CiAgIGlmIChyZWZwID09
IGRpbV9jYWNoZV9bYV0ucGFyZW50XykKICAgICByZXR1cm4gb2ZmOwogCi0gIG9mZiArPSBkaW1f
Y2FjaGVfW2FdLnBhcmVudF8tPnJlbGF0aXZlX2Nvb3JkaW5hdGUgKHJlZnAsIGEpOworICBpZiAo
ZGltX2NhY2hlX1thXS5wYXJlbnRfICE9IE5VTEwpCisgICAgb2ZmICs9IGRpbV9jYWNoZV9bYV0u
cGFyZW50Xy0+cmVsYXRpdmVfY29vcmRpbmF0ZSAocmVmcCwgYSk7CiAKICAgcmV0dXJuIG9mZjsK
IH0KLS0gCjIuNy40Cgo=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1182862</attachid>
            <date>2016-07-22 10:09:00 -0400</date>
            <delta_ts>2016-07-22 10:09:22 -0400</delta_ts>
            <desc>Patch to solve FTBFS with gcc 6</desc>
            <filename>0002-Fix-FTBFS-with-GCC-6.txt</filename>
            <type>text/plain</type>
            <size>1702</size>
            <attacher name="Guido Aulisi">guido.aulisi</attacher>
            
              <data encoding="base64">RnJvbSA1NGFlZjEyMGFmYzM4NTdmZTA3OTcxY2UwYTYyY2IyMTQyNjg5MGQwIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBHdWlkbyBBdWxpc2kgPGd1aWRvLmF1bGlzaUBnbWFpbC5jb20+
CkRhdGU6IEZyaSwgMjIgSnVsIDIwMTYgMTU6MzI6NDYgKzAyMDAKU3ViamVjdDogW1BBVENIIDIv
Ml0gRml4IEZUQkZTIHdpdGggR0NDIDYuCgpHQ0MgNiBub3cgZGVmYXVsdHMgdG8gLXN0ZD1nbnUr
KzE0IGluc3RlYWQgb2YgLXN0ZD1nbnUrKzk4LgpTaW5jZSBDKysxMSwgdGhlIGNvbnN0ZXhwciBr
ZXl3b3JkIGlzIG5lZWRlZCB3aGVuIGluaXRpYWxpemluZwphIG5vbi1pbnRlZ3JhbCBzdGF0aWMg
ZGF0YSBtZW1iZXIgaW4gYSBjbGFzcy4KLS0tCiBsaWx5L2F1ZGlvLWl0ZW0uY2MgICAgICAgICB8
IDYgKysrLS0tCiBsaWx5L2luY2x1ZGUvYXVkaW8taXRlbS5oaCB8IDYgKysrLS0tCiAyIGZpbGVz
IGNoYW5nZWQsIDYgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9s
aWx5L2F1ZGlvLWl0ZW0uY2MgYi9saWx5L2F1ZGlvLWl0ZW0uY2MKaW5kZXggMmM1ZDY5MS4uYzVi
MWY4NyAxMDA2NDQKLS0tIGEvbGlseS9hdWRpby1pdGVtLmNjCisrKyBiL2xpbHkvYXVkaW8taXRl
bS5jYwpAQCAtMTAyLDkgKzEwMiw5IEBAIEF1ZGlvX2tleTo6QXVkaW9fa2V5IChpbnQgYWNjLCBi
b29sIG1ham9yKQogICBtYWpvcl8gPSBtYWpvcjsKIH0KIAotY29uc3QgUmVhbCBBdWRpb19zcGFu
X2R5bmFtaWM6Ok1JTklNVU1fVk9MVU1FOwotY29uc3QgUmVhbCBBdWRpb19zcGFuX2R5bmFtaWM6
Ok1BWElNVU1fVk9MVU1FOwotY29uc3QgUmVhbCBBdWRpb19zcGFuX2R5bmFtaWM6OkRFRkFVTFRf
Vk9MVU1FOworY29uc3RleHByIFJlYWwgQXVkaW9fc3Bhbl9keW5hbWljOjpNSU5JTVVNX1ZPTFVN
RTsKK2NvbnN0ZXhwciBSZWFsIEF1ZGlvX3NwYW5fZHluYW1pYzo6TUFYSU1VTV9WT0xVTUU7Citj
b25zdGV4cHIgUmVhbCBBdWRpb19zcGFuX2R5bmFtaWM6OkRFRkFVTFRfVk9MVU1FOwogCiBBdWRp
b19zcGFuX2R5bmFtaWM6OkF1ZGlvX3NwYW5fZHluYW1pYyAoTW9tZW50IG1vbSwgUmVhbCB2b2x1
bWUpCiAgIDogc3RhcnRfbW9tZW50XyAobW9tKSwKZGlmZiAtLWdpdCBhL2xpbHkvaW5jbHVkZS9h
dWRpby1pdGVtLmhoIGIvbGlseS9pbmNsdWRlL2F1ZGlvLWl0ZW0uaGgKaW5kZXggNTk3ZmE2YS4u
OWEyZWVhMCAxMDA2NDQKLS0tIGEvbGlseS9pbmNsdWRlL2F1ZGlvLWl0ZW0uaGgKKysrIGIvbGls
eS9pbmNsdWRlL2F1ZGlvLWl0ZW0uaGgKQEAgLTQ4LDkgKzQ4LDkgQEAgcHJpdmF0ZToKIGNsYXNz
IEF1ZGlvX3NwYW5fZHluYW1pYyA6IHB1YmxpYyBBdWRpb19lbGVtZW50CiB7CiBwdWJsaWM6Ci0g
IHN0YXRpYyBjb25zdCBSZWFsIE1JTklNVU1fVk9MVU1FID0gMC4wOwotICBzdGF0aWMgY29uc3Qg
UmVhbCBNQVhJTVVNX1ZPTFVNRSA9IDEuMDsKLSAgc3RhdGljIGNvbnN0IFJlYWwgREVGQVVMVF9W
T0xVTUUgPSA5MC4wIC8gMTI3LjA7CisgIHN0YXRpYyBjb25zdGV4cHIgUmVhbCBNSU5JTVVNX1ZP
TFVNRSA9IDAuMDsKKyAgc3RhdGljIGNvbnN0ZXhwciBSZWFsIE1BWElNVU1fVk9MVU1FID0gMS4w
OworICBzdGF0aWMgY29uc3RleHByIFJlYWwgREVGQVVMVF9WT0xVTUUgPSA5MC4wIC8gMTI3LjA7
CiAKIHByaXZhdGU6CiAgIE1vbWVudCBzdGFydF9tb21lbnRfOwotLSAKMi43LjQKCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>
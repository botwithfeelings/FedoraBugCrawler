<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1331834</bug_id>
          
          <creation_ts>2016-04-29 14:12:00 -0400</creation_ts>
          <short_desc>initramfs are no longer hostonly by default</short_desc>
          <delta_ts>2016-06-15 17:49:06 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>spin-kickstarts</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedBlocker</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1230435</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Murphy">bugzilla</reporter>
          <assigned_to name="Jeroen van Meeuwen">vanmeeuwen+fedora</assigned_to>
          <cc>admiller</cc>
    
    
    <cc>atigro</cc>
    
    
    <cc>awilliam</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>bugzilla</cc>
    
    
    <cc>dracut-maint-list</cc>
    
    
    <cc>dustymabe</cc>
    
    
    <cc>harald</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>juliux.pigface</cc>
    
    
    <cc>kevin</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>tflink</cc>
    
    
    <cc>vanmeeuwen+fedora</cc>
    
    
    <cc>vpavlin</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-15 17:49:06</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9280883</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-04-29 14:12:57 -0400</bug_when>
    <thetext>Description of problem:

Fedora 24 initramfs is ~50M, where on Fedora 23 initramfs is ~20M.


Version-Release number of selected component (if applicable):
dracut-044-18.git20160108.fc24
dracut-config-generic-044-18.git20160108.fc24
dracut-live-044-18.git20160108.fc24
dracut-network-044-18.git20160108.fc24
dracut-config-rescue-044-18.git20160108.fc24


How reproducible:
Always


Steps to Reproduce:
1. Do a new installation of Fedora 23
2. Do a new installation of Fedora 24
3. Compare initramfs&apos;s

Actual results:

f23 initramfs varies depending on the host but generally is 17-21M.
f24 initramfs is 49M-50M.

Expected results:

f23 and f24 initramfs&apos;s approximately the same size.

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9280888</commentid>
    <comment_count>1</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-04-29 14:14:00 -0400</bug_when>
    <thetext>If I rebuild the initramfs on the f24 system, it drops to 20M.
dracut -f --hostonly</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9280894</commentid>
    <comment_count>2</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-04-29 14:21:45 -0400</bug_when>
    <thetext>Looks like dracut-config-generic-044-18.git20160108.fc24 is making this happen? It&apos;s installed on f24 systems, but not f23 systems.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9280926</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Blocker Bugs Application">blockerbugs</who>
    <bug_when>2016-04-29 14:40:16 -0400</bug_when>
    <thetext>Proposed as a Freeze Exception for 24-beta by Fedora user chrismurphy using the blocker tracking app because:

 Best if this doesn&apos;t carry forward into beta, since many beta users don&apos;t do clean installs of final.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9280938</commentid>
    <comment_count>4</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-04-29 14:47:27 -0400</bug_when>
    <thetext>So, I&apos;m not actually fully clear on the fix here. 

We could remove the dracut-config-generic from the live&apos;s kickstarts, but does that mean livemedia-creator would make a hostonly initramfs for the live media itself? 

If so, we would need to remove it in the installed system before it generates it&apos;s initramfs. Probibly best to consult with bcl here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9281202</commentid>
    <comment_count>5</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-04-29 17:33:35 -0400</bug_when>
    <thetext>Removing dracut-config-generic from the ks is the right thing to do.

livemedia-creator rebuilds the initrd anyway, making sure livenet, etc. are included and passes it --no-hostonly when it does that. Anaconda regenerates the system initrd after copying over the live image so it will use whatever config is included in the ks. Removing dracut-config-generic results in a hostonly initrd.

I just did a full test and the iso initrd is 36M and the installed system&apos;s is 19M.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9284649</commentid>
    <comment_count>6</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-05-02 08:15:54 -0400</bug_when>
    <thetext>Why did it get pulled in? Is it serving another purpose? Mucking with the generation of initrd while we&apos;re already a week slipped makes me wary. It&apos;s not producing *incorrect* output, just overlarge.

Of course, we also hit the other side of the equation which is that we can&apos;t realistically fix it with an update (since we probably don&apos;t want to force the removal of dracut-config-generic from all systems).

I guess my main concern is whether what I heard in IRC the other day is provably true: Does this cause the /boot partition to fill up if we have three kernels installed? If it does, then I&apos;d actually argue that we should treat this as a blocker, because it&apos;s going to interfere with the Alpha criterion:

&quot;The installed system must be able to download and install updates with the default console package manager.&quot;


If it doesn&apos;t cause that behavior, I think I&apos;m a weak -1 FE simply because I don&apos;t like introducing risk during a slip.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285346</commentid>
    <comment_count>7</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-05-02 10:55:13 -0400</bug_when>
    <thetext>On i686, both PAE and non-PAE kernels are installed, each gets a 50M initrams, and a rescue kernel and initramfs. On clean install with 1 kernel, /boot is 189MB used. I don&apos;t know if updates will continue to update both pae and non-pae kernels, but if so /boot will hit ~430MB used with three kernels installed, and the fourth will fail (four are installed briefly and then the oldest is removed leaving three again).

On x86_64 it&apos;s a non-factor.

It may be a gray area that can be dealt with by documenting it as a common bug for Beta. Strictly speaking the system does update, and more than once.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285469</commentid>
    <comment_count>8</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-05-02 11:24:11 -0400</bug_when>
    <thetext>That&apos;s pretty nasty for i686 though. We don&apos;t *block* on i686-only issues, but I guess I&apos;d be okay with +1 FE to protect against that (since we can&apos;t fix it with an update).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285555</commentid>
    <comment_count>9</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-02 12:03:26 -0400</bug_when>
    <thetext>i686 live images are 400 MB larger than x86_64 images. Cutting down the initramfs size will help with this. (For lives I think we can probably remove the initramfs images, because I don&apos;t think they get used and have added that suggestion to a bug I have filed about the large size difference.)

Unless we slip another week, I think an FE is too risky. If there is time for more than one build to revert the change if necessary, then I think it is worth taking a chance on.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285561</commentid>
    <comment_count>10</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-05-02 12:08:14 -0400</bug_when>
    <thetext>(In reply to Bruno Wolff III from comment #9)
&gt; i686 live images are 400 MB larger than x86_64 images. Cutting down the
&gt; initramfs size will help with this.

? I don&apos;t see how a hostonly initramfs on media is even workable, it&apos;s not generic enough to boot almost anything, which is what&apos;s needed on the media.

&gt; (For lives I think we can probably
&gt; remove the initramfs images, because I don&apos;t think they get used and have
&gt; added that suggestion to a bug I have filed about the large size difference.)

I don&apos;t understand this at all.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285592</commentid>
    <comment_count>11</comment_count>
    <who name="Bruno Wolff III">bruno</who>
    <bug_when>2016-05-02 12:25:43 -0400</bug_when>
    <thetext>Live iamges don&apos;t use the initramfs for booting. It does get copied over on install to hard drive. Appearantly if they are there it confuses grub. They used to be removed but got added back for bug 1214441. There really should be a better fix for that, the doesn&apos;t waste a bunch of space.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9285615</commentid>
    <comment_count>12</comment_count>
    <who name="Tim Flink">tflink</who>
    <bug_when>2016-05-02 12:34:59 -0400</bug_when>
    <thetext>Discussed during the 2016-05-02 blocker review meeting:

Accepted as a beta freeze exception for F24 and we&apos;re willing to run a compose with this change but *only* if there&apos;s sufficient time before the go/no-go date to test it and unwind if things go bad, i.e. on a Monday or earlier. we acknowledge the likely inconvenience for i686 installs</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9379071</commentid>
    <comment_count>13</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-06-01 21:12:09 -0400</bug_when>
    <thetext>This is still a problem with Fedora-Workstation-Live-x86_64-24-20160531.n.0.iso. The initramfs is 50MB. And this is what I get for df -h after a new installation in a VM.

/dev/vda1       477M  142M  306M  32% /boot

Chances are this will accept three more kernels and initramfs, at ~60MB for the lot. (It needs to hold four, the fourth must be installed before the first is removed, with our default limit of three). But it&apos;s kinda tight. In the life of Fedora 24 what are the chances the initramfs gets much bigger and we start seeing failures? Or more likely Fedora 24 to Fedora 25 upgrades?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9379073</commentid>
    <comment_count>14</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-06-01 21:17:12 -0400</bug_when>
    <thetext>I don&apos;t really know the right way to do this to renominate for final freeze exception. I&apos;m going to wipe the Blocks and Whiteboard fields, and put in the bug id for final FE.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9379081</commentid>
    <comment_count>15</comment_count>
    <who name="Chris Murphy">bugzilla</who>
    <bug_when>2016-06-01 21:19:59 -0400</bug_when>
    <thetext>$ rpm -qa | grep dracut
dracut-config-generic-044-18.git20160108.fc24.x86_64
dracut-live-044-18.git20160108.fc24.x86_64
dracut-044-18.git20160108.fc24.x86_64
dracut-network-044-18.git20160108.fc24.x86_64
dracut-config-rescue-044-18.git20160108.fc24.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9379136</commentid>
    <comment_count>16</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-06-01 21:40:59 -0400</bug_when>
    <thetext>I dropped the dracut-config-generic in rawhide branch a while back: 

commit b63ab022d7511670d757a66ade9c9cec0dd4a08d
Author: Kevin Fenzi &lt;kevin@scrye.com&gt;
Date:   Fri Apr 29 15:31:52 2016 -0600

    Drop dracut-config-generic since we don&apos;t want the larger generic initramfses on all installed from live instances.

Can someone check rawhide lives and see that their initramfs&apos;es function and that if installed they default to host only? If that looks good, we can just cherry pick this one commit to the f24 branch.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9383013</commentid>
    <comment_count>17</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-02 20:08:16 -0400</bug_when>
    <thetext>bcl and I think this may possibly be causing https://bugzilla.redhat.com/show_bug.cgi?id=1318045 (which is an F24 Final blocker) too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9383240</commentid>
    <comment_count>18</comment_count>
    <who name="Kevin Fenzi">kevin</who>
    <bug_when>2016-06-02 22:29:54 -0400</bug_when>
    <thetext>PR to pull the change into f24 branch: 

https://pagure.io/fedora-kickstarts/pull-request/26</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9383386</commentid>
    <comment_count>19</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-03 00:18:06 -0400</bug_when>
    <thetext>*** Bug 1318045 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9383388</commentid>
    <comment_count>20</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-03 00:20:51 -0400</bug_when>
    <thetext>so bcl and I are pretty sure that #1318045 - the wrong keymap being used for decryption of encrypted system partitions - is actually just a consequence of this bug. I tested the last Rawhide live nightly that was actually installable - 20160519.n.0 - and indeed found that there is a etc/vconsole.conf in the installed system&apos;s initramfs, and the correct keymap is used for system partition decryption.

Let&apos;s just hope that fixing this doesn&apos;t break anything else :/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9386151</commentid>
    <comment_count>21</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-03 15:05:39 -0400</bug_when>
    <thetext>the dupe was an accepted blocker, copying that status here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9386163</commentid>
    <comment_count>22</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-03 15:11:25 -0400</bug_when>
    <thetext>We&apos;ve merged nirik&apos;s change here:

https://pagure.io/fedora-kickstarts/c/cd2ff0eea2db55947c9826e81b8b001f4fb17223

so this should be ON_QA, the next compose should address it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9411742</commentid>
    <comment_count>23</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-13 18:14:55 -0400</bug_when>
    <thetext>The fact that openQA&apos;s Cyrillic install test is now passing indicates that this is resolved.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9420590</commentid>
    <comment_count>24</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-15 17:49:06 -0400</bug_when>
    <thetext>The spin-kickstarts package has been updated and this fix is in RC-1.2 compose, so I believe we can close this.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
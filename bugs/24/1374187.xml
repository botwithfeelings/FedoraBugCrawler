<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1374187</bug_id>
          
          <creation_ts>2016-09-08 04:27:00 -0400</creation_ts>
          <short_desc>SELinux is preventing /usr/lib/systemd/systemd-journald from &apos;sys_ptrace&apos; accesses on the cap_userns Unknown.</short_desc>
          <delta_ts>2017-01-10 03:18:38 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>selinux-policy</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:aaed1fca824a086e1f06b81b088eb18ea4d9d47c16a6b81f2cda8d2f707337b2;VARIANT_ID=workstation;</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="fred">fredoche</reporter>
          <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
          <cc>daobrien</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>efsnefs</cc>
    
    
    <cc>fedora.243908</cc>
    
    
    <cc>geigor</cc>
    
    
    <cc>jflory7</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>mstuff</cc>
    
    
    <cc>mtinberg</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>yajo.sk8</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>selinux-policy-3.13.1-191.23.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-10 03:18:38</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9689628</commentid>
    <comment_count>0</comment_count>
    <who name="fred">fredoche</who>
    <bug_when>2016-09-08 04:27:45 -0400</bug_when>
    <thetext>Description of problem:
SELinux is preventing /usr/lib/systemd/systemd-journald from &apos;sys_ptrace&apos; accesses on the cap_userns Unknown.

*****  Plugin catchall (100. confidence) suggests   **************************

If vous pensez que systemd-journald devrait être autorisé à accéder sys_ptrace sur Unknown cap_userns par défaut.
Then vous devriez rapporter ceci en tant qu&apos;anomalie.
Vous pouvez générer un module de stratégie local pour autoriser cet accès.
Do
allow this access for now by executing:
# ausearch -c &apos;systemd-journal&apos; --raw | audit2allow -M my-systemdjournal
# semodule -X 300 -i my-systemdjournal.pp

Additional Information:
Source Context                system_u:system_r:syslogd_t:s0
Target Context                system_u:system_r:syslogd_t:s0
Target Objects                Unknown [ cap_userns ]
Source                        systemd-journal
Source Path                   /usr/lib/systemd/systemd-journald
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-191.14.fc24.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     (removed)
Platform                      Linux (removed) 4.7.2-201.fc24.x86_64 #1 SMP Fri
                              Aug 26 15:58:40 UTC 2016 x86_64 x86_64
Alert Count                   107
First Seen                    2016-09-05 14:23:57 CEST
Last Seen                     2016-09-08 10:27:08 CEST
Local ID                      c6f099ef-bbdd-49ae-91b3-a8b1af7044f7

Raw Audit Messages
type=AVC msg=audit(1473323228.146:269): avc:  denied  { sys_ptrace } for  pid=754 comm=&quot;systemd-journal&quot; capability=19  scontext=system_u:system_r:syslogd_t:s0 tcontext=system_u:system_r:syslogd_t:s0 tclass=cap_userns permissive=0


Hash: systemd-journal,syslogd_t,syslogd_t,cap_userns,sys_ptrace

Version-Release number of selected component:
selinux-policy-3.13.1-191.14.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.2-201.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9736659</commentid>
    <comment_count>1</comment_count>
    <who name="fred">fredoche</who>
    <bug_when>2016-09-23 03:50:19 -0400</bug_when>
    <thetext>Description of problem:
boot &amp; start firefox

Version-Release number of selected component:
selinux-policy-3.13.1-191.14.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.3-200.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9747301</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2016-09-27 11:06:46 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9754999</commentid>
    <comment_count>3</comment_count>
    <who name="morgan read">mstuff</who>
    <bug_when>2016-09-29 14:52:18 -0400</bug_when>
    <thetext>Description of problem:
May be started gedit following installing it from a flatpak?

Version-Release number of selected component:
selinux-policy-3.13.1-191.16.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.4-200.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9796496</commentid>
    <comment_count>4</comment_count>
    <who name="Efs">efsnefs</who>
    <bug_when>2016-10-17 06:37:37 -0400</bug_when>
    <thetext>*** Bug 1385577 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9889375</commentid>
    <comment_count>5</comment_count>
    <who name="Yajo">yajo.sk8</who>
    <bug_when>2016-11-14 13:39:05 -0500</bug_when>
    <thetext>Description of problem:
Launch Pitivi from official flatpak when executing by double-click on pitivi-flatpak file and pressing &quot;Execute&quot;.

See http://wiki.pitivi.org/wiki/Install_with_flatpak on how to get that file and how to install Pitivi by flatpak.

Version-Release number of selected component:
selinux-policy-3.13.1-191.19.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.4-200.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9903447</commentid>
    <comment_count>6</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-11-18 08:47:38 -0500</bug_when>
    <thetext>Did anything actually break.  I have a feeling this can be dontaudited.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9907386</commentid>
    <comment_count>7</comment_count>
    <who name="Yajo">yajo.sk8</who>
    <bug_when>2016-11-21 03:03:20 -0500</bug_when>
    <thetext>No, it worked fine.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9913912</commentid>
    <comment_count>8</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-11-22 16:53:34 -0500</bug_when>
    <thetext>Lukas lets add a dontaudit.  Almost no one ever needs SYS_PTRACE.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9914403</commentid>
    <comment_count>9</comment_count>
    <who name="David O&apos;Brien">daobrien</who>
    <bug_when>2016-11-22 21:25:25 -0500</bug_when>
    <thetext>I just hit this on F24 but not sure what I was doing at the time that might have triggered it :(

4.8.8-200.fc24.x86_64

Let&apos;s know if you need more info. If I hit it again or I discover useful info I&apos;ll update here.

thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9944835</commentid>
    <comment_count>11</comment_count>
    <who name="Mark Tinberg">mtinberg</who>
    <bug_when>2016-11-30 15:51:27 -0500</bug_when>
    <thetext>(In reply to Daniel Walsh from comment #6)
&gt; Did anything actually break.  I have a feeling this can be dontaudited.

Not that I have noticed. The AVC denial seems to happen just once on boot.

Source RPM Packages           systemd-231-10.fc25.x86_64         
Policy RPM                    selinux-policy-3.13.1-224.fc25.noarch

According to /usr/lib/systemd/system/systemd-journald.service CapabilityBoundingSet includes CAP_SYS_PTRACE, looks like it&apos;s been that way since 2012 

https://github.com/systemd/systemd/commi/ccd07a083e8040a5bb091c5036ab1b4493ff8363

Maybe I just don&apos;t know how to search but I don&apos;t see a call to ptrace() in the source code, I don&apos;t know what exactly CAP_SYS_PTRACE protects.  Is it choking on allowing the capability to be granted at all, when the process starts, and not on any specific invocation of the ptrace() system call?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9945134</commentid>
    <comment_count>12</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-11-30 17:37:51 -0500</bug_when>
    <thetext>I think it allows a process to look at other processes owned by a different UID memory.  There are fields in /proc, that tell where a processes memory address (Stack) starts, and you need SYS_PTRACE to look at these fields.  Problem is commands like ps can easily trigger this capability, even though the program executing the ps command has no interest in looking at these fields.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9957020</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-05 12:04:03 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-191.23.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-90bd4d7d33</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9962718</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-06 21:57:07 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-191.23.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-90bd4d7d33</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10048156</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-10 03:18:38 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-191.23.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-requests@redhat.com"
>

    <bug>
          <bug_id>1151651</bug_id>
          
          <creation_ts>2014-10-10 19:15:00 -0400</creation_ts>
          <short_desc>localectl: globally changing locale/keymap does not affect initramfs</short_desc>
          <delta_ts>2016-07-20 09:26:56 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>NEXTRELEASE</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1150384</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1059485</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Stadelmann">rhbz2</reporter>
          <assigned_to>systemd-maint</assigned_to>
          <cc>johannbg</cc>
    
    
    <cc>jsynacek</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>rhbz2</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>vpavlin</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-07-20 09:26:56</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>7563682</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2014-10-10 19:15:15 -0400</bug_when>
    <thetext>Description of problem:
changing system virtual console locale/keymap does not affect initramfs

Version-Release number of selected component (if applicable):
F21 Alpha

How reproducible:
always

Steps to Reproduce:
1. change VC keymap using localectl

Actual results:
initramfs is left unchanged

Expected results:
since this keymap affects luks/cryptsetup, the initramfs should be updated with most recent keymap</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7584252</commentid>
    <comment_count>1</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2014-10-16 17:42:32 -0400</bug_when>
    <thetext>In fact localectl affects initramfs, but this takes as long as initramfs is not regenerated. This does not happen by localectl but e.g. on new kernel install.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7591018</commentid>
    <comment_count>2</comment_count>
    <who name="Michal Sekletar">msekleta</who>
    <bug_when>2014-10-20 06:24:17 -0400</bug_when>
    <thetext>localectl is only &quot;front-end&quot; for /etc/locale.conf and /etc/vconsole.conf. Regenerating initramfs image as consequence of running the tool would be very surprising for many users.

Maybe we could add a line to the manpage mentioning that regeneration of initramfs image is advised for some setups, i.e. hard-drives encrypted by luks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7591662</commentid>
    <comment_count>3</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2014-10-20 09:39:41 -0400</bug_when>
    <thetext>... but only for non-host-only images.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7714300</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Synacek">jsynacek</who>
    <bug_when>2014-11-27 09:52:14 -0500</bug_when>
    <thetext>I&apos;m not sure if it will ever be possible to change an initramfs using localectl, but I think that your problem might be solved by https://admin.fedoraproject.org/updates/systemd-216-12.

Could you please try and report back?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7754276</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Synacek">jsynacek</who>
    <bug_when>2014-12-11 03:36:31 -0500</bug_when>
    <thetext>VC font problems were resolved in bug 1150384.

Closing this bug.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7927837</commentid>
    <comment_count>6</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2015-02-11 10:08:12 -0500</bug_when>
    <thetext>@Jan Synacek: This is not related to VC font problems and not to the PolicyKit change in systemd-216-12.
And no, it still doesn&apos;t work to change locale/keymap and afterwards regenerate initramfs. But I see your point that this is not possible as of now without major changes.
Since this is not fixed and neiter of us seems to see an easy way to fix this, I&apos;m marking this bug as WONTFIX.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7927874</commentid>
    <comment_count>7</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2015-02-11 10:19:16 -0500</bug_when>
    <thetext>Why would you mark a bug as WONTFIX? WONTFIX means that the maintainers refuse or cannot fix the bug. So it&apos;s a resolution that can only reasonably be set by a maintainer of the package.

I think Jan changed the status of this bug by mistake: this one is about setting the right config, 1150384 was about applying it during boot. I think we should implement this:

(In reply to Michal Sekletar from comment #2)
&gt; Maybe we could add a line to the manpage mentioning that regeneration of
&gt; initramfs image is advised for some setups, i.e. hard-drives encrypted by
&gt; luks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7928317</commentid>
    <comment_count>8</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2015-02-11 10:58:10 -0500</bug_when>
    <thetext>Sorry.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7928463</commentid>
    <comment_count>9</comment_count>
    <who name="Jóhann B. Guðmundsson">johannbg</who>
    <bug_when>2015-02-11 11:27:04 -0500</bug_when>
    <thetext>(In reply to Zbigniew Jędrzejewski-Szmek from comment #7)
&gt; Why would you mark a bug as WONTFIX? WONTFIX means that the maintainers
&gt; refuse or cannot fix the bug. So it&apos;s a resolution that can only reasonably
&gt; be set by a maintainer of the package.
&gt; 
&gt; I think Jan changed the status of this bug by mistake: this one is about
&gt; setting the right config, 1150384 was about applying it during boot. I think
&gt; we should implement this:

Arguably the regeneration of the initramfs should be strictly handled by the administrator that ran the relevant configuration tool and or edited the configuration file(s) by hand but since you seem to be heading down this road ensure you...

a) handle the use cases where no initramfs is being used ( do nothing ) 
b) notify the user when the command starts regenerating with a msg that the initramfs is being regenerated since it can take some time
c) handle the uses case where the end user manually edits the configuration files</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7928770</commentid>
    <comment_count>10</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2015-02-11 12:03:11 -0500</bug_when>
    <thetext>(In reply to Jóhann B. Guðmundsson from comment #9)
&gt; Arguably the regeneration of the initramfs should be strictly handled by the
&gt; administrator that ran the relevant configuration tool
Exactly. We are only adding a hint to the man page.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8790448</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2015-11-04 10:41:26 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 21 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 21. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;21&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 21 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9522619</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-07-19 08:12:30 -0400</bug_when>
    <thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is
no longer maintained, which means that it will not receive any further
security or bug fix updates. As a result we are closing this bug.

If you can reproduce this bug against a currently maintained version of
Fedora please feel free to reopen this bug against that version. If you
are unable to reopen this bug, please file a new report against the
current release. If you experience problems, please add a comment to this
bug.

Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9525980</commentid>
    <comment_count>13</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-07-19 12:59:21 -0400</bug_when>
    <thetext>https://github.com/systemd/systemd/pull/3754</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9525988</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-07-19 13:01:43 -0400</bug_when>
    <thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is
no longer maintained, which means that it will not receive any further
security or bug fix updates. As a result we are closing this bug.

If you can reproduce this bug against a currently maintained version of
Fedora please feel free to reopen this bug against that version. If you
are unable to reopen this bug, please file a new report against the
current release. If you experience problems, please add a comment to this
bug.

Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9531686</commentid>
    <comment_count>15</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-07-20 07:03:11 -0400</bug_when>
    <thetext>Did you want to mark this as CLOSED WONTFIX? The commit you referenced in comment #13 doesn&apos;t fix this issue but tell the user what to do.

In case you&apos;re interested in fixing this bug, bug #1059485 and bug #1304795 look quite similar. They probably could use the same piece of software to regenerate initramfs, maybe some rpm triggers.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9532404</commentid>
    <comment_count>16</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-07-20 09:26:56 -0400</bug_when>
    <thetext>No, I meant to mark it as NEXTRELEASE, since it will be handled to the little extent that we can in some future version of systemd.

I think the dangers of automatically rebuilding the initramfs are too big. If anything, we should work on a better mechanism to update the boot options, which can achieve the same effect. But as long as grub is the main boot loader, this is too risky and complicated.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
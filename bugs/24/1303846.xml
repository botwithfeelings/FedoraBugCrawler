<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1303846</bug_id>
          
          <creation_ts>2016-02-02 03:41:00 -0500</creation_ts>
          <short_desc>mongod does not start on i686: The default storage engine &apos;wiredTiger&apos; is not available with this build of mongod</short_desc>
          <delta_ts>2016-05-10 04:29:13 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>mongodb</component>
          <version>24</version>
          <rep_platform>i686</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1334640</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Regression</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>1305214</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Pisar">ppisar</reporter>
          <assigned_to name="Marek Skalický">mskalick</assigned_to>
          <cc>admiller</cc>
    
    
    <cc>jdornak</cc>
    
    
    <cc>johan.o.hedin</cc>
    
    
    <cc>jpacner</cc>
    
    
    <cc>mskalick</cc>
    
    
    <cc>npmccallum</cc>
    
    
    <cc>strobert</cc>
    
    
    <cc>tdawson</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>mongodb-3.2.3-2.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-04-06 10:08:02</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9028332</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Pisar">ppisar</who>
    <bug_when>2016-02-02 03:41:16 -0500</bug_when>
    <thetext>Since mongodb-3.2.0, the server refuses to start with an empty database on i686. This is a log from my package using mongod for tests:

+ mkdir test_db
+ mongod --fork --logpath /builddir/build/BUILD/MongoDB-v0.708.4.0/mongod.log --pidfilepath /builddir/build/BUILD/MongoDB-v0.708.4.0/mongod.pid --dbpath /builddir/build/BUILD/MongoDB-v0.708.4.0/test_db/
2016-02-02T08:20:19.367+0000 I CONTROL  [main] 
2016-02-02T08:20:19.367+0000 W CONTROL  [main] 32-bit servers don&apos;t have journaling enabled by default. Please use --journal if you want durability.
2016-02-02T08:20:19.367+0000 I CONTROL  [main] 
about to fork child process, waiting until server is ready for connections.
forked process: 14456
ERROR: child process failed, exited with error number 100
+ test_rc=100
Error: Could not start mongod server
+ &apos;[&apos; -n 100 &apos;]&apos;
+ printf &apos;Error: Could not start mongod server\n&apos;
+ cat mongod.log
2016-02-02T08:20:19.375+0000 I CONTROL  [initandlisten] MongoDB starting : pid=14456 port=27017 dbpath=/builddir/build/BUILD/MongoDB-v0.708.4.0/test_db/ 32-bit host=buildvm-02-nfs.phx2.fedoraproject.org
2016-02-02T08:20:19.375+0000 I CONTROL  [initandlisten] db version v3.2.1
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] git version: a14d55980c2cdc565d4704a7e3ad37e4e535c1b2
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.0.2f-fips  28 Jan 2016
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] allocator: tcmalloc
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] modules: none
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] build environment:
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten]     distarch: i386
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten]     target_arch: i386
2016-02-02T08:20:19.376+0000 I CONTROL  [initandlisten] options: { processManagement: { fork: true, pidFilePath: &quot;/builddir/build/BUILD/MongoDB-v0.708.4.0/mongod.pid&quot; }, storage: { dbPath: &quot;/builddir/build/BUILD/MongoDB-v0.708.4.0/test_db/&quot; }, systemLog: { destination: &quot;file&quot;, path: &quot;/builddir/build/BUILD/MongoDB-v0.708.4.0/mongod.log&quot; } }
2016-02-02T08:20:19.409+0000 I STORAGE  [initandlisten] exception in initAndListen: 28663 Cannot start server. The default storage engine &apos;wiredTiger&apos; is not available with this build of mongod. Please specify a different storage engine explicitly, e.g. --storageEngine=mmapv1., terminating
2016-02-02T08:20:19.409+0000 I CONTROL  [initandlisten] dbexit:  rc: 100
RPM build errors:
+ exit 1

They error message states the mongod defults to wiredTiger storage that is not supported.

I think the server should work with default configuration. Plesse either enable the wiredTiger on i686 or change the default storage to something that is available there.

Tested with mongodb-server-3.2.1-3.fc24.i686.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9029043</commentid>
    <comment_count>1</comment_count>
    <who name="Marek Skalický">mskalick</who>
    <bug_when>2016-02-02 08:02:03 -0500</bug_when>
    <thetext>WiredTiger is not supported on 32 bit architectures, so it is not possible to enable it on i686.
Also 32 bit builds are deprecated sice 3.2 release. And even 32bit binaries downloaded from mongodb.org don&apos;t start with the same error.

There is the bug in Fedora! For i686 it is not specified storage.engie option in mongod.conf file. So mongod won&apos;t start with default config file.

However there is no build option to specify default storage engine on build time (I will ask upstream if I don&apos;t miss something). And in my point of view the supported way of using mongod in Fedora is by systemd service (or at least with default config file) and therefore it is not necessary to somehow patch it to change this upstream behavior. Without default config file, there is simple fix - add &quot;--storageEngine=mmapv1&quot; parameter to the mongod command.

Are you OK with this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9029061</commentid>
    <comment_count>2</comment_count>
    <who name="Petr Pisar">ppisar</who>
    <bug_when>2016-02-02 08:11:56 -0500</bug_when>
    <thetext>That&apos;s your point of view. My point of view is the executable should be modified to default to a storage that is supported in the architecture. In other words, no, I&apos;m not fine with it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9092993</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-02-24 09:23:13 -0500</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 24 development cycle.
Changing version to &apos;24&apos;.

More information and reason for this action is here:
https://fedoraproject.org/wiki/Fedora_Program_Management/HouseKeeping/Fedora24#Rawhide_Rebase</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9194374</commentid>
    <comment_count>4</comment_count>
    <who name="Marek Skalický">mskalick</who>
    <bug_when>2016-03-31 03:11:08 -0400</bug_when>
    <thetext>(In reply to Petr Pisar from comment #2)
&gt; That&apos;s your point of view. My point of view is the executable should be
&gt; modified to default to a storage that is supported in the architecture. In
&gt; other words, no, I&apos;m not fine with it.

This is a reason for default configuration. With your POV every maintainer in Fedora could have to change the code of maintained project to hardcode there every value from default configuration file to be able to be able to run executable without any parameters. For example for databases he should hardcode port, listening interface, database path, socket path,...
This is not the right way!

So I still think this change is not necessary. On the other hand for the backward compatibility it could be better to have default engine working by default since mongod was working this way before.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9195129</commentid>
    <comment_count>5</comment_count>
    <who name="Petr Pisar">ppisar</who>
    <bug_when>2016-03-31 04:02:59 -0400</bug_when>
    <thetext>You already hard-code a default configuration. But the wrong one that leads to a crash.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9195176</commentid>
    <comment_count>6</comment_count>
    <who name="Marek Skalický">mskalick</who>
    <bug_when>2016-03-31 04:19:20 -0400</bug_when>
    <thetext>No no! It is an upstream choice. They decided that storage engine should be configured and they don&apos;t want to support others as a default. It is the same as with other options...

I am building a new version. For the backward compatibility (I think it is your case too) this is fixed for non x86_64 archs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9195266</commentid>
    <comment_count>7</comment_count>
    <who name="Petr Pisar">ppisar</who>
    <bug_when>2016-03-31 04:36:53 -0400</bug_when>
    <thetext>Upstream sometimes does wrong decisions. That&apos;s the place when distribution steps in and either fixes it or removes it from the distribution. I&apos;m glad you decided to fix it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9198982</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-01 03:08:06 -0400</bug_when>
    <thetext>mongodb-3.2.3-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-150e04ec3b</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9199000</commentid>
    <comment_count>9</comment_count>
    <who name="Marek Skalický">mskalick</who>
    <bug_when>2016-04-01 03:11:52 -0400</bug_when>
    <thetext>This bug is fixed in above mentioned update. So please test it...

For Fedora rawhide (F25) builds are not done yet. It is because new version of gcc with fix is failing to build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9201566</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-02 01:25:11 -0400</bug_when>
    <thetext>mongodb-3.2.3-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-150e04ec3b</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9212289</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-04-06 10:07:37 -0400</bug_when>
    <thetext>mongodb-3.2.3-2.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
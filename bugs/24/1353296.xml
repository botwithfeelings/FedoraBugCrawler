<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1353296</bug_id>
          
          <creation_ts>2016-07-06 13:59:00 -0400</creation_ts>
          <short_desc>Libvirt fails to validate following virsh edit. XML created by virt-manager.</short_desc>
          <delta_ts>2017-05-18 16:59:03 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>libvirt</component>
          <version>24</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Upstream</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Griffith">EGriffith92</reporter>
          <assigned_to name="Libvirt Maintainers">libvirt-maint</assigned_to>
          <cc>agedosier</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>clalancette</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jtomko</cc>
    
    
    <cc>laine</cc>
    
    
    <cc>libvirt-maint</cc>
    
    
    <cc>mprivozn</cc>
    
    
    <cc>veillard</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>libvirt-1.3.3.3-1.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-05-18 16:59:03</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9485003</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Griffith">EGriffith92</who>
    <bug_when>2016-07-06 13:59:55 -0400</bug_when>
    <thetext>I&apos;m not sure who&apos;s technically at fault here, because I&apos;m not sure what part libvirt thinks is in violation. But, the following XML file fails to validate against libvirt&apos;s Domain.rng schema. The following XML was created by virt-manager, and will fail to validate, even if all I change is bumping the memory by 1 KiB. 

&lt;domain type=&apos;kvm&apos;&gt;
  &lt;name&gt;Windows_10_Pro&lt;/name&gt;
  &lt;uuid&gt;(censored)&lt;/uuid&gt;
  &lt;memory unit=&apos;KiB&apos;&gt;12288000&lt;/memory&gt;
  &lt;currentMemory unit=&apos;KiB&apos;&gt;12288000&lt;/currentMemory&gt;
  &lt;vcpu placement=&apos;static&apos;&gt;4&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch=&apos;x86_64&apos; machine=&apos;pc-i440fx-2.6&apos;&gt;hvm&lt;/type&gt;
    &lt;loader readonly=&apos;yes&apos; type=&apos;pflash&apos;&gt;/usr/share/edk2/ovmf/OVMF_CODE.fd&lt;/loader&gt;
    &lt;nvram&gt;/var/lib/libvirt/qemu/nvram/Windows_10_Pro_VARS.fd&lt;/nvram&gt;
    &lt;bootmenu enable=&apos;yes&apos;/&gt;
  &lt;/os&gt;
  &lt;features&gt;
    &lt;acpi/&gt;
    &lt;apic/&gt;
    &lt;hyperv&gt;
      &lt;relaxed state=&apos;on&apos;/&gt;
      &lt;vapic state=&apos;on&apos;/&gt;
      &lt;spinlocks state=&apos;on&apos; retries=&apos;8191&apos;/&gt;
    &lt;/hyperv&gt;
    &lt;vmport state=&apos;off&apos;/&gt;
  &lt;/features&gt;
  &lt;cpu mode=&apos;host-passthrough&apos;&gt;
    &lt;topology sockets=&apos;1&apos; cores=&apos;4&apos; threads=&apos;1&apos;/&gt;
  &lt;/cpu&gt;
  &lt;clock offset=&apos;localtime&apos;&gt;
    &lt;timer name=&apos;rtc&apos; tickpolicy=&apos;catchup&apos;/&gt;
    &lt;timer name=&apos;pit&apos; tickpolicy=&apos;delay&apos;/&gt;
    &lt;timer name=&apos;hpet&apos; present=&apos;no&apos;/&gt;
    &lt;timer name=&apos;hypervclock&apos; present=&apos;yes&apos;/&gt;
  &lt;/clock&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;pm&gt;
    &lt;suspend-to-mem enabled=&apos;no&apos;/&gt;
    &lt;suspend-to-disk enabled=&apos;no&apos;/&gt;
  &lt;/pm&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type=&apos;file&apos; device=&apos;disk&apos;&gt;
      &lt;driver name=&apos;qemu&apos; type=&apos;qcow2&apos; cache=&apos;none&apos; io=&apos;native&apos;/&gt;
      &lt;source file=&apos;/mnt/Data/Virtual Machines/virt-manager/Windows_10_Pro.qcow2&apos;/&gt;
      &lt;target dev=&apos;sda&apos; bus=&apos;scsi&apos;/&gt;
      &lt;boot order=&apos;1&apos;/&gt;
      &lt;address type=&apos;drive&apos; controller=&apos;0&apos; bus=&apos;0&apos; target=&apos;0&apos; unit=&apos;0&apos;/&gt;
    &lt;/disk&gt;
    &lt;disk type=&apos;file&apos; device=&apos;cdrom&apos;&gt;
      &lt;driver name=&apos;qemu&apos; type=&apos;raw&apos;/&gt;
      &lt;source file=&apos;/mnt/Data/Virtual Machines/virt-manager/virtio-win-0.1.102.iso&apos;/&gt;
      &lt;target dev=&apos;hdb&apos; bus=&apos;ide&apos;/&gt;
      &lt;readonly/&gt;
      &lt;address type=&apos;drive&apos; controller=&apos;0&apos; bus=&apos;0&apos; target=&apos;0&apos; unit=&apos;1&apos;/&gt;
    &lt;/disk&gt;
    &lt;controller type=&apos;pci&apos; index=&apos;0&apos; model=&apos;pci-root&apos;/&gt;
    &lt;controller type=&apos;ide&apos; index=&apos;0&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x01&apos; function=&apos;0x1&apos;/&gt;
    &lt;/controller&gt;
    &lt;controller type=&apos;virtio-serial&apos; index=&apos;0&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x05&apos; function=&apos;0x0&apos;/&gt;
    &lt;/controller&gt;
    &lt;controller type=&apos;sata&apos; index=&apos;0&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x07&apos; function=&apos;0x0&apos;/&gt;
    &lt;/controller&gt;
    &lt;controller type=&apos;usb&apos; index=&apos;0&apos; model=&apos;nec-xhci&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x06&apos; function=&apos;0x0&apos;/&gt;
    &lt;/controller&gt;
    &lt;controller type=&apos;scsi&apos; index=&apos;0&apos; model=&apos;virtio-scsi&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x0b&apos; function=&apos;0x0&apos;/&gt;
    &lt;/controller&gt;
    &lt;interface type=&apos;network&apos;&gt;
      &lt;mac address=&apos;52:54:00:c2:73:bc&apos;/&gt;
      &lt;source network=&apos;default&apos;/&gt;
      &lt;model type=&apos;virtio&apos;/&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x03&apos; function=&apos;0x0&apos;/&gt;
    &lt;/interface&gt;
    &lt;serial type=&apos;pty&apos;&gt;
      &lt;target port=&apos;0&apos;/&gt;
    &lt;/serial&gt;
    &lt;console type=&apos;pty&apos;&gt;
      &lt;target type=&apos;serial&apos; port=&apos;0&apos;/&gt;
    &lt;/console&gt;
    &lt;input type=&apos;mouse&apos; bus=&apos;ps2&apos;/&gt;
    &lt;input type=&apos;keyboard&apos; bus=&apos;ps2&apos;/&gt;
    &lt;sound model=&apos;ich6&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x04&apos; function=&apos;0x0&apos;/&gt;
    &lt;/sound&gt;
    &lt;hostdev mode=&apos;subsystem&apos; type=&apos;pci&apos; managed=&apos;yes&apos;&gt;
      &lt;source&gt;
        &lt;address domain=&apos;0x0000&apos; bus=&apos;0x01&apos; slot=&apos;0x00&apos; function=&apos;0x0&apos;/&gt;
      &lt;/source&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x02&apos; function=&apos;0x0&apos;/&gt;
    &lt;/hostdev&gt;
    &lt;hostdev mode=&apos;subsystem&apos; type=&apos;pci&apos; managed=&apos;yes&apos;&gt;
      &lt;source&gt;
        &lt;address domain=&apos;0x0000&apos; bus=&apos;0x01&apos; slot=&apos;0x00&apos; function=&apos;0x1&apos;/&gt;
      &lt;/source&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x0a&apos; function=&apos;0x0&apos;/&gt;
    &lt;/hostdev&gt;
    &lt;memballoon model=&apos;virtio&apos;&gt;
      &lt;address type=&apos;pci&apos; domain=&apos;0x0000&apos; bus=&apos;0x00&apos; slot=&apos;0x08&apos; function=&apos;0x0&apos;/&gt;
    &lt;/memballoon&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9485013</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Griffith">EGriffith92</who>
    <bug_when>2016-07-06 14:01:41 -0400</bug_when>
    <thetext>Error is: 

error: XML document failed to validate against schema: Unable to validate doc against /usr/share/libvirt/schemas/domain.rng
Extra element devices in interleave
Element domain failed to validate content</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9486506</commentid>
    <comment_count>2</comment_count>
    <who name="Ján Tomko">jtomko</who>
    <bug_when>2016-07-07 04:44:07 -0400</bug_when>
    <thetext>domain.rng is overly restrictive about path names:
test.xml:43:84: error: value of attribute &quot;file&quot; is invalid; must be a string matching the regular expression &quot;/[a-zA-Z0-9_\.\+\-\\&amp;&quot;&apos;&lt;&gt;/%,:]+&quot;


As a workaround, you can use &apos;i&apos; to ignore the validation error:

Element domain failed to validate content
Failed. Try again? [y,n,i,f,?]: ?
...
i - turn off validation and try to redefine again</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9608253</commentid>
    <comment_count>3</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-08-11 13:39:56 -0400</bug_when>
    <thetext>Particularly in this case it&apos;s rejecting the space in the filename, even though it&apos;s a valid path, and libvirt will handle it correctly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9614312</commentid>
    <comment_count>4</comment_count>
    <who name="Michal Privoznik">mprivozn</who>
    <bug_when>2016-08-15 04:34:30 -0400</bug_when>
    <thetext>I&apos;ve just pushed the patch upstream:

commit c4b92f1a8a9cb64a2c4a9f0ed899ed8a7d95d935
Author:     Michal Privoznik &lt;mprivozn@redhat.com&gt;
AuthorDate: Fri Aug 12 10:52:30 2016 +0200
Commit:     Michal Privoznik &lt;mprivozn@redhat.com&gt;
CommitDate: Fri Aug 12 10:59:21 2016 +0200

    schema: Don&apos;t validate paths
    
    https://bugzilla.redhat.com/show_bug.cgi?id=1353296
    
    On UNIX like systems there are no constraints on what characters
    can be in file/dir names (except for NULL, obviously). Moreover,
    some values that we think of as paths (e.g. disk source) are not
    necessarily paths at all. For instance, some hypervisors take
    that as an arbitrary identifier and corresponding file is then
    looked up by hypervisor in its table. Instead of trying to fix
    our regular expressions (and forgetting to include yet another
    character there), lets drop the validation completely.
    
    Signed-off-by: Michal Privoznik &lt;mprivozn@redhat.com&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9702167</commentid>
    <comment_count>5</comment_count>
    <who name="Christophe Fergeau">cfergeau</who>
    <bug_when>2016-09-13 06:14:22 -0400</bug_when>
    <thetext>Just hit this issue, would be great to have this fixed in the  f24 package :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10402069</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-10 18:01:10 -0400</bug_when>
    <thetext>libvirt-1.3.3.3-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-6055198a14</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10409169</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-12 18:33:49 -0400</bug_when>
    <thetext>libvirt-1.3.3.3-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-6055198a14</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10427061</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-18 16:59:03 -0400</bug_when>
    <thetext>libvirt-1.3.3.3-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
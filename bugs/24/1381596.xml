<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1381596</bug_id>
          
          <creation_ts>2016-10-04 10:01:00 -0400</creation_ts>
          <short_desc>SELinux is preventing worker from &apos;read&apos; accesses on the blk_file /dev/dm-11.</short_desc>
          <delta_ts>2016-10-07 02:03:04 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1381468</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1147910</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1378974</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:c51767bcc139188e5b1b213bea45fd8f49bffe649ea55dc4f1641ab3b7eb9c6f;VARIANT_ID=workstation;</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ting-Wei Lan">lantw44</reporter>
          <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
          <cc>agedosier</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>clalancette</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>johannbg</cc>
    
    
    <cc>laine</cc>
    
    
    <cc>libvirt-maint</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>muadda</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>pmoore</cc>
    
    
    <cc>ssahani</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>veillard</cc>
    
    
    <cc>virt-maint</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>systemd-229-16.fc24</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-07 02:03:04</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9764805</commentid>
    <comment_count>0</comment_count>
    <who name="Ting-Wei Lan">lantw44</who>
    <bug_when>2016-10-04 10:01:36 -0400</bug_when>
    <thetext>Description of problem:
This problem happens after running &apos;dnf upgrade&apos;. Virtual machines are no longer able to access their disks because the user, group, and SELinux context of disk files are reset to the default. This usually causes virtual machines to stop working or crash.
This problem is not always reproducible because most updates don&apos;t trigger it. Only a few updates can cause this problem.
SELinux is preventing worker from &apos;read&apos; accesses on the blk_file /dev/dm-11.

*****  Plugin catchall (100. confidence) suggests   **************************

If 您認為 worker 就預設值應擁有 dm-11 blk_file 的 read 存取權。
Then 您應將此回報為錯誤。
您可產生本機模組，以允許這項存取。
Do
allow this access for now by executing:
# ausearch -c &apos;worker&apos; --raw | audit2allow -M my-worker
# semodule -X 300 -i my-worker.pp

Additional Information:
Source Context                system_u:system_r:svirt_t:s0:c645,c843
Target Context                system_u:object_r:fixed_disk_device_t:s0
Target Objects                /dev/dm-11 [ blk_file ]
Source                        worker
Source Path                   worker
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-191.16.fc24.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     (removed)
Platform                      Linux (removed) 4.7.4-200.fc24.x86_64 #1 SMP Thu
                              Sep 15 18:42:09 UTC 2016 x86_64 x86_64
Alert Count                   3
First Seen                    2016-10-04 20:51:14 CST
Last Seen                     2016-10-04 20:51:14 CST
Local ID                      650fd888-20dc-4f2d-8d49-afa7aaf6cd10

Raw Audit Messages
type=AVC msg=audit(1475585474.117:3088): avc:  denied  { read } for  pid=13158 comm=&quot;worker&quot; path=&quot;/dev/dm-11&quot; dev=&quot;devtmpfs&quot; ino=13533 scontext=system_u:system_r:svirt_t:s0:c645,c843 tcontext=system_u:object_r:fixed_disk_device_t:s0 tclass=blk_file permissive=0


Hash: worker,svirt_t,fixed_disk_device_t,blk_file,read

Version-Release number of selected component:
selinux-policy-3.13.1-191.16.fc24.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.7.4-200.fc24.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9767407</commentid>
    <comment_count>1</comment_count>
    <who name="Ting-Wei Lan">lantw44</who>
    <bug_when>2016-10-05 06:09:33 -0400</bug_when>
    <thetext>I found the problem can be reproduced by running &apos;systemctl try-restart systemd-udev-trigger.service&apos;. This command is included in systemd-udev scriptlets, so it can also happen when updating systemd.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9769247</commentid>
    <comment_count>2</comment_count>
    <who name="Ting-Wei Lan">lantw44</who>
    <bug_when>2016-10-05 16:02:43 -0400</bug_when>
    <thetext>Move it to systemd because it is a change in systemd.spec that causes the issue to become annoying and easily reproducible:

http://pkgs.fedoraproject.org/cgit/rpms/systemd.git/commit/?id=c16b573</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9770747</commentid>
    <comment_count>3</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-06 07:02:36 -0400</bug_when>
    <thetext>Looks like udev or something changed the label on this device.  Looks like another good reason not to do dnf upgrade on a running machine.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9772574</commentid>
    <comment_count>4</comment_count>
    <who name="Ting-Wei Lan">lantw44</who>
    <bug_when>2016-10-07 02:03:04 -0400</bug_when>
    <thetext>Thia problem has been fixed by removing &apos;systemctl try-restart systemd-udev-trigger.service&apos; in systemd.spec.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
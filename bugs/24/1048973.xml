<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1048973</bug_id>
          
          <creation_ts>2014-01-06 11:30:00 -0500</creation_ts>
          <short_desc>[rfe] repo priorities and costs</short_desc>
          <delta_ts>2016-04-19 09:03:29 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>high</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1328467</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="MaxiPunkt">maxantispam</reporter>
          <assigned_to>packaging-team-maint</assigned_to>
          <cc>akozumpl</cc>
    
    
    <cc>gotwig</cc>
    
    
    <cc>jzeleny</cc>
    
    
    <cc>langdon</cc>
    
    
    <cc>lkocman</cc>
    
    
    <cc>pnemade</cc>
    
    
    <cc>rholy</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>hawkey-0.4.18-2.fc20</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-04-19 09:03:29</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      <flag name="needinfo"
          id="2624706"
          type_id="16"
          status="?"
          setter="lkocman"
          requestee="langdon"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>6677256</commentid>
    <comment_count>0</comment_count>
    <who name="MaxiPunkt">maxantispam</who>
    <bug_when>2014-01-06 11:30:10 -0500</bug_when>
    <thetext>Description of problem:
Wanted do give dnf/PackageKit-hawkey a try.
Beside official Fedora-repos I&apos;m using my own, local repo.

This repo has high priority-setting:
[repo-maxipunkt]
name=Repo-MaxiPunkt for Fedora $releasever - $basearch
baseurl=file:///var/cache/repo-maxipunkt/
enabled=1
priority=1
...
...

yum/PackageKit-yum does honor this priority-setting, if &quot;yum-plugin-priorities&quot; is installed - meaning my own packages won&apos;t be replaced by other (newer) versions beloning to other repos, when doing a &quot;yum update&quot;.


But dnf/PackageKit-hawkey doesn&apos;t care about &quot;priority=1&quot; and wants to update my packages, when doing an update.


Version-Release number of selected component (if applicable):
* dnf-0.4.10-1.fc20.noarch
* PackageKit-hawkey-0.8.15-1.fc20.x86_64



Must priority-setting be done in a different way for dnf/hawkey, or is this &quot;just&quot; a feature still to come?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6677342</commentid>
    <comment_count>1</comment_count>
    <who name="Ales Kozumplik">akozumpl</who>
    <bug_when>2014-01-06 11:52:49 -0500</bug_when>
    <thetext>Hey there, thanks for the report. The priorities option is supplied by the yum-plugin-priorities plugin which is not available for DNF yet. Assigning this somewhat lower priority for now, several pieces in the DNF API are missing yet to make an implementation possible.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7141866</commentid>
    <comment_count>2</comment_count>
    <who name="Eduard Gotwig">gotwig</who>
    <bug_when>2014-06-03 07:30:27 -0400</bug_when>
    <thetext>I depend on this function.

Is there no change for more than 5 months?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7176891</commentid>
    <comment_count>3</comment_count>
    <who name="Ales Kozumplik">akozumpl</who>
    <bug_when>2014-06-12 04:07:40 -0400</bug_when>
    <thetext>Hello Eduard, there has been many changes since January, see e.g. [1]

[1] https://github.com/akozumpl/dnf/commits/master</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7288929</commentid>
    <comment_count>4</comment_count>
    <who name="Ales Kozumplik">akozumpl</who>
    <bug_when>2014-07-14 08:22:37 -0400</bug_when>
    <thetext>Added with 5928785.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7290321</commentid>
    <comment_count>5</comment_count>
    <who name="MaxiPunkt">maxantispam</who>
    <bug_when>2014-07-14 13:21:34 -0400</bug_when>
    <thetext>Cool, thanks!

Would be great if you would backport next release of dnf including this fix to FC20 (official update-repos)...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7299889</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2014-07-17 02:42:34 -0400</bug_when>
    <thetext>hawkey-0.4.18-2.fc20, dnf-0.5.4-1.fc20, libsolv-0.6.4-0.git2a5c1c4.fc20 has been submitted as an update for Fedora 20.
https://admin.fedoraproject.org/updates/hawkey-0.4.18-2.fc20,dnf-0.5.4-1.fc20,libsolv-0.6.4-0.git2a5c1c4.fc20</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7307130</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2014-07-19 02:03:03 -0400</bug_when>
    <thetext>hawkey-0.4.18-2.fc20, dnf-0.5.4-1.fc20, libsolv-0.6.4-0.git2a5c1c4.fc20 has been pushed to the Fedora 20 stable repository.  If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7338184</commentid>
    <comment_count>8</comment_count>
    <who name="MaxiPunkt">maxantispam</who>
    <bug_when>2014-07-29 15:26:23 -0400</bug_when>
    <thetext>Sorry, this fix doesn&apos;t work for me:

I&apos;ve updated my system to new dnf/hawkey-version.
Some days later there are new updates are available for my system:

# yum update
Geladene Plugins: langpacks, priorities, refresh-packagekit
repo-maxipunkt                                                                                                    | 2.9 kB  00:00:00     
72 packages excluded due to repository priority protections
Abhängigkeiten werden aufgelöst
--&gt; Transaktionsprüfung wird ausgeführt
---&gt; Paket fxload.x86_64 0:2002_04_11-14.fc20 markiert, um aktualisiert zu werden
---&gt; Paket fxload.x86_64 0:2008_10_13-1.fc20 markiert, um eine Aktualisierung zu werden
---&gt; Paket qt.x86_64 1:4.8.6-9.fc20.1 markiert, um aktualisiert zu werden
---&gt; Paket qt.x86_64 1:4.8.6-10.fc20 markiert, um eine Aktualisierung zu werden
---&gt; Paket qt-devel.x86_64 1:4.8.6-9.fc20.1 markiert, um aktualisiert zu werden
---&gt; Paket qt-devel.x86_64 1:4.8.6-10.fc20 markiert, um eine Aktualisierung zu werden
---&gt; Paket qt-mysql.x86_64 1:4.8.6-9.fc20.1 markiert, um aktualisiert zu werden
---&gt; Paket qt-mysql.x86_64 1:4.8.6-10.fc20 markiert, um eine Aktualisierung zu werden
---&gt; Paket qt-x11.x86_64 1:4.8.6-9.fc20.1 markiert, um aktualisiert zu werden
---&gt; Paket qt-x11.x86_64 1:4.8.6-10.fc20 markiert, um eine Aktualisierung zu werden
--&gt; Abhängigkeitsauflösung beendet
...
...
...

To be able to test new dnf-version, I have canceled these yum-updates.


But new dnf-version doesn&apos;t find ANY updates.
At least it doesn&apos;t try to overwrite my personal RPM&apos;s with higher priority-setting anymore:

# dnf update
Repo-MaxiPunkt for Fedora 20 - x86_64                                                                     11 MB/s | 110 kB     00:00    
Abhängigkeiten sind aufgelöst.
Nichts zu tun.


To be able to test new hawkey-version, I have uninstalled yum-backend for packagekit:
# yum erase PackageKit-yum

# pkcon backend-details
Name:           hawkey
Description:    Hawkey
Author: Richard Hughes &lt;richard@hughsie.com&gt;


# pkcon get-updates
Aktualisierungen werden abgerufen[=========================]         
Warten in Warteschlange       [=========================]         
Fertig                        [=========================]         
Normal          audiofile-1:0.3.6-2.fc20.x86_64 (fedora)                        A library for accessing various audio file formats
Normal          audiofile-devel-1:0.3.6-2.fc20.x86_64 (fedora)                  Development files for Audio File applications
Normal          fxload-2008_10_13-1.fc20.x86_64 (updates)                       A helper program to download firmware into FX and FX2 EZ-USB devices
Normal          gpsd-3.9-4.fc20.x86_64 (updates)                                Service daemon for mediating access to a GPS
Normal          gpsd-devel-3.9-4.fc20.x86_64 (updates)                          Development files for the gpsd library
Normal          gpsd-libs-3.9-4.fc20.x86_64 (updates)                           Client libraries in C and Python for talking to a running gpsd or GPS
Normal          kde-plasma-translatoid-1.30-10.svn01092011.fc20.x86_64 (fedora) Translator Using Google Translator
Normal          libzen-0.4.29-2.fc20.x86_64 (fedora)                            Shared library for libmediainfo and medianfo*
Normal          libzen-devel-0.4.29-2.fc20.x86_64 (fedora)                      Include files and mandatory libraries for development
Normal          qmmp-0.7.7-1.fc20.1.x86_64 (updates)                            Qt-based multimedia player
Normal          qt-1:4.8.6-10.fc20.x86_64 (updates)                             Qt toolkit
Normal          qt-devel-1:4.8.6-10.fc20.x86_64 (updates)                       Development files for the Qt toolkit
Normal          qt-mysql-1:4.8.6-10.fc20.x86_64 (updates)                       MySQL driver for Qt&apos;s SQL classes
Normal          qt-x11-1:4.8.6-10.fc20.x86_64 (updates)                         Qt GUI-related libraries
Normal          soxr-0.1.1-2.fc20.x86_64 (fedora)                               The SoX Resampler library
Normal          soxr-devel-0.1.1-2.fc20.x86_64 (fedora)                         Development files for soxr
Normal          tinyxml2-1.0.11-3.20130805git0323851.fc20.x86_64 (fedora)       Simple, small and efficient C++ XML parser
Normal          tinyxml2-devel-1.0.11-3.20130805git0323851.fc20.x86_64 (fedora) Development files for tinyxml2


New hawkey-version does find the updates, BUT
it also wants to overwrite my personal RPM&apos;s with higher priority-setting!


So beside the other issue (dnf can&apos;t find updates available),
there still something is wrong with your recent fix.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9250726</commentid>
    <comment_count>9</comment_count>
    <who name="Lubos Kocman">lkocman</who>
    <bug_when>2016-04-19 08:24:15 -0400</bug_when>
    <thetext>Hi team

It&apos;s not working at all. This is currently a blocker for modularity project.

Why is it a blocker?

I can&apos;t use pungi&apos;s lookaside (hey if something is in this repo with super high priority ... don&apos;t make it part of result (e.g. this is already in another module). Both priority and cost are totally ignored and I can&apos;t really say what repo will be the result of query from :-P

Lubos</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9250853</commentid>
    <comment_count>10</comment_count>
    <who name="Lubos Kocman">lkocman</who>
    <bug_when>2016-04-19 09:03:29 -0400</bug_when>
    <thetext>Closing this particular bug, as it fixes one usecase. My usecase (.query()) is tracked in Bug 1328467

Lubos</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
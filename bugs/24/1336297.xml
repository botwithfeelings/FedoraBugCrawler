<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1336297</bug_id>
          
          <creation_ts>2016-05-16 02:55:00 -0400</creation_ts>
          <short_desc>Bluetooth mouse doesn&apos;t work after resume with kernel 4.5.4</short_desc>
          <delta_ts>2016-06-28 19:33:59 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>kernel</component>
          <version>24</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>NEXTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Bojan Smojver">bojan</reporter>
          <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
          <cc>bojan</cc>
    
    
    <cc>david.ward</cc>
    
    
    <cc>devin</cc>
    
    
    <cc>dimitris</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>dzickus</cc>
    
    
    <cc>gansalmon</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>marcel</cc>
    
    
    <cc>mchehab</cc>
    
    
    <cc>robin.a.meade</cc>
    
    
    <cc>s.gendre</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-06-28 19:33:59</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="Linux Kernel">118471</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9328508</commentid>
    <comment_count>0</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-16 02:55:08 -0400</bug_when>
    <thetext>Description of problem:
Upon resume, bluetooth mouse (in this case Logitech M337) does not connect any more. Only trackpad available on this ThinkPad T450s.

Version-Release number of selected component (if applicable):
kernel-4.5.4-200.fc23

How reproducible:
Always.

Steps to Reproduce:
1. Boot, use mouse.
2. Suspend/resume.
3. No mouse (bluetooth connection does not appear).

Actual results:
Mouse unavailable.

Expected results:
Works with 4.4.9-300.fc23.

Additional info:
Quick search suggests 2ff13894cfb877cb3d02d96a8402202f0a6f3efd as the start of &quot;bad&quot; commits related to Bluetooth problems. See: http://lkml.iu.edu/hypermail/linux/kernel/1602.2/02725.html. Not Fedora specific, so I&apos;m guessing this would be affecting F-24 and rawhide too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9330641</commentid>
    <comment_count>1</comment_count>
    <who name="Dimitris">dimitris</who>
    <bug_when>2016-05-16 12:58:54 -0400</bug_when>
    <thetext>Seeing the same with F23 on a Thinkpad X250.  Bluetooth (mouse but also PAN) worked flawlessly up to 4.4.9-300.  With 4.5.4-200, bluetooth mouse and PAN don&apos;t work on resume from suspend.

FWIW, I can restore BT with &quot;systemctl restart bluetooth.service&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9331445</commentid>
    <comment_count>2</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-16 19:47:07 -0400</bug_when>
    <thetext>Possibly related, I also noticed problems with my XT1562 phone when BT connection is attempted to the laptop running 4.5.4 kernel. It (supposedtly) successfully pairs the device, but then disconnects.

Reverting to 4.4.9 kernel and pairing again makes everything normal. Just FYI.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9331680</commentid>
    <comment_count>3</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-16 21:41:12 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #2)
&gt; Possibly related, I also noticed problems with my XT1562 phone when BT
&gt; connection is attempted to the laptop running 4.5.4 kernel. It (supposedtly)
&gt; successfully pairs the device, but then disconnects.

Log has (for kernel 4.5.4):

May 14 10:23:43 &lt;hostname&gt; bluetoothd[927]: Access denied: Rejecting service auth (0000110d-0000-1000-8000-00805f9b34fb) for /org/bluez/hci0/dev_E0_98_61_D6_2A_E6: not HID</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9335665</commentid>
    <comment_count>4</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-17 22:26:31 -0400</bug_when>
    <thetext>I see a whole lot of new firmwares for various Intel hardware has been pushed to testing. I&apos;m guessing some of those updates may affect Bluetooth as well.

Anyone cares to venture a guess whether testing 4.5.4 with the new firmware would produce different results?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9335775</commentid>
    <comment_count>5</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-17 22:58:17 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #4)
&gt; I see a whole lot of new firmwares for various Intel hardware has been
&gt; pushed to testing. I&apos;m guessing some of those updates may affect Bluetooth
&gt; as well.
&gt; 
&gt; Anyone cares to venture a guess whether testing 4.5.4 with the new firmware
&gt; would produce different results?

Just tried that. No dice.

The restart of bluetooth.service does reconnect the mouse. And the phone can connect too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9335870</commentid>
    <comment_count>6</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-18 00:19:16 -0400</bug_when>
    <thetext>Here are the error messages from the log when manual connection is attempted to the mouse (without restarting the service on resume):

May 18 14:11:49 &lt;host&gt; bluetoothd[13349]: Can&apos;t get HIDP connection info
May 18 14:11:49 &lt;host&gt; bluetoothd[13349]: connect error: Device or resource busy (16)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9339510</commentid>
    <comment_count>7</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-19 01:25:39 -0400</bug_when>
    <thetext>Is it possible that this is some kind of user space bug triggered by changes in the kernel? Given that a restart of bluetooth.service makes the whole thing work again, maybe that is where the bug is...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9366038</commentid>
    <comment_count>8</comment_count>
    <who name="Dimitris">dimitris</who>
    <bug_when>2016-05-27 13:07:38 -0400</bug_when>
    <thetext>By the way, suspend/resume is not required to reproduce this:

- Bluetooth mouse working.
- From GNOME settings, turn bluetooth off.
- Turn mouse&apos;s own hw switch off.
- GNOME settings, bluetooth on.
- Moush switch on.
- Move mouse, wait for quite a while, no pointer movement.
- systemctl restart bluetooth.service
- Mouse works again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9366042</commentid>
    <comment_count>9</comment_count>
    <who name="Dimitris">dimitris</who>
    <bug_when>2016-05-27 13:10:30 -0400</bug_when>
    <thetext>See also: https://bugzilla.redhat.com/show_bug.cgi?id=988481#c45</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9367164</commentid>
    <comment_count>10</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-28 23:12:07 -0400</bug_when>
    <thetext>Are we thinking this is a userspace bug?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9367634</commentid>
    <comment_count>11</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-29 22:16:30 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #10)
&gt; Are we thinking this is a userspace bug?

bluez 5.40 is out, so maybe we should try that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9367662</commentid>
    <comment_count>12</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-05-29 22:23:40 -0400</bug_when>
    <thetext>Assigning to bluez component until 5.40 gets built. Maybe that&apos;s the key to solving this problem.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9369906</commentid>
    <comment_count>13</comment_count>
    <who name="Dimitris">dimitris</who>
    <bug_when>2016-05-30 17:17:40 -0400</bug_when>
    <thetext>5.40 changelog has a couple of interesting-looking items:

ver 5.40:
        Fix issue with not storing GATT attributes.
        Fix issue with optional GATT notifications.
        Fix issue with reading GATT extended properties.
        Fix issue with GATT device name properties.
        Fix issue with previously paired devices.
        Fix issue with handling device removal.
        Fix issue with profile connection handling.
        Add support for TTY monitor protocol.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9411844</commentid>
    <comment_count>14</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-06-13 19:16:42 -0400</bug_when>
    <thetext>Assigning back to kernel and moving to F24, where this problem still exists, despite bluez 5.40.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9452964</commentid>
    <comment_count>15</comment_count>
    <who name="David Ward">david.ward</who>
    <bug_when>2016-06-26 06:19:33 -0400</bug_when>
    <thetext>@Bojan, from your comment on kernel-4.6.3-300.fc24: https://bodhi.fedoraproject.org/updates/kernel-4.6.3-300.fc24#comment-451180

Is this perhaps a duplicate of bug 1338025?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9453023</commentid>
    <comment_count>16</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-06-26 07:42:16 -0400</bug_when>
    <thetext>(In reply to David Ward from comment #15)
&gt; @Bojan, from your comment on kernel-4.6.3-300.fc24:
&gt; https://bodhi.fedoraproject.org/updates/kernel-4.6.3-300.fc24#comment-451180
&gt; 
&gt; Is this perhaps a duplicate of bug 1338025?

That other bug seems to be about wireless and Atheos chipset. This is about Bluetooth with Intel. So, probably different...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9453099</commentid>
    <comment_count>17</comment_count>
    <who name="David Ward">david.ward</who>
    <bug_when>2016-06-26 08:36:56 -0400</bug_when>
    <thetext>The other bug is about rfkill on HP laptops affecting wifi, Bluetooth, etc.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9453116</commentid>
    <comment_count>18</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-06-26 09:15:46 -0400</bug_when>
    <thetext>(In reply to David Ward from comment #17)
&gt; The other bug is about rfkill on HP laptops affecting wifi, Bluetooth, etc.

OK. I have a Lenovo laptop (ThinkPad T450s) and this bug occurs with 4.5 kernel even if I just turn my mouse off and back on. So, maybe. No idea.

Anyhow, I was able to resume the second time and get the mouse back without restarting bluetooth service. So, maybe it did get fixed in 4.6.3 that just hit F24.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9453146</commentid>
    <comment_count>19</comment_count>
    <who name="David Ward">david.ward</who>
    <bug_when>2016-06-26 09:31:38 -0400</bug_when>
    <thetext>(In reply to Bojan Smojver from comment #18)
&gt; (In reply to David Ward from comment #17)
&gt; &gt; The other bug is about rfkill on HP laptops affecting wifi, Bluetooth, etc.
&gt; 
&gt; OK. I have a Lenovo laptop (ThinkPad T450s)

Ok, please ignore me...I read &quot;ThinkPad&quot; and thought &quot;ElitePad&quot; (HP). Sorry for the noise.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9460916</commentid>
    <comment_count>20</comment_count>
    <who name="Bojan Smojver">bojan</who>
    <bug_when>2016-06-28 19:33:59 -0400</bug_when>
    <thetext>This has been fixed in kernel-4.6.3-300.fc24.x86_64. I resumed many, many times now and the mouse consistently cames back online.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1384615</bug_id>
          
          <creation_ts>2016-10-13 12:38:00 -0400</creation_ts>
          <short_desc>Use &quot;F&quot; flag in binfmt for qemu-user-static</short_desc>
          <delta_ts>2016-10-25 10:19:57 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>qemu</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Bastien Nocera">bnocera</reporter>
          <assigned_to name="Fedora Virtualization Maintainers">virt-maint</assigned_to>
          <cc>amit.shah</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-25 10:19:57</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9789354</commentid>
    <comment_count>0</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-10-13 12:38:59 -0400</bug_when>
    <thetext>qemu-user-static-2.7.0-3.fc25.x86_64

Using the &quot;F&quot; flag[1] in the binfmt configuration would allow the static qemu-user instances to stay available in containers, such as the one used when doing Flatpak builds.

This would make cross-compilation of Flatpak targets work out-of-the-box on Fedora:
http://www.hadess.net/2016/08/flatpak-cross-compilation-support.html

(Note, I can patch, test and upload the fix if necessary)

[1]: https://lwn.net/Articles/682286/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9792884</commentid>
    <comment_count>1</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-10-14 11:47:04 -0400</bug_when>
    <thetext>Patch + test + upload sounds good to me, thanks! I&apos;ll scoop it up in the next build</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9796470</commentid>
    <comment_count>2</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-10-17 06:29:03 -0400</bug_when>
    <thetext>A scratch build has been building since Friday (it&apos;s Monday now):
http://koji.fedoraproject.org/koji/taskinfo?taskID=16087957</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9796534</commentid>
    <comment_count>3</comment_count>
    <who name="Richard W.M. Jones">rjones</who>
    <bug_when>2016-10-17 06:47:01 -0400</bug_when>
    <thetext>It looks as if the armv7 build has hung/broken somehow
and is not progressing.  I would cancel that and try again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9796678</commentid>
    <comment_count>4</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-10-17 07:37:10 -0400</bug_when>
    <thetext>I cancelled it already, as I added the flag in the wrong place...

There&apos;s another build running at:
http://koji.fedoraproject.org/koji/taskinfo?taskID=16105688</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9798667</commentid>
    <comment_count>5</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-10-17 16:54:43 -0400</bug_when>
    <thetext>Yeah my builds are hanging too, maybe some transient rawhide breakage. I&apos;ll try again in a few days</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9800297</commentid>
    <comment_count>6</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-10-18 06:18:11 -0400</bug_when>
    <thetext>Note that the builds are still broken. It&apos;s pretty complicated, as the packages take a long while to build, and I keep hitting problems with the binfmt configuration files.

I think I might have found some problems in that (recently added) code, and sent a mail to danpb.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805493</commentid>
    <comment_count>7</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-10-19 13:21:44 -0400</bug_when>
    <thetext>Pushed to master:

* Wed Oct 19 2016 Bastien Nocera &lt;bnocera@redhat.com&gt; - 2:2.7.0-6
- Add &quot;F&quot; flag to static user emulators&apos; binfmt, to make them
  available in containers (#1384615)
- Also fixes the path of those emulators in the binfmt configurations

Can you please pick this up for F25 as well?

As mentioned in the last line, the binfmt files in qemu-user-static weren&apos;t working properly, as the perl line changed the binfmt name, not the binary&apos;s path.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9819804</commentid>
    <comment_count>8</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-10-25 10:19:57 -0400</bug_when>
    <thetext>Changes are in the latest F25 build, but rawhide is only building now.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
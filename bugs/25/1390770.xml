<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1390770</bug_id>
          
          <creation_ts>2016-11-01 18:02:00 -0400</creation_ts>
          <short_desc>Cacti needs to be ported to PHP 7</short_desc>
          <delta_ts>2017-01-28 19:20:18 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>cacti</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Hill">dhill</reporter>
          <assigned_to name="Morten Stevens">mstevens</assigned_to>
          <cc>dhill</cc>
    
    
    <cc>fabrice</cc>
    
    
    <cc>frank</cc>
    
    
    <cc>limburgher</cc>
    
    
    <cc>mstevens</cc>
    
    
    <cc>pat</cc>
    
    
    <cc>pzeppegno</cc>
    
    
    <cc>russ+bugzilla-redhat</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>cacti-0.8.8h-3.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-28 19:20:18</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9838832</commentid>
    <comment_count>0</comment_count>
    <who name="David Hill">dhill</who>
    <bug_when>2016-11-01 18:02:18 -0400</bug_when>
    <thetext>Description of problem:
Cacti is totally broken in fc25 (probably because we&apos;re not using fc25)


==&gt; error_log &lt;==
[Tue Nov 01 18:00:00.157179 2016] [:error] [pid 1042] [client 192.168.1.27:39066] PHP Parse error:  syntax error, unexpected &apos;new&apos; (T_NEW) in /usr/share/cacti/lib/adodb/adodb.inc.php on line 866

==&gt; access_log &lt;==
192.168.1.27 - - [01/Nov/2016:18:00:00 -0400] &quot;GET /cacti/install/ HTTP/1.1&quot; 500 - &quot;-&quot; &quot;Mozilla/5.0 (X11; Fedora; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36&quot;


Version-Release number of selected component (if applicable):


How reproducible:
Always

Steps to Reproduce:
1. Install cacti
2. Try using it
3.

Actual results:
Fails

Expected results:
Succeeds

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9838836</commentid>
    <comment_count>1</comment_count>
    <who name="David Hill">dhill</who>
    <bug_when>2016-11-01 18:07:09 -0400</bug_when>
    <thetext>mysql_pconnect is also missing in fc25.

[Tue Nov 01 18:00:00.157179 2016] [:error] [pid 1042] [client 192.168.1.27:39066] PHP Parse error:  syntax error, unexpected &apos;new&apos; (T_NEW) in /usr/share/cacti/lib/adodb/adodb.inc.php on line 866
[Tue Nov 01 18:05:00.253350 2016] [:error] [pid 1062] [client 192.168.1.27:39198] PHP Fatal error:  Uncaught Error: Call to undefined function mysql_pconnect() in /usr/share/cacti/lib/adodb/drivers/adodb-mysql.inc.php:355\nStack trace:\n#0 /usr/share/cacti/lib/adodb/adodb.inc.php(470): ADODB_mysql-&gt;_pconnect(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;)\n#1 /usr/share/cacti/lib/adodb/adodb.inc.php(3624): ADOConnection-&gt;PConnect(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;)\n#2 /usr/share/cacti/lib/database.php(51): ADONewConnection(&apos;mysql&apos;)\n#3 /usr/share/cacti/include/global.php(212): db_connect_real(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;, &apos;mysql&apos;, &apos;3306&apos;, false)\n#4 /usr/share/cacti/include/auth.php(25): include(&apos;/usr/share/cact...&apos;)\n#5 /usr/share/cacti/index.php(25): include(&apos;/usr/share/cact...&apos;)\n#6 {main}\n  thrown in /usr/share/cacti/lib/adodb/drivers/adodb-mysql.inc.php on line 355
[Tue Nov 01 18:05:13.788668 2016] [:error] [pid 1036] [client 192.168.1.27:39204] PHP Fatal error:  Uncaught Error: Call to undefined function mysql_pconnect() in /usr/share/cacti/lib/adodb/drivers/adodb-mysql.inc.php:355\nStack trace:\n#0 /usr/share/cacti/lib/adodb/adodb.inc.php(470): ADODB_mysql-&gt;_pconnect(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;)\n#1 /usr/share/cacti/lib/adodb/adodb.inc.php(3624): ADOConnection-&gt;PConnect(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;)\n#2 /usr/share/cacti/lib/database.php(51): ADONewConnection(&apos;mysql&apos;)\n#3 /usr/share/cacti/include/global.php(212): db_connect_real(&apos;localhost&apos;, &apos;cactiuser&apos;, &apos;cactiuser&apos;, &apos;cacti&apos;, &apos;mysql&apos;, &apos;3306&apos;, false)\n#4 /usr/share/cacti/include/auth.php(25): include(&apos;/usr/share/cact...&apos;)\n#5 /usr/share/cacti/index.php(25): include(&apos;/usr/share/cact...&apos;)\n#6 {main}\n  thrown in /usr/share/cacti/lib/adodb/drivers/adodb-mysql.inc.php on line 355</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9838878</commentid>
    <comment_count>2</comment_count>
    <who name="David Hill">dhill</who>
    <bug_when>2016-11-01 19:05:14 -0400</bug_when>
    <thetext>You&apos;ll also need to add a dependency on cacti for &quot;php-xml&quot;
and change /usr/share/cacti/install/index.php so the line 66 looks like this :        $extensions = array(&quot;session&quot;, &quot;sockets&quot;, &quot;mysqli&quot;, &quot;xml&quot;);

and replace all &quot; =&amp; new &quot; to &quot; = new &quot;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9990969</commentid>
    <comment_count>3</comment_count>
    <who name="">pzeppegno</who>
    <bug_when>2016-12-15 13:03:57 -0500</bug_when>
    <thetext>Cacti has been broken for a very long while. Are you going to do something about it? Fedora is not the only OS coming with PHP7 and the needed fixes are widely available on the net (I think Arch and Ubuntu both have applied fixes).

Please fix it, I need cacti for monitorin my home network..</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991050</commentid>
    <comment_count>4</comment_count>
    <who name="Morten Stevens">mstevens</who>
    <bug_when>2016-12-15 13:44:52 -0500</bug_when>
    <thetext>(In reply to pzeppegno from comment #3)
&gt; Cacti has been broken for a very long while. Are you going to do something
&gt; about it? Fedora is not the only OS coming with PHP7 and the needed fixes
&gt; are widely available on the net (I think Arch and Ubuntu both have applied
&gt; fixes).

No. Cacti is not broken. It&apos;s working fine with Fedora 24 and we have the latest upstream release (0.8.8h) in our repos.

&gt; Please fix it, I need cacti for monitorin my home network..

Please report it upstream. We will always stay with the latest upstream release.

An interim solution for Fedora is:
1) Stay with Fedora 24 (PHP 5.6)
2) Downgrade to PHP 5.6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991055</commentid>
    <comment_count>5</comment_count>
    <who name="">pzeppegno</who>
    <bug_when>2016-12-15 13:49:43 -0500</bug_when>
    <thetext>It just seems a bit weird to ship it broken in 25 and not comment about your position it until now..</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991079</commentid>
    <comment_count>6</comment_count>
    <who name="Morten Stevens">mstevens</who>
    <bug_when>2016-12-15 14:02:48 -0500</bug_when>
    <thetext>(In reply to pzeppegno from comment #5)
&gt; It just seems a bit weird to ship it broken in 25 and not comment about your
&gt; position it until now..

Sure, we need to wait for a new cacti release. You can be sure that we will update to the latest release as soon as possible. But it depends on the upstream project to release a new version with PHP7 compatibility.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991087</commentid>
    <comment_count>7</comment_count>
    <who name="David Hill">dhill</who>
    <bug_when>2016-12-15 14:07:51 -0500</bug_when>
    <thetext>I wrote the steps to make it work with php7... just fix it on your side until we get an official RPM of that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10023804</commentid>
    <comment_count>8</comment_count>
    <who name="Frank Crawford">frank</who>
    <bug_when>2016-12-29 05:28:37 -0500</bug_when>
    <thetext>Two additional items for this, actual patches for this are available for ArchLinux at https://bugs.archlinux.org/task/48325 and https://bugs.archlinux.org/task/49039 (although watch the DB update which may be to pdo_mysql, not mysqli).

Secondly, if you already have a working configuration you need to change the variable in /etc/cacti/db.php for $database_type to &quot;mysqli&quot;.

Also, additionally, there are likely to be other errors in various plugins, but that isn&apos;t an issue with the core installation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10077003</commentid>
    <comment_count>9</comment_count>
    <who name="Morten Stevens">mstevens</who>
    <bug_when>2017-01-18 10:46:23 -0500</bug_when>
    <thetext>All right. It looks like that it takes even longer for upstream to release a new cacti version with PHP7 compatibility.

Therefore, I have backported the patches available from ArchLinux. Please note: This doesn&apos;t add full PHP7 compatibility. But the basic functionality of cacti should work now.

Here is my commit for Fedora 25: https://src.fedoraproject.org/cgit/rpms/cacti.git/commit/?h=f25&amp;id=c793bfa67944ede77a3796b1f275fa193eaaec40   Please let me know if you have any objections.

RPM packages:
https://koji.fedoraproject.org/koji/buildinfo?buildID=834677</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10077010</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-18 10:48:05 -0500</bug_when>
    <thetext>cacti-0.8.8h-3.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-01a21b5785</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10079198</commentid>
    <comment_count>11</comment_count>
    <who name="Russell Odom">russ+bugzilla-redhat</who>
    <bug_when>2017-01-19 03:57:30 -0500</bug_when>
    <thetext>Great, now working for me, as soon as I changed $database_type = &quot;mysqli&quot;; /etc/cacti/db.php (this was correct in /etc/cacti/db.php.rpmnew).

Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10079305</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-19 04:11:55 -0500</bug_when>
    <thetext>cacti-0.8.8h-3.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-01a21b5785</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10084703</commentid>
    <comment_count>13</comment_count>
    <who name="">pzeppegno</who>
    <bug_when>2017-01-20 14:04:50 -0500</bug_when>
    <thetext>Pulled from the testing repo and it started working immediately. +1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10103848</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-28 19:20:18 -0500</bug_when>
    <thetext>cacti-0.8.8h-3.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1411127</bug_id>
          
          <creation_ts>2017-01-08 10:28:00 -0500</creation_ts>
          <short_desc>Segfault /usr/sbin/tc</short_desc>
          <delta_ts>2017-01-16 14:52:16 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>iproute</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>redhat</reporter>
          <assigned_to name="Phil Sutter">psutter</assigned_to>
          <cc>psimerda</cc>
    
    
    <cc>psutter</cc>
    
    
    <cc>rvokal</cc>
    
    
    <cc>twoerner</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>iproute-4.6.0-6.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-16 14:52:16</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10043243</commentid>
    <comment_count>0</comment_count>
    <who name="">redhat</who>
    <bug_when>2017-01-08 10:28:29 -0500</bug_when>
    <thetext>Description of problem:
/usr/sbin/tc produces segfault

Version-Release number of selected component (if applicable):
iproute-tc-4.6.0-5.fc25.x86_64

How reproducible:
Use tc to configure traffic shaping on ppp0

tc qdisc add dev ppp0 handle ffff: ingress
tc filter add dev ppp0 parent ffff: protocol ip prio 110 u32 match ip src 0.0.0.0/0 flowid :1 police rate 16056kbit burst 6k linklay atm conform-exceed continue/ok
tc filter add dev ppp0 parent ffff: protocol ip prio 111 u32 match u32 0 0 flowid :1 action xt -j MARK --set-mark 20 action continue
(Speicherabzug geschrieben) tc filter add dev ppp0 parent ffff: protocol ip prio 111 u32 match u32 0 0 flowid :1 action xt -j MARK --set-mark 20 action continue


Steps to Reproduce:
1. run the four commands mentioned above
2.
3.

Actual results:
tc[7808]: segfault at 0 ip           (null) sp 00007ffde2adf898 error 14 in tc[400000+56000]


Expected results:
No segfault

Additional info:
I&apos;ve set the core limit to unlimited (ulimit -c unlimited) but can&apos;t find a core file. Where is it?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10049683</commentid>
    <comment_count>1</comment_count>
    <who name="">redhat</who>
    <bug_when>2017-01-10 10:14:49 -0500</bug_when>
    <thetext>Reading symbols from /usr/sbin/tc...Reading symbols from /usr/lib/debug/usr/sbin/tc.debug...done.
done.
(gdb) run filter add dev ppp0 parent ffff: protocol ip prio 111 u32 match u32 0 0 flowid :1 action xt -j MARK --set-mark 20 action continue
Starting program: /usr/sbin/tc filter add dev ppp0 parent ffff: protocol ip prio 111 u32 match u32 0 0 flowid :1 action xt -j MARK --set-mark 20 action continue

Program received signal SIGSEGV, Segmentation fault.
0x0000000000000000 in ?? ()
(gdb) bt
#0  0x0000000000000000 in ?? ()
#1  0x00007ffff6cc9174 in compatible_target_revision (revision=&lt;optimized out&gt;, name=&lt;optimized out&gt;) at xtables.c:833
#2  xtables_fully_register_pending_target (me=0x7ffff6a800c0 &lt;mark_tg_reg+192&gt;) at xtables.c:1068
#3  xtables_find_target (name=0x7ffff687f2bf &quot;MARK&quot;, tryload=tryload@entry=XTF_DURING_LOAD) at xtables.c:732
#4  0x00007ffff6cc90ee in xtables_fully_register_pending_target (me=0x7ffff6a80000 &lt;mark_tg_reg&gt;) at xtables.c:1053
#5  xtables_find_target (name=name@entry=0x7fffffffe208 &quot;MARK&quot;, tryload=tryload@entry=XTF_DONT_LOAD) at xtables.c:732
#6  0x00007ffff6cc9526 in load_extension (search_path=&lt;optimized out&gt;, af_prefix=0x7ffff6ccdcff &quot;libipt_&quot;, name=name@entry=0x7fffffffe208 &quot;MARK&quot;, is_target=is_target@entry=true) at xtables.c:588
#7  0x00007ffff6cc9097 in xtables_find_target (name=0x7fffffffe208 &quot;MARK&quot;, tryload=tryload@entry=XTF_TRY_LOAD) at xtables.c:745
#8  0x00007ffff6ed34a4 in parse_ipt (a=&lt;optimized out&gt;, argc_p=0x7fffffff92f4, argv_p=0x7fffffff92f8, tca_id=2, n=0x7fffffff9cb0) at m_xt.c:161
#9  0x0000000000413aaf in parse_action (argc_p=argc_p@entry=0x7fffffff939c, argv_p=argv_p@entry=0x7fffffff9390, tca_id=tca_id@entry=7, n=n@entry=0x7fffffff9cb0) at m_action.c:219
#10 0x0000000000424555 in u32_parse_opt (qu=&lt;optimized out&gt;, handle=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, n=0x7fffffff9cb0) at f_u32.c:1137
#11 0x000000000040b7e5 in tc_filter_modify (cmd=&lt;optimized out&gt;, flags=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at tc_filter.c:154
#12 0x0000000000407982 in main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at tc.c:346</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10057470</commentid>
    <comment_count>2</comment_count>
    <who name="Phil Sutter">psutter</who>
    <bug_when>2017-01-12 09:47:42 -0500</bug_when>
    <thetext>Hi,

Thanks for reporting the issue!

While reproducing, I found an even simpler reproducer:

# ip link add d0 type dummy
# ip link set d0 up
# tc qdisc add dev d0 ingress
# tc filter add dev d0 parent ffff: u32 match u32 0 0 action xt -j MARK --set-mark 20

Culprit found and patch sent upstream:
https://www.mail-archive.com/netdev@vger.kernel.org/msg147377.html

Thanks, Phil</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10061033</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-13 09:13:21 -0500</bug_when>
    <thetext>iproute-4.6.0-6.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-8de07e8699</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10063223</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-14 01:21:48 -0500</bug_when>
    <thetext>iproute-4.6.0-6.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-8de07e8699</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10064485</commentid>
    <comment_count>5</comment_count>
    <who name="">redhat</who>
    <bug_when>2017-01-15 15:24:11 -0500</bug_when>
    <thetext>Looks good to me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10067765</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-01-16 14:52:16 -0500</bug_when>
    <thetext>iproute-4.6.0-6.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
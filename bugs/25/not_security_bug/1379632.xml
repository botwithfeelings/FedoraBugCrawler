<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1379632</bug_id>

    <creation_ts>2016-09-27 05:24:00 -0400</creation_ts>
    <short_desc>fails to link on s390x</short_desc>
    <delta_ts>2016-10-12 14:58:28 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>tbb</component>
    <version>25</version>
    <rep_platform>s390x</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>

    <blocked>467765</blocked>
    <everconfirmed>1</everconfirmed>
    <reporter name="Dan Horák">dan</reporter>
    <assigned_to name="Jiri Kastner">jkastner</assigned_to>
    <cc>c.david86</cc>

    <cc>dakingun</cc>

    <cc>dkaspar</cc>

    <cc>jkastner</cc>

    <cc>loganjerry</cc>

    <cc>nphilipp</cc>

    <cc>pmachata</cc>

    <cc>richmattes</cc>

    <cc>taylor</cc>

    <cc>xjakub</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>tbb-2017-3.20160916.fc25</cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2016-10-12 14:58:28</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9745681</commentid>
<comment_count>0</comment_count>
<who name="Dan Horák">dan</who>
<bug_when>2016-09-27 05:24:23 -0400</bug_when>
<thetext>ceres-solver fails to build on s390x due missing symbols when linking ... [ 44%] Linking CXX executable ../bin/ellipse_approximation cd /builddir/build/BUILD/ceres-solver-1.11.0/build/examples &amp;&amp; /usr/bin/cmake -E cmake_link_script
CMakeFiles/ellipse_approximation.dir/link.txt --verbose=1 /usr/bin/c++ -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches
-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -march=z9-109 -mtune=z10 -fopenmp -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-missing-field-initializers -DNDEBUG -Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld
CMakeFiles/ellipse_approximation.dir/ellipse_approximation.cc.o -o ../bin/ellipse_approximation -rdynamic ../lib/libceres.so.1.11.0 -lglog -Wl,-rpath,/builddir/build/BUILD/ceres-solver-1.11.0/build/lib /usr/lib64/libspqr.so.2: undefined reference to
`tbb::internal::allocate_child_proxy::allocate(unsigned long) const&apos; /usr/lib64/libspqr.so.2: undefined reference to `tbb::task_scheduler_init::initialize(int, unsigned long)&apos; /usr/lib64/libspqr.so.2: undefined reference to
`tbb::internal::allocate_root_proxy::allocate(unsigned long)&apos; collect2: error: ld returned 1 exit status examples/CMakeFiles/ellipse_approximation.dir/build.make:99: recipe for target &apos;bin/ellipse_approximation&apos; failed make[2]: ***
[bin/ellipse_approximation] Error 1 make[2]: Leaving directory &apos;/builddir/build/BUILD/ceres-solver-1.11.0/build&apos; CMakeFiles/Makefile2:3037: recipe for target &apos;examples/CMakeFiles/ellipse_approximation.dir/all&apos; failed make[1]: ***
[examples/CMakeFiles/ellipse_approximation.dir/all] Error 2 [ 45%] Linking CXX shared library ../../lib/libtest_util.so cd /builddir/build/BUILD/ceres-solver-1.11.0/build/internal/ceres &amp;&amp; /usr/bin/cmake -E cmake_link_script
CMakeFiles/test_util.dir/link.txt --verbose=1 /usr/bin/c++ -fPIC -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches
-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -march=z9-109 -mtune=z10 -fopenmp -Wno-unknown-pragmas -Wno-sign-compare -Wno-unused-parameter -Wno-missing-field-initializers -DNDEBUG -Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld
-shared -Wl,-soname,libtest_util.so -o ../../lib/libtest_util.so CMakeFiles/test_util.dir/evaluator_test_utils.cc.o CMakeFiles/test_util.dir/numeric_diff_test_utils.cc.o CMakeFiles/test_util.dir/test_util.cc.o ../../lib/libceres.so.1.11.0
../../lib/libgtest.so -lglog /usr/lib64/libgflags.so.2.1.2 -lpthread -Wl,-rpath,/builddir/build/BUILD/ceres-solver-1.11.0/build/lib make[2]: Leaving directory &apos;/builddir/build/BUILD/ceres-solver-1.11.0/build&apos; [ 45%] Built target test_util [
46%] Linking CXX executable ../bin/more_garbow_hillstrom cd /builddir/build/BUILD/ceres-solver-1.11.0/build/examples &amp;&amp; /usr/bin/cmake -E cmake_link_script CMakeFiles/more_garbow_hillstrom.dir/link.txt --verbose=1 /usr/bin/c++ -O2 -g -pipe
-Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -march=z9-109 -mtune=z10 -fopenmp -Wno-unknown-pragmas
-Wno-sign-compare -Wno-unused-parameter -Wno-missing-field-initializers -DNDEBUG -Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld CMakeFiles/more_garbow_hillstrom.dir/more_garbow_hillstrom.cc.o -o ../bin/more_garbow_hillstrom -rdynamic
../lib/libceres.so.1.11.0 /usr/lib64/libgflags.so.2.1.2 -lglog -lpthread -Wl,-rpath,/builddir/build/BUILD/ceres-solver-1.11.0/build/lib /usr/lib64/libspqr.so.2: undefined reference to `tbb::internal::allocate_child_proxy::allocate(unsigned long)
const&apos; /usr/lib64/libspqr.so.2: undefined reference to `tbb::task_scheduler_init::initialize(int, unsigned long)&apos; /usr/lib64/libspqr.so.2: undefined reference to `tbb::internal::allocate_root_proxy::allocate(unsigned long)&apos; collect2:
error: ld returned 1 exit status examples/CMakeFiles/more_garbow_hillstrom.dir/build.make:100: recipe for target &apos;bin/more_garbow_hillstrom&apos; failed make[2]: *** [bin/more_garbow_hillstrom] Error 1 ... for full logs please see
http://s390.koji.fedoraproject.org/koji/taskinfo?taskID=2359599 It might be a problem in suitesparse if I can understand the problem correctly. Version-Release number of selected component (if applicable): ceres-solver-1.11.0-8.fc25</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9745963</commentid>
<comment_count>1</comment_count>
<who name="Dan Horák">dan</who>
<bug_when>2016-09-27 06:21:11 -0400</bug_when>
<thetext>FWIW http://s390.koji.fedoraproject.org/koji/packageinfo?packageID=19778 shows only the f25 build is broken</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9772931</commentid>
<comment_count>2</comment_count>
<who name="Dan Horák">dan</who>
<bug_when>2016-10-07 05:19:43 -0400</bug_when>
<thetext>same problem with mrpt-1.3.2-9.fc25 - http://s390.koji.fedoraproject.org/koji/taskinfo?taskID=2367367 switching to suitesparse for investigation Note: suitesparse-4.4.6-6 hasn&apos;t been rebuilt for new TBB in Rawhide</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9772978</commentid>
<comment_count>3</comment_count>
<who name="Jiri Kastner">jkastner</who>
<bug_when>2016-10-07 05:44:48 -0400</bug_when>
<thetext>asking tbb co-maintainer for his input</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9773248</commentid>
<comment_count>4</comment_count>
<who name="Dan Horák">dan</who>
<bug_when>2016-10-07 08:05:05 -0400</bug_when>
<thetext>The problem is in TBB build scripts. Based on architecture they select the version script used to filter symbols in the resulting library and wrongly considered s390x as 32-bit arch. As result tbb::task_scheduler_init::initialize(int,
unsigned int) was expected in the lib while tbb::task_scheduler_init::initialize(int, unsigned long) existed in the built source code. The 2nd parameter is size_t in this function whose definition differs between 32-bit and 64-bit arches.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9776390</commentid>
<comment_count>5</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-10-09 08:30:18 -0400</bug_when>
<thetext>suitesparse-4.4.6-7.fc25, tbb-2017-3.20160916.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-3fbb30af18</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9785786</commentid>
<comment_count>6</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2016-10-12 14:58:28 -0400</bug_when>
<thetext>suitesparse-4.4.6-7.fc25, tbb-2017-3.20160916.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

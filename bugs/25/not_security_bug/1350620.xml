<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1350620</bug_id>

    <creation_ts>2016-06-27 17:45:00 -0400</creation_ts>
    <short_desc>redland-bindings: FTBFS in rawhide: &apos;rsrc&apos; undeclared</short_desc>
    <delta_ts>2017-06-22 21:56:23 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>redland-bindings</component>
    <version>25</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <bug_file_loc>http://bugs.librdf.org/mantis/view.php?id=622</bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>
    <dependson>1356985</dependson>
    <blocked>1423041</blocked>
    <everconfirmed>1</everconfirmed>
    <reporter name="Shawn Iwinski">shawn</reporter>
    <assigned_to name="Thomas Vander Stichele">thomas</assigned_to>
    <cc>jplesnik</cc>

    <cc>ppisar</cc>

    <cc>releng</cc>

    <cc>thomas</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>redland-bindings-1.0.16.1-20.fc27 redland-bindings-1.0.16.1-19.fc26 redland-bindings-1.0.16.1-18.fc25</cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-06-19 10:34:33</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>9457036</commentid>
<comment_count>0</comment_count>
<who name="Shawn Iwinski">shawn</who>
<bug_when>2016-06-27 17:45:38 -0400</bug_when>
<thetext>Description of problem: Package redland-bindings fails to build from source in rawhide. Version-Release number of selected component (if applicable): 1.0.16.1-16.fc25 Steps to Reproduce: koji build --scratch f25
redland-bindings-1.0.16.1-16.fc25.src.rpm Additional info: This package is tracked by Koschei. See: https://apps.fedoraproject.org/koschei/package/redland-bindings</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9550021</commentid>
<comment_count>1</comment_count>
<who name="Jan Kurik">jkurik</who>
<bug_when>2016-07-26 01:08:22 -0400</bug_when>
<thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle. Changing version to &apos;25&apos;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9768260</commentid>
<comment_count>2</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2016-10-05 10:17:34 -0400</bug_when>
<thetext>It fails in build phase: gcc -DHAVE_CONFIG_H -I. -DREDLAND_POST_I -DREDLAND_INIT_I -DREDLAND_DECL_I -DREDLAND_TYPEMAP_I -UHAVE_CONFIG_H -I/usr/include/rasqal -I/usr/include/raptor2 -I/usr/include/php -I/usr/include/php/main
-I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib -DREDLAND_BINDINGS_VERSION=\&quot;1.0.16.1\&quot; -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic -I/usr/include/rasqal -I/usr/include/raptor2 -O2 -g -pipe -Wall -Werror=format-security
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic -fPIC -DPIC redland_wrap.c -c -o redland_wrap.o redland_wrap.c: In
function &apos;SWIG_landfill&apos;: redland_wrap.c:811:51: error: &apos;rsrc&apos; undeclared (first use in this function) static ZEND_RSRC_DTOR_FUNC(SWIG_landfill) { (void)rsrc; } ^~~~ A difference between working and failing build root is:
php-devel 5.6.23-1.fc25 &gt; 7.0.8-1.fc25 php-cli 5.6.23-1.fc25 &gt; 7.0.8-1.fc25 php-common 5.6.23-1.fc25 &gt; 7.0.8-1.fc25 openssl-libs 1:1.0.2h-1.fc25 &gt; 1:1.0.2h-2.fc25 nss 3.24.0-3.fc25 &gt; 3.25.0-3.fc25 libselinux 2.5-8.fc25 &gt; 2.5-9.fc25
php-json &gt; 7.0.8-1.fc25 php-pecl-jsonc-devel 1.3.10-1.fc25 &lt; php-pecl-jsonc 1.3.10-1.fc25 &lt; libnghttp2 1.11.1-1.fc25 &gt; 1.12.0-1.fc25 nss-tools 3.24.0-3.fc25 &gt; 3.25.0-3.fc25 file-libs 5.28-1.fc25 &gt; 5.28-2.fc25 nss-sysinit
3.24.0-3.fc25 &gt; 3.25.0-3.fc25 file 5.28-1.fc25 &gt; 5.28-2.fc25 This is very probably caused by upgrading PHP.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9785188</commentid>
<comment_count>3</comment_count>
<who name="Jitka Plesnikova">jplesnik</who>
<bug_when>2016-10-12 11:23:40 -0400</bug_when>
<thetext>swig doesn&apos;t support php7 yet.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9793558</commentid>
<comment_count>4</comment_count>
<who name="Shawn Iwinski">shawn</who>
<bug_when>2016-10-14 15:30:25 -0400</bug_when>
<thetext>Note: Removed blocked bug 1350621 as I removed the redland dependency from php-EasyRdf</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10501038</commentid>
<comment_count>5</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2017-06-13 08:31:25 -0400</bug_when>
<thetext>*** Bug 1424251 has been marked as a duplicate of this bug. ***</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10501139</commentid>
<comment_count>6</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2017-06-13 08:49:45 -0400</bug_when>
<thetext>swig already supports PHP 7, but this package uses pregenerated sources and the build fails with: gcc -DHAVE_CONFIG_H -I. -DREDLAND_POST_I -DREDLAND_INIT_I -DREDLAND_DECL_I -DREDLAND_TYPE MAP_I -UHAVE_CONFIG_H -I/usr/include/raptor2
-I/usr/include/rasqal -I/usr/include/php - I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ ext -I/usr/include/php/ext/date/lib -DREDLAND_BINDINGS_VERSION=\&quot;1.0.16.1\&quot; -O2 -g -pipe -Wall
-Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-stron g --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-harden ed-cc1 -m64 -mtune=generic -I/usr/include/raptor2 -I/usr/include/rasqal
-O2 -g -pipe -W all -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened -cc1 -m64 -mtune=generic -fPIC -DPIC redland_wrap.c
-c -o redland_wrap.o redland_wrap.c:730:3: error: #error These bindings need PHP5 - to generate PHP7 bindings use: swig -php7 # error These bindings need PHP5 - to generate PHP7 bindings use: swig -php7 ^~~~~ I was told that&apos;s its impossible to
regenerate the sources. If this is true I will try to disable the PHP support in this package.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10502057</commentid>
<comment_count>7</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2017-06-13 12:26:44 -0400</bug_when>
<thetext>After patching these two files: --- a/configure.ac +++ b/configure.ac @@ -165,7 +165,9 @@ if test &quot;X$PHP_CONFIG&quot; != X ; then PHP_INCLUDES=`$PHP_CONFIG --includes` PHP_EXTENSION_DIR=`$PHP_CONFIG --extension-dir` - if test
$PHP_VERSION &apos;&gt;&apos; 5.0.0; then + if test $PHP_VERSION &apos;&gt;&apos; 7; then + PHP_SWIG=&quot;-php7&quot; + elif test $PHP_VERSION &apos;&gt;&apos; 5.0.0; then PHP_SWIG=&quot;-php5&quot; else PHP_SWIG=&quot;-php4&quot; diff --git
a/php/redland-post.i b/php/redland-post.i index 2ab09dd..6b16e0a 100644 --- a/php/redland-post.i +++ b/php/redland-post.i @@ -132,8 +132,11 @@ librdf_php_world_init(void) exception_ce = zend_exception_get_default(); INIT_CLASS_ENTRY(ee_ce,
&quot;RedlandException&quot;, NULL); redland_exception_ptr = zend_register_internal_class_ex(&amp;ee_ce, - exception_ce, - NULL TSRMLS_CC); + exception_ce +#if PHP_MAJOR_VERSION &lt; 7 + ,NULL TSRMLS_CC +#endif + ); #endif
memset(&amp;librdf_php_locator, &apos;\0&apos;, sizeof(raptor_locator)); I get tons of these errors: redland_wrap.c: In function ‘_wrap_librdf_world_get_feature’: redland_wrap.c:1700:22: error: invalid type argument of unary ‘*’ (have ‘zval {aka
struct _zval_struct}’) if(SWIG_ConvertPtr(*args[1], (void **) &amp;arg2, SWIGTYPE_p_librdf_uri_s, 0) &lt; 0) { ^~~~~~~~ It&apos;s probably related to this PHP change
&lt;https://nikic.github.io/2015/05/05/Internal-value-representation-in-PHP-7-part-1.html&gt;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10503666</commentid>
<comment_count>8</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2017-06-14 01:34:01 -0400</bug_when>
<thetext>I patched the code and submitted it to upstream in &lt;http://bugs.librdf.org/mantis/view.php?id=622&gt;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10503685</commentid>
<comment_count>9</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-14 01:38:41 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-19.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-51d9681974</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10503694</commentid>
<comment_count>10</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-14 01:44:16 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-18.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-d7dd086849</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10508984</commentid>
<comment_count>11</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-15 06:57:56 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-18.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to
install test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-d7dd086849</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10509787</commentid>
<comment_count>12</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-15 09:58:42 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-19.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to
install test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-51d9681974</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10518870</commentid>
<comment_count>13</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-19 10:34:33 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-19.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10533412</commentid>
<comment_count>14</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-06-22 21:56:23 -0400</bug_when>
<thetext>redland-bindings-1.0.16.1-18.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>

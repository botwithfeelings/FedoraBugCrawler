<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1445255</bug_id>

    <creation_ts>2017-04-25 07:22:00 -0400</creation_ts>
    <short_desc>Squid SMP Mode Fails</short_desc>
    <delta_ts>2017-04-26 07:56:20 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>squid</component>
    <version>25</version>
    <rep_platform>All</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>RAWHIDE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>unspecified</priority>
    <bug_severity>low</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Frank Crawford">frank</reporter>
    <assigned_to name="Luboš Uhliarik">luhliari</assigned_to>
    <cc>frank</cc>

    <cc>henrik</cc>

    <cc>jonathansteffan</cc>

    <cc>luhliari</cc>

    <cc>psimerda</cc>

    <cc>thozza</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-04-26 04:44:50</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>10359790</commentid>
<comment_count>0</comment_count>
<who name="Frank Crawford">frank</who>
<bug_when>2017-04-25 07:22:00 -0400</bug_when>
<thetext>Description of problem: If squid is run in SMP mode, either through running &quot;workers 2&quot; or enabling &quot;dir_cache rock&quot; then squid fails listen on any ports. The SMP mode needs /var/run/squid for IPC sockets. Version-Release
number of selected component (if applicable): squid-4.0.17-1.fc25.x86_64 How reproducible: 100% Steps to Reproduce: 1. Add &quot;workers 2&quot; to a running squid.conf file 2. Restart squid 3. netstat -anp | grep 3128 (default port) Actual results:
No squid workers listening on port 3128 Expected results: Multiple squid workers listening on port 3128 Additional info: If the directory /var/run/squid is created and owned by squid then multiple workers will work. This just needs
/etc/tmpfile.d/squid (or equivalent) added back into the distribution, as previously existed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10360354</commentid>
<comment_count>1</comment_count>
<who name="Luboš Uhliarik">luhliari</who>
<bug_when>2017-04-25 09:38:59 -0400</bug_when>
<thetext>Change causing this bug was reverted due to this bug: https://bugzilla.redhat.com/show_bug.cgi?id=1145235 I will add /etc/tmpfile.d/squid.conf as it is in RHEL-7.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10363473</commentid>
<comment_count>2</comment_count>
<who name="Luboš Uhliarik">luhliari</who>
<bug_when>2017-04-26 04:44:50 -0400</bug_when>
<thetext>Fix pushed to RAWHIDE and built: https://koji.fedoraproject.org/koji/taskinfo?taskID=19200109</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10364105</commentid>
<comment_count>3</comment_count>
<who name="Frank Crawford">frank</who>
<bug_when>2017-04-26 07:09:10 -0400</bug_when>
<thetext>Thanks. Two minor questions, should it be in /etc/tmpfiles.d or /usr/lib/tmpfiles.d, as /lib/tmpfiled.d seems to be where vendors put the file. Secondly, what permissions are you putting on the directory? I feel that 0755 may have a security
issue, but I can&apos;t really see how it could be used.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10364144</commentid>
<comment_count>4</comment_count>
<who name="Luboš Uhliarik">luhliari</who>
<bug_when>2017-04-26 07:25:22 -0400</bug_when>
<thetext>I installed squid.conf file to %{_tmpfilesdir}/squid.conf , which expands to %{_prefix}/lib/tmpfiles.d . I used 0755, which should be enough. cat &gt; ${RPM_BUILD_ROOT}%{_tmpfilesdir}/squid.conf &lt;&lt;EOF # See tmpfiles.d(5) for details d
/run/squid 0755 squid squid - - EOF</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10364215</commentid>
<comment_count>5</comment_count>
<who name="Frank Crawford">frank</who>
<bug_when>2017-04-26 07:56:20 -0400</bug_when>
<thetext>Ahh macros, they are set up to do the right thing. Thanks.</thetext>
</long_desc>

</bug>

</bugzilla>

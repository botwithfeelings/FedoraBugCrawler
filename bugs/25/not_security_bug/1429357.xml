<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1429357</bug_id>

    <creation_ts>2017-03-06 03:21:00 -0500</creation_ts>
    <short_desc>qla2xxx FC - Server crash when resetting the adapter</short_desc>
    <delta_ts>2017-04-13 12:32:38 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>kernel</component>
    <version>25</version>
    <rep_platform>x86_64</rep_platform>
    <op_sys>Linux</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>CURRENTRELEASE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords></keywords>
    <priority>medium</priority>
    <bug_severity>medium</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Bruno Goncalves">bgoncalv</reporter>
    <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
    <cc>gansalmon</cc>

    <cc>himanshu.madhani</cc>

    <cc>ichavero</cc>

    <cc>itamar</cc>

    <cc>jkastner</cc>

    <cc>jonathan</cc>

    <cc>kernel-maint</cc>

    <cc>madhu.chinakonda</cc>

    <cc>mchehab</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>If docs needed, set a value</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-04-13 12:32:38</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>10210242</commentid>
<comment_count>0</comment_count>
<who name="Bruno Goncalves">bgoncalv</who>
<bug_when>2017-03-06 03:21:30 -0500</bug_when>
<thetext>Description of problem: Performing sysfs reset of HBA port causes system to crash. Version-Release number of selected component (if applicable): kernel-4.9.13-200.fc25.x86_64 How reproducible: sometimes Steps to Reproduce: Repeat these
commands few times, usually crashes withing 50 interactions echo 1 &gt; /sys/bus/pci/drivers/qla2xxx/0000:0a:00.0/remove sleep 1 echo 1 &gt; /sys/bus/pci/rescan sleep 1 Actual results: [15100.404570] qla2xxx [0000:0a:00.0]-500b:3: LOOP DOWN detected
(4 7 0 0). [15101.626090] qla2xxx [0000:0a:00.0]-011c: : MSI-X vector count: 31. [15101.627567] qla2xxx [0000:0a:00.0]-001d: : Found an ISP2031 irq 35 iobase 0xffff9f0cc0f51000. [15101.680364] qla2xxx [0000:0a:00.0]-0075:3: ZIO mode 6 enabled; timer
delay (400 us). [15102.929910] qla2xxx [0000:0a:00.0]-00fb:3: QLogic QLE2672 - QLE2672 QLogic 2-port 16Gb Fibre Channel Adapter. [15102.932031] qla2xxx [0000:0a:00.0]-00fc:3: ISP2031: PCIe (8.0GT/s x8) @ 0000:0a:00.0 hdma+ host#=3 fw=6.02.00 (d0d5).
[15105.059099] qla2xxx [0000:0a:00.0]-011c: : MSI-X vector count: 31. [15105.060427] qla2xxx [0000:0a:00.0]-001d: : Found an ISP2031 irq 35 iobase 0xffff9f0cc0f61000. [15105.114429] qla2xxx [0000:0a:00.0]-0075:3: ZIO mode 6 enabled; timer delay (400
us). [15106.362175] qla2xxx [0000:0a:00.0]-00fb:3: QLogic QLE2672 - QLE2672 QLogic 2-port 16Gb Fibre Channel Adapter. [15106.364364] qla2xxx [0000:0a:00.0]-00fc:3: ISP2031: PCIe (8.0GT/s x8) @ 0000:0a:00.0 hdma+ host#=3 fw=6.02.00 (d0d5).
[15108.607808] qla2xxx [0000:0a:00.0]-500a:3: LOOP UP detected (8 Gbps). [15109.416428] BUG: unable to handle kernel NULL pointer dereference at 0000000000000002 [15109.418113] IP: [&lt;ffffffffc01b0d06&gt;] qla2xxx_eh_abort+0x16/0x2e0 [qla2xxx]
[15109.419612] PGD 0 [15109.419991] [15109.420359] Oops: 0000 [#1] SMP [15109.421012] Modules linked in: ip6table_filter ip6_tables bnx2i libiscsi scsi_transport_iscsi cnic uio fuse btrfs xor raid6_pq hfsplus hfs minix vfat msdos fat jfs binfmt_misc
rpcsec_gss_krb5 nfsv4 dns_resolver nfs fscache intel_powerclamp coretemp ipmi_ssif kvm_intel gpio_ich kvm iTCO_wdt ipmi_si iTCO_vendor_support dm_service_time irqbypass ipmi_msghandler intel_cstate bnx2 intel_uncore fjes acpi_power_meter hpilo hpwdt
shpchp i7core_edac edac_core lpc_ich pcc_cpufreq acpi_cpufreq tpm_tis tpm_tis_core tpm nfsd auth_rpcgss nfs_acl lockd grace sunrpc dm_multipath xfs libcrc32c amdkfd amd_iommu_v2 radeon i2c_algo_bit drm_kms_helper qla2xxx ttm drm crc32c_intel
serio_raw hpsa ata_generic pata_acpi scsi_transport_fc scsi_transport_sas [15109.434598] CPU: 0 PID: 28634 Comm: sh Tainted: G I 4.9.13-200.fc25.x86_64 #1 [15109.436406] Hardware name: HP ProLiant DL380 G6, BIOS P62 08/16/2015 [15109.437731] task:
ffff8aabdefa1d40 task.stack: ffff9f0ccd94c000 [15109.438967] RIP: 0010:[&lt;ffffffffc01b0d06&gt;] [&lt;ffffffffc01b0d06&gt;] qla2xxx_eh_abort+0x16/0x2e0 [qla2xxx] [15109.440985] RSP: 0018:ffff9f0ccd94fc08 EFLAGS: 00010282 [15109.442101] RAX:
ffff8aac0e9b0010 RBX: ffff8aac0f4f0000 RCX: 0000000000000000 [15109.443593] RDX: 0000000000000010 RSI: 0000000000000246 RDI: 0000000000000002 [15109.445091] RBP: ffff9f0ccd94fc70 R08: ffff8aabed5c0440 R09: 00000001801e0017 [15109.446583] R10:
0000000000000000 R11: 0000000000000000 R12: ffff8aabed5747b0 [15109.448083] R13: ffff8aac12df1800 R14: ffff8aabe2649ec0 R15: 0000000000000002 [15109.449576] FS: 00007fba34c7b700(0000) GS:ffff8aac1f400000(0000) knlGS:0000000000000000 [15109.451267]
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [15109.452468] CR2: 0000000000000002 CR3: 00000001e84c0000 CR4: 00000000000006f0 [15109.453959] Stack: [15109.454382] ffff9f0ccd94fc20 ffffffff851131c8 ffff8aac1f410140 ffff9f0ccd94fcb0 [15109.455927]
ffffffff8581c3d0 0000000000000000 0000000000000246 dead000000000200 [15109.457479] ffff8aac0f4f0000 ffff8aabed5747b0 ffff8aac12df1800 ffff8aabe2649ec0 [15109.459024] Call Trace: [15109.459542] [&lt;ffffffff851131c8&gt;] ? del_timer_sync+0x48/0x50
[15109.460829] [&lt;ffffffff8581c3d0&gt;] ? schedule_timeout+0x180/0x300 [15109.462147] [&lt;ffffffffc01b476b&gt;] qla2x00_abort_all_cmds+0xfb/0x150 [qla2xxx] [15109.463702] [&lt;ffffffffc01b605b&gt;] qla2x00_remove_one+0x11b/0x2f0 [qla2xxx]
[15109.465205] [&lt;ffffffff8544ba49&gt;] pci_device_remove+0x39/0xc0 [15109.466472] [&lt;ffffffff8554bbb1&gt;] __device_release_driver+0xa1/0x160 [15109.467865] [&lt;ffffffff8554bc93&gt;] device_release_driver+0x23/0x30 [15109.469148]
[&lt;ffffffff85443dca&gt;] pci_stop_bus_device+0x8a/0xa0 [15109.470436] [&lt;ffffffff85443eea&gt;] pci_stop_and_remove_bus_device_locked+0x1a/0x30 [15109.472071] [&lt;ffffffff8544d70c&gt;] remove_store+0x7c/0x90 [15109.473185]
[&lt;ffffffff85546868&gt;] dev_attr_store+0x18/0x30 [15109.474374] [&lt;ffffffff852e23f7&gt;] sysfs_kf_write+0x37/0x40 [15109.475526] [&lt;ffffffff852e192c&gt;] kernfs_fop_write+0x12c/0x1c0 [15109.476835] [&lt;ffffffff85259747&gt;]
__vfs_write+0x37/0x160 [15109.477946] [&lt;ffffffff8537d577&gt;] ? selinux_file_permission+0xd7/0x110 [15109.479367] [&lt;ffffffff8537310b&gt;] ? security_file_permission+0x3b/0xc0 [15109.480730] [&lt;ffffffff8525a085&gt;] vfs_write+0xb5/0x1a0
[15109.481807] [&lt;ffffffff8525b4e5&gt;] SyS_write+0x55/0xc0 [15109.482862] [&lt;ffffffff8581dc77&gt;] entry_SYSCALL_64_fastpath+0x1a/0xa9 [15109.484215] Code: 80 00 00 bf 00 00 40 00 e8 88 ff 02 00 31 c0 5b 5d c3 0f 1f 00 66 66 66 66 90 55 48 89 e5
41 57 41 56 41 55 41 54 53 48 83 ec 40 &lt;48&gt; 8b 07 4c 8b 20 4d 8b b4 24 a0 09 00 00 4d 8d ac 24 b0 07 00 [15109.488163] RIP [&lt;ffffffffc01b0d06&gt;] qla2xxx_eh_abort+0x16/0x2e0 [qla2xxx] [15109.489683] RSP &lt;ffff9f0ccd94fc08&gt;
[15109.490413] CR2: 0000000000000002 [15109.506681] ---[ end trace 90867666f9a1d374 ]---</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10324806</commentid>
<comment_count>2</comment_count>
<who name="Justin M. Forbes">jforbes</who>
<bug_when>2017-04-11 10:42:49 -0400</bug_when>
<thetext>*********** MASS BUG UPDATE ************** We apologize for the inconvenience. There is a large number of bugs to go through and several of them have gone stale. Due to this, we are doing a mass bug update across all of the Fedora 25 kernel
bugs. Fedora 25 has now been rebased to 4.10.9-200.fc25. Please test this kernel update (or newer) and let us know if you issue has been resolved or if it is still present with the newer kernel. If you have moved on to Fedora 26, and are still
experiencing this issue, please change the version to Fedora 26. If you experience different issues, please open a new bug report for those.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10332834</commentid>
<comment_count>3</comment_count>
<who name="Bruno Goncalves">bgoncalv</who>
<bug_when>2017-04-13 08:04:34 -0400</bug_when>
<thetext>I have not been able to reproduce the issue with kernel-4.10.9-200.fc25. I&apos;ve tried with 500 interactions in each port. Himanshu, do you know if the patch is already included in kernel-4.10.9-200.fc25?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10333748</commentid>
<comment_count>4</comment_count>
<who name="Himanshu Madhani (Cavium)">himanshu.madhani</who>
<bug_when>2017-04-13 12:30:28 -0400</bug_when>
<thetext>Hi Bruno, (In reply to Bruno Goncalves from comment #3) &gt; I have not been able to reproduce the issue with kernel-4.10.9-200.fc25. &gt; I&apos;ve tried with 500 interactions in each port. &gt; &gt; Himanshu, do you know if the patch is
already included in &gt; kernel-4.10.9-200.fc25? I do see that following patch is part of linux-stable 4.10.10
https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/drivers/scsi/qla2xxx?h=linux-4.10.y&amp;id=2780f3c8f0233de90b6b47a23fc422b7780c5436 so my guess is Fedora kernel must have pulled this patch into kernel-4.10.9-200.fc25.
We should close this BZ. Thanks, Himanshu</thetext>
</long_desc>

</bug>

</bugzilla>

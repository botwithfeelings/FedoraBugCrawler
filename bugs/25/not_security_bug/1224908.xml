<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>1224908</bug_id>

    <creation_ts>2015-05-26 03:51:00 -0400</creation_ts>
    <short_desc>dnf fails to verify gpgkey</short_desc>
    <delta_ts>2017-05-27 03:23:56 -0400</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>dnf</component>
    <version>25</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>RAWHIDE</resolution>

    <bug_file_loc></bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened, Triaged</keywords>
    <priority>medium</priority>
    <bug_severity>medium</bug_severity>
    <target_milestone>---</target_milestone>

    <everconfirmed>1</everconfirmed>
    <reporter name="Marcus Moeller">marcus.moeller</reporter>
    <assigned_to>rpm-software-management</assigned_to>
    <cc>aliakc</cc>

    <cc>jmracek</cc>

    <cc>jzeleny</cc>

    <cc>marcus.moeller</cc>

    <cc>matorola</cc>

    <cc>mclay</cc>

    <cc>mluscon</cc>

    <cc>packaging-team-maint</cc>

    <cc>patrick.pichon</cc>

    <cc>redhat-bugzilla</cc>

    <cc>rjones</cc>

    <cc>sirdeiu</cc>

    <cc>techtonik</cc>

    <cc>tla</cc>

    <cc>trurl7</cc>

    <cc>vmojzis</cc>

    <cc>vmukhame</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in></cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-05-25 14:24:03</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>8265222</commentid>
<comment_count>0</comment_count>
<who name="Marcus Moeller">marcus.moeller</who>
<bug_when>2015-05-26 03:51:45 -0400</bug_when>
<thetext>I have added a repo definition like: [isv_ownCloud_desktop] name=The ownCloud Desktop Client (Fedora_21) type=rpm-md baseurl=http://download.opensuse.org/repositories/isv:/ownCloud:/desktop/Fedora_21/ gpgcheck=1
gpgkey=http://download.opensuse.org/repositories/isv:/ownCloud:/desktop/Fedora_21/repodata/repomd.xml.key enabled=1 When trying to install a package from that repo (in this case owncloud-client), I got an error like: warning:
/var/cache/dnf/x86_64/22/isv_ownCloud_desktop/packages/libqtkeychain0-0.4-8.1.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID ba684223: NOKEY Traceback (most recent call last): File &quot;/usr/bin/dnf&quot;, line 36, in &lt;module&gt;
main.user_main(sys.argv[1:], exit_code=True) File &quot;/usr/lib/python2.7/site-packages/dnf/cli/main.py&quot;, line 185, in user_main errcode = main(args) File &quot;/usr/lib/python2.7/site-packages/dnf/cli/main.py&quot;, line 84, in main return
_main(base, args) File &quot;/usr/lib/python2.7/site-packages/dnf/cli/main.py&quot;, line 141, in _main ret = resolving(cli, base) File &quot;/usr/lib/python2.7/site-packages/dnf/cli/main.py&quot;, line 160, in resolving base.do_transaction() File
&quot;/usr/lib/python2.7/site-packages/dnf/cli/cli.py&quot;, line 216, in do_transaction self.gpgsigcheck(downloadpkgs) File &quot;/usr/lib/python2.7/site-packages/dnf/cli/cli.py&quot;, line 249, in gpgsigcheck self.getKeyForPackage(po, fn) File
&quot;/usr/lib/python2.7/site-packages/dnf/base.py&quot;, line 1737, in getKeyForPackage keys = dnf.crypto.retrieve(keyurl, repo) File &quot;/usr/lib/python2.7/site-packages/dnf/crypto.py&quot;, line 124, in retrieve keyinfos = rawkey2infos(handle)
File &quot;/usr/lib/python2.7/site-packages/dnf/crypto.py&quot;, line 107, in rawkey2infos ctx.import_(key_fo) gpgme.GpgmeError: (7, 32870, u&apos;Inappropriate ioctl for device&apos;) In the past (when using yum), I have been prompted to accept the
key in order to continue. This does not seem to happen anymore. I have also tried to import the key manually in advance, using the rpm --import command, without a luck. dnf-1.0.0-1.fc22.noarch is installed. Installing packages from the official
repositories using gpgcheck seems to work, though.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8265425</commentid>
<comment_count>1</comment_count>
<who name="Radek Holy">rholy</who>
<bug_when>2015-05-26 05:04:38 -0400</bug_when>
<thetext>Hi, I&apos;ve hit similar problems when running DNF with a non-interactive standard input stream (i.e. mock --chroot). Can you confirm that this is your case?</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8265472</commentid>
<comment_count>2</comment_count>
<who name="Marcus Moeller">marcus.moeller</who>
<bug_when>2015-05-26 05:19:58 -0400</bug_when>
<thetext>Yes, that&apos;s also the case here. Sorry for not mentioning it initially.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8301143</commentid>
<comment_count>3</comment_count>
<who name="Radek Holy">rholy</who>
<bug_when>2015-06-03 09:52:54 -0400</bug_when>
<thetext>*** Bug 1227689 has been marked as a duplicate of this bug. ***</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8301236</commentid>
<comment_count>4</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2015-06-03 10:16:50 -0400</bug_when>
<thetext>Yeah hit that one too. Quite irritating. Looks like yum is affected by this as well. At least the above marked duplicate bug has a reference to CementOS&apos;s yum.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8301305</commentid>
<comment_count>5</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2015-06-03 10:31:20 -0400</bug_when>
<thetext>*** Bug 1226715 has been marked as a duplicate of this bug. ***</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8628750</commentid>
<comment_count>6</comment_count>
<who name="John">trurl7</who>
<bug_when>2015-09-11 12:05:47 -0400</bug_when>
<thetext>Run into the same issue after installing the gitlab repo inside a CentOS 7 lxc container when working inside an lxc-attach session. Curiously when I logged in to the same container through SSH magically everything worked fine. I was able to
execute `yum search gitlab` without any errors. I was prompted to accept the keys as usual.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8664796</commentid>
<comment_count>7</comment_count>
<who name="Richard W.M. Jones">rjones</who>
<bug_when>2015-09-24 06:51:21 -0400</bug_when>
<thetext>Same problem when running Fedora in a chroot on a phone. Workaround is to use dnf --nogpgcheck which is not nice.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8664998</commentid>
<comment_count>8</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2015-09-24 07:45:33 -0400</bug_when>
<thetext>(In reply to Richard W.M. Jones from comment #7) &gt; Workaround is to use dnf --nogpgcheck which is not nice. I initially thought myself that this may be a workaround. Unfortunately it isn&apos;t! Reason: If you work in a chroot (as I do)
and you intend to install other repositories like RPMFUSION, GOOGLE, ORACLE, VIRTUALBOX and so on, then you migh possibly be installing some *.rpm packages that provide the key&apos;s as well as the *.repo files (this is of course optional in plenty
of cases). In case of RPMFUSION as example, the keys will not be installed into the RPM database if you use --nogpgcheck. You end up in package being installed. But the keys not added to the database. I had to manually add the keys into the rpm
database by running rpm -i key. You can verify this by running: rpm -qa | grep &quot;^gpg-pubkey&quot; | sort gpg-pubkey-02e3ddfb-54f368d3 gpg-pubkey-34ec9cba-54e38751 gpg-pubkey-5ca6c469-548632d2 gpg-pubkey-6b6f9eec-54d3b43d
gpg-pubkey-6ce33d20-54d768b4 gpg-pubkey-7fac5991-4615767f gpg-pubkey-873529b8-54e386ff gpg-pubkey-8e1431d5-53bcbac7 gpg-pubkey-96ca6280-5544d430 gpg-pubkey-97f4d1c1-52ae28d3 gpg-pubkey-98ab5139-4bf2d0b0 gpg-pubkey-a29cb19c-53bcbba6
gpg-pubkey-a6708da3-52ae2b2e gpg-pubkey-a8ce6fe9-54d38742 gpg-pubkey-b7546f06-5544d2dc gpg-pubkey-e051b67e-54863278 gpg-pubkey-ff6382fa-3e1ab2ca This is on my system. I believe I added rpmfusion, some copr keys and some other stuff manually to the
rpm database.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8947085</commentid>
<comment_count>9</comment_count>
<who name="Anatoly Pugachev">matorola</who>
<bug_when>2015-12-31 06:10:46 -0500</bug_when>
<thetext>if you&apos;re in chroot, try &quot;mount /dev/pts&quot; before command.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8947095</commentid>
<comment_count>10</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2015-12-31 06:29:20 -0500</bug_when>
<thetext>(In reply to Anatoly Pugachev from comment #9) &gt; if you&apos;re in chroot, try &quot;mount /dev/pts&quot; before command. Interesting! I will give this a definite try - but - I here on my system use mount -o bind /dev/ /chroot/dev. So the
entire dev directory from the host is being binded to the other dev directory. This also includes the pts subdirectory. What I can do is trying an rbind rather than general bind and see whether there is a difference. Still - yum doesn&apos;t cause an
issue like this.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>8957191</commentid>
<comment_count>11</comment_count>
<who name="Matt Clay">mclay</who>
<bug_when>2016-01-06 02:33:16 -0500</bug_when>
<thetext>I&apos;ve encountered the same issue running inside an LXD container using lxc exec. A simple work-around is to pipe the output of dnf through tee. Running &quot;dnf install -y -q which&quot; fails with a stack trace and the error:
gpgme.GpgmeError: (7, 32870, u&apos;Inappropriate ioctl for device&apos;) While running &quot;dnf install -y -q which | tee&quot; succeeds. Redirecting to /dev/null also works.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9040858</commentid>
<comment_count>12</comment_count>
<who name="Ralf Ertzinger">redhat-bugzilla</who>
<bug_when>2016-02-06 15:47:51 -0500</bug_when>
<thetext>Bind mounting /dev will not pull in /dev/pts (at least on Fedora 23 it doesn&apos;t), you&apos;ll have to also bind mount that.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9040889</commentid>
<comment_count>13</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2016-02-06 16:51:56 -0500</bug_when>
<thetext>(In reply to Ralf Ertzinger from comment #12) &gt; Bind mounting /dev will not pull in /dev/pts (at least on Fedora 23 it &gt; doesn&apos;t), you&apos;ll have to also bind mount that. -bash-4.3$ mount --help | grep &quot;rbind&quot;
&lt;directory&gt; mountpoint for bind mounts (see --bind/rbind) -R, --rbind mount a subtree and all submounts somewhere else -bash-4.3$</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9440066</commentid>
<comment_count>14</comment_count>
<who name="Patrick Pichon">patrick.pichon</who>
<bug_when>2016-06-22 05:59:56 -0400</bug_when>
<thetext>Got the same problem on a fresh Fedora 24 installation ! rpm -qa | grep &quot;^gpg-pubkey&quot; | sort -&gt; give nothing.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9490280</commentid>
<comment_count>15</comment_count>
<who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
<bug_when>2016-07-08 05:31:28 -0400</bug_when>
<thetext>This package has changed ownership in the Fedora Package Database. Reassigning to the new owner of this component.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9524383</commentid>
<comment_count>16</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2016-07-19 10:15:21 -0400</bug_when>
<thetext>Fedora 22 changed to end-of-life (EOL) status on 2016-07-19. Fedora 22 is no longer maintained, which means that it will not receive any further security or bug fix updates. As a result we are closing this bug. If you can reproduce this bug
against a currently maintained version of Fedora please feel free to reopen this bug against that version. If you are unable to reopen this bug, please file a new report against the current release. If you experience problems, please add a comment to
this bug. Thank you for reporting this bug and we are sorry it could not be fixed.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9526785</commentid>
<comment_count>17</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2016-07-19 13:47:31 -0400</bug_when>
<thetext>Could the owner of this bug please repopen this. The bug seem to be still existing and no other feedback has been given so far.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9549889</commentid>
<comment_count>18</comment_count>
<who name="Jan Kurik">jkurik</who>
<bug_when>2016-07-26 01:01:52 -0400</bug_when>
<thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle. Changing version to &apos;25&apos;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>9556796</commentid>
<comment_count>19</comment_count>
<who name="">techtonik</who>
<bug_when>2016-07-27 04:52:44 -0400</bug_when>
<thetext>It is still actual for 24.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10408557</commentid>
<comment_count>20</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2017-05-12 13:01:33 -0400</bug_when>
<thetext>We made a massive improvement of dnf in versions 2.4.1-1 that is available for rawhide and Fedora 26. We provide packages for Fedora 24+ from our testing repository (dnf copr enable rpmsoftwaremanagement/dnf-nightly). Please can you test the
case if it is still valid with dnf-2.4? Thanks a lot</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10448621</commentid>
<comment_count>21</comment_count>
<who name="Jaroslav Mracek">jmracek</who>
<bug_when>2017-05-25 14:24:03 -0400</bug_when>
<thetext>I am sorry, but I am unable to reproduce a problem with dnf-2.4.1-1 that was released into rawhide and Fedora 26. Please if anyone will be able to reproduce the problem with dnf-2.4+, please reopen the bug report and we will be happy to fix it.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10453150</commentid>
<comment_count>22</comment_count>
<who name="Ali Akcaagac">aliakc</who>
<bug_when>2017-05-27 03:23:56 -0400</bug_when>
<thetext>Sorry for the delay in responding to this issue. I confirm that this issue has been addressed in dnf 2.4.x (infact I am on 2.5.x now). From my initial tests, it looks like the issue with pgpgkey verification is indeed gone. Thank you!</thetext>
</long_desc>

</bug>

</bugzilla>

<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1348883</bug_id>
          
          <creation_ts>2016-06-22 05:12:00 -0400</creation_ts>
          <short_desc>Can&apos;t pull docker images behind a corporate proxy even though http_proxy is apparently well setup</short_desc>
          <delta_ts>2016-12-10 15:19:34 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>docker</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Paul Matencio">paulo.matencio</reporter>
          <assigned_to name="Antonio Murdaca">amurdaca</assigned_to>
          <cc>adimania</cc>
    
    
    <cc>admiller</cc>
    
    
    <cc>amurdaca</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>fzipi</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>jcajka</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>lsm5</cc>
    
    
    <cc>marianne</cc>
    
    
    <cc>miminar</cc>
    
    
    <cc>nalin</cc>
    
    
    <cc>paulo.matencio</cc>
    
    
    <cc>riek</cc>
    
    
    <cc>vbatts</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-10 15:19:34</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9439916</commentid>
    <comment_count>0</comment_count>
    <who name="Paul Matencio">paulo.matencio</who>
    <bug_when>2016-06-22 05:12:51 -0400</bug_when>
    <thetext>Description of problem:

Can&apos;t pull docker images behind a corporate proxy even though http_proxy is apparently well setup


docker pull ubuntu

Using default tag: latest
Trying to pull repository docker.io/library/ubuntu ... failed
Error while pulling image: Get https://index.docker.io/v1/repositories/library/ubuntu/images: http: error connecting to proxy http://htp://proxylb.interna%C3%B6.epo.orh:8080: dial tcp: unknown port tcp/



The http_proxy has been setup as following 

cat /etc/systemd/system/docker.service.d/http-proxy.conf 
[Service]
Environment=&quot;HTTP_PROXY=http://proxylb.internal.epo.org:8080/&quot; &quot;HTTPS_PROXY=https://proxylb.internal.epo.org:8080/&quot; &quot;NO_PROXY=localhost,127.0.0.1&quot;

The above http_proxy setting worked fine with go 1.4.2  but has problem with  go 1.5.3. Not sue if building docker with go options GODEBUG=netdns=cgo will dolve the problem.


Version-Release number of selected component (if applicable):

Client:
 Version:         1.9.1
 API version:     1.21
 Package version: docker-1.9.1-9.gitee06d03.fc23.x86_64
 Go version:      go1.5.3
 Git commit:      ee06d03/1.9.1
 Built:           
 OS/Arch:         linux/amd64

Server:
 Version:         1.9.1
 API version:     1.21
 Package version: docker-1.9.1-9.gitee06d03.fc23.x86_64
 Go version:      go1.5.3
 Git commit:      ee06d03/1.9.1
 Built:           
 OS/Arch:         linux/amd64

How reproducible:


Steps to Reproduce:
1. Install Fedora-Cloud_Atomic-x86_64-23-20160607.iso
2. docker pull &lt;whatever container images&gt; 
3.

Actual results:

can&apos;t pull any  

Expected results:

Should pull the docker images 

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9800913</commentid>
    <comment_count>1</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2016-10-18 09:27:34 -0400</bug_when>
    <thetext>Are you still seeing this problem with docker-1.12?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9928485</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-25 04:21:26 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9972116</commentid>
    <comment_count>3</comment_count>
    <who name="Felipe Zipitría">fzipi</who>
    <bug_when>2016-12-09 10:38:25 -0500</bug_when>
    <thetext>Same problem happens on Fedora 25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9973442</commentid>
    <comment_count>4</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-12-10 03:22:39 -0500</bug_when>
    <thetext>Felipe, could you provide more info about the error and the reproducer you&apos;re getting in F25? 
The first comment tells me that there was a typo in the configuration honestly:

 http: error connecting to proxy http://htp://proxylb.interna%C3%B6.epo.orh:8080: dial tcp: unknown port tcp/

The configuration provided looks good but there&apos;s a weird &quot;htp://&quot; in the above error which makes me think this was just a typo. 

HTH if you can give me more information.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9973731</commentid>
    <comment_count>5</comment_count>
    <who name="Felipe Zipitría">fzipi</who>
    <bug_when>2016-12-10 10:01:48 -0500</bug_when>
    <thetext>The same configuration was working as expected in F24. I&apos;ve made a system-upgrade, so I was confident it should work well.

But after trying some builds, I&apos;ve found that neither build or pull were using my proxy.

Here&apos;s my &apos;/etc/systemd/system/docker.service.d/http-proxy.conf&apos;:
[Service]
Environment=&quot;HTTP_PROXY=http://proxy.mysite.uy:3128/&quot;
Environment=&quot;http_proxy=http://proxy.mysite.uy:3128/&quot;
Environment=&quot;HTTPS_PROXY=http://proxy.mysite.uy:3128/&quot;
Environment=&quot;https_proxy=http://proxy.mysite.uy:3128/&quot;

For building I&apos;ve been using this command:
sudo docker build --build-arg https_proxy=http://proxy.mysite.uy:3128 --build-arg http_proxy=http://proxy.mysite.uy:3128 --build-arg HTTPS_PROXY=http://proxy.mysite.uy:3128 --build-arg HTTP_PROXY=http://proxy.mysite.uy:3128 -t fzipi/coq-makefile-build .

In both cases, there is a timeout because is trying to pull wihtout using the http_proxy.

sudo docker --debug=true -l debug pull centos:7
Trying to pull repository docker.io/library/centos ... 
Get https://auth.docker.io/token?scope=repository%3Alibrary%2Fcentos%3Apull&amp;service=registry.docker.io: dial tcp 52.55.243.236:443: getsockopt: connection timed out

And journalctl says:

-- Logs begin at vie 2015-11-20 09:00:55 UYT, end at sáb 2016-12-10 11:57:21 UYT. --
dic 10 11:55:32 misite.uy dockerd-current[8560]: time=&quot;2016-12-10T11:55:32.041481128-03:00&quot; level=error msg=&quot;Error trying v2 registry: Get https://auth.docker.io/token?scope=reposit
ory%3Alibrary%2Fcentos%3Apull&amp;service=registry.docker.io: dial tcp 52.72.174.83:443: getsockopt: connection timed out&quot;
dic 10 11:55:32 misite.uy dockerd-current[8560]: time=&quot;2016-12-10T11:55:32.041531593-03:00&quot; level=error msg=&quot;Not continuing with pull after error: Get https://auth.docker.io/token?s
cope=repository%3Alibrary%2Fcentos%3Apull&amp;service=registry.docker.io: dial tcp 52.72.174.83:443: getsockopt: connection timed out&quot;
dic 10 11:56:04 misite.uy dockerd-current[8560]: time=&quot;2016-12-10T11:56:04.809468337-03:00&quot; level=error msg=&quot;Error trying v2 registry: Get https://auth.docker.io/token?scope=reposit
ory%3Alibrary%2Fcentos%3Apull&amp;service=registry.docker.io: dial tcp 52.55.243.236:443: getsockopt: connection timed out&quot;
dic 10 11:56:04 misite.uy dockerd-current[8560]: time=&quot;2016-12-10T11:56:04.809506285-03:00&quot; level=error msg=&quot;Attempting next endpoint for pull after error: Get https://auth.docker.i
o/token?scope=repository%3Alibrary%2Fcentos%3Apull&amp;service=registry.docker.io: dial tcp 52.55.243.236:443: getsockopt: connection timed out&quot;

The most frustrating part is that this setup was already working on F24.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9973768</commentid>
    <comment_count>6</comment_count>
    <who name="Antonio Murdaca">amurdaca</who>
    <bug_when>2016-12-10 10:46:56 -0500</bug_when>
    <thetext>That&apos;s clearly not the same issue as the one reported here, as you stated this was working on F24 so... Please provide the output of docker version and docker info.
What you&apos;re reporting sounds like an issue I&apos;ve already fixed for F25 some time ago. Please make sure to provide the info I requested. Before doing that, please update your system (or just Docker) and try to pull again. The issue you&apos;re having is probably https://bugzilla.redhat.com/show_bug.cgi?id=1398631 so make sure you&apos;re using at least docker-1.12.3-10.git7b5044b.fc25</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9973924</commentid>
    <comment_count>7</comment_count>
    <who name="Felipe Zipitría">fzipi</who>
    <bug_when>2016-12-10 15:13:37 -0500</bug_when>
    <thetext>You&apos;re right Antonio. I had docker-1.12.3-9.git47e22f2.fc25, and after updating to docker-1.12.3-12.git97974ae.fc25 all is working again.

Sorry about confusing both issues, now that I read the other one it seems to be more accurate in the description of the problem (or maybe you should close this one).

Felipe.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
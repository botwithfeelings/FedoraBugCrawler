<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1458520</bug_id>
          
          <creation_ts>2017-06-03 17:36:00 -0400</creation_ts>
          <short_desc>nethack: sudden exit with X Error</short_desc>
          <delta_ts>2017-07-07 19:00:21 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>nethack</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>low</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jerry James">loganjerry</reporter>
          <assigned_to name="Luke Macken">lewk</assigned_to>
          <cc>cummings</cc>
    
    
    <cc>fale</cc>
    
    
    <cc>lewk</cc>
    
    
    <cc>loganjerry</cc>
    
    
    <cc>tachoknight</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>nethack-3.6.0-38.fc25 nethack-3.6.0-38.fc24 nethack-3.6.0-38.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-07-05 22:22:32</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10474483</commentid>
    <comment_count>0</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2017-06-03 17:36:01 -0400</bug_when>
    <thetext>Description of problem:
I tried out the new version of nethack.  On the 1st level, my character was killed by a newt.  Sad, isn&apos;t it?  Instead of showing me the usual end of game information, though, the window closed abruptly and left this on the terminal:

Failed to load pilemark.xbm
X Error of failed request:  BadDrawable (invalid Pixmap or Window parameter)
  Major opcode of failed request:  63 (X_CopyPlane)
  Resource id in failed request:  0x0
  Serial number of failed request:  12308
  Current serial number in output stream:  12378

I&apos;m pretty sure I saw the pilemark.xbm complaint there prior to the end of the game, so that is probably not related.  I am using an X session, not a Wayland session.

Version-Release number of selected component (if applicable):
nethack-3.6.0-36.fc25.x86_64

How reproducible:
I don&apos;t know yet.  Will try again.

Steps to Reproduce:
1. Play the game in an X session.
2. Get killed.  That&apos;s probably the easiest step.
3. See the window close abruptly.

Actual results:
The window closed suddenly, skipping the usual end of game information.

Expected results:
No X errors, and end of game information shown.

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10474484</commentid>
    <comment_count>1</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2017-06-03 17:40:34 -0400</bug_when>
    <thetext>First, I got the pilemark.xbm message on startup, so while that should probably be fixed, it is not related.

Second, I tried playing again.  I had just killed kobold, and stepped onto the pile of darts it left behind when this happened again, so me getting killed has nothing to do with it.  Once again, it is a BadDrawable error.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10474520</commentid>
    <comment_count>2</comment_count>
    <who name="Ron Olson">tachoknight</who>
    <bug_when>2017-06-03 20:06:12 -0400</bug_when>
    <thetext>I tried reproducing this in an xterm and running Gnome in X (not Wayland) on F25 but can&apos;t reproduce *anything* in this bug report; no errors on startup, no crashing on getting killed (had to get to level 2 without my kitten as it was killing everything around me as I just stood there). 

Any chance to get some more info on your setup?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10474603</commentid>
    <comment_count>3</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2017-06-03 23:55:59 -0400</bug_when>
    <thetext>You know, it would have been really helpful if I had mentioned that I have this in my ~/.nethackrc:

OPTIONS=menustyle:partial,time,showexp,showscore,!silent
OPTIONS=number_pad,hilite_pet,toptenwin,msghistory:250,windowtype:X11

Sorry about that.  Probably the windowtype:X11 is the only important part as far as this bug is concerned.

And, by the way, /usr/games/nethack-3.6.0/recover is missing executable bits, and doesn&apos;t work even after adding executable bits:

# /usr/games/nethack-3.6.0/recover alock
Cannot open level 0 for alock.

That appears to be the same bug I filed years ago, which was eventually closed without being fixed: recover is looking in the wrong directory.  Running under strace shows:

chdir(&quot;/usr/games/nethack-3.6.0&quot;)       = 0
open(&quot;alock.0&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
write(2, &quot;Cannot open level 0 for alock.\n&quot;, 31Cannot open level 0 for alock.
) = 31
exit_group(0)                           = ?

The alock files are in /var/games/nethack.  And after moving the alock files to /var/games/nethack, recover STILL doesn&apos;t work:

# /usr/games/nethack-3.6.0/recover alock
Cannot create savefile save/1000jamesjer.

... because it is trying to write to /usr/games/nethack-3.6.0/save/1000jamesjer, but the save directory is in /var/games/nethack.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10474607</commentid>
    <comment_count>4</comment_count>
    <who name="Jerry James">loganjerry</who>
    <bug_when>2017-06-04 00:01:55 -0400</bug_when>
    <thetext>(In reply to Jerry James from comment #3)
&gt; ... because it is trying to write to
&gt; /usr/games/nethack-3.6.0/save/1000jamesjer, but the save directory is in
&gt; /var/games/nethack.

And even after making a symlink to work around this problem, things STILL don&apos;t work correctly because recover creates 1000jamesjer, but the nethack game looks for 1000jamesjer.gz and, not finding it, offers to start the game from scratch again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10475140</commentid>
    <comment_count>5</comment_count>
    <who name="Ron Olson">tachoknight</who>
    <bug_when>2017-06-04 18:04:56 -0400</bug_when>
    <thetext>&quot;And, by the way, /usr/games/nethack-3.6.0/recover is missing executable bits, and doesn&apos;t work even after adding executable bits:&quot;

Please submit a separate bug report for this for tracking purposes.

I get the same error about &apos;Failed to load pilemark.xbm&apos;, but not the crashing. This is supposedly fixed in 3.6.1 so I&apos;ll compile that and see if that&apos;s still an issue, along with your crashing problem.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10511601</commentid>
    <comment_count>6</comment_count>
    <who name="Ron Olson">tachoknight</who>
    <bug_when>2017-06-15 23:27:28 -0400</bug_when>
    <thetext>(In reply to Jerry James from comment #4)
&gt; (In reply to Jerry James from comment #3)
&gt; &gt; ... because it is trying to write to
&gt; &gt; /usr/games/nethack-3.6.0/save/1000jamesjer, but the save directory is in
&gt; &gt; /var/games/nethack.
&gt; 
&gt; And even after making a symlink to work around this problem, things STILL
&gt; don&apos;t work correctly because recover creates 1000jamesjer, but the nethack
&gt; game looks for 1000jamesjer.gz and, not finding it, offers to start the game
&gt; from scratch again.

I submitted an update to fix this particular issue (recover program does not have executable bits set). This will be in nethack-3.6.0-37; please submit a ticket for it so it can be tracked.

In regards to the original bug 
My patches break on 3.6.1 so there&apos;s some work to be done to get it to build and package properly so I can test that the pilemark/X crashing error.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10537730</commentid>
    <comment_count>7</comment_count>
    <who name="Kevin J. Cummings">cummings</who>
    <bug_when>2017-06-25 00:06:54 -0400</bug_when>
    <thetext>I too am getting sudden errors, but I get mine while playing.  I&apos;m not sure what the problem is (how to reliably recreate), but I find that by just playing the game, before I die, the window suddenly disappears.

When I run the game from an xterm, I, too, see the pilemark.xbm error.  Upon further investigation, I find that there is no pilemark.xbm file in the RPM.
So, I downloaded the source tarball, and copied the pilemake.xbm file from
nethack-3.6.0/win/X11 to /usr/games/nethack-3.6.0

Now, I can play the game to completion.  Looks like this file needs to be included in the RPM.  Note that this file was not present in nethack 3.4.3.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10538466</commentid>
    <comment_count>8</comment_count>
    <who name="Ron Olson">tachoknight</who>
    <bug_when>2017-06-25 20:41:35 -0400</bug_when>
    <thetext>Yes, I found it as well. I&apos;ll update the rpm to include it; sorry about that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10542397</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-26 22:37:32 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-48c0c655e6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545176</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 13:21:02 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-48c0c655e6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545199</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 13:26:12 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-c5e887fc01</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545664</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 16:25:55 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-74d4aa87df</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10569080</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-05 22:22:32 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10569965</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-06 04:52:37 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10575996</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-07 19:00:21 -0400</bug_when>
    <thetext>nethack-3.6.0-38.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
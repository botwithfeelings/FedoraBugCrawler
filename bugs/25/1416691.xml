<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1416691</bug_id>
          
          <creation_ts>2017-01-26 04:25:00 -0500</creation_ts>
          <short_desc>gettext-0.19.8.1-3.fc25 FTBFS when building without git</short_desc>
          <delta_ts>2017-03-06 12:26:56 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gettext</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1161284</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1400162</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Merlin Mathesius">mmathesi</reporter>
          <assigned_to name="Pavel Raiskup">praiskup</assigned_to>
          <cc>dueno</cc>
    
    
    <cc>i18n-bugs</cc>
    
    
    <cc>petersen</cc>
    
    
    <cc>praiskup</cc>
    
    
    <cc>psabata</cc>
    
    
    <cc>sgallagh</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-26 10:03:29</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10098124</commentid>
    <comment_count>0</comment_count>
    <who name="Merlin Mathesius">mmathesi</who>
    <bug_when>2017-01-26 04:25:32 -0500</bug_when>
    <thetext>Description of problem:
When attempting to rebuild portions of the frozen package set of Fedora 25 for the Base Runtime effort, we discovered that gettext has an undesirable hard runtime requirement upon git. When making a test build without git, it was also found that the package fails to build due to %autosetup&apos;s use of git.

Version-Release number of selected component (if applicable):
gettext-0.19.8.1-3.fc25

How reproducible:
Every time

Steps to Reproduce (rawhide):
1. fedpkg clone gettext &amp;&amp; cd gettext
2. fedpkg switch-branch master
3. fedpkg srpm
4. mock --root=fedora-25-x86_64 --without=git gettext-0.19.8.1-6.fc26.src.rpm 

Actual results:
Executing(%prep): /bin/sh -e /var/tmp/rpm-tmp.42u1jg
+ umask 022
+ cd /builddir/build/BUILD
+ cd /builddir/build/BUILD
+ rm -rf gettext-0.19.8.1
+ /usr/bin/tar -xof -
+ /usr/bin/xz -dc /builddir/build/SOURCES/gettext-0.19.8.1.tar.xz
+ STATUS=0
+ &apos;[&apos; 0 -ne 0 &apos;]&apos;
+ cd gettext-0.19.8.1
+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .
+ /usr/bin/git init -q
/var/tmp/rpm-tmp.42u1jg: line 42: /usr/bin/git: No such file or directory


Expected results:
Successful build of the package.

Additional info:
Attached is a patch that corrects the error when building without git. The patch also fixes the default &quot;with git&quot; case so the gettext-devel subpackage only Recommends: git rather than the strict Requires to avoid at unnecessary mandatory dependency upon git. This is needed for the Base Runtime Project.

Please apply the patch or respond with a reason it should not be applied within two weeks. After that time, a provenpackager will go ahead and apply it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10098140</commentid>
    <comment_count>1</comment_count>
      <attachid>1244654</attachid>
    <who name="Merlin Mathesius">mmathesi</who>
    <bug_when>2017-01-26 04:31:26 -0500</bug_when>
    <thetext>Created attachment 1244654
proposed patch to correct FTBFS issue and git dependency</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10098169</commentid>
    <comment_count>2</comment_count>
    <who name="Pavel Raiskup">praiskup</who>
    <bug_when>2017-01-26 04:36:07 -0500</bug_when>
    <thetext>Speaking about BuildRequires issue ... so does that mean that you can&apos;t
build Base Runtime package against non-Base Runtime package?  Why?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10098188</commentid>
    <comment_count>3</comment_count>
    <who name="Pavel Raiskup">praiskup</who>
    <bug_when>2017-01-26 04:41:16 -0500</bug_when>
    <thetext>I mean, what&apos;s wrong on &apos;%autosetup -S git&apos;?  I&apos;ll rather drop that
unconditionally because that&apos;s not related to &apos;bcond_with git&apos; switch ..

Also, doing such changes is a bit annoying, there&apos;s basically nothing
wrong on &apos;-S git&apos; ... and I&apos;m curious whether you document somewhere that
it is from now forbidden to use &apos;%autosetup -S git&apos; from now for &quot;certain&quot;
set of packages.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10098360</commentid>
    <comment_count>4</comment_count>
    <who name="Merlin Mathesius">mmathesi</who>
    <bug_when>2017-01-26 05:36:38 -0500</bug_when>
    <thetext>Sorry if I wasn&apos;t clear, but there are two things are going on here.

1. There&apos;s nothing wrong with using %autosetup &apos;-S git&apos;, but it does mean there needs to be a &apos;BuildRequires: git&apos;--since git is not otherwise guaranteed to be in the buildroot. That BR is currently within a &quot;%{with git}&quot; conditional. Thus, when attempting to build using the --without=git, the build fails.

2. For Base Runtime, we are making every effort to eliminate unnecessary mandatory dependencies to minimize the size. Base Runtime should include the gettext-devel subpackage, but we do not want to include git, Changing the &quot;Requires: git&quot; to &quot;Recommends: git&quot; will allow that--since git doesn&apos;t need to be a strict requirement. Such a change should also do no harm for the standard Fedora releases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10098713</commentid>
    <comment_count>5</comment_count>
    <who name="Pavel Raiskup">praiskup</who>
    <bug_when>2017-01-26 07:18:09 -0500</bug_when>
    <thetext>(In reply to Merlin Mathesius from comment #4)
&gt; Sorry if I wasn&apos;t clear, but there are two things are going on here.
&gt; 
&gt; 1. There&apos;s nothing wrong with using %autosetup &apos;-S git&apos;, but it does mean
&gt; there needs to be a &apos;BuildRequires: git&apos;--since git is not otherwise
&gt; guaranteed to be in the buildroot. That BR is currently within a &quot;%{with
&gt; git}&quot; conditional. Thus, when attempting to build using the --without=git,
&gt; the build fails.

That sounds good then.  We can have the BuildRequires unconditional.

&gt; 2. For Base Runtime, we are making every effort to eliminate unnecessary
&gt;    mandatory dependencies to minimize the size. Base Runtime should
&gt;    include the gettext-devel subpackage, but we do not want to include
&gt;    git, Changing the &quot;Requires: git&quot; to &quot;Recommends: git&quot; will allow
&gt;    that--since git doesn&apos;t need to be a strict requirement. Such a
&gt;    change should also do no harm for the standard Fedora releases.

Based on bug 1161284 (and based on /bin/autopoint source code), we can
avoid git dependency.

Rawhide:
http://pkgs.fedoraproject.org/cgit/rpms/gettext.git/commit/?id=83c226dd020a8f15

Can you confirm it is OK?  There was also bug 1405433 (related to Base
Runtime?), which was _not_ merged into F25.  So I guess it is OK to stay in
Rawhide with this bugreport, right?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10099137</commentid>
    <comment_count>6</comment_count>
    <who name="Merlin Mathesius">mmathesi</who>
    <bug_when>2017-01-26 09:56:22 -0500</bug_when>
    <thetext>Rawhide is fine. Thank you for the quick fix!</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1244654</attachid>
            <date>2017-01-26 04:31:00 -0500</date>
            <delta_ts>2017-01-26 04:31:26 -0500</delta_ts>
            <desc>proposed patch to correct FTBFS issue and git dependency</desc>
            <filename>0001-BZ-1416691.patch</filename>
            <type>text/plain</type>
            <size>1528</size>
            <attacher name="Merlin Mathesius">mmathesi</attacher>
            
              <data encoding="base64">RnJvbSA5NzFhYjVkNWYwMGM5ZjY5NjE5OWNmZTEzZjMyOWFjM2YxNWRmNzg4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBNZXJsaW4gTWF0aGVzaXVzIDxtbWF0aGVzaUByZWRoYXQuY29t
PgpEYXRlOiBUaHUsIDI2IEphbiAyMDE3IDAzOjI5OjA1IC0wNjAwClN1YmplY3Q6IFtQQVRDSF0g
QlojMTQxNjY5MSBGaXggYnVpbGQgZXJyb3Igd2hlbiBidWlsZGluZyB3aXRob3V0IGdpdC4gV2Vh
a2VuCiBydW50aW1lIGRlcGVuZGVuY3kgb24gZ2l0IGZyb20gUmVxdWlyZXMgdG8gUmVjb21tZW5k
cy4KCi0tLQogZ2V0dGV4dC5zcGVjIHwgMTMgKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQs
IDExIGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZ2V0dGV4dC5z
cGVjIGIvZ2V0dGV4dC5zcGVjCmluZGV4IGJiZjA2NWMuLjZhMTVhYjQgMTAwNjQ0Ci0tLSBhL2dl
dHRleHQuc3BlYworKysgYi9nZXR0ZXh0LnNwZWMKQEAgLTksNyArOSw3IEBACiBTdW1tYXJ5OiBH
TlUgbGlicmFyaWVzIGFuZCB1dGlsaXRpZXMgZm9yIHByb2R1Y2luZyBtdWx0aS1saW5ndWFsIG1l
c3NhZ2VzCiBOYW1lOiBnZXR0ZXh0CiBWZXJzaW9uOiAwLjE5LjguMQotUmVsZWFzZTogNiV7P2Rp
c3R9CitSZWxlYXNlOiA3JXs/ZGlzdH0KIExpY2Vuc2U6IEdQTHYzKyBhbmQgTEdQTHYyKwogR3Jv
dXA6IERldmVsb3BtZW50L1Rvb2xzCiBVUkw6IGh0dHA6Ly93d3cuZ251Lm9yZy9zb2Z0d2FyZS9n
ZXR0ZXh0LwpAQCAtOTgsNyArOTgsNyBAQCBSZXF1aXJlcyhwb3N0KTogaW5mbwogUmVxdWlyZXMo
cHJldW4pOiBpbmZvCiAlaWYgJXt3aXRoIGdpdH0KICMgZm9yIGF1dG9wb2ludAotUmVxdWlyZXM6
IGdpdAorUmVjb21tZW5kczogZ2l0CiAlZW5kaWYKIFJlcXVpcmVzOiB4egogT2Jzb2xldGVzOiBn
ZXR0ZXh0LWF1dG9wb2ludCA8IDAuMTguMS4xLTMKQEAgLTE0NSw3ICsxNDUsMTEgQEAgdGhpbmsg
YWJvdXQuCiAKIAogJXByZXAKKyVpZiAle3dpdGggZ2l0fQogJWF1dG9zZXR1cCAtbiAle25hbWV9
LSV7dGFydmVyc2lvbn0gLVMgZ2l0CislZWxzZQorJWF1dG9zZXR1cCAtbiAle25hbWV9LSV7dGFy
dmVyc2lvbn0gLXAgMQorJWVuZGlmCiAKIAogJWJ1aWxkCkBAIC0zNTgsNiArMzYyLDExIEBAIGZp
CiAle19tYW5kaXJ9L21hbjEvbXNnaGFjay4xKgogCiAlY2hhbmdlbG9nCisqIFdlZCBKYW4gMjUg
MjAxNyBNZXJsaW4gTWF0aGVzaXVzIDxtbWF0aGVzaUByZWRoYXQuY29tPiAtIDAuMTkuOC4xLTcK
Ky0gQlojMTQxNjY5MQorLSBGaXggYnVpbGQgZXJyb3Igd2hlbiBidWlsZGluZyB3aXRob3V0IGdp
dC4KKy0gV2Vha2VuIHJ1bnRpbWUgZGVwZW5kZW5jeSBvbiBnaXQgZnJvbSBSZXF1aXJlcyB0byBS
ZWNvbW1lbmRzLgorCiAqIFdlZCBEZWMgMjEgMjAxNiBQYXZlbCBSYWlza3VwIDxwcmFpc2t1cEBy
ZWRoYXQuY29tPiAtIDAuMTkuOC4xLTYKIC0gZGlzYWJsZSB0ZXN0LWxvY2sgZm9yICdnZXR0ZXh0
LXRvb2wnIHN1YmRpciB0b28gKHJoYnojMTQwNjAzMSkKIAotLSAKMi45LjMKCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>
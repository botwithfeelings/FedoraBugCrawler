<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1405028</bug_id>
          
          <creation_ts>2016-12-15 07:22:00 -0500</creation_ts>
          <short_desc>container-selinux-1.12.4-2.git1b5971a.fc25.x86_64 fails to load module, docker run does not work</short_desc>
          <delta_ts>2016-12-15 19:27:41 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>docker</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Regression</keywords>
          <priority>urgent</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Pazdziora">jpazdziora</reporter>
          <assigned_to name="Daniel Walsh">dwalsh</assigned_to>
          <cc>adimania</cc>
    
    
    <cc>admiller</cc>
    
    
    <cc>amurdaca</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>jcajka</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>lsm5</cc>
    
    
    <cc>marianne</cc>
    
    
    <cc>miminar</cc>
    
    
    <cc>nalin</cc>
    
    
    <cc>riek</cc>
    
    
    <cc>vbatts</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>docker-1.12.4-6.git1b5971a.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-15 19:27:41</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9989519</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Pazdziora">jpazdziora</who>
    <bug_when>2016-12-15 07:22:40 -0500</bug_when>
    <thetext>Description of problem:

When installing docker-1.12.4-2.git1b5971a.fc25.x86_64 and its dependency container-selinux-1.12.4-2.git1b5971a.fc25.x86_64, there is semodule error

/var/lib/selinux/final/targeted/contexts/files/file_contexts: Multiple different specifications for /var/lib/containers(/.*)?  (system_u:object_r:gear_var_lib_t:s0 and system_u:object_r:container_var_lib_t:s0).
/var/lib/selinux/final/targeted/contexts/files/file_contexts: Invalid argument
libsemanage.semanage_validate_and_compile_fcontexts: setfiles returned error code 1.
/usr/sbin/semodule:  Failed!

shown and attempt to run container fails, with AVC denial.

Version-Release number of selected component (if applicable):

container-selinux-1.12.4-2.git1b5971a.fc25.x86_64

How reproducible:

Deterministic.

Steps to Reproduce:
1. dnf install -y docker
2. systemctl start docker
3. docker run --rm -ti fedora:25 cat /etc/fedora-release

Actual results:

  Installing  : policycoreutils-python-utils-2.5-19.fc25.x86_64           11/16 
  Installing  : container-selinux-2:1.12.4-2.git1b5971a.fc25.x86_64       12/16 
/var/lib/selinux/final/targeted/contexts/files/file_contexts: Multiple different specifications for /var/lib/containers(/.*)?  (system_u:object_r:gear_var_lib_t:s0 and system_u:object_r:container_var_lib_t:s0).
/var/lib/selinux/final/targeted/contexts/files/file_contexts: Invalid argument
libsemanage.semanage_validate_and_compile_fcontexts: setfiles returned error code 1.
/usr/sbin/semodule:  Failed!
  Installing  : docker-common-2:1.12.4-2.git1b5971a.fc25.x86_64           13/16 
  Installing  : docker-2:1.12.4-2.git1b5971a.fc25.x86_64                  14/16 
  Installing  : oci-systemd-hook-0.1.4-3.git41491a3.fc25.x86_64           15/16 
  Installing  : oci-register-machine-0-2.7.gitbb20b00.fc25.x86_64         16/16 

# docker run --rm -ti fedora:25 cat /etc/fedora-release
/usr/bin/docker-current: Error response from daemon: invalid header field value &quot;oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:334: running prestart hook 1 caused \\\&quot;error running hook: exit status 1, stdout: , stderr: \\\&quot;\&quot;\n&quot;.

Expected results:

No error during dnf install.

# docker run --rm -ti fedora:25 cat /etc/fedora-release
Fedora release 25 (Twenty Five)

Additional info:

type=AVC msg=audit(1481803735.800:265): avc:  denied  { search } for  pid=3776 comm=&quot;systemd-machine&quot; name=&quot;8380&quot; dev=&quot;proc&quot; ino=46377 scontext=system_u:system_r:systemd_machined_t:s0 tcontext=system_u:system_r:unconfined_service_t:s0 tclass=dir permissive=0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9989578</commentid>
    <comment_count>1</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-15 07:28:57 -0500</bug_when>
    <thetext>docker-1.12.4-6.git1b5971a.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-44ed3dd527</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9991842</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-15 19:27:41 -0500</bug_when>
    <thetext>docker-1.12.4-6.git1b5971a.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
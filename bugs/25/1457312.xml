<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1457312</bug_id>
          
          <creation_ts>2017-05-31 09:36:00 -0400</creation_ts>
          <short_desc>AVCs seen during deployment of Fedora 26 ipa-server-docker image</short_desc>
          <delta_ts>2017-06-15 05:23:21 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>container-selinux</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>medium</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Babinsky">mbabinsk</reporter>
          <assigned_to name="Daniel Walsh">dwalsh</assigned_to>
          <cc>amurdaca</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>fkluknav</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>jlebon</cc>
    
    
    <cc>lsm5</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>container-selinux-2.18-1.fc26 container-selinux-2.18-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-13 09:35:35</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10463606</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Babinsky">mbabinsk</who>
    <bug_when>2017-05-31 09:36:43 -0400</bug_when>
    <thetext>Description of problem:

When running ipa-server-docker container based on Fedora 26 image on Fedora 25, We can observe the following AVCs related to configuration of NTP:

```
time-&gt;Tue May 30 06:27:59 2017
type=AVC msg=audit(1496140079.957:317): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:27:59 2017
type=AVC msg=audit(1496140079.957:318): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:28:55 2017
type=AVC msg=audit(1496140135.956:326): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:28:59 2017
type=AVC msg=audit(1496140139.956:328): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:28:58 2017
type=AVC msg=audit(1496140138.956:327): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:29:04 2017
type=AVC msg=audit(1496140144.956:330): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:29:03 2017
type=AVC msg=audit(1496140143.956:329): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:29:38 2017
type=AVC msg=audit(1496140178.957:331): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:29:59 2017
type=AVC msg=audit(1496140199.957:339): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:30:03 2017
type=AVC msg=audit(1496140203.959:347): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:30:06 2017
type=AVC msg=audit(1496140206.957:348): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:30:08 2017
type=AVC msg=audit(1496140208.957:349): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Tue May 30 06:30:10 2017
type=AVC msg=audit(1496140210.957:350): avc:  denied  { module_request } for  pid=18483 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c30,c644 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
```

While they do not seem to interfere with the operation of the container, they can cause false positive error reports and even conceal more serious selinux issues during debugging.

Version-Release number of selected component (if applicable):
Host: Fedora 25
Packages:

audit-libs-python3     x86_64 2.7.6-1.fc25                 updates        78 k
 checkpolicy            x86_64 2.5-8.fc25                   beaker-Fedora 297 k
 container-selinux      noarch 2:2.14-1.fc25                updates        32 k
 docker                 x86_64 2:1.12.6-6.gitae7d637.fc25   updates        17 M
 docker-common          x86_64 2:1.12.6-6.gitae7d637.fc25   updates        71 k
 gnupg                  x86_64 1.4.21-1.fc25                beaker-Fedora 1.3 M
 libcgroup              x86_64 0.41-9.fc25                  beaker-Fedora  67 k
 libsemanage-python3    x86_64 2.5-9.fc25                   updates       111 k
 libusb                 x86_64 1:0.1.5-7.fc24               beaker-Fedora  40 k
 oci-register-machine   x86_64 0-3.7.gitbb20b00.fc25        updates       954 k
 oci-systemd-hook       x86_64 1:0.1.7-1.git1788cf2.fc25    updates        32 k
 policycoreutils-python-utils
                        x86_64 2.5-20.fc25                  updates       217 k
 policycoreutils-python3
                        x86_64 2.5-20.fc25                  updates       1.8 M
 python-IPy-python3     noarch 0.81-16.fc25                 beaker-Fedora  43 k
 setools-libs           x86_64 3.3.8-12.fc25                beaker-Fedora 560 k
 skopeo-containers      x86_64 0.1.19-1.dev.git0224d8c.fc25 updates       9.6 k
 sqlite                 x86_64 3.14.2-1.fc25                beaker-Fedora 490 k
 systemd-container      x86_64 231-15.fc25                  updates       412 k
 yajl                   x86_64 2.1.0-5.fc24                 beaker-Fedora  37 k


Image: Fedora 26
Packages: freeipa-server-x86_64 4.4.4-1.fc26, ntp-x86_64 4.2.8p10-1.fc26

How reproducible:
Always

Steps to Reproduce:
1. docker pull freeipa/freeipa-server:fedora-26
2. install freeipa-server (easiest using atomic
3. ausearch -m avc -i

Actual results:
AVCs shown above are reported

Expected results:
No AVCs in the log</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10464860</commentid>
    <comment_count>2</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-05-31 12:03:18 -0400</bug_when>
    <thetext>These look like you have disabled ipv6, somewhat incorrectly.  These AVC&apos;s indicate that the container will cause IPv6 to start running. We could don&apos;t audit these avcs/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10470678</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-01 21:13:47 -0400</bug_when>
    <thetext>container-selinux-2.16-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-39b21be7b7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10470679</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-01 21:14:00 -0400</bug_when>
    <thetext>container-selinux-2.16-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-4ba099329f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10474016</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-03 00:37:01 -0400</bug_when>
    <thetext>container-selinux-2.16-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-4ba099329f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10475053</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-04 15:39:54 -0400</bug_when>
    <thetext>container-selinux-2.16-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-39b21be7b7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10481213</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-06 08:58:03 -0400</bug_when>
    <thetext>container-selinux-2.17-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-483d4b64eb</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10481218</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-06 08:58:22 -0400</bug_when>
    <thetext>container-selinux-2.17-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-6d722cd191</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10482810</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-06 15:05:59 -0400</bug_when>
    <thetext>container-selinux-2.17-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-6d722cd191</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10483239</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-06 16:58:56 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-78ffa38344</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10483242</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-06 16:59:15 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-e756e8fdde</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10484366</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-07 03:35:06 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-78ffa38344</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10487458</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-07 19:10:58 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-e756e8fdde</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10501312</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-13 09:35:35 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10504621</commentid>
    <comment_count>15</comment_count>
    <who name="Martin Babinsky">mbabinsk</who>
    <bug_when>2017-06-14 06:31:15 -0400</bug_when>
    <thetext>I can still see the AVCs on F25 host with container-selinux-2:2.18-1.fc25.noarch when configuring freeipa-server:fedora-26

Moreover, I have noticed the following messages during the installation:

```
system.slice: Failed to set invocation ID on control group /system.slice/docker-5b9d4f31d91031388b0cf0951cddfa3d1e61b903ea39a90474d0f200cada714f.scope/system.slice, ignoring: Operation not permitted
systemd-journald.service: Failed to set invocation ID on control group /system.slice/docker-5b9d4f31d91031388b0cf0951cddfa3d1e61b903ea39a90474d0f200cada714f.scope/system.slice/systemd-journald.service, ignoring: Operation not permitted
fedora-readonly.service: Failed to set invocation ID on control group /system.slice/docker-5b9d4f31d91031388b0cf0951cddfa3d1e61b903ea39a90474d0f200cada714f.scope/system.slice/fedora-readonly.service, ignoring: Operation not permitted
```</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505291</commentid>
    <comment_count>16</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-14 09:26:59 -0400</bug_when>
    <thetext>Please show the latest avc&apos;s.  This looks like the contianer process is trying to set some content under /sys/fs/cgroup.

Which would indicate that you need container_manage_cgroup boolean turned on?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505395</commentid>
    <comment_count>17</comment_count>
    <who name="Martin Babinsky">mbabinsk</who>
    <bug_when>2017-06-14 09:51:28 -0400</bug_when>
    <thetext>AVCs are here:

```
----
time-&gt;Wed Jun 14 04:42:00 2017
type=AVC msg=audit(1497429720.408:383): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:42:01 2017
type=AVC msg=audit(1497429721.409:384): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:42:46 2017
type=AVC msg=audit(1497429766.458:388): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:43:50 2017
type=AVC msg=audit(1497429830.409:389): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:44:54 2017
type=AVC msg=audit(1497429894.409:390): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:44:57 2017
type=AVC msg=audit(1497429897.442:391): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:45:58 2017
type=AVC msg=audit(1497429958.409:392): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:47:02 2017
type=AVC msg=audit(1497430022.408:394): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
----
time-&gt;Wed Jun 14 04:48:06 2017
type=AVC msg=audit(1497430086.667:398): avc:  denied  { module_request } for  pid=21944 comm=&quot;ntpd&quot; kmod=&quot;net-pf-0&quot; scontext=system_u:system_r:container_t:s0:c720,c775 tcontext=system_u:system_r:kernel_t:s0 tclass=system permissive=0
```

I have checked my env and `container_manage_cgroup` is always turned on during test setup.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505438</commentid>
    <comment_count>18</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-14 10:01:51 -0400</bug_when>
    <thetext>Sorry never scrolled up to the top.

Container-selinux does not fix this, sorry I added it to the chain.

The problem here is we don&apos;t want to allow containers to trigger the kernel to load kernel modules.  If you want to run this container you would have to load the kernel module outside of the container. 

modutil net-pf-0 
 
Should eliminate this issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505443</commentid>
    <comment_count>19</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-14 10:02:34 -0400</bug_when>
    <thetext>I guess I could add a boolean to allow this behaviour, but I am not crazy about containers abiltiy to cause the kernel to modify itself.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10508535</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 05:23:21 -0400</bug_when>
    <thetext>container-selinux-2.18-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
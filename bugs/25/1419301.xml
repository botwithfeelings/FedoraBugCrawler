<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1419301</bug_id>
          
          <creation_ts>2017-02-04 21:08:00 -0500</creation_ts>
          <short_desc>SELinux is preventing python3 from &apos;write&apos; accesses on the directory __pycache__.</short_desc>
          <delta_ts>2017-03-16 18:21:40 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>python3</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:b2d1fab5ad20339fe282a9fb3ed82bfa95caf5a52d857c03636b7408035f33af;</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Filipe Rosset">rosset.filipe</reporter>
          <assigned_to name="Charalampos Stratakis">cstratak</assigned_to>
          <cc>alex.ploumistos</cc>
    
    
    <cc>bkabrda</cc>
    
    
    <cc>cstratak</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>ishcherb</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mcyprian</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>mhroncok</cc>
    
    
    <cc>nphilipp</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>pmoore</cc>
    
    
    <cc>proski</cc>
    
    
    <cc>pviktori</cc>
    
    
    <cc>rkuska</cc>
    
    
    <cc>ssekidde</cc>
    
    
    <cc>tomspur</cc>
    
    
    <cc>torsava</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>python3-3.5.3-3.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-16 18:21:40</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10121552</commentid>
    <comment_count>0</comment_count>
    <who name="Filipe Rosset">rosset.filipe</who>
    <bug_when>2017-02-04 21:08:41 -0500</bug_when>
    <thetext>Description of problem:
SELinux is preventing python3 from &apos;write&apos; accesses on the directory __pycache__.

*****  Plugin catchall (100. confidence) suggests   **************************

If você acredita que o python3 deva ser permitido acesso de write em __pycache__ directory  por default.
Then você deve informar que este é um erro.
Você pode gerar um módulo de política local para permitir este acesso.
Do
allow this access for now by executing:
# ausearch -c &apos;python3&apos; --raw | audit2allow -M my-python3
# semodule -X 300 -i my-python3.pp

Additional Information:
Source Context                system_u:system_r:blueman_t:s0-s0:c0.c1023
Target Context                system_u:object_r:lib_t:s0
Target Objects                __pycache__ [ dir ]
Source                        python3
Source Path                   python3
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-225.6.fc25.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     (removed)
Platform                      Linux (removed) 4.9.7-201.fc25.x86_64 #1 SMP Thu
                              Feb 2 23:32:42 UTC 2017 x86_64 x86_64
Alert Count                   55
First Seen                    2017-02-05 00:06:48 BRST
Last Seen                     2017-02-05 00:06:49 BRST
Local ID                      84074be3-b250-4b2f-a54a-c7b7ab1f4cf6

Raw Audit Messages
type=AVC msg=audit(1486260409.5:395): avc:  denied  { write } for  pid=2614 comm=&quot;blueman-mechani&quot; name=&quot;__pycache__&quot; dev=&quot;sdb7&quot; ino=13548 scontext=system_u:system_r:blueman_t:s0-s0:c0.c1023 tcontext=system_u:object_r:lib_t:s0 tclass=dir permissive=0


Hash: python3,blueman_t,lib_t,dir,write

Version-Release number of selected component:
selinux-policy-3.13.1-225.6.fc25.noarch

Additional info:
reporter:       libreport-2.8.0
hashmarkername: setroubleshoot
kernel:         4.9.7-201.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10129849</commentid>
    <comment_count>1</comment_count>
    <who name="Pavel Roskin">proski</who>
    <bug_when>2017-02-08 00:35:46 -0500</bug_when>
    <thetext>Got that issue as well. It appears to be relatively new. It started yesterday, but I&apos;m not using the system every day. It wasn&apos;t there a week ago. I&apos;m using Fedora 25 with updates-testing repository enabled.

Package versions:

kernel-4.9.7-201.fc25.x86_64
python3-3.5.3-1.fc25.x86_64
blueman-2.0.4-4.fc25.x86_64
libreport-2.8.0-1.fc25.x86_64
selinux-policy-3.13.1-225.6.fc25.noarch
selinux-policy-targeted-3.13.1-225.6.fc25.noarch

reason from the &quot;problem details&quot;:

SELinux is preventing python3 from &apos;write&apos; accesses on the directory /usr/lib/python3.5/site-packages/blueman/plugins/mechanism/__pycache__</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10143702</commentid>
    <comment_count>2</comment_count>
    <who name="Alexander Ploumistos">alex.ploumistos</who>
    <bug_when>2017-02-13 11:30:12 -0500</bug_when>
    <thetext>Description of problem:
This seems to happen on startup and keeps reappearing. Similar notifications pop up for firewalld and abrt-action-not:

SELinux is preventing firewalld from write access on the directory /usr/lib/python3.5/site-packages/firewall/core/__pycache__

SELinux is preventing abrt-action-not from write access on the directory /usr/lib64/python3.5/site-packages/dbus/__pycache__

I have kept this system in sync with updates-testing and it&apos;s been probably a little over a week since I first noticed these messages.


Additional info:
reporter:       libreport-2.8.0
hashmarkername: setroubleshoot
kernel:         4.9.9-200.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10232291</commentid>
    <comment_count>3</comment_count>
    <who name="Nils Philippsen">nphilipp</who>
    <bug_when>2017-03-13 05:55:51 -0400</bug_when>
    <thetext>I got this for /usr/lib/python3.5/site-packages/blueman/plugins/mechanism/__pycache__ but don&apos;t believe this is an SELinux policy problem as python shouldn&apos;t attempt to write these files at all -- the __pycache__/*.pyc files are all newer than their source counterparts:

root@gibraltar:/usr/lib/python3.5/site-packages/blueman/plugins/mechanism&gt; for py in *.py; do pyc=&quot;__pycache__/${py%.py}.cpython-35.pyc&quot;; pyo=&quot;__pycache__/${py%.py}.cpython-35.opt-1.pyc&quot;; [ ! &quot;$pyc&quot; -nt &quot;$py&quot; -o ! &quot;$pyo&quot; -nt &quot;$py&quot; ] &amp;&amp; echo $i; done
root@gibraltar:/usr/lib/python3.5/site-packages/blueman/plugins/mechanism&gt;

Apparently this has been fixed in python3 already, there&apos;s a testing update carrying this patch:

From 93602e3af70d3b9f98ae2da654b16b3382b68d50 Mon Sep 17 00:00:00 2001
From: Nick Coghlan &lt;ncoghlan@gmail.com&gt;
Date: Wed, 8 Mar 2017 16:41:01 +1000
Subject: [PATCH] [3.5] bpo-29537: Tolerate legacy invalid bytecode (#169)

bpo-27286 fixed a problem where BUILD_MAP_UNPACK_WITH_CALL could
be emitted with an incorrect oparg value, causing the eval loop
to access the wrong stack entry when attempting to read the
function name.

The associated magic number change caused significant problems when
attempting to upgrade to 3.5.3 for anyone that relies on pre-cached
bytecode remaining valid across maintenance releases.

This patch restores the ability to import legacy bytecode generated
by 3.5.0, 3.5.1 or 3.5.2, and modifies the eval loop to
avoid any harmful consequences from the potentially malformed legacy
bytecode.

Original import patch by Petr Viktorin, eval loop patch by Serhiy Storchaka,
and tests and integration by Nick Coghlan.

https://bodhi.fedoraproject.org/updates/FEDORA-2017-f1a1bb2c4c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10232300</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-13 05:57:55 -0400</bug_when>
    <thetext>python3-3.5.3-3.fc25 python3-docs-3.5.3-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-f1a1bb2c4c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10247662</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-16 18:21:40 -0400</bug_when>
    <thetext>python3-3.5.3-3.fc25, python3-docs-3.5.3-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
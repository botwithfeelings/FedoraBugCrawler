<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1396893</bug_id>
          
          <creation_ts>2016-11-21 01:02:00 -0500</creation_ts>
          <short_desc>ypbind-1.38-6.fc25.x86_64 breaks nis/yp</short_desc>
          <delta_ts>2016-11-30 00:28:57 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>ypbind</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ralf Corsepius">rc040203</reporter>
          <assigned_to name="Ralf Corsepius">rc040203</assigned_to>
          <cc>adler</cc>
    
    
    <cc>craig</cc>
    
    
    <cc>fweimer</cc>
    
    
    <cc>hhorak</cc>
    
    
    <cc>mmuzila</cc>
    
    
    <cc>paolini</cc>
    
    
    <cc>pkubat</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>ypbind-1.38-7.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-30 00:28:57</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9907128</commentid>
    <comment_count>0</comment_count>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-21 01:02:12 -0500</bug_when>
    <thetext>Description of problem:

ypbind-1.38-6.fc25.x86_64 breaks nis:

Upon bootup, ypbind fails to start:

# systemctl status ypbind
● ypbind.service - NIS/YP (Network Information Service) Clients to NIS Domain Binder
   Loaded: loaded (/usr/lib/systemd/system/ypbind.service; enabled; vendor preset: disabled)
   Active: failed (Result: timeout) since Mon 2016-11-21 06:48:49 CET; 23s ago
  Process: 1219 ExecStart=/usr/sbin/ypbind -n $OTHER_YPBIND_OPTS (code=exited, status=0/SUCCESS)
  Process: 1216 ExecStartPre=/usr/sbin/setsebool allow_ypbind=1 (code=exited, status=0/SUCCESS)
  Process: 1208 ExecStartPre=/usr/libexec/ypbind-pre-setdomain (code=exited, status=0/SUCCESS)
 Main PID: 1219 (code=exited, status=0/SUCCESS)

Nov 21 06:47:19 troy systemd[1]: Starting NIS/YP (Network Information Service) Clients to NIS Domain Binder...
Nov 21 06:47:19 troy ypbind-pre-setdomain[1208]: Setting NIS domain: &apos;&lt;DISCLOSED&gt;&apos; (environment variable)
Nov 21 06:48:49 troy systemd[1]: ypbind.service: Start operation timed out. Terminating.
Nov 21 06:48:49 troy systemd[1]: Failed to start NIS/YP (Network Information Service) Clients to NIS Domain Binder.
Nov 21 06:48:49 troy systemd[1]: ypbind.service: Unit entered failed state.
Nov 21 06:48:49 troy systemd[1]: ypbind.service: Failed with result &apos;timeout&apos;.


Version-Release number of selected component (if applicable):
ypbind-1.38-6.fc25


How reproducible:
Always, on different machines (albeit similar configurations).


Expected results:
Function.

Additional info:
- For me, ypserv stopped working when upgrading to ypserv-1.38-6.fc25. 
It did work with ypserv-1.38-5.fc24 (from fc25 Everything) + nss_nis. Downgrading to ypbind-1.38-5.fc24.x86_64 immediately remedies this issue:

# systemctl status ypbind
● ypbind.service - NIS/YP (Network Information Service) Clients to NIS Domain Binder
   Loaded: loaded (/usr/lib/systemd/system/ypbind.service; enabled; vendor preset: disabled)
   Active: failed (Result: timeout) since Mon 2016-11-21 06:48:49 CET; 23s ago
...
# dnf downgrade ypserv
...
# systemctl restart ypbind
...
# systemctl status ypbind
● ypbind.service - NIS/YP (Network Information Service) Clients to NIS Domain Binder
   Loaded: loaded (/usr/lib/systemd/system/ypbind.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2016-11-21 06:56:03 CET; 3min 43s ago
...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9915301</commentid>
    <comment_count>1</comment_count>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-23 04:48:39 -0500</bug_when>
    <thetext>(In reply to Ralf Corsepius from comment #0)
&gt; - For me, ypserv stopped working when upgrading to ypserv-1.38-6.fc25. 
&gt; It did work with ypserv-1.38-5.fc24 (from fc25 Everything) + nss_nis.
&gt; Downgrading to ypbind-1.38-5.fc24.x86_64 immediately remedies this issue:

Ouch, this of course should have read:
&gt; For me, ypbind stopped working when upgrading to ypbind-1.38-6.fc25. 
&gt; It did work with ypbind-1.38-5.fc24 (from fc25 Everything) + nss_nis.


Further observations:
- Invoking ypbind in a shell/on the command line works.

- &quot;systemctl start ypbind.service&quot;
deterministically fails:
# systemctl start ypbind.service
Job for ypbind.service failed because a timeout was exceeded.
..
# systemctl status ypbind.service
● ypbind.service - NIS/YP (Network Information Service) Clients to NIS Domain Binder
   Loaded: loaded (/usr/lib/systemd/system/ypbind.service; enabled; vendor preset: disabled)
   Active: failed (Result: timeout) since Wed 2016-11-23 10:19:46 CET; 8min ago
  Process: 23153 ExecStart=/usr/sbin/ypbind -n $OTHER_YPBIND_OPTS (code=exited, status=0/SUCCESS)
  Process: 23149 ExecStartPre=/usr/sbin/setsebool allow_ypbind=1 (code=exited, status=0/SUCCESS)
  Process: 23145 ExecStartPre=/usr/libexec/ypbind-pre-setdomain (code=exited, status=0/SUCCESS)
 Main PID: 23153 (code=exited, status=0/SUCCESS)


- A ypserv-1.38-5 rebuilt from source for fc25 exposes the same issues as 
  ypserv-1.38-6.fc26.fc25</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9916951</commentid>
    <comment_count>2</comment_count>
      <attachid>1223329</attachid>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-23 11:04:54 -0500</bug_when>
    <thetext>Created attachment 1223329
The patch mentioned in comment #2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9916962</commentid>
    <comment_count>3</comment_count>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-23 11:06:23 -0500</bug_when>
    <thetext>Yeah! I believe to have found the cause:

The systemd-devel being shipped with fedora &gt;= 25 doesn&apos;t ship
libsystemd-daemon, anymore.

However, a patch to ypbind&apos;s configure.ac adds a check for libsystemd-daemon&apos;s *.pc file. This check fails, because none such file is being shipped and causes ypbind to be compiled without systemd support.

At run-time this causes the mess above.

A brute-force fix to this issue is to take out the check for libsystemd-daemon from ypbind-systemdso.patch (cf. attachment abvoe).

Unless somebody objects, I will a patch to the packages.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9917307</commentid>
    <comment_count>4</comment_count>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-23 12:48:31 -0500</bug_when>
    <thetext>Taking.

I am going to apply a patch to fc25 and rawhide</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9917364</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-23 13:13:59 -0500</bug_when>
    <thetext>ypbind-1.38-7.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-5956cb7606</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9926932</commentid>
    <comment_count>6</comment_count>
    <who name="craigo">craig</who>
    <bug_when>2016-11-25 00:06:56 -0500</bug_when>
    <thetext>We found this to work well as temporary work-around while waiting for the patch:

cp /usr/lib/systemd/system/ypbind.service /etc/systemd/system/
sed -i &apos;s/Type=.*/Type=forking/&apos; /etc/systemd/system/ypbind.service
sed -i &apos;s%ExecStart=.*%ExecStart=/usr/sbin/ypbind $OTHER_YPBIND_OPTS%&apos; /etc/systemd/system/ypbind.service
systemctl daemon-reload
systemctl start ypbind

And after ypbind is patched:

rm /etc/systemd/system/ypbind.service
systemctl daemon-reload
systemctl restart ypbind

I hope you find this helpful.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9929167</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-25 04:42:33 -0500</bug_when>
    <thetext>ypbind-1.38-7.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-5956cb7606</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9929894</commentid>
    <comment_count>8</comment_count>
    <who name="Stephen Adler">adler</who>
    <bug_when>2016-11-25 08:10:22 -0500</bug_when>
    <thetext>*** Bug 1398020 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9933297</commentid>
    <comment_count>9</comment_count>
    <who name="Maurizio Paolini">paolini</who>
    <bug_when>2016-11-28 02:17:40 -0500</bug_when>
    <thetext>Thank you.  Now ypbind works fine (after an upgrade to f25.
We are waiting for the update to become stable :-)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9941434</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-30 00:28:57 -0500</bug_when>
    <thetext>ypbind-1.38-7.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1223329</attachid>
            <date>2016-11-23 11:04:00 -0500</date>
            <delta_ts>2016-11-23 11:04:54 -0500</delta_ts>
            <desc>The patch mentioned in comment #2</desc>
            <filename>ypbind.diff</filename>
            <type>text/plain</type>
            <size>766</size>
            <attacher name="Ralf Corsepius">rc040203</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL3lwYmluZC1zeXN0ZW1kc28ucGF0Y2ggYi95cGJpbmQtc3lzdGVtZHNvLnBh
dGNoCmluZGV4IDE1YmU1NTIuLjdlZGEzZWYgMTAwNjQ0Ci0tLSBhL3lwYmluZC1zeXN0ZW1kc28u
cGF0Y2gKKysrIGIveXBiaW5kLXN5c3RlbWRzby5wYXRjaApAQCAtMSwxNiArMSw2IEBACiBkaWZm
IC1ydSBhL2NvbmZpZ3VyZS5hYyBiL2NvbmZpZ3VyZS5hYwogLS0tIGEvY29uZmlndXJlLmFjCTIw
MTQtMTAtMjEgMTc6Mzc6MjAuNTI2NjI4ODI3ICswMjAwCiArKysgYi9jb25maWd1cmUuYWMJMjAx
NC0xMC0yMSAxNzo1MTozOS42NDkzNjI2ODYgKzAyMDAKLUBAIC00NCw3ICs0NCw4IEBACi0gQUNf
Q0hFQ0tfTElCKHNvY2tldCwgYmluZCkKLSBBQ19DSEVDS19MSUIocHRocmVhZCwgcHRocmVhZF9j
cmVhdGUpCi0gCi0tUEtHX0NIRUNLX01PRFVMRVMoW1NZU1RFTURdLCBbbGlic3lzdGVtZCA+PSAy
MDldLCBbVVNFX1NEX05PVElGWT0xXSwgW1VTRV9TRF9OT1RJRlk9MF0pCi0rUEtHX0NIRUNLX01P
RFVMRVMoW1NZU1RFTURdLCBbbGlic3lzdGVtZCA+PSAyMDldIFtsaWJzeXN0ZW1kLWRhZW1vbiA+
PSAyMDldLCBbVVNFX1NEX05PVElGWT0xXSwgW1VTRV9TRF9OT1RJRlk9MF0pCi0rCQotIEFDX1NV
QlNUKFVTRV9TRF9OT1RJRlkpCi0gCi0gQUNfQVJHX0VOQUJMRShbZGJ1cy1ubV0sCiBAQCAtMTA1
LDcgKzEwNiw3IEBACiAgQU1fQ09ORElUSU9OQUwoRU5BQkxFX1JFR0VORVJBVEVfTUFOLCB0ZXN0
IHgkZW5hYmxlX21hbiAhPSB4bm8pCiAgCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1419288</bug_id>
          
          <creation_ts>2017-02-04 17:01:00 -0500</creation_ts>
          <short_desc>container-selinux-2.5-1.fc25 causes AVC denials with bind-mounted files</short_desc>
          <delta_ts>2017-03-01 20:21:02 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>container-selinux</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alexander Groß">agross</reporter>
          <assigned_to name="Lokesh Mandvekar">lsm5</assigned_to>
          <cc>agross</cc>
    
    
    <cc>amurdaca</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>fkluknav</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>jlebon</cc>
    
    
    <cc>lsm5</cc>
    
    
    <cc>sds</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>container-selinux-2.9-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-01 20:21:02</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10121428</commentid>
    <comment_count>0</comment_count>
    <who name="Alexander Groß">agross</who>
    <bug_when>2017-02-04 17:01:26 -0500</bug_when>
    <thetext># Description of problem:

I use docker-compose to orchestrate containers, e.g. a database and a web application. The web application container must wait until the database is up before running. I use https://github.com/vishnubob/wait-for-it to do the waiting and bind-mount the script into the container. Since installing container-selinux-2.5-1.fc25 docker fails to execute the wait script because access is denied by SELinux. The behavior is the same on two machines tested (all running Fedora 25 patched to latest).


Version-Release number of selected component (if applicable):

container-selinux-2.5-1.fc25
container-selinux-2.2-2.fc25 works.


# How reproducible:

Every time, downgrading to 2.2-2 removes the error.

# Steps to Reproduce:

The simplest way to reproduce is to emulate docker-compose with a docker invocation.

1. git clone https://github.com/vishnubob/wait-for-it.git /usr/local/src/wait-for-it
2. docker run --entrypoint=&quot;/wait-for-it.sh&quot; -v /usr/local/src/wait-for-it/wait-for-it.sh:/wait-for-it.sh:ro agross/stress
   (agross/stress is just an example image)


# Actual results (docker run output):

panic: standard_init_linux.go:178: exec user process caused &quot;permission denied&quot; [recovered]
        panic: standard_init_linux.go:178: exec user process caused &quot;permission denied&quot;


# Expected results  (docker run output):

Error: you need to provide a host and port to test.
Usage:
    wait-for-it.sh host:port [-s] [-t timeout] [-- command args]
    -h HOST | --host=HOST       Host or IP under test
    -p PORT | --port=PORT       TCP port under test
                                Alternatively, you specify the host and port as host:port
    -s | --strict               Only execute subcommand if the test succeeds
    -q | --quiet                Don&apos;t output any status messages
    -t TIMEOUT | --timeout=TIMEOUT
                                Timeout in seconds, zero for no timeout
    -- COMMAND ARGS             Execute command with args after the test finishes


# Additional info:

$ audit2why &lt; /var/log/audit/audit.log
type=AVC msg=audit(1486244245.275:7129): avc:  denied  { entrypoint } for  pid=20532 comm=&quot;exe&quot; path=&quot;/wait-for-it.sh&quot; dev=&quot;dm-0&quot; ino=50618329 scontext=system_u:system_r:container_t:s0:c116,c857 tcontext=unconfined_u:object_r:usr_t:s0 tclass=file permissive=0

        Was caused by:
                Unknown - would be allowed by active policy
                Possible mismatch between this policy and the one under which the audit message was generated.

                Possible mismatch between current in-memory boolean settings vs. permanent ones.

$ ls /usr/local/src/wait-for-it/wait-for-it.sh -laZ
-rwxr-xr-x. 1 root root unconfined_u:object_r:usr_t:s0 3658 Aug 25 20:25 /usr/local/src/wait-for-it/wait-for-it.sh

As suggested (https://bodhi.fedoraproject.org/updates/container-selinux-2.5-1.fc25#comment-557261) I also tried to chcon wait-for-it.sh and bind-mounting with the &quot;Z&quot; flag, but to no avail.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10123836</commentid>
    <comment_count>1</comment_count>
    <who name="Stephen Smalley">sds</who>
    <bug_when>2017-02-06 09:29:24 -0500</bug_when>
    <thetext>Add this to policy:
typebounds container_runtime_exec_t usr_t;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10143415</commentid>
    <comment_count>2</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-02-13 10:19:39 -0500</bug_when>
    <thetext>Fixed in container-selinux-2.8 in updates testing.  Please update to this package and if it fixes your problem, update the karma</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10143994</commentid>
    <comment_count>3</comment_count>
    <who name="Alexander Groß">agross</who>
    <bug_when>2017-02-13 13:07:21 -0500</bug_when>
    <thetext>Seems like container-selinux-2.8 is not available (yet?)

dnf update --enablerepo=updates-testing container-selinux
...
Upgrading:
 container-selinux noarch 2:2.6-1.fc25 updates-testing

https://bodhi.fedoraproject.org/updates/?packages=container-selinux</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10187550</commentid>
    <comment_count>4</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-02-27 12:13:03 -0500</bug_when>
    <thetext>Ok I just fired off a build 
https://koji.fedoraproject.org/koji/taskinfo?taskID=18096916</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10187574</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-27 12:18:34 -0500</bug_when>
    <thetext>container-selinux-2.9-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-018d2c13f7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10187739</commentid>
    <comment_count>6</comment_count>
    <who name="Alexander Groß">agross</who>
    <bug_when>2017-02-27 13:11:34 -0500</bug_when>
    <thetext>container-selinux 2.9 is still not available for me on testing, but I can confirm that 2.6 also works on two machines.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10195868</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-28 21:52:51 -0500</bug_when>
    <thetext>container-selinux-2.9-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-018d2c13f7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10200028</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-01 20:21:02 -0500</bug_when>
    <thetext>container-selinux-2.9-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
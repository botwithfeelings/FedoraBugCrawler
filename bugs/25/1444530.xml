<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1444530</bug_id>
          
          <creation_ts>2017-04-21 10:29:00 -0400</creation_ts>
          <short_desc>Using --efi returns a &quot;label too long&quot; error</short_desc>
          <delta_ts>2017-05-26 00:02:23 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>livecd-tools</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Larsen">plarsen</reporter>
          <assigned_to name="Neal Gompa">ngompa13</assigned_to>
          <cc>adam.stokes</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>bruno</cc>
    
    
    <cc>dhuff</cc>
    
    
    <cc>fgrose</cc>
    
    
    <cc>Jasper.Hartline</cc>
    
    
    <cc>katzj</cc>
    
    
    <cc>ngompa13</cc>
    
    
    <cc>plarsen</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>livecd-tools-24.4-1.fc26 livecd-tools-24.4-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-05-14 16:17:27</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="Github">livecd-tools/livecd-tools/issues/59</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      <flag name="needinfo"
          id="3038857"
          type_id="16"
          status="?"
          setter="fgrose"
          requestee="plarsen"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10353680</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Larsen">plarsen</who>
    <bug_when>2017-04-21 10:29:57 -0400</bug_when>
    <thetext>Description of problem:
When creating livecd images using livecd-iso-to-disk, you get a fatlabel:labels can not be longer than 11 characters error.

sudo livecd-iso-to-disk --noverify --format --reset-mbr --efi --overlay-size-mb 1024 --home-size-mb 2048 --unencrypted-home --msdos  some.iso /dev/sdc

    WARNING: This will DESTROY All DATA on: /dev/sdc !!

        Press Enter to continue, or Ctrl C to abort.

/dev/sdc: 8 bytes were erased at offset 0x00000200 (gpt): 45 46 49 20 50 41 52 54
/dev/sdc: 8 bytes were erased at offset 0x3a4fffe00 (gpt): 45 46 49 20 50 41 52 54
/dev/sdc: 2 bytes were erased at offset 0x000001fe (PMBR): 55 aa
/dev/sdc: calling ioctl to re-read partition table: Success
Waiting for devices to settle...
mkfs.fat 4.1 (2017-01-24)
mkfs.fat: warning - lowercase labels might not work properly with DOS or Windows
fatlabel: labels can be no longer than 11 characters
Cleaning up to exit...

The label created is:
sudo parted /dev/sdc print
Model: UFD 3.0 Silicon-Power16G (scsi)
Disk /dev/sdc: 15.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name                  Flags
 1      4194kB  15.7GB  15.6GB  fat32        EFI System Partition  boot, esp

If you try to force the label to a different value, you get an error that the label MUST be &quot;EFI System Partition&quot;. 

Version-Release number of selected component (if applicable):
rpm -q livecd-tools
livecd-tools-24.3-2.fc25.x86_64


How reproducible:
Run the above command - run with --efi enabled and I&apos;ve had no successful run so it&apos;s reproducing every time.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10354905</commentid>
    <comment_count>1</comment_count>
    <who name="Frederick Grose">fgrose</who>
    <bug_when>2017-04-23 21:19:07 -0400</bug_when>
    <thetext>See https://github.com/livecd-tools/livecd-tools/pull/60

You might avoid this bug by using the --label option.

(Aside, --msdos is redundant with --efi in livecd-iso-to-disk currently.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10354948</commentid>
    <comment_count>2</comment_count>
    <who name="Peter Larsen">plarsen</who>
    <bug_when>2017-04-23 22:20:19 -0400</bug_when>
    <thetext>(In reply to Frederick Grose from comment #1)
&gt; See https://github.com/livecd-tools/livecd-tools/pull/60
&gt; 
&gt; You might avoid this bug by using the --label option.
&gt; 
&gt; (Aside, --msdos is redundant with --efi in livecd-iso-to-disk currently.)

There&apos;s a constraint enforced by livecd-iso-to-disk requiring the label of the EFI partition to be &quot;EFI System Partition&quot;. Also note, that --label is used for the data partition, not the EFI partition. That&apos;s true for --msdos too. EFI can only be vfat by definition.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10355112</commentid>
    <comment_count>3</comment_count>
    <who name="Neal Gompa">ngompa13</who>
    <bug_when>2017-04-24 01:48:01 -0400</bug_when>
    <thetext>(In reply to Peter Larsen from comment #2)
&gt; (In reply to Frederick Grose from comment #1)
&gt; &gt; See https://github.com/livecd-tools/livecd-tools/pull/60
&gt; &gt; 
&gt; &gt; You might avoid this bug by using the --label option.
&gt; &gt; 
&gt; &gt; (Aside, --msdos is redundant with --efi in livecd-iso-to-disk currently.)
&gt; 
&gt; There&apos;s a constraint enforced by livecd-iso-to-disk requiring the label of
&gt; the EFI partition to be &quot;EFI System Partition&quot;. Also note, that --label is
&gt; used for the data partition, not the EFI partition. That&apos;s true for --msdos
&gt; too. EFI can only be vfat by definition.

ESP isn&apos;t technically vfat (though it is derived from it) as it has its own filesystem type defined in the UEFI spec. Do we need to set the proper fs type when we&apos;re creating the partition? Maybe it has slightly different rules...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10358245</commentid>
    <comment_count>4</comment_count>
    <who name="Frederick Grose">fgrose</who>
    <bug_when>2017-04-24 17:14:39 -0400</bug_when>
    <thetext>I reproduced Peter&apos;s symptoms with a device that has/had a long filesystem label with an ext4 or btrfs volume.

Because commit 34c52bc68a9f7ee82293215943c565c04a483abc introduced code to preserve the original label, it neglected logic to recognize the truncation of the label by mkfs.fat to 11 bytes and to update the held variable for later comparison.

The patch provided in https://github.com/livecd-tools/livecd-tools/pull/60 provides the missing logic.  With this patch, the requested installation completes successfully.

Peter should be able to confirm if it works.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10392072</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-08 00:59:42 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-6d5aa85fd7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10392074</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-08 01:00:26 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-7076993b7d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10394447</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-08 20:46:12 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-6d5aa85fd7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10394637</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-08 22:38:25 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-7076993b7d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10410637</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-14 16:17:27 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10449742</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-05-26 00:02:23 -0400</bug_when>
    <thetext>livecd-tools-24.4-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1408604</bug_id>
          
          <creation_ts>2016-12-25 15:11:00 -0500</creation_ts>
          <short_desc>Dovecot downgrade going from F24 to F25 causes crashes on access</short_desc>
          <delta_ts>2017-01-03 11:25:06 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dovecot</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Oleg Drokin">green</reporter>
          <assigned_to name="Michal Hlavinka">mhlavink</assigned_to>
          <cc>dexter</cc>
    
    
    <cc>frank</cc>
    
    
    <cc>janfrode</cc>
    
    
    <cc>mhlavink</cc>
    
    
    <cc>pokorra.mailinglists</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-03 11:25:06</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10019591</commentid>
    <comment_count>0</comment_count>
    <who name="Oleg Drokin">green</who>
    <bug_when>2016-12-25 15:11:22 -0500</bug_when>
    <thetext>Description of problem:
I just updated from Fedora 24 to Feedora 25 which happened to downgrade dovecot
from 2.2.27 to 2.2.26
Now modification of mailboxes leads to assertion:
Dec 25 14:37:23 intel-vm dovecot: imap(green): Panic: file mail-index-sync-keywords.c: line 228 (keywords_update_records): assertion failed: (data_offset &gt;= sizeof(struct mail_index_record))
Dec 25 14:37:23 intel-vm dovecot: imap(green): Error: Raw backtrace: /usr/lib64/dovecot/libdovecot.so.0(+0x91a92) [0x7f9e68ad3a92] -&gt; /usr/lib64/dovecot/libdovecot.so.0(+0x91b8d) [0x7f9e68ad3b8d] -&gt; /usr/lib64/dovecot/libdovecot.so.0(i_fatal+0) [0x7f9e68a6cf21] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mail_index_sync_keywords+0x858) [0x7f9e68e2cdc8] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mail_index_sync_record+0xef) [0x7f9e68e2d79f] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mail_index_sync_map+0x248) [0x7f9e68e2e748] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mail_index_map+0x71) [0x7f9e68e25ca1] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(+0xdebe2) [0x7f9e68e3bbe2] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(+0xdf1d8) [0x7f9e68e3c1d8] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mail_index_open+0x7a) [0x7f9e68e3c2ba] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(index_storage_mailbox_open+0x92) [0x7f9e68e147e2] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(+0x7895d) [0x7f9e68dd595d] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(+0x7909d) [0x7f9e68dd609d] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(+0x41ee6) [0x7f9e68d9eee6] -&gt; /usr/lib64/dovecot/libdovecot-storage.so.0(mailbox_open+0x20) [0x7f9e68d9f060] -&gt; dovecot/imap(cmd_select_full+0x169) [0x5565e8ca83e9] -&gt; dovecot/imap(command_exec+0xa5) [0x5565e8caf5b5] -&gt; dovecot/imap(+0x19832) [0x5565e8cad832] -&gt; dovecot/imap(+0x198be) [0x5565e8cad8be] -&gt; dovecot/imap(client_handle_input+0x1b5) [0x5565e8cadcc5] -&gt; dovecot/imap(client_input+0x82) [0x5565e8cae242] -&gt; /usr/lib64/dovecot/libdovecot.so.0(io_loop_call_io+0x4c) [0x7f9e68ae831c] -&gt; /usr/lib64/dovecot/libdovecot.so.0(io_loop_handler_run_internal+0x109) [0x7f9e68ae97f9] -&gt; /usr/lib64/dovecot/libdovecot.so.0(io_loop_handler_run+0x25) [0x7f9e68ae83a5] -&gt; /usr/lib64/dovecot/libdovecot.so.0(io_loop_run+0x38) [0x7f9e68ae8548] -&gt; /usr/lib64/dovecot/libdovecot.so.0(master_service_run+0x13) [0x7f9e68a734e3] -&gt; dovecot/imap(main+0x328) [0x5565e8ca0ee8] -&gt; /lib64/libc.so.6(__libc_start_main+0xf1) [0x7f9e6869c401]
Dec 25 14:37:23 intel-vm dovecot: imap(green): Fatal: master: service(imap): child 1437 killed with signal 6 (core dumped)

Version-Release number of selected component (if applicable):

I see this from the upgrade process:
Downgraded:
  dovecot.x86_64 1:2.2.26.0-1.fc25       

I also see this bugreport from dovecot list that seems to be related:
http://www.mail-archive.com/dovecot@dovecot.org/msg68027.html

Anyway, there does not appear 2.2.27 version of dovecot for Fedora 25.

Downgrding to Fedora 24&apos;s dovecot-2.2.27-1.fc24.x86_64 with
&quot;dnf --releasever=24 update dovecot&quot; brings things back into the working order
for now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10024688</commentid>
    <comment_count>1</comment_count>
    <who name="Frank Crawford">frank</who>
    <bug_when>2016-12-29 19:57:10 -0500</bug_when>
    <thetext>Yep, I see the same too, and the downgrade to the F24 dovecot seems to fix the issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10029891</commentid>
    <comment_count>2</comment_count>
    <who name="Michal Hlavinka">mhlavink</who>
    <bug_when>2017-01-03 04:33:21 -0500</bug_when>
    <thetext>Fedora 25 repository should contain updated version like F24 has and this problem should be fixed. Please confirm. Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10031022</commentid>
    <comment_count>3</comment_count>
    <who name="Oleg Drokin">green</who>
    <bug_when>2017-01-03 11:03:47 -0500</bug_when>
    <thetext>Yes, I see the updated package and it seems to be working for me now.

Thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10031082</commentid>
    <comment_count>4</comment_count>
    <who name="Michal Hlavinka">mhlavink</who>
    <bug_when>2017-01-03 11:25:06 -0500</bug_when>
    <thetext>Thanks for confirming this.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
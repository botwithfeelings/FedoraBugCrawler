<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1415512</bug_id>
          
          <creation_ts>2017-01-22 18:16:00 -0500</creation_ts>
          <short_desc>Using clang with libc++ does not work</short_desc>
          <delta_ts>2017-03-01 16:05:18 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>libcxx</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>imbacen</reporter>
          <assigned_to name="Tom &quot;spot&quot; Callaway">tcallawa</assigned_to>
          <cc>fweimer</cc>
    
    
    <cc>nieric</cc>
    
    
    <cc>tcallawa</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-01 16:05:18</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10087184</commentid>
    <comment_count>0</comment_count>
    <who name="">imbacen</who>
    <bug_when>2017-01-22 18:16:59 -0500</bug_when>
    <thetext>Description of problem:
Trying to compile a hello world cpp on Fedora 25 with clang++ and libc++ (libcxx).

sudo dnf install clang libcxx-devel

#include &lt;iostream&gt;
#include &lt;string&gt;

int main()
{
    std::string a = &quot;abc&quot;;
    std::cout &lt;&lt; a;
}

clang++ -stdlib=libc++ hello.cpp

This results in a bunch of linker errors.

Version-Release number of selected component (if applicable):
libcxx-devel-3.8.1-1.fc25.x86_64

How reproducible:
Always

Steps to Reproduce:
1. Install clang and libcxx
2. Try to compile a hello world program

Actual results:
Compile fails

Expected results:
Compile succeeds

Additional info:
I am not a C++ expert but to my understanding libc++ needs to be linked against libc++abi to work and this is not the case with current package. libc++-abi is also not packaged yet (https://bugzilla.redhat.com/show_bug.cgi?id=1332306 ?) so as far as I can understand it is not currently possible to effectively use libc++ on Fedora, unless someone can correct me on this.
What I can&apos;t really understand is why libcxx was even included in this state as a package.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10088895</commentid>
    <comment_count>1</comment_count>
    <who name="Tom &quot;spot&quot; Callaway">tcallawa</who>
    <bug_when>2017-01-23 09:40:18 -0500</bug_when>
    <thetext>Upstream separates them. I am waiting on a review for 1332306 in order to get libcxxabi in to Fedora. I did not think it would take this long for that to happen.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10198512</commentid>
    <comment_count>2</comment_count>
    <who name="E.N.">nieric</who>
    <bug_when>2017-03-01 12:37:48 -0500</bug_when>
    <thetext>There is now a libcxxabi package (https://admin.fedoraproject.org/pkgdb/package/rpms/libcxxabi/), but still the code in comment #1 can&apos;t compile maybe because issues raised by GCC developers here: https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/thread/UHWAP45O7DOWQ6QA5KL36T5D5YHTLE5K/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10198535</commentid>
    <comment_count>3</comment_count>
    <who name="E.N.">nieric</who>
    <bug_when>2017-03-01 12:45:31 -0500</bug_when>
    <thetext>(In reply to E.N. from comment #2)
&gt; the code in comment #1
comment #0, I meant.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10198640</commentid>
    <comment_count>4</comment_count>
    <who name="Tom &quot;spot&quot; Callaway">tcallawa</who>
    <bug_when>2017-03-01 13:25:38 -0500</bug_when>
    <thetext>It seems to work if you append -lc++abi.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10198961</commentid>
    <comment_count>5</comment_count>
    <who name="E.N.">nieric</who>
    <bug_when>2017-03-01 15:26:24 -0500</bug_when>
    <thetext>$ cat hello-world.cpp 
#include &lt;iostream&gt;
#include &lt;string&gt;

int main()
{
    std::string a = &quot;abc&quot;;
    std::cout &lt;&lt; a &lt;&lt; std::endl;
}


$ clang++ -stdlib=libc++ -lc++abi -o bar hello-world.cpp
hello-world.cpp:3:10: fatal error: &apos;iostream&apos; file not found
#include &lt;iostream&gt;
         ^
1 error generated.


$ cat /etc/os-release 
NAME=Fedora
VERSION=&quot;26 (Rawhide)&quot;
…


$ rpm --query llvm llvm-devel clang clang-devel libcxx libcxxabi
llvm-3.9.0-7.fc26.x86_64
llvm-devel-3.9.0-7.fc26.x86_64
clang-3.9.0-4.fc26.x86_64
clang-devel-3.9.0-4.fc26.x86_64
libcxx-3.9.0-2.fc26.x86_64
libcxxabi-3.9.0-1.fc26.x86_64


Am I missing something? Is it related to versions&apos; mismatches?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10198975</commentid>
    <comment_count>6</comment_count>
    <who name="Tom &quot;spot&quot; Callaway">tcallawa</who>
    <bug_when>2017-03-01 15:30:34 -0500</bug_when>
    <thetext>Try it with libcxx-3.9.0-3, which is built against libcxxabi.

https://koji.fedoraproject.org/koji/buildinfo?buildID=863381

[spot@localhost ~]$ cat hello-world.cpp 
#include &lt;iostream&gt;
#include &lt;string&gt;

int main()
{
    std::string a = &quot;abc&quot;;
    std::cout &lt;&lt; a &lt;&lt; std::endl;
}
[spot@localhost ~]$ clang++ -stdlib=libc++ -lc++abi -o bar hello-world.cpp 
[spot@localhost ~]$ cat /etc/os-release
NAME=Fedora
VERSION=&quot;26 (Workstation Edition)&quot;
…

[spot@localhost ~]$ rpm --query llvm llvm-devel clang clang-devel libcxx libcxxabi
llvm-3.9.0-7.fc26.x86_64
llvm-devel-3.9.0-7.fc26.x86_64
clang-3.9.0-4.fc26.x86_64
package clang-devel is not installed
libcxx-3.9.0-3.fc26.x86_64
libcxxabi-3.9.0-1.fc26.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10199075</commentid>
    <comment_count>7</comment_count>
    <who name="E.N.">nieric</who>
    <bug_when>2017-03-01 15:59:55 -0500</bug_when>
    <thetext>My error, my bad. After running

koji download-build --arch=x86_64 libcxx-3.9.0-3.fc26

and installing the downloaded RPMs, I saw libcxxabi-devel being pulled as a dependency because it was not yet installed. The code compile well after downgrading libcxx and libcxx-devel to 3.9.0.2 while having libcxxabi-devel onto the box.

For the record:
$ rpm --query llvm llvm-devel clang clang-devel libcxx libcxx-devel libcxxabi libcxxabi-devel
llvm-3.9.0-7.fc26.x86_64
llvm-devel-3.9.0-7.fc26.x86_64
clang-3.9.0-4.fc26.x86_64
clang-devel-3.9.0-4.fc26.x86_64
libcxx-3.9.0-2.fc26.x86_64
libcxx-devel-3.9.0-2.fc26.x86_64
libcxxabi-3.9.0-1.fc26.x86_64
libcxxabi-devel-3.9.0-1.fc26.x86_64
$ clang++ -stdlib=libc++ -lc++ -lc++abi -o bar hello-world.cpp
$ ./bar 
abc

Thanks for your time and all the packages you maintain, it&apos;s really amazing to realize the great stuff you do for the distro.

My impression is this bug should now be closed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10199091</commentid>
    <comment_count>8</comment_count>
    <who name="Tom &quot;spot&quot; Callaway">tcallawa</who>
    <bug_when>2017-03-01 16:05:18 -0500</bug_when>
    <thetext>Thanks for the kind words (and your patience).</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
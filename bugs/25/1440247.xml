<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1440247</bug_id>
          
          <creation_ts>2017-04-07 12:28:00 -0400</creation_ts>
          <short_desc>DeferUpdate is broken in tigervnc-1.7.1</short_desc>
          <delta_ts>2017-04-24 13:51:34 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>tigervnc</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="nvk.reg@gmail.com">nvk.reg</reporter>
          <assigned_to name="Jan Grulich">jgrulich</assigned_to>
          <cc>bphinz</cc>
    
    
    <cc>jayguerette</cc>
    
    
    <cc>jgrulich</cc>
    
    
    <cc>twaugh</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>tigervnc-1.7.90-1.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-04-21 10:28:49</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10315114</commentid>
    <comment_count>0</comment_count>
    <who name="nvk.reg@gmail.com">nvk.reg</who>
    <bug_when>2017-04-07 12:28:09 -0400</bug_when>
    <thetext>Description of problem:

Xvnc server running on FC25 doesn&apos;t send correctly update screen in some cases until there is an input from the client. Issue is easy notice with terminal applications like lxterminal and gnome-terminal when the cursor-blink is off.

The results in incorrect cursor position and affects variety of editing activities.

Issue seen in all versions of tigervnc shipped with FC25 so far.

Issue not seen in tigervnc distributed with FC24 and earlier releases.


Version-Release number of selected component (if applicable):
tigervnc-1.7.1


How reproducible:

Reproducible with a high consistency.


Steps to Reproduce:
1. Start vncserver.
   e.g: vncserver -geometry 1366x768 :3646
2. Connect to the VNC server using vncclient (any OS, any variant of vnc client) from another machine
3. Launch lxterminal (or gnome-terminal)
4. Turn off cursor-blink in lxterminal from the preferences
5. From lxterminal do an ssh to another machine that is reachable.
6. Ensure there are no further inputs to the server (keyboard inputs, mouse movements)

Actual results:

It can be noticed that ssh Password prompt doesn&apos;t appear till there is an input from the vncclient or some other part of the screen gets updated (e.g: clock)

Example:
$ ssh some-ssh-server
Password: &lt;----------- Prompt doesn&apos;t appear till some key is pressed (e.g: shift) or mouse movement


Expected results:

Password prompt should appear without any further input from the client.




Additional info:
Issue won&apos;t be noticed if the cursor-blink is on.

A workaround is to turnoff DeferUpdate by setting to 0 (defaults to 1). But this may reduce the performance and utilize more network bandwidth.


Issue has been reported to tigervnc upstream team who identified it as a bug specific to Fedora&apos;s distribution of tigervnc server.

https://github.com/TigerVNC/tigervnc/issues/443#event-1033743066

A fix has been identified in the upstream that can resolve the issue.

https://github.com/TigerVNC/tigervnc/commit/b192107b302098864358cd54b6323129c23e271e

-------------------------------------
xstartup configguration

vnallamothu-lnx: /home/vnallamothu/.vnc&gt; cat xstartup
#!/bin/sh

# Disable wayland
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS
export XDG_SESSION_TYPE=x11

export XKL_XMODMAP_DISABLE=1
[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources
xsetroot -solid grey

vncconfig -nowin &amp;
(startfluxbox || blackbox || openbox || xterm ) &amp;
lxterminal &amp;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10348853</commentid>
    <comment_count>1</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-20 05:22:54 -0400</bug_when>
    <thetext>tigervnc-1.7.90-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-1e844336cd</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10351389</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-20 16:24:28 -0400</bug_when>
    <thetext>tigervnc-1.7.90-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-1e844336cd</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10353672</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-21 10:28:49 -0400</bug_when>
    <thetext>tigervnc-1.7.90-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10356664</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Guerette">jayguerette</who>
    <bug_when>2017-04-24 09:35:39 -0400</bug_when>
    <thetext>The fix was to remove support for DeferUpdate ?

tigervnc-server-minimal-1.7.90-1.fc27.x86_64
...
(EE) 
Fatal server error:
(EE) Unrecognized option: -DeferUpdate
(EE)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10357615</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Grulich">jgrulich</who>
    <bug_when>2017-04-24 13:13:22 -0400</bug_when>
    <thetext>From I can see DeferUpdate has been changed to FrameRate option. Can you verify that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10357767</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Guerette">jayguerette</who>
    <bug_when>2017-04-24 13:51:34 -0400</bug_when>
    <thetext>I have verified that FrameRate works as expected. I tried a few rates, going as low as 10, and observed the expected behavior: increased choppiness while dragging a full screen window, and reduced bandwidth.

The man page just needs to be updated to reflect this change.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
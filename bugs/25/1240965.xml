<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1240965</bug_id>
          
          <creation_ts>2015-07-08 05:13:00 -0400</creation_ts>
          <short_desc>dependency on qemu while removing gluster</short_desc>
          <delta_ts>2017-01-16 09:21:12 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>qemu</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Saro">saravanakumar.punith</reporter>
          <assigned_to name="Fedora Virtualization Maintainers">virt-maint</assigned_to>
          <cc>amit.shah</cc>
    
    
    <cc>bengland</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>humble.devassy</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>joe</cc>
    
    
    <cc>jonathansteffan</cc>
    
    
    <cc>kkeithle</cc>
    
    
    <cc>lmohanty</cc>
    
    
    <cc>mpillai</cc>
    
    
    <cc>ndevos</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>rsawhill</cc>
    
    
    <cc>sankarshan</cc>
    
    
    <cc>saravanakumar.punith</cc>
    
    
    <cc>sasundar</cc>
    
    
    <cc>vbellur</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-16 09:21:12</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8419095</commentid>
    <comment_count>0</comment_count>
    <who name="Saro">saravanakumar.punith</who>
    <bug_when>2015-07-08 05:13:31 -0400</bug_when>
    <thetext>Description of problem:
While trying to remove gluster packages from Fedora 22 system it shows dependency on qemu, libvirt and boxes.

Version-Release number of selected component (if applicable):
Fedora release 22

How reproducible:

# rpm -qa  | grep gluster
glusterfs-cli-3.6.3-3.fc22.x86_64
glusterfs-libs-3.6.3-3.fc22.x86_64
glusterfs-api-3.6.3-3.fc22.x86_64
glusterfs-3.6.3-3.fc22.x86_64
glusterfs-fuse-3.6.3-3.fc22.x86_64
glusterfs-server-3.6.3-3.fc22.x86_64
# 
# yum erase `rpm -qa  | grep gluster` 
Yum command has been deprecated, redirecting to &apos;/usr/bin/dnf erase glusterfs-cli-3.6.3-3.fc22.x86_64 glusterfs-libs-3.6.3-3.fc22.x86_64 glusterfs-api-3.6.3-3.fc22.x86_64 glusterfs-3.6.3-3.fc22.x86_64 glusterfs-fuse-3.6.3-3.fc22.x86_64 glusterfs-server-3.6.3-3.fc22.x86_64&apos;.
See &apos;man dnf&apos; and &apos;man yum2dnf&apos; for more information.
To transfer transaction metadata from yum to DNF, run:
&apos;dnf install python-dnf-plugins-extras-migrate &amp;&amp; dnf-2 migrate&apos;

Dependencies resolved.
==============================================================================================================================
 Package                                     Arch                 Version                         Repository             Size
==============================================================================================================================
Removing:
 glusterfs                                   x86_64               3.6.3-3.fc22                    @System               5.1 M
 glusterfs-api                               x86_64               3.6.3-3.fc22                    @System               117 k
 glusterfs-cli                               x86_64               3.6.3-3.fc22                    @System               385 k
 glusterfs-fuse                              x86_64               3.6.3-3.fc22                    @System               225 k
 glusterfs-libs                              x86_64               3.6.3-3.fc22                    @System               884 k
 glusterfs-server                            x86_64               3.6.3-3.fc22                    @System               2.3 M
 gnome-boxes                                 x86_64               3.16.2-3.fc22                   @System               4.5 M
 libvirt                                     x86_64               1.2.13.1-2.fc22                 @System                 0  
 libvirt-daemon-driver-qemu                  x86_64               1.2.13.1-2.fc22                 @System               1.2 M
 libvirt-daemon-driver-storage               x86_64               1.2.13.1-2.fc22                 @System               540 k
 libvirt-daemon-kvm                          x86_64               1.2.13.1-2.fc22                 @System                 0  
 qemu-img                                    x86_64               2:2.3.0-5.fc22                  @System               2.9 M
 qemu-kvm                                    x86_64               2:2.3.0-5.fc22                  @System                 0  
 qemu-system-x86                             x86_64               2:2.3.0-5.fc22                  @System                13 M

Transaction Summary
==============================================================================================================================
Remove  14 Packages

Installed size: 32 M
Is this ok [y/N]: N
Operation aborted.


Steps to Reproduce:
1. list gluster packages installed
2. try to remove gluster packages
3. It shows dependencies on qemu, libvirt and boxes

Actual results:
shows dependencies on qemu,libvirt and box

Expected results:
There should not be any dependency on qemu,libvirt..It should remove only gluster related packages.

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8419361</commentid>
    <comment_count>1</comment_count>
    <who name="Niels de Vos">ndevos</who>
    <bug_when>2015-07-08 06:08:38 -0400</bug_when>
    <thetext>qemu links against libgfapi.so from the glusterfs-api package. This makes it possible to support storage directly on Gluster volumes without the need to mount the volume, like &quot;qemu ... -drive gluster://server/volume/vm.img ...&quot;.

The dependency is the other way around, qemu depends on glusterfs-api, and if glusterfs-api gets uninstalled, qemu gets pulled with it. The same is true for installing qemu, glusterfs-api is a requirement and will get installed too.

Some other projects that use libgfapi.so implement a plugin functionality (see Samba, NFS-Ganesha). This makes it possible to only install the plugins (and dependencies) that a user wants. For all I know, qemu does not offer the option for dynamically loaded plugins :-/

Moving this to the qemu component so that the maintainers can share their thoughts.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8419411</commentid>
    <comment_count>2</comment_count>
    <who name="Saro">saravanakumar.punith</who>
    <bug_when>2015-07-08 06:22:29 -0400</bug_when>
    <thetext>Thanks Niels.

&lt;&lt;The same is true for installing qemu, glusterfs-api is a requirement and will get installed too.
If I am &quot;not&quot; interested in using glusterfs in qemu, should installing qemu still install glusterfs-api too? I think it is wrong.

There is too much of inter-dependencies created here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8420485</commentid>
    <comment_count>3</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-07-08 10:25:16 -0400</bug_when>
    <thetext>qemu does have support for block driver modules, so we could make the gluster dep a subpackage. But I never did it since libvirt storage support _also_ has a dep on gluster, which can&apos;t be modularized. So most qemu/kvm users wouldn&apos;t really benefit since they are likely using libvirt anyways. But I&apos;ll add it to the todo list to investigate again</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8437740</commentid>
    <comment_count>4</comment_count>
    <who name="Saro">saravanakumar.punith</who>
    <bug_when>2015-07-14 09:32:22 -0400</bug_when>
    <thetext>(In reply to Cole Robinson from comment #3)
&gt; qemu does have support for block driver modules, so we could make the
&gt; gluster dep a subpackage. But I never did it since libvirt storage support
&gt; _also_ has a dep on gluster, which can&apos;t be modularized. So most qemu/kvm
&gt; users wouldn&apos;t really benefit since they are likely using libvirt anyways.
&gt; But I&apos;ll add it to the todo list to investigate again

Thanks Cole!

If somebody wishes to upgrade/remove glusterfs. They need to remove qemu,libvirt, boxes even if they are NOT using these packages. 

My humble request is to make the dependency ONLY if there is a need.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8437905</commentid>
    <comment_count>5</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-07-14 10:00:44 -0400</bug_when>
    <thetext>As mentioned, the libvirt/boxes dep issue will take substantially more work... we need dynamic modules for libvirt&apos;s storage support.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8438065</commentid>
    <comment_count>6</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-07-14 10:29:19 -0400</bug_when>
    <thetext>I opened an upstream libvirt bug to track that work:

https://bugzilla.redhat.com/show_bug.cgi?id=1243001</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8952317</commentid>
    <comment_count>7</comment_count>
    <who name="Ben England">bengland</who>
    <bug_when>2016-01-04 12:07:00 -0500</bug_when>
    <thetext>cc&apos;ing Vijay Bellur.  I agree (bz 1194503), KVM should NOT have any hard dependency on Gluster being present, but should be able to utilize it (for libgfapi, for example), if it is present.  That&apos;s why we have dynamically loadable shared libraries.  This is consistent with creating leaner, smaller, less complicated Linux installs.

We don&apos;t want to blow away running VMs that depend on Gluster by uninstalling Gluster, but it&apos;s not hard to tell whether there are such VMs running - they would have disks in their libvirt XML that reference libgfapi, yes?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9438668</commentid>
    <comment_count>8</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-06-21 20:24:57 -0400</bug_when>
    <thetext>Still relevant with f24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10066324</commentid>
    <comment_count>9</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2017-01-16 09:21:12 -0500</bug_when>
    <thetext>Fedora 25+ now has qemu block drivers built as modules. qemu-system-x86 will still pull in gluster via qemu-block-gluster, but you can use the qemu-system-x86-core package to pull in qemu without any external block drivers.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
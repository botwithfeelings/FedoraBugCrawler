<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1357383</bug_id>
          
          <creation_ts>2016-07-18 02:07:00 -0400</creation_ts>
          <short_desc>Better Switchable Graphics Support</short_desc>
          <delta_ts>2016-11-22 08:59:09 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>Changes Tracking</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>ChangeAcceptedF25, SelfContainedChange</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Kurik">jkurik</reporter>
          <assigned_to name="Hans de Goede">hdegoede</assigned_to>
          <cc>afonsobordado</cc>
    
    
    <cc>d-bugzilla</cc>
    
    
    <cc>hdegoede</cc>
    
    
    <cc>luneworm</cc>
    
    
    <cc>starfall</cc>
    
    
    <cc>vseleznv</cc>
    
    
    <cc>wsxy162</cc>
          
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-22 08:59:09</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9516272</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-18 02:07:18 -0400</bug_when>
    <thetext>This is a tracking bug for Change: Better Switchable Graphics Support
For more details, see: https://fedoraproject.org//wiki/Changes/BetterSwitchableGraphicsSupport

All modern laptops have a gpu integrated into their processor (the igpu), some models also have a more powerful dedicated gpu (dgpu), this is called switchable graphics. The goal of this feature is to improve Fedora&apos;s support for such laptops.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9516300</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-18 02:19:43 -0400</bug_when>
    <thetext>*** Bug 1357385 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549107</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 00:19:30 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9550186</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 01:22:56 -0400</bug_when>
    <thetext>On 2016-July-26, we have reached Fedora 25 Change Checkpoint: Completion deadline (testable).

At this point, all accepted changes should be substantially complete, and testable. Additionally, if a change is to be enabled by default, it must be enabled at Change Completion deadline as well.

Change tracking bug should be set to the MODIFIED state to indicate it achieved completeness.

Incomplete and non testable Changes will be reported to FESCo on 2016-July-29 meeting.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9629949</commentid>
    <comment_count>4</comment_count>
    <who name="Dingzhong Chen">wsxy162</who>
    <bug_when>2016-08-19 05:28:14 -0400</bug_when>
    <thetext>Will this also improve the experience with proprietary drivers from Nvidia or AMD？</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9630098</commentid>
    <comment_count>5</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-08-19 06:24:27 -0400</bug_when>
    <thetext>(In reply to Dingzhong Chen from comment #4)
&gt; Will this also improve the experience with proprietary drivers from Nvidia
&gt; or AMD？

No for now we are purely focussing on the experience when using Open Source drivers.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9666126</commentid>
    <comment_count>6</comment_count>
    <who name="Aynur Yanturin">luneworm</who>
    <bug_when>2016-08-31 03:14:49 -0400</bug_when>
    <thetext>Dear Hans de Goede,
I cannot understand from the description whether this implies changing the gpu automatically for gpu-heavy tasks as in Windows) or manually (as in nvidia-prime or bumblebee). Could you please clarify?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9666674</commentid>
    <comment_count>7</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-08-31 06:02:17 -0400</bug_when>
    <thetext>The focus for now is on just making things work, using the discrete gpu as little as possible. E.g. currently there are sometimes problems using external outputs which are only connected to the dgpu; or problems with suspend / resume. The focus of this feature is to fix all these problems.

Besides that I&apos;m also trying to make sure that &quot;DRI_PRIME=1 opengl-app&quot; works everywhere to actually
run opengl heavy tasks on the dgpu.

Note this is all with the opensource drivers, closed source drivers are not supported by Fedora. Since the nouveau opengl performance is not always what it should be, using &quot;DRI_PRIME=1 opengl-app&quot; there is no necessarily a win.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9752831</commentid>
    <comment_count>8</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-09-29 05:06:19 -0400</bug_when>
    <thetext>On 2016-Sep-27 we reached the &quot;Change Checkpoint: 100% Code Complete Deadline&quot; milestone for Fedora 25 release. At this point all the Changes not at least in &quot;ON_QA&quot; state should be brought to FESCo for review. Please update the state of this bug to &quot;ON_QA&quot; if it is already 100% completed. Please let me know in case you have any trouble with the implementation and the Change needs any help or review.

Thanks, Jan</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9829582</commentid>
    <comment_count>9</comment_count>
    <who name="Didier">d-bugzilla</who>
    <bug_when>2016-10-28 08:48:50 -0400</bug_when>
    <thetext>FYI :

(not quite sure whether to post this as a separate bug, or here, as feedback to the Test Day)


Fairly recent high-end Dell Precision 7710 (latest BIOS 1.8.3 10/2016) :
- LCD : 17.3&quot; UHD 3840x2160
- IGP : Intel Xeon E3-1545M (Intel Iris Pro P580)
- DGP : AMD FirePro W7170M (Radeon R9 285) , GCN 1.2

WRT https://fedoraproject.org/wiki/Test_Day:2016-10-26_BetterSwitchableGraphicsSupport , downloaded and ran Fedora-Workstation-Live-x86_64-25-20161026.n.0.iso (from https://www.happyassassin.net/nightlies.html).


Experiencing the same issues as with almost every F24/kernel incantation :

- With hybrid/switchable graphics enabled :
the system almost always locks up hard (black screen, no caps lock or num lock, no Alt-SysRq) when trying to suspend or when the screen saver (DPMS ?) is started.
This is with both i915 and amdgpu loaded (vgaswitcheroo), and with amdgpu blacklisted.

- With hybrid/switchable graphics disabled in the BIOS :
Screen locking usually works, suspending usually fails.

Other info :
* Tested with and without &quot;dis_ucode_ldr&quot; kernel parameter ;
* Unfortunately, it seems I am unable to setup kernel logging via USB serial console ;
* Willing to supply all kinds of info (ACPI dumps etc.), if instructed what &amp; how.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9829607</commentid>
    <comment_count>10</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-10-28 09:03:07 -0400</bug_when>
    <thetext>Hi,

(In reply to Didier from comment #9)
&gt; Fairly recent high-end Dell Precision 7710 (latest BIOS 1.8.3 10/2016) :
&gt; - LCD : 17.3&quot; UHD 3840x2160
&gt; - IGP : Intel Xeon E3-1545M (Intel Iris Pro P580)
&gt; - DGP : AMD FirePro W7170M (Radeon R9 285) , GCN 1.2

Can you please file a new bug for this (just copy and paste your comment here to a new bug).
Pick xorg-x11-drv-ati as the component; and add me to the Cc.

Can you try hybrid mode with the 4.9 kernel? Download it here:
http://koji.fedoraproject.org/koji/buildinfo?buildID=812344

Download the kernel-core and kernel-modules files for your arch (likely x86_64) into a new directory,
then in that directory run: &quot;sudo rpm -ivh kernel*.rpm&quot;. Note with kernels you should always use -ivh and not -Uvh so that they get installed in parallel and you can still choose the old kernel in the bootloader.
Please do not use any special kernel cmdline options when trying the 4.9 kernel.

If the 4.9 kernel does not resolve the suspend/resume issue you are seeing, please try hybrid mode with the amdgpu driver blacklisted; and see if this at least gives you a working system including working suspend / resume ?

Note I&apos;m afraid this is going to be a tricky issue to resolve.

Regards,

Hans</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9830266</commentid>
    <comment_count>11</comment_count>
    <who name="Didier">d-bugzilla</who>
    <bug_when>2016-10-28 14:32:38 -0400</bug_when>
    <thetext>Hi Hans,

Thanks for the reply ; I&apos;ll open a new bug report and test Koji&apos;s kernel-4.9.x after the weekend.

I guess, without any decent kernel reporting (i.e. by means of USB serial logging), these will be largely shots in the dark.


A similar Dell Precision 7510 exhibits more or less the same issues ; Dell ACPI ?

(how ironic I specifically dropped years of NVIDIA use because of its closed source nature).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9837650</commentid>
    <comment_count>12</comment_count>
    <who name="">starfall</who>
    <bug_when>2016-11-01 11:14:09 -0400</bug_when>
    <thetext>After upgrading to kernel 4.8.4-200.fc24, DRI_PRIME is resulting in hangs on my Dell XPS 15 9530 (Nouveau on 750M). It was working fine on 4.7.9-200 (although reclocking never worked on this Keplar card properly, it still ran fine).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9845113</commentid>
    <comment_count>13</comment_count>
    <who name="Didier">d-bugzilla</who>
    <bug_when>2016-11-02 10:00:25 -0400</bug_when>
    <thetext>(In reply to Hans de Goede from comment #10)

&gt; Can you please file a new bug for this (just copy and paste your comment
&gt; here to a new bug).
&gt; Pick xorg-x11-drv-ati as the component; and add me to the Cc.

Filed as bug 1391045.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
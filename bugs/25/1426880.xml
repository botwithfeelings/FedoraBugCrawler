<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1426880</bug_id>
          
          <creation_ts>2017-02-25 21:10:00 -0500</creation_ts>
          <short_desc>Lua plugin is built against luajit and cannot use some lua modules</short_desc>
          <delta_ts>2017-03-26 02:15:09 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>hexchat</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>low</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthew Sage">matthewsage</reporter>
          <assigned_to name="Patrick Griffis">tingping</assigned_to>
          <cc>oliver</cc>
    
    
    <cc>praiskup</cc>
    
    
    <cc>tingping</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-26 02:15:09</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10184141</commentid>
    <comment_count>0</comment_count>
    <who name="Matthew Sage">matthewsage</who>
    <bug_when>2017-02-25 21:10:51 -0500</bug_when>
    <thetext>Description of problem:

The Lua plugin shipping with Hexchat version 2.12.4 on Fedora 25 is compiled against Lua 5.1, when the Lua version that ships with F25 is 5.3.4. This causes problems when trying to load Lua modules in Lua-written Hexchat addons, since the Lua plugin will always try looking for modules under the Lua 5.1 directories.


Version-Release number of selected component (if applicable):

2.12.4


How reproducible:

It can be reproduced with any Lua addon that loads any Lua modules.


Steps to Reproduce:

1. Add any Lua script that explicitly requires a Lua module to the addons directory
2. Run Hexchat


Actual results:

Lua fails to load the required moduled. See sample output:

 Lua version 1.3/5.1 loaded.
 Lua error: /home/sage/.config/hexchat/addons/nowplaying.lua:1: module &apos;lgi&apos; not found:
 no field package.preload[&apos;lgi&apos;]
 no file &apos;./lgi.lua&apos;
 no file &apos;/usr/share/luajit-2.0.4/lgi.lua&apos;
 no file &apos;/usr/local/share/lua/5.1/lgi.lua&apos;
 no file &apos;/usr/local/share/lua/5.1/lgi/init.lua&apos;
 no file &apos;/usr/share/lua/5.1/lgi.lua&apos;
 no file &apos;/usr/share/lua/5.1/lgi/init.lua&apos;
 no file &apos;./lgi.so&apos;
 no file &apos;/usr/local/lib/lua/5.1/lgi.so&apos;
 no file &apos;/usr/lib64/lua/5.1/lgi.so&apos;
 no file &apos;/usr/local/lib/lua/5.1/loadall.so&apos;
 stack traceback:
 [C]: in function &apos;require&apos;
 /home/sage/.config/hexchat/addons/nowplaying.lua:1: in main chunk

As you can see in the following output, the LGI module is actually installed, however it is located in the 5.3 directory:

[sage@qub addons]$ ls -l /usr/share/lua/5.3/lgi.lua
-rw-r--r--. 1 root root 756 Jun  3  2016 /usr/share/lua/5.3/lgi.lua


Expected results:

The Lua-writted addon should load successfully. In fact, after manually compiling hexchat-lua against lua 5.3 and copying lua.so to /usr/lib64/hexchat/plugins, this is the expected output:

 lua version 1.3-5.3 loaded.

And my Lua-written addon loads properly and works after that.


Additional info:

None.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10184340</commentid>
    <comment_count>1</comment_count>
    <who name="Patrick Griffis">tingping</who>
    <bug_when>2017-02-26 03:49:55 -0500</bug_when>
    <thetext>Well yes they are parallel ABIs like Python2 and Python3.

I have reported that lgi needs to be built against luajit here: https://bugzilla.redhat.com/show_bug.cgi?id=1323428</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10277274</commentid>
    <comment_count>2</comment_count>
    <who name="Patrick Griffis">tingping</who>
    <bug_when>2017-03-26 02:15:09 -0400</bug_when>
    <thetext>The lgi package has been updated and you can now just install `lua-lgi-compat`.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1021795</bug_id>
          
          <creation_ts>2013-10-22 02:33:00 -0400</creation_ts>
          <short_desc>spice wants to run &apos;gstack&apos; on itself to log backtrace, upsets selinux</short_desc>
          <delta_ts>2016-12-13 09:05:10 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>spice</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:54b3f0b26c809c29e55b14da2435a594293112524d1a237d256cfdecd5987fb0</status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to name="Christophe Fergeau">cfergeau</assigned_to>
          <cc>abrt-devel-list</cc>
    
    
    <cc>alexl</cc>
    
    
    <cc>amit.shah</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dblechte</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>fziglio</cc>
    
    
    <cc>hdegoede</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jberan</cc>
    
    
    <cc>jforbes</cc>
    
    
    <cc>kem</cc>
    
    
    <cc>luya</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>marcandre.lureau</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>scottt.tw</cc>
    
    
    <cc>uril</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-12 15:49:45</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>6443856</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2013-10-22 02:33:25 -0400</bug_when>
    <thetext>Description of problem:
Well, no idea really, but I&apos;d just tried to run rendercheck in a VM, and things seemed to go south.
SELinux is preventing /usr/bin/gdb from &apos;open&apos; accesses on the file /var/lib/rpm/Packages.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that gdb should be allowed open access on the Packages file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# grep gdb /var/log/audit/audit.log | audit2allow -M mypol
# semodule -i mypol.pp

Additional Information:
Source Context                system_u:system_r:svirt_t:s0:c547,c920
Target Context                system_u:object_r:rpm_var_lib_t:s0
Target Objects                /var/lib/rpm/Packages [ file ]
Source                        gdb
Source Path                   /usr/bin/gdb
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           gdb-7.6.50.20130731-12.fc20.x86_64
Target RPM Packages           rpm-4.11.1-7.fc20.x86_64
Policy RPM                    selinux-policy-3.12.1-90.fc20.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Permissive
Host Name                     (removed)
Platform                      Linux (removed) 3.11.6-300.fc20.x86_64 #1 SMP Fri
                              Oct 18 22:31:53 UTC 2013 x86_64 x86_64
Alert Count                   1
First Seen                    2013-10-21 23:32:06 PDT
Last Seen                     2013-10-21 23:32:06 PDT
Local ID                      e03def73-ecd2-4e00-bf7b-495c06672b4b

Raw Audit Messages
type=AVC msg=audit(1382423526.567:1667): avc:  denied  { open } for  pid=19890 comm=&quot;gdb&quot; path=&quot;/var/lib/rpm/Packages&quot; dev=&quot;dm-1&quot; ino=686712 scontext=system_u:system_r:svirt_t:s0:c547,c920 tcontext=system_u:object_r:rpm_var_lib_t:s0 tclass=file


type=SYSCALL msg=audit(1382423526.567:1667): arch=x86_64 syscall=open success=yes exit=ENOMEM a0=23c0b90 a1=0 a2=0 a3=7fff6f7f04c0 items=0 ppid=19886 pid=19890 auid=4294967295 uid=107 gid=107 euid=107 suid=107 fsuid=107 egid=107 sgid=107 fsgid=107 ses=4294967295 tty=(none) comm=gdb exe=/usr/bin/gdb subj=system_u:system_r:svirt_t:s0:c547,c920 key=(null)

Hash: gdb,svirt_t,rpm_var_lib_t,file,open

Additional info:
reporter:       libreport-2.1.8
hashmarkername: setroubleshoot
kernel:         3.11.6-300.fc20.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6446714</commentid>
    <comment_count>1</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2013-10-22 13:32:08 -0400</bug_when>
    <thetext>Looks like a crashing svirt_t process is trying to launch gdb which is not something we will support from a svirt confinement.

This is most likely not the cause of everything going south, but the result.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6477098</commentid>
    <comment_count>2</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2013-10-31 16:32:44 -0400</bug_when>
    <thetext>I don&apos;t understand where this is coming from, libvirt or qemu don&apos;t appear to launch gdb anywhere. Not really sure what to do with this one, someone reopen if they have hints</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6479770</commentid>
    <comment_count>3</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2013-11-01 12:33:09 -0400</bug_when>
    <thetext>Could this be abrt doing something wacky?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6480303</commentid>
    <comment_count>4</comment_count>
    <who name="Jakub Filak">jfilak</who>
    <bug_when>2013-11-01 15:58:27 -0400</bug_when>
    <thetext>abrt uses gdb to create a backtrace and explore vulnerabilities. However abrt does this for all detected coredumps.


abrt vulnerability analysis snippet:

gdb --batch \
    -ex &apos;python execfile(&quot;/usr/libexec/abrt-gdb-exploitable&quot;)&apos; \
    -ex &apos;core-file ./coredump&apos; \
    -ex &apos;abrt-exploitable 4 ./exploitable&apos;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6484658</commentid>
    <comment_count>5</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2013-11-04 10:51:01 -0500</bug_when>
    <thetext>Jakub does it do this by inserting a library into the process stack?  We do not want to allow every app on the system to be allowed to execute gdb and ptrace processes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6484778</commentid>
    <comment_count>6</comment_count>
    <who name="Jakub Filak">jfilak</who>
    <bug_when>2013-11-04 11:14:05 -0500</bug_when>
    <thetext>(In reply to Daniel Walsh from comment #5)
I am not sure if this will answer your question exactly but abrt always runs gdb on a core dump file stored in /var/tmp/abrt/ccpp-* directory (abrt never tries to attach a running process) and all gdb processes are run by one of the following executables /usr/sbin/abrtd, /usr/bin/abrt-action-generate-core-backtrace and /usr/bin/abrt-action-analyze-vulnerability.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6485351</commentid>
    <comment_count>7</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2013-11-04 12:31:34 -0500</bug_when>
    <thetext>Which probably means these are not being caused by abrt.  But by something else?

What desktop are you guys running? kde?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6629919</commentid>
    <comment_count>8</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2013-12-17 16:18:50 -0500</bug_when>
    <thetext>I just hit this myself. Looks like spice has some internal &apos;log a backtrace&apos; behavior that basically just calls &apos;gstack&apos; on the current process. Not surprising that selinux complains.

spice guys, can there be a configure switch that disables this behavior that we turn on by default in fedora? abrt is going to catch these backtraces anyways so there&apos;s not much gained from dumping them in the libvirt logs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>6920792</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Admin XMLRPC Client">fedora-admin-xmlrpc</who>
    <bug_when>2014-03-17 05:25:49 -0400</bug_when>
    <thetext>This package has changed ownership in the Fedora Package Database.  Reassigning to the new owner of this component.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8278764</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2015-05-29 05:36:38 -0400</bug_when>
    <thetext>This message is a reminder that Fedora 20 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 20. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;20&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 20 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8290619</commentid>
    <comment_count>11</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2015-05-31 15:03:54 -0400</bug_when>
    <thetext>Haven&apos;t seen any other selinux warnings about this, so I assume this was fixed somehow</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9156747</commentid>
    <comment_count>12</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-03-17 11:10:52 -0400</bug_when>
    <thetext>*** Bug 1266582 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9156753</commentid>
    <comment_count>13</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-03-17 11:11:56 -0400</bug_when>
    <thetext>There were hits on f23, I suspect this is still relevant</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9920124</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-24 06:03:30 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9978318</commentid>
    <comment_count>15</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-12-12 15:49:45 -0500</bug_when>
    <thetext>I can&apos;t find any reference to backtracing in the latest spice.git code, nor any recent selinux AVC reports in bugzilla, so hopefully this is fixed/avoided nowadays</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9980184</commentid>
    <comment_count>16</comment_count>
    <who name="Christophe Fergeau">cfergeau</who>
    <bug_when>2016-12-13 04:51:40 -0500</bug_when>
    <thetext>For what it&apos;s worth, spice still has this code, it&apos;s in a git submodule:
https://cgit.freedesktop.org/spice/spice-common/tree/common/log.c#n150
https://cgit.freedesktop.org/spice/spice-common/tree/common/backtrace.c

Iirc I did not manage to get selinux warnings last time I tried to reproduce.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9980984</commentid>
    <comment_count>17</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2016-12-13 09:05:10 -0500</bug_when>
    <thetext>Whoops, I tried to check spice-common but must have screwed it up somehow...</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
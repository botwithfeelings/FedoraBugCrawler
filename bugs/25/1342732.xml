<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1342732</bug_id>
          
          <creation_ts>2016-06-04 05:38:00 -0400</creation_ts>
          <short_desc>SELinux is preventing accounts-daemon from &apos;write&apos; accesses on the directory root.</short_desc>
          <delta_ts>2017-06-19 13:14:45 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>selinux-policy</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1344144</see_also>
    
    
    
    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1344145</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>abrt_hash:aa8dff3211f69a6999a3bdb11526902db8d8109607cd0638826b1fc857bbfc4d;VARIANT_ID=workstation; AcceptedBlocker</status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>high</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1277289</blocked>
    
    
    <blocked>1462924</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Joachim Frieben">jfrieben</reporter>
          <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
          <cc>13639307543</cc>
    
    
    <cc>awilliam</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>luya</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mclasen</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>mikhail.v.gavrilov</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>pschindl</cc>
    
    
    <cc>reklov</cc>
    
    
    <cc>rhbz2</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>rstrode</cc>
    
    
    <cc>stefw</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>selinux-policy-3.13.1-211.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-09-13 14:12:16</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9387030</commentid>
    <comment_count>0</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-06-04 05:38:42 -0400</bug_when>
    <thetext>Description of problem:
Alert showed up in the graphical SELinux Troubleshooter tool after performing a network install from the current Fedora development 25 (rawhide) tree, fully relabeling the file system and rebooting the system in permissive mode.
SELinux is preventing accounts-daemon from &apos;write&apos; accesses on the directory root.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that accounts-daemon should be allowed write access on the root directory by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# ausearch -c &apos;accounts-daemon&apos; --raw | audit2allow -M my-accountsdaemon
# semodule -X 300 -i my-accountsdaemon.pp

Additional Information:
Source Context                system_u:system_r:accountsd_t:s0
Target Context                system_u:object_r:admin_home_t:s0
Target Objects                root [ dir ]
Source                        accounts-daemon
Source Path                   accounts-daemon
Port                          &lt;Unknown&gt;
Host                          (removed)
Source RPM Packages           
Target RPM Packages           filesystem-3.2-37.fc24.x86_64
Policy RPM                    selinux-policy-3.13.1-193.fc25.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     (removed)
Platform                      Linux (removed) 4.7.0-0.rc1.git3.1.fc25.x86_64 #1
                              SMP Thu Jun 2 15:45:29 UTC 2016 x86_64 x86_64
Alert Count                   1
First Seen                    2016-06-04 11:16:31 CEST
Last Seen                     2016-06-04 11:16:31 CEST
Local ID                      4cf6afbc-28ad-4b76-9218-9aa86e43f217

Raw Audit Messages
type=AVC msg=audit(1465031791.730:94): avc:  denied  { write } for  pid=743 comm=&quot;accounts-daemon&quot; name=&quot;root&quot; dev=&quot;dm-0&quot; ino=655362 scontext=system_u:system_r:accountsd_t:s0 tcontext=system_u:object_r:admin_home_t:s0 tclass=dir permissive=0


Hash: accounts-daemon,accountsd_t,admin_home_t,dir,write

Version-Release number of selected component:
selinux-policy-3.13.1-193.fc25.noarch

Additional info:
reporter:       libreport-2.7.1
hashmarkername: setroubleshoot
kernel:         4.7.0-0.rc1.git3.1.fc25.x86_64
reproducible:   Not sure how to reproduce the problem
type:           libreport

Potential duplicate: bug 1341911</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9399388</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-08 17:14:16 -0400</bug_when>
    <thetext>Description of problem:
Appears on boot of current Rawhide Workstation live with enforcing=0 . If you attempt to boot without enforcing=0, the system never reaches the desktop. There are 3 other alerts, not sure which is the critical one.

Version-Release number of selected component:
selinux-policy-3.13.1-194.fc25.noarch

Additional info:
reporter:       libreport-2.7.1
hashmarkername: setroubleshoot
kernel:         4.7.0-0.rc2.git1.1.fc25.x86_64
reproducible:   Not sure how to reproduce the problem
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9399404</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-08 17:21:10 -0400</bug_when>
    <thetext>Proposing as an F25 Alpha blocker: &quot;All release-blocking images must boot in their supported configurations. ...  Release-blocking live images must boot to the expected boot menu, and then to a desktop or to a login prompt where it is clear how to log in to a desktop.&quot; - Workstation live does not reach a desktop unless you boot with enforcing=0 . This (and/or the other two related denials I listed in &apos;See Also&apos;) are my best bets as to why.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9399405</commentid>
    <comment_count>3</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-08 17:21:57 -0400</bug_when>
    <thetext>adding Ray for info, as he&apos;s the accountsservice maintainer.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9399443</commentid>
    <comment_count>4</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-08 17:48:55 -0400</bug_when>
    <thetext>Confirming this also appears to be what prevents a fresh Workstation network install from booting; I see the same denial and can boot with enforcing=0 . (The other two accounts-daemon denials don&apos;t happen for this case, though).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9400991</commentid>
    <comment_count>5</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-06-09 09:05:10 -0400</bug_when>
    <thetext>probably dupe of bug 1331926.  i guess i forgot to do a rawhide build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9405496</commentid>
    <comment_count>6</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-06-11 10:50:00 -0400</bug_when>
    <thetext>Sorry, it&apos;s still broken the same way in today&apos;s Rawhide nightly, with accountsservice-0.6.42-1.fc25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9432520</commentid>
    <comment_count>7</comment_count>
    <who name="Lukas Vrabec">lvrabec</who>
    <bug_when>2016-06-20 06:53:46 -0400</bug_when>
    <thetext>Ray, 
What is state of this issue? Do you need any policy changes?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9433385</commentid>
    <comment_count>8</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-06-20 10:22:12 -0400</bug_when>
    <thetext>no sure. I tried to reproduce everything worked for me.  adamw mentioned to me on the 15th (on irc) that things were working for him again, too, so I&apos;ll just close this WORKSFORME

If a problem remanifests we can reopen.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9440915</commentid>
    <comment_count>9</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-06-22 09:00:26 -0400</bug_when>
    <thetext>Description of problem:
Alert appeared in the SELinux Troubleshooter utility after removing directory /root/.cache and rebooting the system.

Version-Release number of selected component:
selinux-policy-3.13.1-197.fc25.noarch

Additional info:
reporter:       libreport-2.7.1
hashmarkername: setroubleshoot
kernel:         4.7.0-0.rc4.git1.2.fc25.x86_64
reproducible:   Not sure how to reproduce the problem
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9440935</commentid>
    <comment_count>10</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-06-22 09:06:18 -0400</bug_when>
    <thetext>(In reply to Joachim Frieben from comment #9)
Installed packages include accountsservice-0.6.42-1.fc25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9468841</commentid>
    <comment_count>11</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-06-30 10:12:01 -0400</bug_when>
    <thetext>(In reply to Ray Strode [halfline] from comment #8)
As of accountsservice-0.6.42-1.fc25, directory /root/.cache does get created upon reboot every time it has been removed, and this action does trigger an AVC as reported in /var/log/audit/audit.log but currently -not- by the SELinux Troubleshooter utility.
This behaviour contradicts the changelog of package accountsservice which states:

* Tue May 31 2016 Ray Strode &lt;rstrode redhat com&gt; - 0.6.40-4
- Don&apos;t create /root/.cache at startup
  Resolves: #1331926</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9469499</commentid>
    <comment_count>12</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-06-30 12:58:56 -0400</bug_when>
    <thetext>does your /usr/lib/systemd/system/accounts-daemon.service have:

Environment=GVFS_DISABLE_FUSE=1
Environment=GIO_USE_VFS=local
Environment=GVFS_REMOTE_VOLUME_MONITOR_IGNORE=1

in it?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9469581</commentid>
    <comment_count>13</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-06-30 13:24:54 -0400</bug_when>
    <thetext>Both Fedora 24 and Fedora 25 include identical files /usr/lib/systemd/system/accounts-daemon.service with content:

[Unit]
Description=Accounts Service

# In order to avoid races with identity-providing services like SSSD or
# winbind, we need to ensure that Accounts Service starts after
# nss-user-lookup.target
After=nss-user-lookup.target
Wants=nss-user-lookup.target

[Service]
Type=dbus
BusName=org.freedesktop.Accounts
ExecStart=/usr/libexec/accounts-daemon
StandardOutput=syslog
Environment=GVFS_DISABLE_FUSE=1
Environment=GIO_USE_VFS=local
Environment=GVFS_REMOTE_VOLUME_MONITOR_IGNORE=1

[Install]
# We pull this in by graphical.target instead of waiting for the bus
# activation, to speed things up a little: gdm uses this anyway so it is nice
# if it is already around when gdm wants to use it and doesn&apos;t have to wait for
# it.
WantedBy=graphical.target</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9471977</commentid>
    <comment_count>14</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-07-01 07:59:40 -0400</bug_when>
    <thetext>can you run strings /proc/$(pidof accounds-daemon)/environ and post the output ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9473378</commentid>
    <comment_count>15</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-07-01 17:22:46 -0400</bug_when>
    <thetext>(In reply to Ray Strode [halfline] from comment #14)
LANG=en_US.UTF-8
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
GVFS_DISABLE_FUSE=1
GIO_USE_VFS=local
GVFS_REMOTE_VOLUME_MONITOR_IGNORE=1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9536026</commentid>
    <comment_count>16</comment_count>
    <who name="Petr Schindler">pschindl</who>
    <bug_when>2016-07-21 05:34:32 -0400</bug_when>
    <thetext>Discussed at 2016-07-20 blocker review meeting: [1]. 

We decided to remove blocker nomination from this bug. Original bug seems to be already fixed. There is no need to block on this now. If the problem appears again, please repropose.

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2016-07-20/f25-blocker-review.2016-07-20-16.00.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9537212</commentid>
    <comment_count>17</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-07-21 10:29:40 -0400</bug_when>
    <thetext>(In reply to Petr Schindler from comment #16)
Comment 11 is still valid even though related AVCs are again reported by the graphical SELinux Troubleshooter utility.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9537217</commentid>
    <comment_count>18</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-07-21 10:30:20 -0400</bug_when>
    <thetext>SELinux is preventing accounts-daemon from write access on the directory /root.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that accounts-daemon should be allowed write access on the root directory by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# ausearch -c &apos;accounts-daemon&apos; --raw | audit2allow -M my-accountsdaemon
# semodule -X 300 -i my-accountsdaemon.pp

Additional Information:
Source Context                system_u:system_r:accountsd_t:s0
Target Context                system_u:object_r:admin_home_t:s0
Target Objects                /root [ dir ]
Source                        accounts-daemon
Source Path                   accounts-daemon
Port                          &lt;Unknown&gt;
Host                          noname
Source RPM Packages           
Target RPM Packages           filesystem-3.2-37.fc24.x86_64
Policy RPM                    selinux-policy-3.13.1-203.fc25.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     noname
Platform                      Linux noname 4.7.0-0.rc7.git4.2.fc25.x86_64 #1 SMP
                              Tue Jul 19 15:56:43 UTC 2016 x86_64 x86_64
Alert Count                   1
First Seen                    2016-07-21 13:35:52 CEST
Last Seen                     2016-07-21 13:35:52 CEST
Local ID                      a5502fb0-e5b5-4f36-993c-f0d6a463462d

Raw Audit Messages
type=AVC msg=audit(1469100952.512:91): avc:  denied  { write } for  pid=672 comm=&quot;accounts-daemon&quot; name=&quot;root&quot; dev=&quot;dm-0&quot; ino=262146 scontext=system_u:system_r:accountsd_t:s0 tcontext=system_u:object_r:admin_home_t:s0 tclass=dir permissive=0


Hash: accounts-daemon,accountsd_t,admin_home_t,dir,write</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549506</commentid>
    <comment_count>19</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 00:42:12 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9617356</commentid>
    <comment_count>20</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-08-16 02:16:25 -0400</bug_when>
    <thetext>Description of problem:
This popped up on me on first boot after a default Workstation Live install (Fedora-Workstation-Live-x86_64-25-20160815.n.2.iso). I just started terminal and ran dnf, nothing else. Not sure whether this occurred before or after.

Version-Release number of selected component:
selinux-policy-3.13.1-207.fc25.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.0-0.rc1.git0.1.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9617364</commentid>
    <comment_count>21</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-08-16 02:19:59 -0400</bug_when>
    <thetext>Proposing as a Final blocker:
&quot;There must be no SELinux denial notifications or crash notifications on boot of or during installation from a release-blocking live image, or at first login after a default install of a release-blocking desktop. &quot;
https://fedoraproject.org/wiki/Fedora_25_Final_Release_Criteria#SELinux_and_crash_notifications</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9628430</commentid>
    <comment_count>22</comment_count>
    <who name="Luya Tshimbalanga">luya</who>
    <bug_when>2016-08-18 17:32:18 -0400</bug_when>
    <thetext>Description of problem:
Bug occurred on booting a F25 Workstation livemedia

Version-Release number of selected component:
selinux-policy-3.13.1-207.fc25.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.0-0.rc1.git0.1.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9637760</commentid>
    <comment_count>23</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-08-22 18:18:44 -0400</bug_when>
    <thetext>Discussed during the 2016-08-22 blocker review meeting: [1]

The decision to classify this bug as an AcceptedBlocker was made as it is a clear violation of &quot;There must be no SELinux denial notifications or crash notifications on boot of or during installation from a release-blocking live image, or at first login after a default install of a release-blocking desktop.&quot;

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2016-08-22/f25-blocker-review.2016-08-22-16.00.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9645354</commentid>
    <comment_count>24</comment_count>
    <who name="Joachim Frieben">jfrieben</who>
    <bug_when>2016-08-24 07:30:18 -0400</bug_when>
    <thetext>Description of problem:
Alert appears after booting from Fedora-Workstation-Live-x86_64-25_Alpha-1.1 media.

Version-Release number of selected component:
selinux-policy-3.13.1-208.fc25.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.0-0.rc2.git3.1.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9649904</commentid>
    <comment_count>25</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-25 14:20:53 -0400</bug_when>
    <thetext>selinux-policy-3.13.1-211.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-cbdde50ec4</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9657014</commentid>
    <comment_count>26</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-08-28 12:38:49 -0400</bug_when>
    <thetext>Description of problem:
I booted a Fedora 25 Workstation iso compose (2016-08-27) in a virtual machine using virt-manager and got this selinux alert after boot.

Version-Release number of selected component:
selinux-policy-3.13.1-208.fc25.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.0-0.rc2.git3.1.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9664414</commentid>
    <comment_count>27</comment_count>
    <who name="Mikhail">mikhail.v.gavrilov</who>
    <bug_when>2016-08-30 12:57:44 -0400</bug_when>
    <thetext>Description of problem:
Just run Fedora from live USB

Version-Release number of selected component:
selinux-policy-3.13.1-208.fc25.noarch

Additional info:
reporter:       libreport-2.7.2
hashmarkername: setroubleshoot
kernel:         4.8.0-0.rc2.git3.1.fc25.x86_64
type:           libreport</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9704380</commentid>
    <comment_count>28</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-09-13 14:11:41 -0400</bug_when>
    <thetext>selinux-policy-3.13.1-211.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9758337</commentid>
    <comment_count>29</comment_count>
    <who name="john smith">13639307543</who>
    <bug_when>2016-09-30 15:00:28 -0400</bug_when>
    <thetext>*** Bug 1380849 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
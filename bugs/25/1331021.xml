<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1331021</bug_id>
          
          <creation_ts>2016-04-27 09:09:00 -0400</creation_ts>
          <short_desc>Assertion &quot;(_cairo_atomic_int_get (&amp;(&amp;surface-&gt;ref_count)-&gt;ref_count) &gt; 0)</short_desc>
          <delta_ts>2016-08-08 04:00:20 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>cairo</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Patch</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jaroslav Škarvada">jskarvad</reporter>
          <assigned_to name="Benjamin Otte">otte</assigned_to>
          <cc>fedora</cc>
    
    
    <cc>hicham.haouari</cc>
    
    
    <cc>klember</cc>
    
    
    <cc>mauricio.pronet</cc>
    
    
    <cc>otte</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>cairo-1.14.6-2.fc24</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-01 12:25:00</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9273192</commentid>
    <comment_count>0</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2016-04-27 09:09:13 -0400</bug_when>
    <thetext>Description of problem:
cairo-surface.c:953: cairo_surface_destroy: assert „((*&amp;(&amp;surface-&gt;ref_count)-&gt;ref_count) &gt; 0)“ not valid.

Version-Release number of selected component (if applicable):
emerald-0.8.8-14.fc23 

How reproducible:
Always

Steps to Reproduce:
1. Used xfce with emerald theme Crystal-ICE (legacy engine)
2. Interaction with sim messanger (e.g. send few jabber messages)

Actual results:
Segfault in less than 60 seconds of sim usage.
cairo-surface.c:953: cairo_surface_destroy: assert „((*&amp;(&amp;surface-&gt;ref_count)-&gt;ref_count) &gt; 0)“ not valid.

Expected results:
No segfault

Additional info:
There may be more reproducers for this problem, but this one is really reliable. It seems it doesn&apos;t happen with emerald-0.8.8-14.fc23.x86_64

The backtrace is attached, but it doesn&apos;t help me much:
#0  0x00007f67f0e00a98 in raise () at /lib64/libc.so.6
#1  0x00007f67f0e0269a in abort () at /lib64/libc.so.6
#2  0x00007f67f0df9227 in __assert_fail_base () at /lib64/libc.so.6
#3  0x00007f67f0df92d2 in  () at /lib64/libc.so.6
#4  0x00007f67f191ee12 in cairo_surface_destroy () at /lib64/libcairo.so.2
#5  0x00007f67f194e000 in _get_image_surface () at /lib64/libcairo.so.2
#6  0x00007f67f194ec73 in _cairo_xlib_surface_acquire_source_image () at /lib64/libcairo.so.2
#7  0x00007f67f191f6d4 in _cairo_surface_acquire_source_image () at /lib64/libcairo.so.2
#8  0x00007f67f18e7e52 in _pixman_image_for_pattern () at /lib64/libcairo.so.2
#9  0x00007f67f18e893e in _cairo_image_source_create_for_pattern () at /lib64/libcairo.so.2
#10 0x00007f67f191c151 in clip_and_composite_boxes.part () at /lib64/libcairo.so.2
#11 0x00007f67f191c75e in clip_and_composite_boxes () at /lib64/libcairo.so.2
#12 0x00007f67f191ca79 in _cairo_spans_compositor_mask () at /lib64/libcairo.so.2
#13 0x00007f67f18d7429 in _cairo_compositor_paint () at /lib64/libcairo.so.2
#14 0x00007f67f191f8b1 in _cairo_surface_paint () at /lib64/libcairo.so.2
#15 0x00007f67f18df285 in _cairo_gstate_paint () at /lib64/libcairo.so.2
#16 0x00007f67f18d1ea5 in cairo_paint () at /lib64/libcairo.so.2
#17 0x00007f67f4308ad0 in try_pixmap_and_mask.part () at /lib64/libwnck-3.so.0
#18 0x00007f67f4309fa4 in _wnck_read_icons () at /lib64/libwnck-3.so.0
#19 0x00007f67f42ff90f in get_icons () at /lib64/libwnck-3.so.0
#20 0x00007f67f43004af in force_update_now () at /lib64/libwnck-3.so.0
#21 0x00007f67f430175a in update_idle () at /lib64/libwnck-3.so.0
#22 0x00007f67f1c22e3a in g_main_context_dispatch () at /lib64/libglib-2.0.so.0
#23 0x00007f67f1c231d0 in g_main_context_iterate.isra () at /lib64/libglib-2.0.so.0
#24 0x00007f67f1c234f2 in g_main_loop_run () at /lib64/libglib-2.0.so.0
#25 0x00007f67f3bc4325 in gtk_main () at /lib64/libgtk-3.so.0
#26 0x00005618cfe959ef in main (argc=2, argv=0x7ffff2923ff8) at main.c:6027</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9273205</commentid>
    <comment_count>1</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2016-04-27 09:12:24 -0400</bug_when>
    <thetext>I will check with upstream git, and if it is still reproducible I will report this upstream.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9273210</commentid>
    <comment_count>2</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2016-04-27 09:14:21 -0400</bug_when>
    <thetext>The core is generated by emerald process:
Core was generated by `emerald --replace&apos;.
Program terminated with signal SIGABRT, Aborted.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9273219</commentid>
    <comment_count>3</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2016-04-27 09:16:09 -0400</bug_when>
    <thetext>(In reply to Jaroslav Škarvada from comment #0)
&gt; Version-Release number of selected component (if applicable):
&gt; emerald-0.8.8-14.fc23 

I meant emerald-0.8.12.4-1.fc23.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9273908</commentid>
    <comment_count>4</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2016-04-27 12:42:03 -0400</bug_when>
    <thetext>Cairo upstream bug:
https://bugs.freedesktop.org/show_bug.cgi?id=91967

Thanks to raveit65 and XRevan86 for investigation.

The proposed patch resolved the problem for me:
https://bugs.freedesktop.org/attachment.cgi?id=118325</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9430667</commentid>
    <comment_count>6</comment_count>
    <who name="Wolfgang Ulbrich">fedora</who>
    <bug_when>2016-06-19 06:08:05 -0400</bug_when>
    <thetext>Cairo upstream have applied the fix.
https://cgit.freedesktop.org/cairo/commit/?id=d69dd6b341594c338fa6c7b327fd7f201eb37bc1

Dear maintainer, can you please rebuild cairo with that fix for all branches?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9544170</commentid>
    <comment_count>7</comment_count>
    <who name="Wolfgang Ulbrich">fedora</who>
    <bug_when>2016-07-24 10:20:02 -0400</bug_when>
    <thetext>Any news?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9545277</commentid>
    <comment_count>8</comment_count>
    <who name="Kalev Lember">klember</who>
    <bug_when>2016-07-25 03:39:10 -0400</bug_when>
    <thetext>Thanks, I&apos;ve backported the patch as http://pkgs.fedoraproject.org/cgit/rpms/cairo.git/commit/?id=fd73152fd62eb9a58716ff2a7151354226305e09</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9545284</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-25 03:39:59 -0400</bug_when>
    <thetext>cairo-1.14.6-2.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2016-680189b17c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549704</commentid>
    <comment_count>10</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 00:52:51 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9561751</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-07-28 02:01:26 -0400</bug_when>
    <thetext>cairo-1.14.6-2.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-680189b17c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9573757</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-08-01 12:24:57 -0400</bug_when>
    <thetext>cairo-1.14.6-2.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9592205</commentid>
    <comment_count>13</comment_count>
    <who name="Wolfgang Ulbrich">fedora</who>
    <bug_when>2016-08-08 03:59:09 -0400</bug_when>
    <thetext>*** Bug 1364824 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9592209</commentid>
    <comment_count>14</comment_count>
    <who name="Wolfgang Ulbrich">fedora</who>
    <bug_when>2016-08-08 04:00:20 -0400</bug_when>
    <thetext>This fix needs to be applied to f23 too.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
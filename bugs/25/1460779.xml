<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1460779</bug_id>
          
          <creation_ts>2017-06-12 13:15:00 -0400</creation_ts>
          <short_desc>adding /dev/net/tun to a container with --cap-add=NET_ADMIN fails</short_desc>
          <delta_ts>2017-06-22 21:56:41 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>container-selinux</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brian (bex) Exelbierd">bexelbie</reporter>
          <assigned_to name="Lokesh Mandvekar">lsm5</assigned_to>
          <cc>amurdaca</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>fkluknav</cc>
    
    
    <cc>jchaloup</cc>
    
    
    <cc>jlebon</cc>
    
    
    <cc>lsm5</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>container-selinux-2.19-1.fc26 container-selinux-2.19-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-22 09:35:22</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10498706</commentid>
    <comment_count>0</comment_count>
    <who name="Brian (bex) Exelbierd">bexelbie</who>
    <bug_when>2017-06-12 13:15:28 -0400</bug_when>
    <thetext>Description of problem:

Adding /dev/net/tun to a container and giving the privilege NET_ADMIN should allow the device to be used.  It doesn&apos;t.

Version-Release number of selected component (if applicable):

Fedora 25 Container

How reproducible:

always

Steps to Reproduce and failed results:
1. docker run z --device /dev/net/tun -p 1194:1194/udp --cap-add=NET_ADMIN -it -v ... bex-openvpn bash
2. (in the container) # openvpn config file
...
Mon Jun 12 17:08:57 2017 ERROR: Cannot ioctl TUNSETIFF tun: Permission denied (errno=13)
Mon Jun 12 17:08:57 2017 Exiting due to fatal error

3. in the base system&apos;s journal
setroubleshoot[1009]: SELinux is preventing openvpn from create access on the tun_socket Unknown. For complete SELinux messages. run sealert -l b8b2caa6-3f51-4f03-8b18-748f3b073ba3
python3[1009]: SELinux is preventing openvpn from create access on the tun_socket Unknown.
                                                          
                                                          *****  Plugin catchall (100. confidence) suggests   **************************
                                                          
                                                          If you believe that openvpn should be allowed create access on the Unknown tun_socket by default.
                                                          Then you should report this as a bug.
                                                          You can generate a local policy module to allow this access.
                                                          Do
                                                          allow this access for now by executing:
                                                          # ausearch -c &apos;openvpn&apos; --raw | audit2allow -M my-openvpn
                                                          # semodule -X 300 -i my-openvpn.pp

# sealert -l b8b2caa6-3f51-4f03-8b18-748f3b073ba3
SELinux is preventing openvpn from create access on the tun_socket Unknown.

*****  Plugin catchall (100. confidence) suggests   **************************

If you believe that openvpn should be allowed create access on the Unknown tun_socket by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# ausearch -c &apos;openvpn&apos; --raw | audit2allow -M my-openvpn
# semodule -X 300 -i my-openvpn.pp


Additional Information:
Source Context                system_u:system_r:container_t:s0:c77,c594
Target Context                system_u:system_r:container_t:s0:c77,c594
Target Objects                Unknown [ tun_socket ]
Source                        openvpn
Source Path                   openvpn
Port                          &lt;Unknown&gt;
Host                          localhost.localdomain
Source RPM Packages           
Target RPM Packages           
Policy RPM                    selinux-policy-3.13.1-225.11.fc25.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Enforcing
Host Name                     dhcp129-113.brq.redhat.com
Platform                      Linux dhcp129-113.brq.redhat.com
                              4.10.10-200.fc25.x86_64 #1 SMP Thu Apr 13 01:11:51
                              UTC 2017 x86_64 x86_64
Alert Count                   1
First Seen                    2017-06-12 18:03:24 CEST
Last Seen                     2017-06-12 18:03:24 CEST
Local ID                      b8b2caa6-3f51-4f03-8b18-748f3b073ba3

Raw Audit Messages
type=AVC msg=audit(1497283404.276:5236): avc:  denied  { create } for  pid=928 comm=&quot;openvpn&quot; scontext=system_u:system_r:container_t:s0:c77,c594 tcontext=system_u:system_r:container_t:s0:c77,c594 tclass=tun_socket permissive=0


Hash: openvpn,container_t,container_t,tun_socket,create



Expected results:

openvpn starts</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10498835</commentid>
    <comment_count>1</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-12 14:16:03 -0400</bug_when>
    <thetext>Fixed in container-selinux-2.19</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10498871</commentid>
    <comment_count>2</comment_count>
    <who name="Brian (bex) Exelbierd">bexelbie</who>
    <bug_when>2017-06-12 14:46:47 -0400</bug_when>
    <thetext>Could this get built for F25 as we don&apos;t seem to have later fedora images in docker hub?  This would allow me to test it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10498999</commentid>
    <comment_count>3</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-12 15:45:21 -0400</bug_when>
    <thetext>Building it now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10499000</commentid>
    <comment_count>4</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-12 15:45:40 -0400</bug_when>
    <thetext> https://koji.fedoraproject.org/koji/taskinfo?taskID=20001990</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10500016</commentid>
    <comment_count>5</comment_count>
    <who name="Brian (bex) Exelbierd">bexelbie</who>
    <bug_when>2017-06-13 03:11:28 -0400</bug_when>
    <thetext>I have not been able to verify this works.  I tested it by building a container that specifically dnf installed the rpm from the koji build above.

Using just --cap-add=NET_ADMIN still gets me the same error.

Is this the wrong way to test this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10501602</commentid>
    <comment_count>6</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-13 10:30:56 -0400</bug_when>
    <thetext>The RPM needs to be installed on the host, not in the container.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10501614</commentid>
    <comment_count>7</comment_count>
    <who name="Brian (bex) Exelbierd">bexelbie</who>
    <bug_when>2017-06-13 10:34:08 -0400</bug_when>
    <thetext>(In reply to Daniel Walsh from comment #6)
&gt; The RPM needs to be installed on the host, not in the container.

HAHAHA.

Well know that that is sorted out it works for me.  Let me know if it hits bodhi so I can add some karma.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10502814</commentid>
    <comment_count>8</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-13 17:17:49 -0400</bug_when>
    <thetext>I have released a new version for Fedora 26, but want to wait til tomorrow for F25, since there is a previous version of container-selinux out that needs one more karma or day so that I can push it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10504848</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-14 07:48:14 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-ddc47a53ee</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10504849</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-14 07:48:21 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-607d2c542d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505311</commentid>
    <comment_count>11</comment_count>
    <who name="Daniel Walsh">dwalsh</who>
    <bug_when>2017-06-14 09:30:32 -0400</bug_when>
    <thetext>Brian, you can test and update karma now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10505473</commentid>
    <comment_count>12</comment_count>
    <who name="Brian (bex) Exelbierd">bexelbie</who>
    <bug_when>2017-06-14 10:11:32 -0400</bug_when>
    <thetext>(In reply to Daniel Walsh from comment #11)
&gt; Brian, you can test and update karma now.

karma&apos;ed

Thank you again for the speedy fix on this!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10508994</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 06:58:19 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-ddc47a53ee</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10509813</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 09:59:57 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-607d2c542d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10531737</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-22 09:35:22 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10533418</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-22 21:56:41 -0400</bug_when>
    <thetext>container-selinux-2.19-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
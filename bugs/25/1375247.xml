<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1375247</bug_id>
          
          <creation_ts>2016-09-12 10:25:00 -0400</creation_ts>
          <short_desc>gdm should fallback to Xorg on laptops with 2 gpu-s</short_desc>
          <delta_ts>2016-11-24 08:44:15 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>mutter</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans de Goede">hdegoede</reporter>
          <assigned_to name="Florian MÃ¼llner">fmuellner</assigned_to>
          <cc>fmuellner</cc>
    
    
    <cc>nobodyless</cc>
    
    
    <cc>otaylor</cc>
    
    
    <cc>rstrode</cc>
    
    
    <cc>thetaeridanus</cc>
    
    
    <cc>walters</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>mutter-3.22.1-4.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-22 00:00:50</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9699346</commentid>
    <comment_count>0</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-09-12 10:25:24 -0400</bug_when>
    <thetext>Hi,

Since wayland does not yet support prime and esp. not slave outputs, gdm really should fallback to Xorg if there are 2 /dev/dri/card# devices. Otherwise external connectors on laptops which are only connected to the discrete gpu will not be usable (without manually switching to a gnome on xorg session).

I guess this has been a problem wrt the login screen not showing on such external displays for a while now, but although for the login screen this typically is not a big problem, this is a problem with the actual gnome-session, think e.g. not being able to use a projector on conferences because of this.

Regards,

Hans</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9708150</commentid>
    <comment_count>1</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-09-14 13:13:33 -0400</bug_when>
    <thetext>Filed upstream as:
https://bugzilla.gnome.org/show_bug.cgi?id=771442

Lets track this there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9805911</commentid>
    <comment_count>2</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-10-19 15:50:15 -0400</bug_when>
    <thetext>let&apos;s use this bug to track the bodhi update</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9809695</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-20 18:56:47 -0400</bug_when>
    <thetext>mutter-3.22.1-4.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-018689d0e7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9812765</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-22 00:00:50 -0400</bug_when>
    <thetext>mutter-3.22.1-4.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9812967</commentid>
    <comment_count>5</comment_count>
    <who name="Bill">thetaeridanus</who>
    <bug_when>2016-10-22 06:33:47 -0400</bug_when>
    <thetext>Well it&apos;s a problem for me as I can no longer run gnome on wayland session on my Dell Latitude E6540 (intel + AMD hybrid graphics).
 
Whereas it was working fine before this update, even with an external monitor plugged in.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9815322</commentid>
    <comment_count>6</comment_count>
    <who name="Ray Strode [halfline]">rstrode</who>
    <bug_when>2016-10-24 09:52:53 -0400</bug_when>
    <thetext>I&apos;m sorry that things stopped working for you.  This suggests that there are some connectors on your laptop that are only hooked up to the AMD card.

Can you post the output of

ls /sys/class/drm/*

?

As a near term workaround, you can put MUTTER_ALLOW_HYBRID_GPUS=1 in /etc/environment and it should revert to the old behavior.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9815344</commentid>
    <comment_count>7</comment_count>
    <who name="Hans de Goede">hdegoede</who>
    <bug_when>2016-10-24 10:03:35 -0400</bug_when>
    <thetext>(In reply to Ray Strode [halfline] from comment #6)
&gt; I&apos;m sorry that things stopped working for you.  This suggests that there are
&gt; some connectors on your laptop that are only hooked up to the AMD card.

Or they are connected via a mux, so both GPUs will appear to have connectors at the drm driver level, but only outputs connected to the primary GPU (the one selected in the BIOS as default) are routed to the outside.

I&apos;m afraid that there is no way to detect this, the mux routing (if there is a mux) cannot be determined via any known means. So people with a mux will typically see a ton of connectors in xrandr and only be able
to plug cables into some of them.

I do believe that falling back to Xorg by default is the right thing to do here, since we simply do not know if there are external connectors routed only to the secondary GPU and we don&apos;t want people to end up being unable to plug a projector into their laptop.

One good thing here is that (judging from my limited sample set) more and more laptops seem to forgo the mux and there the dgpu does typically report 0 outputs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9816862</commentid>
    <comment_count>8</comment_count>
    <who name="Bill">thetaeridanus</who>
    <bug_when>2016-10-24 14:59:47 -0400</bug_when>
    <thetext>FYI - here is the output of ls /sys/class/drm/*


/sys/class/drm/version

/sys/class/drm/card0:
card0-VGA-2  dev  device  power  subsystem  uevent

/sys/class/drm/card0-VGA-2:
device  dpms  edid  enabled  modes  power  status  subsystem  uevent

/sys/class/drm/card1:
card1-DP-1      card1-HDMI-A-3  gt_act_freq_mhz  gt_RP1_freq_mhz  uevent
card1-DP-2      card1-VGA-1     gt_cur_freq_mhz  gt_RPn_freq_mhz
card1-eDP-1     dev             gt_max_freq_mhz  l3_parity
card1-HDMI-A-1  device          gt_min_freq_mhz  power
card1-HDMI-A-2  error           gt_RP0_freq_mhz  subsystem

/sys/class/drm/card1-DP-1:
device  drm_dp_aux1  enabled  modes  status     uevent
dpms    edid         i2c-15   power  subsystem

/sys/class/drm/card1-DP-2:
device  drm_dp_aux2  enabled  modes  status     uevent
dpms    edid         i2c-16   power  subsystem

/sys/class/drm/card1-eDP-1:
device  drm_dp_aux0  enabled  intel_backlight  power   subsystem
dpms    edid         i2c-14   modes            status  uevent

/sys/class/drm/card1-HDMI-A-1:
device  dpms  edid  enabled  modes  power  status  subsystem  uevent

/sys/class/drm/card1-HDMI-A-2:
device  dpms  edid  enabled  modes  power  status  subsystem  uevent

/sys/class/drm/card1-HDMI-A-3:
device  dpms  edid  enabled  modes  power  status  subsystem  uevent

/sys/class/drm/card1-VGA-1:
device  dpms  edid  enabled  modes  power  status  subsystem  uevent

/sys/class/drm/controlD64:
dev  device  power  subsystem  uevent

/sys/class/drm/controlD65:
dev  device  power  subsystem  uevent

/sys/class/drm/renderD128:
dev  device  power  subsystem  uevent

/sys/class/drm/renderD129:
dev  device  power  subsystem  uevent

/sys/class/drm/ttm:
buffer_objects  memory_accounting  power  subsystem  uevent</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
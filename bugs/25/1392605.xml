<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1392605</bug_id>
          
          <creation_ts>2016-11-07 16:33:00 -0500</creation_ts>
          <short_desc>Most Qt5 applications crash when opening any file dialog under GNOME wayland session</short_desc>
          <delta_ts>2017-04-04 11:19:16 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>gtk3</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>https://fedoraproject.org/wiki/Common_F25_bugs#wayland-qt5-dialog-crash</status_whiteboard>
          <keywords>CommonBugs</keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1277927</blocked>
    
    
    <blocked>1392597</blocked>
    
    
    <blocked>1392601</blocked>
    
    
    <blocked>1392604</blocked>
    
    
    <blocked>1405117</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Stadelmann">rhbz2</reporter>
          <assigned_to name="Matthias Clasen">mclasen</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>cosimo.cecchi</cc>
    
    
    <cc>emmanuel.touzery</cc>
    
    
    <cc>kamikazow</cc>
    
    
    <cc>kparal</cc>
    
    
    <cc>laurent.rineau__fedora</cc>
    
    
    <cc>mclasen</cc>
    
    
    <cc>okrh</cc>
    
    
    <cc>rdieter</cc>
    
    
    <cc>redhat</cc>
    
    
    <cc>robatino</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>qt5-qtbase-5.7.1-10.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-09 11:43:11</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9868991</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-11-07 16:33:15 -0500</bug_when>
    <thetext>Description of problem:
It seems like most Qt5 applications crash whenever they should display a file chooser in a GNOME wayland session.

Version-Release number of selected component (if applicable):
gtk3-3.22.2-1.fc25.x86_64
glib2-2.50.1-1.fc25.x86_64
libwayland-client-1.12.0-1.fc25.x86_64
qt5-qtbase-5.7.0-3.fc25.x86_64

How reproducible:
always under a GNOME wayland session

Steps to Reproduce:
1. Open Qt5 application
2. open any file dialog
3. watch what happens

Actual results:
Application crashes right after logging this warning message:

Gdk-WARNING **: gdkwindow-x11.c:5554 drawable is not a native X11 window

Expected results:
No crash.

Additional info:
This bug affects:
TeXstudio (see bug #1392597)
KWrite (see bug #1392601)
Ark (see bug #1392604)
Konversation
Marble
KAlgebra

This bug does not affect:
Okular (Qt4)
VLC (Qt5)

Workaround:
Start all affected applications with GDK_BACKEND=x11 environment variable.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9869097</commentid>
    <comment_count>1</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-11-07 16:55:43 -0500</bug_when>
    <thetext>Also affects:
Dolphin (in application chooser dialog for opening files with)
Calibre (see bug #1387928 and upstream https://bugreports.qt.io/browse/QTBUG-55583 )

I&apos;m not closing these bugs as duplicates because the stacktraces differ slightly.

Nominating as Blocker because this bug affects quite many applications and is quite serious.

If you don&apos;t think this is a blocker, please consider adding a freeze exception.

This issue not only happens on Fedora, but also on other distros:
https://bbs.archlinux.org/viewtopic.php?id=218831
https://github.com/fritzing/fritzing-app/issues/3264
https://sourceforge.net/p/gnuplot/mailman/gnuplot-beta/

A KDE upstream bug report:
https://bugs.kde.org/show_bug.cgi?id=369467

A similar issue was present in nautilus but got fixed:
https://bugzilla.gnome.org/show_bug.cgi?id=758026

Other possible duplicates:
https://bugzilla.redhat.com/show_bug.cgi?id=1383069</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9869221</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-11-07 17:50:54 -0500</bug_when>
    <thetext>Do we have any affected apps in a default Workstation install?

Anyone close to a fix for it?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9869235</commentid>
    <comment_count>3</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-11-07 17:59:55 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #2)
&gt; Do we have any affected apps in a default Workstation install?

I don&apos;t think so. Removing qt5-qtbase doesn&apos;t remove anything important and nothing I&apos;ve seen in Workstation composes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9871430</commentid>
    <comment_count>4</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-08 07:13:36 -0500</bug_when>
    <thetext>I can reproduce the crash with kwrite, as long as I don&apos;t have qgnomeplatform installed. If I have it installed, it seems to work OK. Christian, can you confirm?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9871460</commentid>
    <comment_count>5</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-08 07:17:02 -0500</bug_when>
    <thetext>qgnomeplatform seems to be a part of a default Workstation installation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9871639</commentid>
    <comment_count>6</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-11-08 07:42:05 -0500</bug_when>
    <thetext>(In reply to Kamil Páral from comment #4)
&gt; I can reproduce the crash with kwrite, as long as I don&apos;t have
&gt; qgnomeplatform installed. If I have it installed, it seems to work OK.
&gt; Christian, can you confirm?

I can confirm that. Since qgnomeplatform is in Fedora Workstation, I&apos;m removing the blocker proposal for this bug. Sorry for the noise. I don&apos;t know why this package is not installed on my machine, but after installing qgnomeplatform, the issue is gone for me.

Anyway, Qt5 or Gtk3 (whoever is to blame) should bail out more gracefully instead of running into a SIGSEGV.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9871836</commentid>
    <comment_count>7</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-08 08:37:25 -0500</bug_when>
    <thetext>It is possible that qgnomeplatform is not installed on system upgrades.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9872317</commentid>
    <comment_count>8</comment_count>
    <who name="Matthias Clasen">mclasen</who>
    <bug_when>2016-11-08 10:14:43 -0500</bug_when>
    <thetext>If qt applications crash, why is this bug filed against gtk3 ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9872791</commentid>
    <comment_count>9</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-11-08 12:05:02 -0500</bug_when>
    <thetext>At a quick glance, it seems like qgnomeplatform has only been in comps since f24. If you installed before f24 and upgraded, and nothing you have installed has an explicit qgnomeplatform dep, and you didn&apos;t do a &apos;dnf groupinstall workstation-product&apos; or similar after upgrading, that could explain it not being present. Perhaps we should document that. I don&apos;t know if dnf-system-upgrade or the Software graphical upgrade &apos;refresh&apos; group packages on upgrade or not.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9872915</commentid>
    <comment_count>10</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2016-11-08 12:29:24 -0500</bug_when>
    <thetext>(In reply to Matthias Clasen from comment #8)
&gt; If qt applications crash, why is this bug filed against gtk3 ?

Because it only happens with the Gtk3 filechooser and can be worked around by using GDK_BACKEND=x11. And from the backtrace it also looks more like Gtk/GLib than Qt. You probably know better so feel free to reassign.

(In reply to Adam Williamson from comment #9)
&gt; At a quick glance, it seems like qgnomeplatform has only been in comps since
&gt; f24. If you installed before f24 and upgraded, and nothing you have
&gt; installed has an explicit qgnomeplatform dep, and you didn&apos;t do a &apos;dnf
&gt; groupinstall workstation-product&apos; or similar after upgrading, that could
&gt; explain it not being present. Perhaps we should document that. I don&apos;t know
&gt; if dnf-system-upgrade or the Software graphical upgrade &apos;refresh&apos; group
&gt; packages on upgrade or not.

That&apos;s the case for me. Installed with F23, then upgraded F23→F24 and F24→F25 with dnf system-upgrade.
How about adding a section to https://fedoraproject.org/wiki/Common_F25_bugs ?
How about adding a weak (&quot;Recommends:&quot;) dependency to adwaita-qt5 or some similiar package as a workaround?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9873049</commentid>
    <comment_count>11</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-11-08 12:56:17 -0500</bug_when>
    <thetext>&quot;How about adding a section to https://fedoraproject.org/wiki/Common_F25_bugs ?&quot;

That&apos;s why we set the CommonBugs keyword. :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932398</commentid>
    <comment_count>12</comment_count>
    <who name="John Freed">okrh</who>
    <bug_when>2016-11-27 13:17:59 -0500</bug_when>
    <thetext>*** Bug 1398970 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932403</commentid>
    <comment_count>13</comment_count>
    <who name="John Freed">okrh</who>
    <bug_when>2016-11-27 13:37:22 -0500</bug_when>
    <thetext>Comment #7 and Comment #9 are correct. Suggest you include qgnomeplatform in the default upgrade. I can confirm that this solved the problem:

sudo dnf install qgnomeplatform

Also noticed that when I do:

dnf group list

&quot;Fedora Workstation&quot; is listed in the &quot;Available environment groups&quot; and not &quot;Installed groups&quot;. Solved that with:
sudo dnf group install &quot;Fedora Workstation&quot; --best --allowerasing

Again, should this not be included by default on a Fedora Workstation upgrade?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10002763</commentid>
    <comment_count>14</comment_count>
    <who name="Markus S.">kamikazow</who>
    <bug_when>2016-12-20 08:24:29 -0500</bug_when>
    <thetext>(In reply to Adam Williamson from comment #9)
&gt; At a quick glance, it seems like qgnomeplatform has only been in comps since
&gt; f24. If you installed before f24 and upgraded, and nothing you have
&gt; installed has an explicit qgnomeplatform dep, and you didn&apos;t do a &apos;dnf
&gt; groupinstall workstation-product&apos; or similar after upgrading, that could
&gt; explain it not being present.

Sounds like qgnomeplatform should be a dependency of gnome-session-wayland-session until that bug is resolved.

I didn&apos;t have qgnomeplatform installed either and suffered from that bug until I found this report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10043357</commentid>
    <comment_count>15</comment_count>
    <who name="Emmanuel Touzery">emmanuel.touzery</who>
    <bug_when>2017-01-08 14:35:18 -0500</bug_when>
    <thetext>*** Bug 1399045 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10043478</commentid>
    <comment_count>16</comment_count>
    <who name="Rex Dieter">rdieter</who>
    <bug_when>2017-01-08 16:40:51 -0500</bug_when>
    <thetext>Is this still reproducible with
qt5-qtbase-5.7.1-10.fc25
from
https://bodhi.fedoraproject.org/updates/FEDORA-2017-e2f57cb7cd
?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10043550</commentid>
    <comment_count>17</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-01-08 18:19:40 -0500</bug_when>
    <thetext>After uninstalling qgnomeplatform and upgrading to qt5-qtbase-5.7.1-10.fc25, this issue is gone.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10043567</commentid>
    <comment_count>18</comment_count>
    <who name="Rex Dieter">rdieter</who>
    <bug_when>2017-01-08 18:42:21 -0500</bug_when>
    <thetext>and qt5-qtbase-5.7.1-10.fc25 *with* qgnomeplatform?  (still crashes?)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10044589</commentid>
    <comment_count>19</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-01-09 04:56:53 -0500</bug_when>
    <thetext>(In reply to Rex Dieter from comment #18)
&gt; and qt5-qtbase-5.7.1-10.fc25 *with* qgnomeplatform?  (still crashes?)

No, with qgnomeplatform it did not crash. Installing qgnomeplatform was the workaround described in comment #4 … comment #7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10045827</commentid>
    <comment_count>20</comment_count>
    <who name="Rex Dieter">rdieter</who>
    <bug_when>2017-01-09 10:23:53 -0500</bug_when>
    <thetext>OK, so issue is resolved?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10046032</commentid>
    <comment_count>21</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-01-09 11:09:26 -0500</bug_when>
    <thetext>(In reply to Rex Dieter from comment #20)
&gt; OK, so issue is resolved?

As far as I can tell, yes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10046164</commentid>
    <comment_count>22</comment_count>
    <who name="Rex Dieter">rdieter</who>
    <bug_when>2017-01-09 11:43:11 -0500</bug_when>
    <thetext>Thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10302858</commentid>
    <comment_count>23</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-04-04 10:45:41 -0400</bug_when>
    <thetext>*** Bug 1392601 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10302860</commentid>
    <comment_count>24</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-04-04 10:45:42 -0400</bug_when>
    <thetext>*** Bug 1392597 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10302863</commentid>
    <comment_count>25</comment_count>
    <who name="Christian Stadelmann">rhbz2</who>
    <bug_when>2017-04-04 10:46:05 -0400</bug_when>
    <thetext>*** Bug 1392604 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10303010</commentid>
    <comment_count>26</comment_count>
    <who name="NMueller">redhat</who>
    <bug_when>2017-04-04 11:19:16 -0400</bug_when>
    <thetext>*** Bug 1405117 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
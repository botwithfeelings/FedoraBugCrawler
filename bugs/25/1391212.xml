<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1391212</bug_id>
          
          <creation_ts>2016-11-02 15:28:00 -0400</creation_ts>
          <short_desc>Service fails if no switchable graphics present</short_desc>
          <delta_ts>2016-11-11 01:18:43 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>switcheroo-control</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1389762</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>AcceptedFreezeException</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>high</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1277290</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Williamson">awilliam</reporter>
          <assigned_to name="Kalev Lember">klember</assigned_to>
          <cc>bnocera</cc>
    
    
    <cc>gmarr</cc>
    
    
    <cc>klember</cc>
    
    
    <cc>kwizart</cc>
    
    
    <cc>rc040203</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>switcheroo-control-1.1-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-10 11:38:24</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9849232</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-11-02 15:28:18 -0400</bug_when>
    <thetext>switcheroo-control is written to exit 1 if no switchable graphics hardware is present:

	/* Check for VGA switcheroo availability */
	fd = open (SWITCHEROO_SYSFS_PATH, O_WRONLY);
	if (fd &lt; 0) {
		int err = errno;

		switch (err) {
		case EACCES:
			g_warning (&quot;switcheroo-control needs to run as root&quot;);
			break;
		case ENOENT:
			g_debug (&quot;No switcheroo support available&quot;);
			break;
		default:
			g_warning (&quot;switcheroo-control could not query vga_switcheroo status: %s&quot;,
				   g_strerror (err));
		}
		return 1;
}

This means the switcheroo-control service will very commonly fail on boot. This is bad, we don&apos;t want failed services, they cause users to worry (and we have an openQA test that checks for them which will fail forever if this is not fixed). This should be tweaked somehow so the service isn&apos;t considered &apos;failed&apos; when no switchable graphics are present.

Nominating as a freeze exception as I believe this is worth fixing for F25 Final and we&apos;re in freeze. There are several ways to fix this that shouldn&apos;t be too dangerous.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9849662</commentid>
    <comment_count>1</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-11-02 18:56:03 -0400</bug_when>
    <thetext>Whoever patches this should get rid of the useless &apos;err&apos; variable...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9850273</commentid>
    <comment_count>2</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-11-03 03:28:20 -0400</bug_when>
    <thetext>(In reply to Zbigniew Jędrzejewski-Szmek from comment #1)
&gt; Whoever patches this should get rid of the useless &apos;err&apos; variable...

It wouldn&apos;t be useless if errno wasn&apos;t thread-specific. Which it is. Bad habit.

Please file upstream bugs in the future.

Fixed both upstream.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9851277</commentid>
    <comment_count>3</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-11-03 08:08:59 -0400</bug_when>
    <thetext>(In reply to Bastien Nocera from comment #2)
&gt; (In reply to Zbigniew Jędrzejewski-Szmek from comment #1)
&gt; &gt; Whoever patches this should get rid of the useless &apos;err&apos; variable...
&gt; 
&gt; It wouldn&apos;t be useless if errno wasn&apos;t thread-specific. Which it is. Bad
&gt; habit.
&gt; 
&gt; Please file upstream bugs in the future.
&gt; 
&gt; Fixed both upstream.

Can you please link to the fixes here and update this ticket with the Koji build that resolves it?

We need to have a downstream ticket here because we&apos;re in Final Freeze and would need a Freeze Exception or Blocker status in order to pull this in.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9851279</commentid>
    <comment_count>4</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-11-03 08:09:13 -0400</bug_when>
    <thetext>Oh, and +1 FE from me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9862244</commentid>
    <comment_count>5</comment_count>
    <who name="Bastien Nocera">bnocera</who>
    <bug_when>2016-11-04 10:51:14 -0400</bug_when>
    <thetext>It will need release notes changes too. Where would I do that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9862773</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-04 13:13:06 -0400</bug_when>
    <thetext>switcheroo-control-1.1-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-3d2ba1299d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9864226</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-05 15:00:57 -0400</bug_when>
    <thetext>switcheroo-control-1.1-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-3d2ba1299d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9869506</commentid>
    <comment_count>8</comment_count>
    <who name="Geoffrey Marr">gmarr</who>
    <bug_when>2016-11-07 20:04:37 -0500</bug_when>
    <thetext>Discussed during the 2016-11-07 blocker review meeting: [1]

The decision was made to classify this bug as an AcceptedFreezeException.

[1] https://meetbot.fedoraproject.org/fedora-blocker-review/2016-11-07/f25-blocker-review.2016-11-07-17.01.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9880583</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-10 11:38:24 -0500</bug_when>
    <thetext>switcheroo-control-1.1-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9882239</commentid>
    <comment_count>10</comment_count>
    <who name="Ralf Corsepius">rc040203</who>
    <bug_when>2016-11-11 01:18:43 -0500</bug_when>
    <thetext>*** Bug 1393759 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
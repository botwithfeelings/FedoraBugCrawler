<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1464709</bug_id>
          
          <creation_ts>2017-06-24 20:04:00 -0400</creation_ts>
          <short_desc>8250_pci driver is no longer built-in in 4.11.x causing serial console not to be activated</short_desc>
          <delta_ts>2017-07-07 18:59:59 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>kernel</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1464741</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</reporter>
          <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
          <cc>bigkrp</cc>
    
    
    <cc>gansalmon</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>labbott</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>mchehab</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>kernel-4.11.7-300.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-07-07 18:59:59</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10537639</commentid>
    <comment_count>0</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-24 20:04:47 -0400</bug_when>
    <thetext>Description of problem:
The 8250_pci driver was changed from built-in to module in 4.11.x series. This causes serial console not work for serial ports driven by this driver unless
dracut --force-drivers 8250_pci
is used to build initramfs image.

In particular, the serial port is activated after rootfs is mounted, which makes the kernel display the LUKS password prompt and wait for password input on tty0 only. Another side effect is that no kernel output goes to the serial console and systemd doesn&apos;t activate a getty there, either.

Please revert this change or fix dracut to add this module automatically to initramfs.

Version-Release number of selected component (if applicable):
4.11.6-201.fc25.x86_64

How reproducible:
Always

Steps to Reproduce:
1. Install any serial port card supported by the 8250_pci driver, e.g. http://www.i-tec.cz/index.php?t=3&amp;v=103 which is identified as &quot;MosChip Semiconductor Technology Ltd. PCIe 9912 Multi-I/O Controller&quot;
2. Edit the following lines in /etc/default/grub&quot;
GRUB_TERMINAL_INPUT=&quot;console serial&quot;
GRUB_TERMINAL_OUTPUT=&quot;console serial&quot;
GRUB_SERIAL_COMMAND=&quot;serial --speed=115200 --unit=4 --word=8 --parity=no --stop=1&quot;
GRUB_CMDLINE_LINUX_DEFAULT=&quot;LANG=en_GB.UTF=8 console=tty0 console=ttyS4,115200n8&quot;

3. Install any 4.11.x kernel.
4. Boot the newly installed kernel

Actual results:
No output on ttyS4 serial console.

Expected results:
LUKS password prompt is displayed on ttyS4 and password input is accepted there.

Additional info:
This was changed after 4.10.17:
diff -u /boot/config-4.10.17-200.fc25.x86_64 /boot/config-4.11.6-201.fc25.x86_64
[...]
@@ -3511,7 +3546,8 @@
 # CONFIG_SERIAL_8250_FINTEK is not set
 CONFIG_SERIAL_8250_CONSOLE=y
 CONFIG_SERIAL_8250_DMA=y
-CONFIG_SERIAL_8250_PCI=y
+CONFIG_SERIAL_8250_PCI=m
+CONFIG_SERIAL_8250_EXAR=m
 CONFIG_SERIAL_8250_CS=m
 CONFIG_SERIAL_8250_NR_UARTS=32
 CONFIG_SERIAL_8250_RUNTIME_UARTS=32
@@ -3523,7 +3559,7 @@
 # CONFIG_SERIAL_8250_FSL is not set
 CONFIG_SERIAL_8250_DW=y
 CONFIG_SERIAL_8250_RT288X=y
-CONFIG_SERIAL_8250_LPSS=y
+CONFIG_SERIAL_8250_LPSS=m
 CONFIG_SERIAL_8250_MID=y
 CONFIG_SERIAL_8250_MOXA=m
 
[...]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10537905</commentid>
    <comment_count>1</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-25 05:58:43 -0400</bug_when>
    <thetext>f26 and rawhide appear to suffer from the same issue, as they both have CONFIG_SERIAL_8250_PCI=m in kernel-x86_64.config.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10540633</commentid>
    <comment_count>2</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-06-26 10:30:56 -0400</bug_when>
    <thetext>There was a change in 4.11 to let the SERIAL_8250 options be modular but I guess that doesn&apos;t work for Fedora. I changed it back to being built in.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10541862</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-26 17:50:33 -0400</bug_when>
    <thetext>kernel-4.11.7-300.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-44d91780a0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10541863</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-26 17:51:48 -0400</bug_when>
    <thetext>kernel-4.11.7-200.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-65f852596f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10541866</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-26 17:52:51 -0400</bug_when>
    <thetext>kernel-4.11.7-100.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-bbfb70fc1d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10543539</commentid>
    <comment_count>6</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-27 06:13:49 -0400</bug_when>
    <thetext>(In reply to Laura Abbott from comment #2)
&gt; There was a change in 4.11 to let the SERIAL_8250 options be modular but I
&gt; guess that doesn&apos;t work for Fedora. I changed it back to being built in.

Thank you. I guess it could work if dracut were able to add the required module to initramfs automatically. I opened a separate bug against dracut for that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545173</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 13:20:49 -0400</bug_when>
    <thetext>kernel-4.11.7-100.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-bbfb70fc1d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545192</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 13:25:52 -0400</bug_when>
    <thetext>kernel-4.11.7-200.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-65f852596f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10545653</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-27 16:25:22 -0400</bug_when>
    <thetext>kernel-4.11.7-300.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-44d91780a0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10552859</commentid>
    <comment_count>10</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-29 07:11:44 -0400</bug_when>
    <thetext>(In reply to Laura Abbott from comment #2)
&gt; There was a change in 4.11 to let the SERIAL_8250 options be modular but I
&gt; guess that doesn&apos;t work for Fedora. I changed it back to being built in.

FYI, this was apparently fixed in dracut shortly after I opened a ticket upstream (https://github.com/dracutdevs/dracut/issues/248), so if you&apos;d like to modularize these again, you can do so after the fix trickles down to Fedora. I haven&apos;t verified the fix yet, though.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10555264</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-29 20:49:45 -0400</bug_when>
    <thetext>kernel-4.11.7-200.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10557482</commentid>
    <comment_count>12</comment_count>
    <who name="krp">bigkrp</who>
    <bug_when>2017-06-30 10:46:41 -0400</bug_when>
    <thetext>I have updated to kernel-4.11.7-200.fc25, but i have still black display on boot instead suggestions to decode image</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10557511</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-30 10:53:50 -0400</bug_when>
    <thetext>kernel-4.11.8-100.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-4880e0f183</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10559311</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-01 23:23:01 -0400</bug_when>
    <thetext>kernel-4.11.8-100.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-4880e0f183</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10562860</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-03 20:21:02 -0400</bug_when>
    <thetext>kernel-4.11.8-100.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10575991</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-07-07 18:59:59 -0400</bug_when>
    <thetext>kernel-4.11.7-300.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
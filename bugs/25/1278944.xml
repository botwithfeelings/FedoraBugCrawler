<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1278944</bug_id>
          
          <creation_ts>2015-11-06 14:43:00 -0500</creation_ts>
          <short_desc>udisksctl power-off not working with all disks</short_desc>
          <delta_ts>2017-05-24 22:48:23 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>kernel</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jean-Christophe Baptiste">jc</reporter>
          <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
          <cc>extras-orphan</cc>
    
    
    <cc>gansalmon</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jc</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>labbott</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>majzoube</cc>
    
    
    <cc>mchehab</cc>
    
    
    <cc>theholyettlz</cc>
    
    
    <cc>wbreyha</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-24 11:02:35</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>8799341</commentid>
    <comment_count>0</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2015-11-06 14:43:10 -0500</bug_when>
    <thetext>Description of problem:

When ejecting a drive, from the GUI (Gnome, XFCE, ...) or using udiskctl, I believe udev is responsible of spinning it down.

Some disks spins down but spins up again immediately, forcing the user to do a hot unplug.

How reproducible:

Steps to Reproduce:
1. Plug in an external USB disk
2. Then eject it or do type udisksctl power-off -b /dev/sdx

Actual results:

Some disk models would spin back up, while others will properly shutdown. 

Expected results:

All disks should spin down.

Additional info:

All my disks are USB 3.
I have 2 Toshiba external hard drive (500 Mo and 1 To) that do spin down correctly.
I have 1 Seagate Slim hard drive of 500 Mo that also shuts down correctly.

But, another Seagate Slim drive of 1To does spin back up.

Also, strangely, all of these disks do spin back up when they are plugged and ejected from behind an USB 3 hub.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8985713</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2016-01-17 02:22:02 -0500</bug_when>
    <thetext>A lot of reports on the Ubuntu side for a similar issue: https://bugs.launchpad.net/ubuntu/+source/nautilus/+bug/792085

The culprit has not been identified yet, apparently.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8999693</commentid>
    <comment_count>2</comment_count>
    <who name="Zbigniew Jędrzejewski-Szmek">zbyszek</who>
    <bug_when>2016-01-21 09:16:03 -0500</bug_when>
    <thetext>Based on the comments it appears to be drive/chipset specific and maybe some driver issue. Reassigning to the kernel.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9069509</commentid>
    <comment_count>3</comment_count>
    <who name="James">theholyettlz</who>
    <bug_when>2016-02-16 15:16:21 -0500</bug_when>
    <thetext>I find this on my enclosures with Asmedia and Norelsys bridges. The JMicron one seems to power down properly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9181536</commentid>
    <comment_count>4</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2016-03-28 04:15:43 -0400</bug_when>
    <thetext>James, how did you get this info? lsusb,lshw et hdparm do not seem to provide it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9543276</commentid>
    <comment_count>5</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2016-07-23 16:14:48 -0400</bug_when>
    <thetext>Version: 23 → 24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9543961</commentid>
    <comment_count>6</comment_count>
    <who name="James">theholyettlz</who>
    <bug_when>2016-07-24 06:03:17 -0400</bug_when>
    <thetext>(In reply to Jean-Christophe Baptiste from comment #4)
&gt; James, how did you get this info? lsusb,lshw et hdparm do not seem to
&gt; provide it.

Sorry for the very late reply. Sometimes the info identifying the bridge chip is in dmesg. Otherwise I look up the USB numeric IDs on Google. This is for generic enclosures only. In my experience, the bridge on the &apos;complete&apos; big-brand drives have their firmwares and device IDs modified for hide the chip&apos;s origin.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9597228</commentid>
    <comment_count>7</comment_count>
    <who name="Wolfgang Breyha">wbreyha</who>
    <bug_when>2016-08-09 05:24:31 -0400</bug_when>
    <thetext>I see this behaviour as well on fully patched Fedora 24 with
kernel-4.6.4-301.fc24.x86_64

I have a LaCie 9223 1TB with USB ID 059f:1070. According to a google search this device uses a ASMedia 1053. 
According to smartctl the HDD is a 
Device Model:     ST1000LM035-1RK172

If connected to USB 3 port on a 
Gigabyte B85M-HD3 with 
00:14.0 8086:8c31 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 04)
or a 
ASUS Z170-P D3 onboard USB port

the drive powers down using &quot;safely remove drive&quot;...
Aug  9 10:56:16 pcwb ntfs-3g[11727]: Unmounting /dev/sdb1 (LaCie-1TB)
Aug  9 10:56:16 pcwb udisksd[1491]: Unmounted /dev/sdb1 on behalf of uid 1000
Aug  9 10:56:16 pcwb udisksd[1491]: Successfully sent SCSI command SYNCHRONIZE CACHE to /dev/sdb
Aug  9 10:56:17 pcwb udisksd[1491]: Successfully sent SCSI command START STOP UNIT to /dev/sdb
Aug  9 10:56:17 pcwb systemd-udevd: inotify_add_watch(9, /dev/sdb1, 10) failed: No such file or directory
Aug  9 10:56:17 pcwb kernel: sd 6:0:0:0: [sdb] Synchronizing SCSI cache
Aug  9 10:56:17 pcwb kernel: sd 6:0:0:0: [sdb] Synchronize Cache(10) failed: Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK
Aug  9 10:56:17 pcwb udisksd[1491]: Powered off /dev/sdb - successfully wrote to sysfs path /sys/devices/pci0000:00/0000:00:14.0/usb4/4
-1/remove
Aug  9 10:56:17 pcwb kernel: usb 4-1: USB disconnect, device number 21

and immediately reappears...
Aug  9 10:56:17 pcwb kernel: usb 4-1: new SuperSpeed USB device number 22 using xhci_hcd
Aug  9 10:56:17 pcwb kernel: usb 4-1: New USB device found, idVendor=059f, idProduct=1070
Aug  9 10:56:17 pcwb kernel: usb 4-1: New USB device strings: Mfr=2, Product=3, SerialNumber=1
Aug  9 10:56:17 pcwb kernel: usb 4-1: Product: Porsche Mobile for Mac
Aug  9 10:56:17 pcwb kernel: usb 4-1: Manufacturer: LaCie</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9738800</commentid>
    <comment_count>8</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2016-09-23 15:13:37 -0400</bug_when>
    <thetext>*********** MASS BUG UPDATE **************
 
We apologize for the inconvenience.  There is a large number of bugs to go through and several of them have gone stale.  Due to this, we are doing a mass bug update across all of the Fedora 24 kernel bugs.
 
Fedora 24 has now been rebased to 4.7.4-200.fc24.  Please test this kernel update (or newer) and let us know if you issue has been resolved or if it is still present with the newer kernel.
 
If you have moved on to Fedora 25, and are still experiencing this issue, please change the version to Fedora 25.
 
If you experience different issues, please open a new bug report for those.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9762882</commentid>
    <comment_count>9</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2016-10-03 18:45:56 -0400</bug_when>
    <thetext>The bug is still here with latest kernel version.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9763786</commentid>
    <comment_count>10</comment_count>
    <who name="James">theholyettlz</who>
    <bug_when>2016-10-04 03:10:33 -0400</bug_when>
    <thetext>(In reply to Jean-Christophe Baptiste from comment #9)
&gt; The bug is still here with latest kernel version.

Confirmed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932343</commentid>
    <comment_count>11</comment_count>
    <who name="Jean-Christophe Baptiste">jc</who>
    <bug_when>2016-11-27 12:50:52 -0500</bug_when>
    <thetext>Still in Fedora 25.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10068761</commentid>
    <comment_count>12</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-01-16 20:21:08 -0500</bug_when>
    <thetext>*********** MASS BUG UPDATE **************
We apologize for the inconvenience.  There is a large number of bugs to go through and several of them have gone stale.  Due to this, we are doing a mass bug update across all of the Fedora 25 kernel bugs.
 
Fedora 25 has now been rebased to 4.9.3-200.fc25.  Please test this kernel update (or newer) and let us know if you issue has been resolved or if it is still present with the newer kernel.
 
If you have moved on to Fedora 26, and are still experiencing this issue, please change the version to Fedora 26.
 
If you experience different issues, please open a new bug report for those.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10089981</commentid>
    <comment_count>13</comment_count>
    <who name="Wolfgang Breyha">wbreyha</who>
    <bug_when>2017-01-23 15:17:00 -0500</bug_when>
    <thetext>Just tested it again with my
LaCie 9223 1TB with USB ID 059f:1070 on USB3 xhci ports of an ASUS Z-170 board and a HP EliteBook 820 G1.

It works now as expected on:
F24: 4.8.16-200.fc24.x86_64
F25: 4.9.3-200.fc25.x86_64

Drive shuts down and disconnects from USB port after selecting &quot;safely remove drive&quot; on MATE desktop and it does not spin up again.

I also tested an older LaCie USB 2.0 drive and it still works as well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10092543</commentid>
    <comment_count>14</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-01-24 11:02:35 -0500</bug_when>
    <thetext>Thank you for letting us know. I&apos;m going to close this bug. If the problem shows up again, please reopen.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10410587</commentid>
    <comment_count>15</comment_count>
    <who name="Eric M">majzoube</who>
    <bug_when>2017-05-14 14:43:18 -0400</bug_when>
    <thetext>Same issue on fedora 25 on XPS 15 9560. Running kernel 4.8.6-300.fc25.x86_64

Disk: seagate 1TEAPF-500 (4TB drive)

Other usb drives spin down as expected.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10446053</commentid>
    <comment_count>16</comment_count>
    <who name="Eric M">majzoube</who>
    <bug_when>2017-05-24 22:48:23 -0400</bug_when>
    <thetext>(In reply to Eric M from comment #15)
&gt; Same issue on fedora 25 on XPS 15 9560. Running kernel 4.8.6-300.fc25.x86_64
&gt; 
&gt; Disk: seagate 1TEAPF-500 (4TB drive)
&gt; 
&gt; Other usb drives spin down as expected.

kernel 4.10.x resolves the issue for me.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1393373</bug_id>
          
          <creation_ts>2016-11-09 07:22:00 -0500</creation_ts>
          <short_desc>selinux causes certain gnome-disks operations to be 25 seconds delayed</short_desc>
          <delta_ts>2016-11-15 08:33:23 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>selinux-policy</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>RejectedBlocker AcceptedFreezeException</status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>1277290</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Kamil Páral">kparal</reporter>
          <assigned_to name="Lukas Vrabec">lvrabec</assigned_to>
          <cc>awilliam</cc>
    
    
    <cc>dominick.grift</cc>
    
    
    <cc>dwalsh</cc>
    
    
    <cc>jbwillia</cc>
    
    
    <cc>lvrabec</cc>
    
    
    <cc>mgrepl</cc>
    
    
    <cc>nb</cc>
    
    
    <cc>plautrba</cc>
    
    
    <cc>pmoore</cc>
    
    
    <cc>robatino</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>ssekidde</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>selinux-policy-3.13.1-224.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-11-15 08:33:23</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9875715</commentid>
    <comment_count>0</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-09 07:22:22 -0500</bug_when>
    <thetext>Description of problem:
When I try to create a new partitioning table in gnome-disks on a hard drive, nothing seems to happen at first. But after ~25 seconds, the change is applied. During that time I see this printed in the journal:

Nov 09 06:31:53 localhost-live audit[982]: USER_AVC pid=982 uid=81 auid=4294967295 ses=4294967295 subj=system_u:system_r:system_dbusd_t:s0-s0:c0.c1023 msg=&apos;avc:  denied  { send_msg } for msgtype=method_return dest=:1.35 spid=974 tpid=1509 scontext=system_u:system_r:systemd_logind_t:s0 tcontext=system_u:system_r:devicekit_t:s0 tclass=dbus
                                            exe=&quot;/usr/bin/dbus-daemon&quot; sauid=81 hostname=? addr=? terminal=?&apos;
Nov 09 06:32:18 localhost-live udisksd[1509]: Error inhibiting: Timeout was reached (g-io-error-quark, 24)
Nov 09 06:32:18 localhost-live kernel:  vdb:

When I boot with enforcing=0 (but I really have to boot with it, using &quot;setenforce 0&quot; didn&apos;t seem to fix the behavior for me), gnome-disks can format a disk without any delay, repeatedly. So this seems to be a selinux-related issue.

Version-Release number of selected component (if applicable):
Fedora-Workstation-Live-x86_64-25-1.1.iso
gnome-disk-utility-3.22.0-1.fc25.x86_64
selinux-policy-3.13.1-222.fc25.noarch
storaged-2.6.2-2.fc25.x86_64

How reproducible:
always

Steps to Reproduce:
1. add a clean disk to a VM
2. boot either Live or an installed system
3. run gnome-disks
4. try to format the clean disk with MBR or GPT, see that nothing happens at first, but it happens after 25 seconds
5. you can repeat this be swapping MBR and GPT</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9875722</commentid>
    <comment_count>1</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-09 07:24:50 -0500</bug_when>
    <thetext>This seems to break basic application functionality:
&quot;All applications that can be launched using the standard graphical mechanism of a release-blocking desktop after a default installation of that desktop must start successfully and withstand a basic functionality test. &quot;
https://fedoraproject.org/wiki/Fedora_25_Final_Release_Criteria#Default_application_functionality

It does not break it completely, but it seems that nothing has happened, so you try several times in a row, and then gnome-disks gets very weird (stops performing any tasks, shows dbus timeout errors, etc).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9875803</commentid>
    <comment_count>2</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-09 07:39:16 -0500</bug_when>
    <thetext>It seems some of the actions are pending for a long time (perhaps indefinitely). This is what I see many minutes later:

$ poweroff
Operation inhibited by &quot;Disk Manager&quot; (PID 1389 &quot;udisksd&quot;, user root), reason is &quot;Formatting Device&quot;.
Please retry operation after closing inhibitors and logging out other users.
Alternatively, ignore inhibitors and users with &apos;systemctl poweroff -i&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876114</commentid>
    <comment_count>3</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-09 09:07:39 -0500</bug_when>
    <thetext>(A bit off topic, but a weird thing is that the AVC did not appear in setroubleshoot, nor any notification popped up. Is that expected, or a bug in setroubleshoot?)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876668</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-09 11:32:58 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-224.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-f29b746f2e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876818</commentid>
    <comment_count>5</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2016-11-09 12:04:41 -0500</bug_when>
    <thetext>I&apos;m -1 blocker, +1 FE on this one. It&apos;s ugly, but if it eventually completes it&apos;s not quite broken enough for me to block on it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876826</commentid>
    <comment_count>6</comment_count>
    <who name="Dennis Gilmore">dennis</who>
    <bug_when>2016-11-09 12:06:02 -0500</bug_when>
    <thetext>-1 blocker
+1 FE

while annoying it does not prevent it working, just delays things</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876834</commentid>
    <comment_count>7</comment_count>
    <who name="Nick Bebout">nb</who>
    <bug_when>2016-11-09 12:08:14 -0500</bug_when>
    <thetext>-1 blocker, +1 FE</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876842</commentid>
    <comment_count>8</comment_count>
    <who name="Adam Williamson">awilliam</who>
    <bug_when>2016-11-09 12:10:47 -0500</bug_when>
    <thetext>yeah, same for me. -1 / +1.

that&apos;s -4 / +4, so setting accepted FE.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9876846</commentid>
    <comment_count>9</comment_count>
    <who name="Ben Williams">jbwillia</who>
    <bug_when>2016-11-09 12:12:16 -0500</bug_when>
    <thetext>-1 blocker +1 FE</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9879105</commentid>
    <comment_count>10</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2016-11-10 04:46:41 -0500</bug_when>
    <thetext>(In reply to Fedora Update System from comment #4)
&gt; selinux-policy-3.13.1-224.fc25 has been submitted as an update to Fedora 25.
&gt; https://bodhi.fedoraproject.org/updates/FEDORA-2016-f29b746f2e

Seems to fix this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9881144</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-10 14:26:25 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-224.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-f29b746f2e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9892676</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-15 08:33:23 -0500</bug_when>
    <thetext>selinux-policy-3.13.1-224.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1347865</bug_id>
          
          <creation_ts>2016-06-17 17:26:00 -0400</creation_ts>
          <short_desc>systemd spec file needs to escape %prep in comment</short_desc>
          <delta_ts>2016-08-04 01:07:32 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>systemd</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc>http://pkgs.fedoraproject.org/cgit/rpms/systemd.git/tree/systemd.spec#n27</bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Pat Cox">lists</reporter>
          <assigned_to>systemd-maint</assigned_to>
          <cc>johannbg</cc>
    
    
    <cc>lnykryn</cc>
    
    
    <cc>msekleta</cc>
    
    
    <cc>muadda</cc>
    
    
    <cc>ssahani</cc>
    
    
    <cc>s</cc>
    
    
    <cc>systemd-maint</cc>
    
    
    <cc>zbyszek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-08-04 01:07:32</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9429336</commentid>
    <comment_count>0</comment_count>
    <who name="Pat Cox">lists</who>
    <bug_when>2016-06-17 17:26:52 -0400</bug_when>
    <thetext>User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36
Build Identifier: 

The systemd specfile I have is seen here: http://pkgs.fedoraproject.org/cgit/rpms/systemd.git/tree/systemd.spec#n27

rpm (version 4.8.0 on CentOS 6.&amp;) is unable to parse this specfile. See output below.

Reproducible: Always

Steps to Reproduce:
1. download systemd specfile
2. run `rpm -q --qf &quot;%{Name}&quot; --specfile ~/systemd/specfiles/systemd.spec`
Actual Results:  
error: line 217: second %prep
error: query of specfile ~/systemd/specfiles/systemd.spec failed, can&apos;t parse

Expected Results:  
systemdsystemd-libssystemd-compat-libssystemd-pamsystemd-develsystemd-udevsystemd-containersystemd-journal-remotesystemd-debuginfo

According to http://www.rpm.org/max-rpm-snapshot/ch-rpm-inside.html, the %prep macro on the comment line needs to be escaped:
&quot;Comments can be placed in any section of the spec file. Note that macros are expanded everywhere, so with multiline macros which would only have the first line commented also escape the percent (%) character:&quot;

Changing &apos;%prep&apos; to &apos;%%prep&apos; on line 27 fixes the parsing.
$ rpm -q --qf &quot;%{Name}&quot; --specfile ~/systemd/specfiles/systemd.spec
systemdsystemd-libssystemd-compat-libssystemd-pamsystemd-develsystemd-udevsystemd-containersystemd-journal-remotesystemd-debuginfo</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549988</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 01:06:54 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9583663</commentid>
    <comment_count>2</comment_count>
    <who name="Zbigniew JÄ™drzejewski-Szmek">zbyszek</who>
    <bug_when>2016-08-04 01:07:32 -0400</bug_when>
    <thetext>Fixed in edb4e050132b3c8d7764b73d0d7dc564aba51d8f.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
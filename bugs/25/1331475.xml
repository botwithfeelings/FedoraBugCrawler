<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1331475</bug_id>
          
          <creation_ts>2016-04-28 11:10:00 -0400</creation_ts>
          <short_desc>bash segfaults when started via unshare --pid without forking</short_desc>
          <delta_ts>2017-02-13 02:25:38 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>bash</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>low</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tomas Tomecek">ttomecek</reporter>
          <assigned_to name="Siteshwar Vashisht">svashisht</assigned_to>
          <cc>admiller</cc>
    
    
    <cc>dkaspar</cc>
    
    
    <cc>kdudka</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-11 01:39:46</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9277250</commentid>
    <comment_count>0</comment_count>
    <who name="Tomas Tomecek">ttomecek</who>
    <bug_when>2016-04-28 11:10:38 -0400</bug_when>
    <thetext>Description of problem:

When starting bash in a new PID namespace without fork, it segfaults:

$ sudo unshare --pid bash
bash: fork: Cannot allocate memory
Segmentation fault


I understand this is pretty cumbersome. I would expect bash not to segfault, I think it should print that it&apos;s not able to allocate memory.

E.g. zsh carries on:

$ sudo unshare --pid zsh
/etc/profile.d/colorgrep.sh:3: fork failed: cannot allocate memory
/etc/profile.d/colorls.sh:26: fork failed: cannot allocate memory
/etc/profile.d/colorxzgrep.sh:1: fork failed: cannot allocate memory
/etc/profile.d/colorzgrep.sh:3: fork failed: cannot allocate memory
/etc/profile.d/qt-graphicssystem.sh:7: fork failed: cannot allocate memory
/etc/profile.d/vim.sh:3: fork failed: cannot allocate memory
compinit:534: fork failed: cannot allocate memory
[root@localhost]/home/root# ls
zsh: fork failed: cannot allocate memory
[root@localhost]/home/root#</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9292339</commentid>
    <comment_count>1</comment_count>
      <attachid>1153903</attachid>
    <who name="Kamil Dudka">kdudka</who>
    <bug_when>2016-05-04 11:00:02 -0400</bug_when>
    <thetext>Created attachment 1153903
backtrace</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9292365</commentid>
    <comment_count>2</comment_count>
    <who name="David Kaspar [Dee&apos;Kej]">dkaspar</who>
    <bug_when>2016-05-04 11:01:58 -0400</bug_when>
    <thetext>Thank you for the backtrace, because I was unable to reproduce it:
&gt; $ sudo unshare --pid bash
&gt; bash: fork: Cannot allocate memory
&gt; bash-4.3#

My version of bash:
&gt; bash-4.3.42-3.fc23.x86_64

Also, I&apos;m reassigning this to new maintainer of bash (but I will keep myself in CC for now).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549971</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 01:06:11 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10141973</commentid>
    <comment_count>6</comment_count>
    <who name="Siteshwar Vashisht">svashisht</who>
    <bug_when>2017-02-13 02:25:38 -0500</bug_when>
    <thetext>This was fixed by rebasing bash to version 4.4 in rawhide.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>1153903</attachid>
            <date>2016-05-04 11:00:00 -0400</date>
            <delta_ts>2016-05-04 11:00:02 -0400</delta_ts>
            <desc>backtrace</desc>
            <filename>bash-sigsegv.txt</filename>
            <type>text/plain</type>
            <size>2966</size>
            <attacher name="Kamil Dudka">kdudka</attacher>
            
              <data encoding="base64">IzAgIHdhaXRfZm9yIChwaWQ9LTEpIGF0IGpvYnMuYzoyNTU2CiAgICAgICAgam9iID0gPG9wdGlt
aXplZCBvdXQ+CiAgICAgICAgdGVybWluYXRpb25fc3RhdGUgPSA8b3B0aW1pemVkIG91dD4KICAg
ICAgICByID0gPG9wdGltaXplZCBvdXQ+CiAgICAgICAgcyA9IDxvcHRpbWl6ZWQgb3V0PgogICAg
ICAgIGNoaWxkID0gMHgwCiAgICAgICAgc2V0ID0ge19fdmFsID0gezY1NTM2LCAwIDxyZXBlYXRz
IDE1IHRpbWVzPn19CiAgICAgICAgb3NldCA9IHtfX3ZhbCA9IHswIDxyZXBlYXRzIDE2IHRpbWVz
Pn19CiMxICAweDAwMDA1NjA0ZDdiNWJkMDkgaW4gZXhlY3V0ZV9jb21tYW5kX2ludGVybmFsIChj
b21tYW5kPTB4NTYwNGQ5NTMxMjEwLCBhc3luY2hyb25vdXM9YXN5bmNocm9ub3VzQGVudHJ5PTAs
IHBpcGVfaW49cGlwZV9pbkBlbnRyeT0tMSwgcGlwZV9vdXQ9PG9wdGltaXplZCBvdXQ+LCBwaXBl
X291dEBlbnRyeT0tMSwgZmRzX3RvX2Nsb3NlPWZkc190b19jbG9zZUBlbnRyeT0weDU2MDRkOTUz
MTQyMCkgYXQgZXhlY3V0ZV9jbWQuYzo4NDEKICAgICAgICBleGVjX3Jlc3VsdCA9IDAKICAgICAg
ICB1c2VyX3N1YnNoZWxsID0gPG9wdGltaXplZCBvdXQ+CiAgICAgICAgaW52ZXJ0ID0gPG9wdGlt
aXplZCBvdXQ+CiAgICAgICAgaWdub3JlX3JldHVybiA9IDxvcHRpbWl6ZWQgb3V0PgogICAgICAg
IHdhc19lcnJvcl90cmFwID0gMAogICAgICAgIG15X3VuZG9fbGlzdCA9IDxvcHRpbWl6ZWQgb3V0
PgogICAgICAgIGV4ZWNfdW5kb19saXN0ID0gPG9wdGltaXplZCBvdXQ+CiAgICAgICAgdGNtZCA9
IDxvcHRpbWl6ZWQgb3V0PgogICAgICAgIGxhc3RfcGlkID0gLTEKICAgICAgICBzYXZlX2xpbmVf
bnVtYmVyID0gMAogICAgICAgIG9maWZvID0gLTY0ODg4NjU0NAogICAgICAgIG5maWZvID0gMjIw
MjAKICAgICAgICBvc2l6ZSA9IDAKICAgICAgICBzYXZlZF9maWZvID0gMAogICAgICAgIG9maWZv
X2xpc3QgPSAweGYgPGVycm9yOiBDYW5ub3QgYWNjZXNzIG1lbW9yeSBhdCBhZGRyZXNzIDB4Zj4K
IzIgIDB4MDAwMDU2MDRkN2I5Y2Q1MSBpbiBwYXJzZV9hbmRfZXhlY3V0ZSAoc3RyaW5nPTxvcHRp
bWl6ZWQgb3V0PiwgZnJvbV9maWxlPWZyb21fZmlsZUBlbnRyeT0weDU2MDRkN2JkYTU0MyAiUFJP
TVBUX0NPTU1BTkQiLCBmbGFncz1mbGFnc0BlbnRyeT01KSBhdCBldmFsc3RyaW5nLmM6Mzg3CiAg
ICAgICAgYml0bWFwID0gMHg1NjA0ZDk1MzE0MjAKICAgICAgICBjb2RlID0gMAogICAgICAgIGxy
ZXNldCA9IDAKICAgICAgICBzaG91bGRfanVtcF90b190b3BfbGV2ZWwgPSAwCiAgICAgICAgbGFz
dF9yZXN1bHQgPSAwCiAgICAgICAgY29tbWFuZCA9IDB4NTYwNGQ5NTMxMjEwCiAgICAgICAgcGVf
c2lnbWFzayA9IHtfX3ZhbCA9IHswIDxyZXBlYXRzIDE2IHRpbWVzPn19CiMzICAweDAwMDA1NjA0
ZDdiNTIzMGIgaW4gZXhlY3V0ZV92YXJpYWJsZV9jb21tYW5kIChjb21tYW5kPTB4NTYwNGQ5NTMw
ZGIwICJwcmludGYgXCJcXDAzM10wOyVzQCVzOiVzXFwwMDdcIiBcIiR7VVNFUn1cIiBcIiR7SE9T
VE5BTUUlJS4qfVwiIFwiJHtQV0QvIyRIT01FL1xcfn1cIiIsIHZuYW1lPXZuYW1lQGVudHJ5PTB4
NTYwNGQ3YmRhNTQzICJQUk9NUFRfQ09NTUFORCIpIGF0IC4vcGFyc2UueToyNTk1CiAgICAgICAg
bGFzdF9sYXN0YXJnID0gMHg1NjA0ZDk1NDdlMDAgIl0iCiAgICAgICAgcHMgPSB7cGFyc2VyX3N0
YXRlID0gMCwgdG9rZW5fc3RhdGUgPSAweDU2MDRkOTUzNDQ2MCwgdG9rZW4gPSAweDU2MDRkOTUy
YzQyMCAiZmkiLCB0b2tlbl9idWZmZXJfc2l6ZSA9IDQ5NiwgaW5wdXRfbGluZV90ZXJtaW5hdG9y
ID0gMCwgZW9mX2VuY291bnRlcmVkID0gMCwgcHJvbXB0X3N0cmluZ19wb2ludGVyID0gMHg1NjA0
ZDdlMWUwMjAgPHBzMV9wcm9tcHQ+LCBjdXJyZW50X2NvbW1hbmRfbGluZV9jb3VudCA9IDAsIHJl
bWVtYmVyX29uX2hpc3RvcnkgPSAxLCBoaXN0b3J5X2V4cGFuc2lvbl9pbmhpYml0ZWQgPSAwLCBs
YXN0X2NvbW1hbmRfZXhpdF92YWx1ZSA9IDI1NCwgcGlwZXN0YXR1cyA9IDB4NTYwNGQ5NTQ3ZDUw
LCBsYXN0X3NoZWxsX2J1aWx0aW4gPSAweDU2MDRkN2JhNWYxMCA8dGVzdF9idWlsdGluPiwgdGhp
c19zaGVsbF9idWlsdGluID0gMHg1NjA0ZDdiYTVmMTAgPHRlc3RfYnVpbHRpbj4sIGV4cGFuZF9h
bGlhc2VzID0gMSwgZWNob19pbnB1dF9hdF9yZWFkID0gMCwgbmVlZF9oZXJlX2RvYyA9IDB9CiM0
ICAweDAwMDA1NjA0ZDdiNDYxYjcgaW4gcGFyc2VfY29tbWFuZCAoKSBhdCBldmFsLmM6MjMyCiAg
ICAgICAgciA9IDxvcHRpbWl6ZWQgb3V0PgogICAgICAgIGNvbW1hbmRfdG9fZXhlY3V0ZSA9IDxv
cHRpbWl6ZWQgb3V0PgojNSAgMHgwMDAwNTYwNGQ3YjQ2Mjk4IGluIHJlYWRfY29tbWFuZCAoKSBh
dCBldmFsLmM6MjgzCiAgICAgICAgdG1vdXRfdmFyID0gMHgwCiAgICAgICAgdG1vdXRfbGVuID0g
MAogICAgICAgIHJlc3VsdCA9IDxvcHRpbWl6ZWQgb3V0PgogICAgICAgIG9sZF9hbHJtID0gMHgw
CiM2ICAweDAwMDA1NjA0ZDdiNDY0N2IgaW4gcmVhZGVyX2xvb3AgKCkgYXQgZXZhbC5jOjE0Ngog
ICAgICAgIGNvZGUgPSAwCiAgICAgICAgb3VyX2luZGlyZWN0aW9uX2xldmVsID0gMQogICAgICAg
IGN1cnJlbnRfY29tbWFuZCA9IDB4MAojNyAgMHgwMDAwNTYwNGQ3YjQ0ZjYyIGluIG1haW4gKGFy
Z2M9MSwgYXJndj0weDdmZmM1NWNiOWJkOCwgZW52PTB4N2ZmYzU1Y2I5YmU4KSBhdCBzaGVsbC5j
Ojc2NgogICAgICAgIGkgPSA8b3B0aW1pemVkIG91dD4KICAgICAgICBjb2RlID0gPG9wdGltaXpl
ZCBvdXQ+CiAgICAgICAgb2xkX2VycmV4aXRfZmxhZyA9IDxvcHRpbWl6ZWQgb3V0PgogICAgICAg
IHNhdmVyc3QgPSA8b3B0aW1pemVkIG91dD4KICAgICAgICBsb2NhbGx5X3NraXBfZXhlY3V0aW9u
ID0gMQogICAgICAgIGFyZ19pbmRleCA9IDEKICAgICAgICB0b3BfbGV2ZWxfYXJnX2luZGV4ID0g
MQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
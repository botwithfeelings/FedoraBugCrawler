<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1421241</bug_id>
          
          <creation_ts>2017-02-10 12:21:00 -0500</creation_ts>
          <short_desc>Options error: Unrecognized option or missing or extra parameter(s) in [CMD-LINE]:1: tls-remote (2.4.0)</short_desc>
          <delta_ts>2017-03-01 20:21:29 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>NetworkManager-openvpn</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kamil Páral">kparal</reporter>
          <assigned_to name="Lubomir Rintel">lkundrak</assigned_to>
          <cc>choeger</cc>
    
    
    <cc>dazo</cc>
    
    
    <cc>dcbw</cc>
    
    
    <cc>eparis</cc>
    
    
    <cc>fabrice</cc>
    
    
    <cc>huzaifas</cc>
    
    
    <cc>ignatenko</cc>
    
    
    <cc>limburgher</cc>
    
    
    <cc>lkundrak</cc>
    
    
    <cc>mauricio.teixeira</cc>
    
    
    <cc>pgervase</cc>
    
    
    <cc>plambri</cc>
    
    
    <cc>psimerda</cc>
    
    
    <cc>rcyriac</cc>
    
    
    <cc>sgallagh</cc>
    
    
    <cc>steve</cc>
    
    
    <cc>thaller</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>NetworkManager-openvpn-1.2.8-2.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-03-01 20:21:29</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          <external_bugs name="GNOME Desktop">776045</external_bugs>
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10138926</commentid>
    <comment_count>0</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2017-02-10 12:21:46 -0500</bug_when>
    <thetext>Description of problem:
After upgrading from openvpn-2.3.14-1.fc25.x86_64 to 2.4.0-1.fc25.x86_64, I can no longer connect to my corporate VPN. Journal says:

Feb 10 18:16:54 dryad NetworkManager[917]: &lt;info&gt;  [1486747014.5447] audit: op=&quot;connection-activate&quot; uuid=&quot;5777c2b4-defc-46f1-9858-2b850d51587c&quot; name=&quot;Brno (BRQ)&quot; pid=1764 uid=1000 result=&quot;success&quot;
Feb 10 18:16:54 dryad NetworkManager[917]: &lt;info&gt;  [1486747014.5511] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: Started the VPN service, PID 2461
Feb 10 18:16:54 dryad NetworkManager[917]: &lt;info&gt;  [1486747014.5606] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: Saw the service appear; activating connection
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0090] keyfile: update /etc/NetworkManager/system-connections/BRQ.ovpn (5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0196] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: state changed: starting (3)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0197] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN connection: (ConnectInteractive) reply received
Feb 10 18:17:01 dryad NetworkManager[917]: Options error: Unrecognized option or missing or extra parameter(s) in [CMD-LINE]:1: tls-remote (2.4.0)
Feb 10 18:17:01 dryad NetworkManager[917]: Use --help for more information.
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;warn&gt;  [1486747021.0291] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: failed: connect-failed (1)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;warn&gt;  [1486747021.0294] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: failed: connect-failed (1)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0294] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: state changed: stopping (5)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0294] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: state changed: stopped (6)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0303] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN plugin: state change reason: unknown (0)
Feb 10 18:17:01 dryad NetworkManager[917]: &lt;info&gt;  [1486747021.0313] vpn-connection[0x561bc50a0160,5777c2b4-defc-46f1-9858-2b850d51587c,&quot;Brno (BRQ)&quot;,0]: VPN service disappeared


Version-Release number of selected component (if applicable):
openvpn-2.4.0-1.fc25.x86_64

How reproducible:
always

Steps to Reproduce:
1. try to active vpn in gnome
2. type in password
3. see &quot;vpn activation failed&quot; message immediately after confirming</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138955</commentid>
    <comment_count>1</comment_count>
    <who name="Gwyn Ciesla">limburgher</who>
    <bug_when>2017-02-10 12:36:14 -0500</bug_when>
    <thetext>I&apos;m updating NetworkManager-openvpn, see if this build helps when it&apos;s done.

https://koji.fedoraproject.org/koji/taskinfo?taskID=17729210</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138985</commentid>
    <comment_count>2</comment_count>
    <who name="David Sommerseth">dazo</who>
    <bug_when>2017-02-10 12:47:00 -0500</bug_when>
    <thetext>Dan Williams (dcwb) should already have received a heads-up about these potential issues in late november/early december 2016 regarding this issue.  I understood they already had fixed this.

--tls-remote have been deprecated since v2.3.0 (released January 2013) and already at that point had the much improved replacement in-place since that time.  The syntax of --verify-x509-name is different, but more flexible and supports UTF-8 characters properly.  See the man page for more information.

For the record, I am running NetworkManager-openvpn-1.2.6-1.el7.x86_64 (Scientific Linux 7.3) ... and I see it uses --verify-x509-name instead of --tls-remote.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10139120</commentid>
    <comment_count>3</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-10 13:48:32 -0500</bug_when>
    <thetext>Recent versions of the plugin support --verify-x509-name.

Since openvpn removed an option, NetworkManager-openvpn can do nothing here automatically.


Maybe the GUI should now be updated to make it more obvious that tls-remote is defunct. But in the end, there is no solution and users are forced to modify their existing configurations.

upstream: https://bugzilla.gnome.org/show_bug.cgi?id=776045</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142173</commentid>
    <comment_count>4</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-13 03:58:38 -0500</bug_when>
    <thetext>*** Bug 1421499 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142180</commentid>
    <comment_count>5</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-13 03:59:56 -0500</bug_when>
    <thetext>*** Bug 1421592 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142265</commentid>
    <comment_count>6</comment_count>
    <who name="David Sommerseth">dazo</who>
    <bug_when>2017-02-13 04:30:12 -0500</bug_when>
    <thetext>The nm-openvpn plug-in could disable the --tls-remote variant in the UI and in existing configuration convert it to the new syntax.

IIRC ... the eqvivalent of

      --tls-remote host.example.com 

should be

      --verify-x509-name host.example.com name

The &apos;name&apos; type should match against the CN field of the X.509 subject.

The only difference here compared against --tls-remote is that there are no character replacements, where some less used characters (typically outside a-z, A-Z and 0-9) are changed to _ (underscore).  I believe the majority of users uses normal hostnames in the server CN, so this could ease the migration.

Further the plug-in could issue a warning if --tls-remote is used and an underscore is found in the match value.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142354</commentid>
    <comment_count>7</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-13 05:10:22 -0500</bug_when>
    <thetext>(In reply to David Sommerseth from comment #6)
&gt; The nm-openvpn plug-in could disable the --tls-remote variant in the UI and
&gt; in existing configuration convert it to the new syntax.

yes, the nm-connection-editor UI should be improved to strongly discourage the tls-remote option, possibly with a warning that it might make your connection non-working.

The upstream bug is still open to improve here, but these changes only make the issue more discoverable to the user. The user is still required to manually fix the connection.


&gt; IIRC ... the eqvivalent of
&gt; 
&gt;       --tls-remote host.example.com 
&gt; 
&gt; should be
&gt; 
&gt;       --verify-x509-name host.example.com name
&gt; 
&gt; The &apos;name&apos; type should match against the CN field of the X.509 subject.
&gt; 
&gt; The only difference here compared against --tls-remote is that there are no
&gt; character replacements, where some less used characters (typically outside
&gt; a-z, A-Z and 0-9) are changed to _ (underscore).  I believe the majority of
&gt; users uses normal hostnames in the server CN, so this could ease the
&gt; migration.

... so it&apos;s not really equivalent :)

Apparently it was desired by openvpn 2.4 to break configurations with --tls-remoted, otherwise it could just have kept the option. Which raises the question why the nm-openvpn should behave any different here.

But yes, probably this should be done. A user just doesn&apos;t care for the reasons his configuration breaks. (as always: patches welcome).


&gt; Further the plug-in could issue a warning if --tls-remote is used and an
&gt; underscore is found in the match value.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142407</commentid>
    <comment_count>9</comment_count>
    <who name="David Sommerseth">dazo</who>
    <bug_when>2017-02-13 05:30:37 -0500</bug_when>
    <thetext>(In reply to Thomas Haller from comment #7)
&gt; (In reply to David Sommerseth from comment #6)
[...snip...]
&gt; &gt; The only difference here compared against --tls-remote is that there are no
&gt; &gt; character replacements, where some less used characters (typically outside
&gt; &gt; a-z, A-Z and 0-9) are changed to _ (underscore).  I believe the majority of
&gt; &gt; users uses normal hostnames in the server CN, so this could ease the
&gt; &gt; migration.
&gt; 
&gt; ... so it&apos;s not really equivalent :)

Fair point :)

&gt; Apparently it was desired by openvpn 2.4 to break configurations with
&gt; --tls-remoted, otherwise it could just have kept the option. Which raises
&gt; the question why the nm-openvpn should behave any different here.

To be fair, the --tls-remote feature was deprecated officially in OpenVPN v2.3.1, released March 27, 2013 (just re-checked commit logs - we removed it in v2.3.0 and introduced a compatibility wrapper in v2.3.1).  And it has been labelled with &quot;DEPRECATED&quot; in the man page since that release, even saying &quot;It will be removed in either in OpenVPN v2.4 or v2.5&quot;.  Plus we also reminded people about this being removed all back to v2.4_beta1 (released Nov 17, 2016).  I also got in touch with Dan Williams around the same time, to ensure nm-openvpn would be able to tackle this situation.

But in retrospect, we could probably have made even more noise about this.  This is something we need to discuss in the OpenVPN developers community.

With that said, OpenVPN v2.4 carries 240+ configuration options.  So we do need to remove deprecated features from time to time; we already have way too many options.  But on the other hand, we do feel that giving a few years of adoption time is fairly generous.

&gt; But yes, probably this should be done. A user just doesn&apos;t care for the
&gt; reasons his configuration breaks. (as always: patches welcome).

:)  Yeah, users just want things to work.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10142995</commentid>
    <comment_count>10</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-13 08:33:42 -0500</bug_when>
    <thetext>(In reply to Thomas Haller from comment #7)
&gt; But yes, probably this should be done. A user just doesn&apos;t care for the
&gt; reasons his configuration breaks. (as always: patches welcome).

patches for review on upstream bug:

https://bugzilla.gnome.org/show_bug.cgi?id=776045#c3</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10143692</commentid>
    <comment_count>11</comment_count>
    <who name="David Sommerseth">dazo</who>
    <bug_when>2017-02-13 11:28:47 -0500</bug_when>
    <thetext>I have only glared at the code, and I do not have too much experience inside the nm-openvpn plug-in source code and no build setup for NetworkManager stuff.  But this looks like a very reasonable approach.  When there is an EL7 build available, I can definitely test this for you (currently running Scientific Linux 7.3 x86_64, which is a RHEL 7.3 clone).

Just one comment to a sentence in your commit message:
&quot;[...} or ever worse, that it wronlgy accepts a server that should be rejected.&quot;

I don&apos;t dare to say this is completely wrong, but I really struggle to imagine a way this could be abused.

A typical attack vector would be a MITM attack, where the client connects to a different server without being aware of it.  For this to work out, the server must provide to the client a server certificate signed by the same CA as the real OpenVPN server, otherwise OpenVPN will reject the server regardless.  So just here it will be a big challenge.  Secondly, the CN field of the certificate the MITM server provides need to consider a remapping which is not happening.  Such an attack scenario sounds more like to be of more academic interest than a realistic attack vector.  But I might overlook something.

On the other side, you are right that some servers which provides a value typically *not* being a normal host name in the CN field might get the connection rejected.  So if the CN value is &quot;VPN Server (1)&quot;, the old remapping would end up with &quot;VPN_Server__1_&quot; (which would be the value used with --tls-remote).  But with a typical normal host name, this should not be an issue at all.

And to be honest, the --tls-remote feature worked poorly in use cases where the CN was not a typical host name.  Just mix in UTF-8 and other &quot;national characters&quot; and you&apos;re got a challenge.  These are some of the areas --verify-x509-name tries to fix.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10144691</commentid>
    <comment_count>12</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-13 18:32:06 -0500</bug_when>
    <thetext>(In reply to David Sommerseth from comment #11)

I think a false-positive of rejecting a server that would have been accepted by --tls-remote is acceptable. The user really should fix the configuration.

I would be more concerned about a scenario where tls-remove would have rejected the server, but the verify-x509-name workaround doesn&apos;t.
If you say, &quot;I really struggle to imagine a way this could be abused&quot;, that is a good thing, although I am not 100% sure that such a case cannot happen (and neither you &quot;dare to say&quot;). That&apos;s why I&apos;d leave that remark there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10149899</commentid>
    <comment_count>13</comment_count>
    <who name="Peter Gervase">pgervase</who>
    <bug_when>2017-02-15 07:44:54 -0500</bug_when>
    <thetext>As a workaround, I rpm -Uvh --oldpackage openvpn-2.3.12-1.fc26.x86_64.rpm NetworkManager-openvpn-1.2.6-1.fc26.x86_64.rpm NetworkManager-openvpn-gnome-1.2.6-1.fc26.x86_64.rpm
from:
https://koji.fedoraproject.org/koji/buildinfo?buildID=793933
https://koji.fedoraproject.org/koji/buildinfo?buildID=806543
and I&apos;m now able to get back in my corporate vpn.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10150011</commentid>
    <comment_count>14</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-15 08:10:20 -0500</bug_when>
    <thetext>Workaround merged upstream: https://git.gnome.org/browse/network-manager-openvpn/commit/?id=37d6dc4c521ebce71313e9ea757f90cd7eefc7d2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10150142</commentid>
    <comment_count>15</comment_count>
    <who name="Kamil Páral">kparal</who>
    <bug_when>2017-02-15 08:44:30 -0500</bug_when>
    <thetext>(In reply to Peter Gervase from comment #13)
&gt; As a workaround, I rpm -Uvh --oldpackage openvpn-2.3.12-1.fc26.x86_64.rpm

If you installed the &quot;broken&quot; openvpn package and need to downgrade immediately, the easiest way to do that is &quot;sudo dnf distro-sync --disablerepo=updates-testing&quot; (you might specify just those packages you want to downgrade).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10186409</commentid>
    <comment_count>16</comment_count>
    <who name="Stephen Gallagher">sgallagh</who>
    <bug_when>2017-02-27 07:51:44 -0500</bug_when>
    <thetext>(In reply to Thomas Haller from comment #14)
&gt; Workaround merged upstream:
&gt; https://git.gnome.org/browse/network-manager-openvpn/commit/
&gt; ?id=37d6dc4c521ebce71313e9ea757f90cd7eefc7d2

It has been twelve days since this fix went upstream. If there isn&apos;t an imminent upstream release, can we please get a downstream build with this patch ASAP? Those of us on Rawhide really need this working again...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10187105</commentid>
    <comment_count>17</comment_count>
    <who name="Thomas Haller">thaller</who>
    <bug_when>2017-02-27 10:06:30 -0500</bug_when>
    <thetext>(In reply to Stephen Gallagher from comment #16)
&gt; (In reply to Thomas Haller from comment #14)
&gt; &gt; Workaround merged upstream:
&gt; &gt; https://git.gnome.org/browse/network-manager-openvpn/commit/
&gt; &gt; ?id=37d6dc4c521ebce71313e9ea757f90cd7eefc7d2
&gt; 
&gt; It has been twelve days since this fix went upstream. If there isn&apos;t an
&gt; imminent upstream release, can we please get a downstream build with this
&gt; patch ASAP? Those of us on Rawhide really need this working again...

btw, you can also fix your configuration not to use the deprecated option. That is what &quot;openvpn&quot; wants you to do.

But sure, I agree a rawhide build should be done.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10187586</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-27 12:21:29 -0500</bug_when>
    <thetext>NetworkManager-openvpn-1.2.8-2.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-3870a93455</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10195872</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-28 21:53:15 -0500</bug_when>
    <thetext>NetworkManager-openvpn-1.2.8-2.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-3870a93455</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10200032</commentid>
    <comment_count>20</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-03-01 20:21:29 -0500</bug_when>
    <thetext>NetworkManager-openvpn-1.2.8-2.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
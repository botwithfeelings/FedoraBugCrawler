<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1163812</bug_id>
          
          <creation_ts>2014-11-13 09:09:00 -0500</creation_ts>
          <short_desc>Cannot control ejabberd with ejabberdctl</short_desc>
          <delta_ts>2016-12-10 19:28:55 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>ejabberd</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Juan Orti">j.orti.alcaine</reporter>
          <assigned_to name="Randy Barlow">randy</assigned_to>
          <cc>cds</cc>
    
    
    <cc>chrissharp09</cc>
    
    
    <cc>cjs</cc>
    
    
    <cc>erlang</cc>
    
    
    <cc>frederik+fedora</cc>
    
    
    <cc>jerry</cc>
    
    
    <cc>jkaluza</cc>
    
    
    <cc>lemenkov</cc>
    
    
    <cc>martin</cc>
    
    
    <cc>pwouters</cc>
    
    
    <cc>randy</cc>
    
    
    <cc>russ+bugzilla-redhat</cc>
    
    
    <cc>samuel-rhbugs</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>ejabberd-16.09-4.fc26 ejabberd-16.09-4.fc25</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-12-10 19:28:55</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>7670145</commentid>
    <comment_count>0</comment_count>
    <who name="Juan Orti">j.orti.alcaine</who>
    <bug_when>2014-11-13 09:09:23 -0500</bug_when>
    <thetext>Description of problem:
After a clean install of ejabberd in Fedora 21, I cannot use the ejabberdctl utility to register users, etc.

I run:
# ejabberdctl register admin localhost password
Failed RPC connection to the node ejabberd@localhost: nodedown

Commands to start an ejabberd node:
  start  Start an ejabberd node in server mode
  debug  Attach an interactive Erlang shell to a running ejabberd node
  live   Start an ejabberd node in live (interactive) mode

Optional parameters when starting an ejabberd node:
  --config-dir dir   Config ejabberd:    /etc/ejabberd
  --config file      Config ejabberd:    /etc/ejabberd/ejabberd.yml
  --ctl-config file  Config ejabberdctl: /etc/ejabberd/ejabberdctl.cfg
  --logs dir         Directory for logs: /var/log/ejabberd
  --spool dir        Database spool dir: /var/lib/ejabberd
  --node nodename    ejabberd node name: ejabberd@localhost

And I see this in the log /var/log/ejabberd/ejabberd.log:

2014-11-13 14:57:30.188 [info] &lt;0.7.0&gt; Application lager started on node ejabberd@localhost
2014-11-13 14:57:30.257 [info] &lt;0.7.0&gt; Application sasl started on node ejabberd@localhost
2014-11-13 14:57:30.286 [info] &lt;0.7.0&gt; Application crypto started on node ejabberd@localhost
2014-11-13 14:57:30.354 [info] &lt;0.7.0&gt; Application asn1 started on node ejabberd@localhost
2014-11-13 14:57:30.354 [info] &lt;0.7.0&gt; Application public_key started on node ejabberd@localhost
2014-11-13 14:57:30.421 [info] &lt;0.7.0&gt; Application ssl started on node ejabberd@localhost
2014-11-13 14:57:30.450 [info] &lt;0.7.0&gt; Application p1_yaml started on node ejabberd@localhost
2014-11-13 14:57:30.482 [info] &lt;0.7.0&gt; Application p1_tls started on node ejabberd@localhost
2014-11-13 14:57:30.492 [info] &lt;0.7.0&gt; Application p1_xml started on node ejabberd@localhost
2014-11-13 14:57:30.498 [info] &lt;0.7.0&gt; Application p1_stringprep started on node ejabberd@localhost
2014-11-13 14:57:30.508 [info] &lt;0.7.0&gt; Application p1_zlib started on node ejabberd@localhost
2014-11-13 14:57:30.515 [info] &lt;0.7.0&gt; Application p1_cache_tab started on node ejabberd@localhost
2014-11-13 14:57:31.015 [info] &lt;0.7.0&gt; Application mnesia started on node ejabberd@localhost
2014-11-13 14:57:33.259 [info] &lt;0.37.0&gt;@cyrsasl_digest:start:57 FQDN used to check DIGEST-MD5 SASL authentication: charm.miceliux.com
2014-11-13 14:57:33.423 [info] &lt;0.7.0&gt; Application p1_iconv started on node ejabberd@localhost
2014-11-13 14:57:42.556 [info] &lt;0.564.0&gt;@ejabberd_listener:listen_tcp:194 Reusing listening port for 5222
2014-11-13 14:57:42.556 [info] &lt;0.565.0&gt;@ejabberd_listener:listen_tcp:194 Reusing listening port for 5269
2014-11-13 14:57:42.557 [info] &lt;0.566.0&gt;@ejabberd_listener:listen_tcp:194 Reusing listening port for 5280
2014-11-13 14:57:42.557 [info] &lt;0.37.0&gt;@ejabberd_app:start:69 ejabberd community is started in the node ejabberd@localhost
2014-11-13 14:57:42.557 [info] &lt;0.7.0&gt; Application ejabberd started on node ejabberd@localhost
2014-11-13 14:59:18.926 [error] &lt;0.567.0&gt; ** Connection attempt from disallowed node &apos;ejabberdctl-1@charm&apos; **


Version-Release number of selected component (if applicable):
ejabberd-14.07-3.fc21.x86_64

How reproducible:
Always

Steps to Reproduce:
1. yum install ejabberd
2. systemctl start ejabberd
3. ejabberdctl register admin localhost password

Actual results:
Cannot register a user.

Expected results:
Register a user.

Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8020586</commentid>
    <comment_count>1</comment_count>
    <who name="Chris Sharp">chrissharp09</who>
    <bug_when>2015-03-07 09:25:53 -0500</bug_when>
    <thetext>In my case, it&apos;s doing *anything* with ejabberdctl - not just registering.

My steps on a clean installation of Fedora 21:

1. yum install ejabberd
2. systemctl start ejabberd.service
3. ejabberdctl status

[root@localhost ~]# ejabberdctl status
Failed RPC connection to the node ejabberd@localhost: nodedown

Commands to start an ejabberd node:
  start  Start an ejabberd node in server mode
  debug  Attach an interactive Erlang shell to a running ejabberd node
  live   Start an ejabberd node in live (interactive) mode

Optional parameters when starting an ejabberd node:
  --config-dir dir   Config ejabberd:    /etc/ejabberd
  --config file      Config ejabberd:    /etc/ejabberd/ejabberd.yml
  --ctl-config file  Config ejabberdctl: /etc/ejabberd/ejabberdctl.cfg
  --logs dir         Directory for logs: /var/log/ejabberd
  --spool dir        Database spool dir: /var/lib/ejabberd
  --node nodename    ejabberd node name: ejabberd@localhost

/var/log/ejabberd/error.log:

2015-03-07 09:18:31.948 [error] &lt;0.562.0&gt; ** Connection attempt from disallowed node &apos;ejabberdctl-1@localhost&apos; **

There are hints from possibly related issues from ejabberd support that point to .erlang.cookie mismatches - that&apos;s the current rabbit I&apos;m chasing down the hole...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8021876</commentid>
    <comment_count>2</comment_count>
    <who name="">cds</who>
    <bug_when>2015-03-08 23:34:42 -0400</bug_when>
    <thetext>Not a fix, but temporary workaround is to &apos;stop&apos; ejabberd via systemctl and start ejabberd via ejabberdctl.
e.g.,
$ sudo systemctl stop ejabberd
$ sudo ejabberdctl start ejabberd
$ sudo ejabberdctl register user host pass</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8163830</commentid>
    <comment_count>3</comment_count>
    <who name="Juan Orti">j.orti.alcaine</who>
    <bug_when>2015-04-21 08:53:34 -0400</bug_when>
    <thetext>This bug is also present in Fedora 22. Any progress?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8230032</commentid>
    <comment_count>4</comment_count>
    <who name="Paul Wouters">pwouters</who>
    <bug_when>2015-05-13 10:50:06 -0400</bug_when>
    <thetext>upgrading f19 to f22 also caused my jabber server to reject everything

ejabberd-14.07-6.fc22.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8230054</commentid>
    <comment_count>5</comment_count>
    <who name="Paul Wouters">pwouters</who>
    <bug_when>2015-05-13 10:54:22 -0400</bug_when>
    <thetext>my problem was that I ended up with /etc/ejabberd/ejabberd.cfg.rpmnew and  /etc/ejabberd/ejabberd.cfg.rpmsave without leaving any  /etc/ejabberd/ejabberd.cfg

I copied my rpmsave back and then ejabberd started working again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8230240</commentid>
    <comment_count>6</comment_count>
      <attachid>1025103</attachid>
    <who name="Frederik Holden">frederik+fedora</who>
    <bug_when>2015-05-13 11:24:54 -0400</bug_when>
    <thetext>Created attachment 1025103
ejabberd-ejabberdctl-fix.patch

The problem with ejabberdctl being denied connection seems to be related to the .erlang.cookie file. I made a small change to ejabberdctl that fixed this. See the attached file.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8238281</commentid>
    <comment_count>7</comment_count>
    <who name="Jerry C">jerry</who>
    <bug_when>2015-05-15 06:03:09 -0400</bug_when>
    <thetext>comment 2 didn&apos;t work for me
comment 5 doesn&apos;t even make sense, since the new config format is the yml format
editing ejabberdctl as suggested in comment6 worked for me.

I did however lose my user database after upgrading and had to re-create all users.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8306689</commentid>
    <comment_count>8</comment_count>
    <who name="Paul Wouters">pwouters</who>
    <bug_when>2015-06-04 17:45:55 -0400</bug_when>
    <thetext>it seems my #5 comment was pidgin oddly and false claiming i had logged in. Indeed it never worked.

I spend too much time in trying to get the new config file to work. It would never fully start allowing client login. I even ended up installing a fresh new fedora19 server to load the /etc/ejabberd and /var/lib/ejabberd data onto, but that failed as well some error about Error reading Mnesia database

so my ejabberd data is no good on old or new versions. I finally gave up and declared a loss of my buddy list and went with the recommend jabber server prosody. Too bad the prosody migration scripts needed a dump made by ejabberctl that it is not able to do on the f22 or the f19 server :P</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8320204</commentid>
    <comment_count>9</comment_count>
    <who name="Carl-Johan Schenström">cjs</who>
    <bug_when>2015-06-09 18:42:54 -0400</bug_when>
    <thetext>I just upgraded from FC20 (ejabberd-2.1.13-7.fc20.x86_64) to FC22 (ejabberd-14.07-6.fc22.x86_64), which broke ejabberd in the following ways:

1. The configuration file wasn&apos;t converted, only saved as /etc/ejabberd/ejabberd.cfg.rpmsave. Possibly connected to #2, since &quot;ejabberdctl convert_to_yaml&quot; is used for converting.

2. .erlang.cookie mismatch. Solved this one by copying /var/lib/ejabberd/.erlang.cookie to my home directory. Converted configuration file as in #1.

3. All users gone. Copied /var/lib/ejabberd/spool to the same directory on another FC20 host, mucked about with hostnames, dumped the data with &quot;ejabberdctl dump&quot;, copied it back to the FC22 host, loaded it with &quot;ejabberdctl load&quot; and restarted the service. Using &quot;ejabberdctl backup&quot; and &quot;ejabberdctl restore&quot; didn&apos;t work, since the database schema is different.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9549350</commentid>
    <comment_count>10</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2016-07-26 00:33:06 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 25 development cycle.
Changing version to &apos;25&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932301</commentid>
    <comment_count>11</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-11-27 11:55:28 -0500</bug_when>
    <thetext>I submitted a patch that was inspired by Frederik Holden&apos;s patch upstream:

https://github.com/processone/ejabberd/pull/1395

That patch seems to work on my ejabberd box, so I think I will apply it as is for now while we wait on upstream to decide how they want to proceed with my proposal.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932377</commentid>
    <comment_count>12</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-11-27 13:05:30 -0500</bug_when>
    <thetext>A workaround that I&apos;ve been using is to use sudo to execute ejabberdctl as the ejabberd user. For example:

$ sudo -u ejabberd /usr/bin/sh /usr/bin/ejabberdctl &lt;args&gt;

It&apos;s not pretty, but it does work!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9932703</commentid>
    <comment_count>13</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-27 20:00:55 -0500</bug_when>
    <thetext>ejabberd-16.09-3.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-69b7266f39</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9933824</commentid>
    <comment_count>14</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-11-28 04:37:08 -0500</bug_when>
    <thetext>ejabberd-16.09-3.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-69b7266f39</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9934973</commentid>
    <comment_count>15</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-11-28 09:32:55 -0500</bug_when>
    <thetext>I learned that the erlang cookie is a bit like a password (I had thought it was just the id of the node the user wants to connect to). Thus it should not be passed with -set-cookie because we don&apos;t want it to appear in the process table. Thus I will have to solve this another way.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9948443</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-01 12:15:53 -0500</bug_when>
    <thetext>ejabberd-16.09-4.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2016-89b50bf88a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9948449</commentid>
    <comment_count>17</comment_count>
    <who name="Randy Barlow">randy</who>
    <bug_when>2016-12-01 12:17:14 -0500</bug_when>
    <thetext>I fixed this by setting the INSTALLUSER variable in ejabberdctl and patching it to use bash when executing erl with su.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9952926</commentid>
    <comment_count>18</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-02 23:35:28 -0500</bug_when>
    <thetext>ejabberd-16.09-4.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-89b50bf88a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9974125</commentid>
    <comment_count>19</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-12-10 19:28:55 -0500</bug_when>
    <thetext>ejabberd-16.09-4.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1025103</attachid>
            <date>2015-05-13 11:24:00 -0400</date>
            <delta_ts>2015-05-13 11:24:54 -0400</delta_ts>
            <desc>ejabberd-ejabberdctl-fix.patch</desc>
            <filename>ejabberd-ejabberdctl-fix.patch</filename>
            <type>text/plain</type>
            <size>506</size>
            <attacher name="Frederik Holden">frederik+fedora</attacher>
            
              <data encoding="base64">LS0tIGVqYWJiZXJkLTE0LjA3LW9yaWcvZWphYmJlcmRjdGwudGVtcGxhdGUJMjAxNS0wNS0xMyAx
NzoxOTo0OC42MjY1MjA5OTUgKzAyMDAKKysrIGVqYWJiZXJkLTE0LjA3L2VqYWJiZXJkY3RsLnRl
bXBsYXRlCTIwMTUtMDUtMTMgMTc6MjE6MDMuNzkwNTgwNDQ0ICswMjAwCkBAIC0zNTIsMTAgKzM1
MiwxMiBAQAogewogICAgIENPTk5fTkFNRT0kMTsgc2hpZnQKICAgICBDT01NQU5EPSRACisgICAg
RVJMQU5HX0NPT0tJRT0kKGNhdCAiJFNQT09MX0RJUi8uZXJsYW5nLmNvb2tpZSIpCiAgICAgJEVY
RUNfQ01EICIkRVJMIFwKICAgICAgICROQU1FICR7Q09OTl9OQU1FfSBcCiAgICAgICAtbm9pbnB1
dCBcCiAgICAgICAtaGlkZGVuIFwKKyAgICAgIC1zZXRjb29raWUgJEVSTEFOR19DT09LSUUgXAog
ICAgICAgLXBhICRFSkFCQkVSRF9FQklOX1BBVEggXAogICAgICAgJEtFUk5FTF9PUFRTIFwKICAg
ICAgIC1zIGVqYWJiZXJkX2N0bCAtZXh0cmEgJEVSTEFOR19OT0RFICRDT01NQU5EIgo=
</data>

          </attachment>
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1383641</bug_id>
          
          <creation_ts>2016-10-11 06:17:00 -0400</creation_ts>
          <short_desc>ed25519 and ecdsa OpenSSH keys are not pregenerated</short_desc>
          <delta_ts>2016-10-26 18:31:08 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>lorax</component>
          <version>25</version>
          <rep_platform>s390x</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>467765</blocked>
    
    
    <blocked>1378351</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Dan Horák">dan</reporter>
          <assigned_to name="Brian Lane">bcl</assigned_to>
          <cc>anaconda-maint-list</cc>
    
    
    <cc>bcl</cc>
    
    
    <cc>jstodola</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>lorax-25.17-1 lorax-25.17-1.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2016-10-26 18:31:08</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9780881</commentid>
    <comment_count>0</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-10-11 06:17:33 -0400</bug_when>
    <thetext>When booting the F-25 Beta RC images I see 2 errors regarding OpenSSH key generation


from console
...
         Starting OpenSSH ecdsa Server Key Generation...   
[ [0;1;31mFAILED [0m] Failed to start OpenSSH ed25519 Server Key Generation.   
See &apos;systemctl status sshd-keygen@ed25519.service&apos; for details.   
[ [0;1;31mFAILED [0m] Failed to start OpenSSH ecdsa Server Key Generation.   
See &apos;systemctl status sshd-keygen@ecdsa.service&apos; for details.   
[ [0;32m  OK   [0m] Reached target sshd-keygen.target.   

from journalctl
...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting OpenSSH ed25519 Server Key Generation...
Oct 11 09:47:48 devel3.s390.bos.redhat.com kernel: audit: type=1130 audit(1476179268.003:96): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=systemd-up
Oct 11 09:47:48 devel3.s390.bos.redhat.com kernel: audit: type=1130 audit(1476179268.003:97): pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=rngd comm=
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1756]: sshd-keygen@ed25519.service: Failed at step EXEC spawning /usr/libexec/openssh/sshd-keygen: No such file or directory
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting System Logging Service...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting Hold until boot process finishes up...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting Anaconda NetworkManager configuration...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting Terminate Plymouth Boot Screen...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting Service enabling compressing RAM with zRam...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting pre-anaconda logging service...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Starting OpenSSH ecdsa Server Key Generation...
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ed25519.service: Main process exited, code=exited, status=203/EXEC
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Failed to start OpenSSH ed25519 Server Key Generation.
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1764]: sshd-keygen@ecdsa.service: Failed at step EXEC spawning /usr/libexec/openssh/sshd-keygen: No such file or directory
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ed25519.service: Unit entered failed state.
Oct 11 09:47:48 devel3.s390.bos.redhat.com audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=sshd-keygen@ed25519 comm=&quot;systemd&quot; ex
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ed25519.service: Failed with result &apos;exit-code&apos;.
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ecdsa.service: Main process exited, code=exited, status=203/EXEC
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Failed to start OpenSSH ecdsa Server Key Generation.
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ecdsa.service: Unit entered failed state.
Oct 11 09:47:48 devel3.s390.bos.redhat.com audit[1]: SERVICE_START pid=1 uid=0 auid=4294967295 ses=4294967295 subj=system_u:system_r:init_t:s0 msg=&apos;unit=sshd-keygen@ecdsa comm=&quot;systemd&quot; exe=
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: sshd-keygen@ecdsa.service: Failed with result &apos;exit-code&apos;.
Oct 11 09:47:48 devel3.s390.bos.redhat.com systemd[1]: Reached target sshd-keygen.target.
...

The solution can be adding the key generation to the postinstall lorax template
(https://github.com/rhinstaller/lorax/blob/master/share/templates.d/99-generic/runtime-postinstall.tmpl#L91), but my question is whether the generation could be omitted from image creation and left for runtime.

Version-Release number of selected component (if applicable):
lorax-25.15-1.fc25</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9782618</commentid>
    <comment_count>1</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-10-11 17:08:23 -0400</bug_when>
    <thetext>You certainly don&apos;t want to include keygen as part of the image creation process. Then everyone will get the same keys.

Make sure the iso you are using was created using lorax-25.16-1 or later.

*** This bug has been marked as a duplicate of bug 1378378 ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9782667</commentid>
    <comment_count>2</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-10-11 17:35:00 -0400</bug_when>
    <thetext>(In reply to Brian Lane from comment #1)
&gt; You certainly don&apos;t want to include keygen as part of the image creation
&gt; process. Then everyone will get the same keys.

Shouldn&apos;t we then remove the whole key-creation section in runtime-postinstall.tmpl for s390(x) mentioned above?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9782685</commentid>
    <comment_count>3</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-10-11 17:55:47 -0400</bug_when>
    <thetext>(In reply to Dan Horák from comment #2)
&gt; (In reply to Brian Lane from comment #1)
&gt; &gt; You certainly don&apos;t want to include keygen as part of the image creation
&gt; &gt; process. Then everyone will get the same keys.
&gt; 
&gt; Shouldn&apos;t we then remove the whole key-creation section in
&gt; runtime-postinstall.tmpl for s390(x) mentioned above?

I would think so, but since I&apos;m not exactly sure *why* that code is there someone with s390 access will have to give it a try to make sure it doesn&apos;t break anything.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9784373</commentid>
    <comment_count>4</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-10-12 08:18:53 -0400</bug_when>
    <thetext>Log from booting a refreshed install.img after updating post-install lorax template

...
         Starting Anaconda NetworkManager configuration...
         Starting Service enabling compressing RAM with zRam...
         Starting Terminate Plymouth Boot Screen...
         Starting pre-anaconda logging service...
         Starting OpenSSH ecdsa Server Key Generation...
[ [0;32m  OK   [0m] Started Hardware RNG Entropy Gatherer Daemon.
         Starting Hold until boot process finishes up...
         Starting OpenSSH ed25519 Server Key Generation...
         Starting OpenSSH rsa Server Key Generation...
         Starting System Logging Service...
         Starting Login Service...
[   33.533897] anaconda[1680]: Starting installer, one moment...
[   33.535137] anaconda[1680]: 12:02:42 Please ssh install@devel3 (a.b.c.d) to begin the install.

Will send a pull request ASAP.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9784834</commentid>
    <comment_count>5</comment_count>
    <who name="Dan Horák">dan</who>
    <bug_when>2016-10-12 09:58:00 -0400</bug_when>
    <thetext>See https://github.com/rhinstaller/lorax/pull/165 for the dropping of ssh keygen in the image.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9785336</commentid>
    <comment_count>6</comment_count>
    <who name="Brian Lane">bcl</who>
    <bug_when>2016-10-12 12:06:16 -0400</bug_when>
    <thetext>Thanks for testing that!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9803639</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-19 04:29:26 -0400</bug_when>
    <thetext>lorax-25.17-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2016-0a0a45fcbe</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9824877</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2016-10-26 18:31:08 -0400</bug_when>
    <thetext>lorax-25.17-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
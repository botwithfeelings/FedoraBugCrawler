<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1384871</bug_id>
          
          <creation_ts>2016-10-14 06:35:00 -0400</creation_ts>
          <short_desc>pflogsumm: many warnings when parsing logs with IPv6 addresses</short_desc>
          <delta_ts>2017-06-19 10:35:06 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>postfix</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</reporter>
          <assigned_to name="Jaroslav Škarvada">jskarvad</assigned_to>
          <cc>jskarvad</cc>
    
    
    <cc>olysonek</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>postfix-3.1.4-2.fc25 postfix-3.2.2-1.fc26</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-06-16 14:51:57</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>9791373</commentid>
    <comment_count>0</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2016-10-14 06:35:13 -0400</bug_when>
    <thetext>Description of problem:
pflogsumm emits many warnings (to stderr) when maillog contains IPv6 addresses.

Version-Release number of selected component (if applicable):
postfix-perl-scripts-3.0.7-1.fc23.x86_64

How reproducible:
Always.

Steps to Reproduce:
1. Given /var/log/maillog containing lines like:
Oct 13 00:33:24 doumeki postfix/smtpd[9148]: disconnect from localhost[::1] ehlo=1 mail=1 rcpt=1 data=1 commands=4
Oct 13 01:29:12 doumeki postfix/smtpd[14127]: disconnect from se01.ovh6.rpmfusion.net[2001:41d0:2:ad32::1] ehlo=1 mail=1 rcpt=1 data=1 quit=1 commands=5
Oct 13 02:21:47 doumeki postfix/smtpd[18076]: disconnect from mail-yb0-x22e.google.com[2607:f8b0:4002:c09::22e] ehlo=2 starttls=1 mail=1 rcpt=1 data=1 quit=1 commands=7
2. /usr/sbin/pflogsumm -q -d yesterday -h 10 --ignore_case --smtpd_warning_detail=0 --mailq --problems_first --smtpd_stats --verp_mung=2 --zero_fill /var/log/maillog

Actual results:
Use of uninitialized value $domain in string eq at /usr/sbin/pflogsumm line 1539, &lt;&gt; line 62693.
Use of uninitialized value $domain in substitution (s///) at /usr/sbin/pflogsumm line 1545, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 768, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 769, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 770, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 772, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 774, &lt;&gt; line 62693.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 773, &lt;&gt; line 62693.
Use of uninitialized value $domain in string eq at /usr/sbin/pflogsumm line 1539, &lt;&gt; line 63259.
Use of uninitialized value $domain in substitution (s///) at /usr/sbin/pflogsumm line 1545, &lt;&gt; line 63259.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 768, &lt;&gt; line 63259.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 772, &lt;&gt; line 63259.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 774, &lt;&gt; line 63259.
Use of uninitialized value $domain in string eq at /usr/sbin/pflogsumm line 1539, &lt;&gt; line 64377.
Use of uninitialized value $domain in substitution (s///) at /usr/sbin/pflogsumm line 1545, &lt;&gt; line 64377.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 768, &lt;&gt; line 64377.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 772, &lt;&gt; line 64377.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 774, &lt;&gt; line 64377.
Use of uninitialized value $hostID in hash element at /usr/sbin/pflogsumm line 773, &lt;&gt; line 64377.

(lines 62693, 63259 and 64377 are posted above)

Expected results:
No perl warnings in the output.

Additional info:
It looks like parsing in the gimme_domain function doesn&apos;t support IPv6 addresses. Here&apos;s a patch that fixes it for me:

--- /usr/sbin/pflogsumm	2016-10-03 13:39:01.000000000 +0200
+++ /root/bin/pflogsumm	2016-10-14 12:22:34.851472588 +0200
@@ -1529,7 +1529,7 @@
     # split domain/ipaddr into separates
     # newer versions of Postfix have them &quot;dom.ain[i.p.add.ress]&quot;
     # older versions of Postfix have them &quot;dom.ain/i.p.add.ress&quot;
-    unless((($domain, $ipAddr) = /^([^\[]+)\[((?:\d{1,3}\.){3}\d{1,3})\]/o) == 2 ||
+    unless((($domain, $ipAddr) = /^([^\[]+)\[((?:\d{1,3}\.){3}\d{1,3}|[0-9a-f:]+)\]/o) == 2 ||
            (($domain, $ipAddr) = /^([^\/]+)\/([0-9a-f.:]+)/oi) == 2) {
 	# more exhaustive method
         ($domain, $ipAddr) = /^([^\[\(\/]+)[\[\(\/]([^\]\)]+)[\]\)]?:?\s*$/o;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9791378</commentid>
    <comment_count>1</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2016-10-14 06:37:11 -0400</bug_when>
    <thetext>The pflogsumm script itself is version 1.1.3 and I noticed there&apos;s a newer version (1.1.5) on the upstream website (http://jimsun.linxnet.com/postfix_contrib.html), though it&apos;s labelled beta and has the same issue with IPv6.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9929020</commentid>
    <comment_count>2</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-25 04:37:55 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9930629</commentid>
    <comment_count>3</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2016-11-25 13:52:59 -0500</bug_when>
    <thetext>Still reproducible in F24:
postfix-perl-scripts-3.1.3-1.fc24.x86_64

pflogsumm script is unchanged from postfix-perl-scripts-3.0.7-1.fc23.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10496917</commentid>
    <comment_count>4</comment_count>
    <who name="Dominik &apos;Rathann&apos; Mierzejewski">dominik</who>
    <bug_when>2017-06-12 04:16:55 -0400</bug_when>
    <thetext>Still reproducible in F25:
postfix-perl-scripts-3.1.4-1.fc25.x86_64

pflogsumm script still unchanged. The above patch still applies. Please forward it upstream.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10502123</commentid>
    <comment_count>5</comment_count>
    <who name="Jaroslav Škarvada">jskarvad</who>
    <bug_when>2017-06-13 12:43:59 -0400</bug_when>
    <thetext>Thanks, patch sent upstream. I will apply it to f25+ and probably also update the script to 1.1.5 beta in rawhide.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10502390</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-13 14:16:18 -0400</bug_when>
    <thetext>postfix-3.2.1-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-9d3185b14b</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10502421</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-13 14:28:27 -0400</bug_when>
    <thetext>postfix-3.1.4-2.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-839f2b365c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10504477</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-14 05:44:54 -0400</bug_when>
    <thetext>postfix-3.2.2-1.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-48ae31f568</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10508976</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 06:57:41 -0400</bug_when>
    <thetext>postfix-3.1.4-2.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-839f2b365c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10509812</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-15 09:59:54 -0400</bug_when>
    <thetext>postfix-3.2.2-1.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-48ae31f568</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10514096</commentid>
    <comment_count>11</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-16 14:51:57 -0400</bug_when>
    <thetext>postfix-3.1.4-2.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10518880</commentid>
    <comment_count>12</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-06-19 10:35:06 -0400</bug_when>
    <thetext>postfix-3.2.2-1.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
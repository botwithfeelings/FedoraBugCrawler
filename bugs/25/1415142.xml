<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1415142</bug_id>
          
          <creation_ts>2017-01-20 06:58:00 -0500</creation_ts>
          <short_desc>Broken downgrade path from nss-3.28.1-1.2 to nss-3.27.0-1.3</short_desc>
          <delta_ts>2017-02-17 06:14:16 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>dnf</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>RAWHIDE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>EasyFix, Reopened, Triaged</keywords>
          <priority>high</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Babinsky">mbabinsk</reporter>
          <assigned_to>rpm-software-management</assigned_to>
          <cc>dueno</cc>
    
    
    <cc>emaldona</cc>
    
    
    <cc>hkario</cc>
    
    
    <cc>jmracek</cc>
    
    
    <cc>kdudka</cc>
    
    
    <cc>kengert</cc>
    
    
    <cc>mbabinsk</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>rpm-software-management</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-17 06:14:16</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10083117</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Babinsky">mbabinsk</who>
    <bug_when>2017-01-20 06:58:15 -0500</bug_when>
    <thetext>Description of problem:

In an attempt to amend https://bugzilla.redhat.com/show_bug.cgi?id=1415140 an attempt was made do downgrade the library to the previous working version. However, this was not possible due to file ownership conflicts:

{{{
[root@master1 ~]# dnf clean all
234 files removed
[root@master1 ~]# dnf downgrade -y nss --allowerasing
Fedora 25 - x86_64                                                                   86 MB/s |  50 MB     00:00    
Fedora 25 - x86_64 - Updates                                                         85 MB/s |  16 MB     00:00    
Fedora 25 - Test Updates Source                                                      14 MB/s | 489 kB     00:00    
Fedora 25 - x86_64 - Test Updates                                                    84 MB/s | 7.1 MB     00:00    
Fedora 25 - x86_64 - Test Updates Debug                                              56 MB/s | 1.5 MB     00:00    
Failed to synchronize cache for repo &apos;group_freeipa-freeipa-master&apos;, disabling.
Dependencies resolved.
====================================================================================================================
 Package                        Arch               Version                        Repository                   Size
====================================================================================================================
Installing:
 glibc                          i686               2.24-4.fc25                    updates                     4.0 M
 libcrypt-nss                   i686               2.24-4.fc25                    updates                      43 k
 nspr                           i686               4.13.1-1.fc25                  fedora                      138 k
 nss                            i686               3.28.1-1.2.fc25                updates-testing             866 k
 nss-softokn                    i686               3.28.1-1.0.fc25                updates-testing             402 k
 nss-softokn-freebl             i686               3.28.1-1.0.fc25                updates-testing             215 k
 nss-util                       i686               3.28.1-1.0.fc25                updates-testing              82 k
 sqlite-libs                    i686               3.14.2-1.fc25                  fedora                      470 k
 zlib                           i686               1.2.8-10.fc24                  fedora                       98 k
Downgrading:
 nss                            x86_64             3.27.0-1.3.fc25                updates                     846 k
 nss-tools                      x86_64             3.27.0-1.3.fc25                updates                     498 k

Transaction Summary
====================================================================================================================
Install    9 Packages
Downgrade  2 Packages

Total download size: 7.6 M
Downloading Packages:
(1/11): nss-tools-3.27.0-1.3.fc25.x86_64.rpm                                         29 MB/s | 498 kB     00:00    
(2/11): nss-3.27.0-1.3.fc25.x86_64.rpm                                               35 MB/s | 846 kB     00:00    
(3/11): nss-3.28.1-1.2.fc25.i686.rpm                                                 30 MB/s | 866 kB     00:00    
(4/11): nspr-4.13.1-1.fc25.i686.rpm                                                  21 MB/s | 138 kB     00:00    
(5/11): zlib-1.2.8-10.fc24.i686.rpm                                                  12 MB/s |  98 kB     00:00    
(6/11): nss-softokn-3.28.1-1.0.fc25.i686.rpm                                         14 MB/s | 402 kB     00:00    
(7/11): glibc-2.24-4.fc25.i686.rpm                                                   63 MB/s | 4.0 MB     00:00    
(8/11): sqlite-libs-3.14.2-1.fc25.i686.rpm                                          9.7 MB/s | 470 kB     00:00    
(9/11): nss-softokn-freebl-3.28.1-1.0.fc25.i686.rpm                                 7.7 MB/s | 215 kB     00:00    
(10/11): libcrypt-nss-2.24-4.fc25.i686.rpm                                           15 MB/s |  43 kB     00:00    
(11/11): nss-util-3.28.1-1.0.fc25.i686.rpm                                           13 MB/s |  82 kB     00:00    
--------------------------------------------------------------------------------------------------------------------
Total                                                                               2.0 MB/s | 7.6 MB     00:03     
Running transaction check
Transaction check succeeded.
Running transaction test
The downloaded packages were saved in cache until the next successful transaction.
You can remove cached packages by executing &apos;dnf clean packages&apos;.
Error: Transaction check error:
  file /usr/share/man/man5/cert8.db.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64
  file /usr/share/man/man5/cert9.db.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64
  file /usr/share/man/man5/key3.db.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64
  file /usr/share/man/man5/key4.db.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64
  file /usr/share/man/man5/pkcs11.txt.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64
  file /usr/share/man/man5/secmod.db.5.gz conflicts between attempted installs of nss-3.28.1-1.2.fc25.i686 and nss-3.27.0-1.3.fc25.x86_64

Error Summary
}}}

Version-Release number of selected component (if applicable):

See errors reported above.

How reproducible:


Steps to Reproduce:
1. update nss to nss-3.28.1-1.2
2. dnf clean all
3. dnf downgrade -y nss --allowerasing

Actual results:

downgrade fails due to file ownership conflicts.

Expected results:

nss is downgraded to previous versions along its&apos; dependencies</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10083419</commentid>
    <comment_count>1</comment_count>
    <who name="Kai Engert (:kaie)">kengert</who>
    <bug_when>2017-01-20 08:06:24 -0500</bug_when>
    <thetext>Hubert found out it works if all required packages are given to dnf explicitly.

dnf downgrade nss-devel nss-util nss-util-devel nss-softokn nss-sysinit nss-softokn-freebl-devel nss nss-softokn-devel nss-tools nss-softokn-devel

dnf apparently doesn&apos;t figure it out automatically.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10083464</commentid>
    <comment_count>2</comment_count>
    <who name="Igor Gnatenko">ignatenko</who>
    <bug_when>2017-01-20 08:17:31 -0500</bug_when>
    <thetext>

*** This bug has been marked as a duplicate of bug 1326157 ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10083510</commentid>
    <comment_count>3</comment_count>
    <who name="Kai Engert (:kaie)">kengert</who>
    <bug_when>2017-01-20 08:34:29 -0500</bug_when>
    <thetext>Are you sure it&apos;s a duplicate? 

In the given scenario, *NO* i686 packages were installed. The downgrade attempted to install i686 packages with no apparent reason.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10083518</commentid>
    <comment_count>4</comment_count>
    <who name="Igor Gnatenko">ignatenko</who>
    <bug_when>2017-01-20 08:37:17 -0500</bug_when>
    <thetext>(In reply to Kai Engert (:kaie) from comment #3)
&gt; Are you sure it&apos;s a duplicate? 
&gt; 
&gt; In the given scenario, *NO* i686 packages were installed. The downgrade
&gt; attempted to install i686 packages with no apparent reason.
hmm, right.

Actually it means that you don&apos;t have %{?_isa} somewhere in requires.

Please re-run with --debugsolver and attach debugdata directory.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10106602</commentid>
    <comment_count>5</comment_count>
    <who name="Martin Babinsky">mbabinsk</who>
    <bug_when>2017-01-30 12:19:39 -0500</bug_when>
    <thetext>Link to the (rather hefty) debugdata from the failed downgrade here:

https://mbabinsk.fedorapeople.org/f25_nss_dowgrade_debugdata.zip</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10123403</commentid>
    <comment_count>6</comment_count>
    <who name="Honza Silhan">jsilhan</who>
    <bug_when>2017-02-06 07:22:00 -0500</bug_when>
    <thetext>Can you please try that with DNF-2.0 in f26?

we should put ALLOW_DOWNGRADE flag to solver in command downgrade or when --allowerasing is set.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10157276</commentid>
    <comment_count>7</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-02-17 05:54:31 -0500</bug_when>
    <thetext>Please downgrade command was completely refactored (including added ALLOW_DOWNGRADE flag). Please can you try the latest version from rawhide (fc26) or from our testing repository (dnf copr enable rpmsoftwaremanagement/dnf-nightly) where are version for fc24+. 
Thanks a lot

Jaroslav</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10157281</commentid>
    <comment_count>8</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-02-17 05:58:02 -0500</bug_when>
    <thetext>One additional information, please try to run downgrade command without --allowerasing option. Now it allows auto downgrade of dependencies and solver also prefers downgrade from package removal (without --allowerasing option it cannot remove any package).

Jaroslav</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10157315</commentid>
    <comment_count>9</comment_count>
    <who name="Jaroslav Mracek">jmracek</who>
    <bug_when>2017-02-17 06:10:18 -0500</bug_when>
    <thetext>And I cannot reproduce it with following versions:

dnf-2.1.0-1.git.3.6c48a55.fc25.noarch
libsolv-0.6.25-1.fc25.x86_64
libdnf-0.7.3-1.fc25.x86_64

Probably the problem is already fixed as I mentioned above or I have a different system setup.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10157331</commentid>
    <comment_count>10</comment_count>
    <who name="Igor Gnatenko">ignatenko</who>
    <bug_when>2017-02-17 06:14:16 -0500</bug_when>
    <thetext>(In reply to Jaroslav Mracek from comment #9)
&gt; And I cannot reproduce it with following versions:
&gt; 
&gt; dnf-2.1.0-1.git.3.6c48a55.fc25.noarch
&gt; libsolv-0.6.25-1.fc25.x86_64
&gt; libdnf-0.7.3-1.fc25.x86_64
&gt; 
&gt; Probably the problem is already fixed as I mentioned above or I have a
&gt; different system setup.

You definitely have different setup, but actually bug has been fixed.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
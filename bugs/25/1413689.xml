<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1413689</bug_id>
          
          <creation_ts>2017-01-16 11:42:00 -0500</creation_ts>
          <short_desc>Monitors and dual monitors not recognized after kernel 4.9.3-200.fc25.x86_64 update</short_desc>
          <delta_ts>2017-01-20 16:29:41 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>xorg-x11-drv-ati</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="SP">scp.stjohn</reporter>
          <assigned_to name="X/OpenGL Maintenance List">xgl-maint</assigned_to>
          <cc>gansalmon</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jkastner</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>labbott</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>mchehab</cc>
    
    
    <cc>scp.stjohn</cc>
    
    
    <cc>xgl-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>firmware-20161205-69.git91ddce49.fc25.noarch</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-01-20 16:29:41</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10067155</commentid>
    <comment_count>0</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-16 11:42:32 -0500</bug_when>
    <thetext>Description of problem:
After reboot with kernel 4.9.3-200.fc25.x86_64 monitors and dual monitor display is not recognized.  The Display Settings in KDE Plasma will only show a &quot;default&quot; monitor and the same display appears on the screen of both monitors.  Reverting to the previous kernel 4.8.16-300.fc25.x86_64 restores the settings.

Version-Release number of selected component (if applicable):
kernel 4.9.3-200.fc25.x86_64
KDE Plasma 5.8.5

How reproducible:
Always

Steps to Reproduce:
1. boot with kernel  4.9.3-200.fc25.x86_64
2. 
3.

Actual results:
Dual monitors recognized only as &quot;default&quot;
Identical display and cursor appears on both monitors synchonously

Expected results:
Dual onitors should be individually identified with unique displays on both monitors and one them configured as Primary display.


Additional info:</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10067507</commentid>
    <comment_count>1</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-01-16 13:31:17 -0500</bug_when>
    <thetext>Can you give details about your graphics hardware so the correct people can look at this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10067568</commentid>
    <comment_count>2</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-16 13:44:13 -0500</bug_when>
    <thetext>Yes - I should have included that:
Advanced Micro Devices, Inc. [AMD/ATI] Tonga PRO [Radeon R9 285/380] (rev f1)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10068394</commentid>
    <comment_count>3</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-01-16 19:04:34 -0500</bug_when>
    <thetext>Thank you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073254</commentid>
    <comment_count>4</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-17 14:32:25 -0500</bug_when>
    <thetext>(In reply to Laura Abbott from comment #3)
&gt; Thank you.

Laura, I now find that I cannot boot into runlevel 3 with this kernel.  The monitors go into suspend mode and the computer just hangs.  No problem with the previous kernel.
Booting into runlevel 5 with kernel 4.9.3-200.fc25.x86_64 I see this in dmesg:

[    1.637167] [drm] amdgpu: ttm finalized
[    1.637170] amdgpu 0000:01:00.0: Fatal error during GPU init
[    1.637245] [drm] amdgpu: finishing device.
[    1.637246] [TTM] Memory type 2 has not been initialized

Is that relevant?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073363</commentid>
    <comment_count>5</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-17 15:12:54 -0500</bug_when>
    <thetext>Here is a comparison of dmesg from the recent and previous kernels

[with kernel  4.9.3-200.fc25.x86_64]

bash-4.3$ sudo dmesg |grep amdgpu 
[    1.528771] [drm] amdgpu kernel modesetting enabled.
[    1.537242] amdgpu 0000:01:00.0: Invalid PCI ROM header signature: expecting 0xaa55, got 0xffff
[    1.537509] amdgpu 0000:01:00.0: VRAM: 4096M 0x0000000000000000 - 0x00000000FFFFFFFF (4096M used)
[    1.537510] amdgpu 0000:01:00.0: GTT: 8004M 0x0000000100000000 - 0x00000002F44627FF
[    1.537521] [drm] amdgpu: 4096M of VRAM memory ready
[    1.537521] [drm] amdgpu: 8004M of GTT memory ready.
[    1.539167] amdgpu 0000:01:00.0: amdgpu: using MSI.
[    1.539183] [drm] amdgpu: irq initialized.
[    1.546444] amdgpu: powerplay initialized
[    1.546810] amdgpu 0000:01:00.0: fence driver on ring 0 use gpu addr 0x0000000100000008, cpu addr 0xffff96f006d01008
[    1.546836] amdgpu 0000:01:00.0: fence driver on ring 1 use gpu addr 0x0000000100000018, cpu addr 0xffff96f006d01018
[    1.546876] amdgpu 0000:01:00.0: fence driver on ring 2 use gpu addr 0x0000000100000028, cpu addr 0xffff96f006d01028
[    1.546958] amdgpu 0000:01:00.0: fence driver on ring 3 use gpu addr 0x0000000100000038, cpu addr 0xffff96f006d01038
[    1.547050] amdgpu 0000:01:00.0: fence driver on ring 4 use gpu addr 0x0000000100000048, cpu addr 0xffff96f006d01048
[    1.547142] amdgpu 0000:01:00.0: fence driver on ring 5 use gpu addr 0x0000000100000058, cpu addr 0xffff96f006d01058
[    1.547228] amdgpu 0000:01:00.0: fence driver on ring 6 use gpu addr 0x0000000100000068, cpu addr 0xffff96f006d01068
[    1.547268] amdgpu 0000:01:00.0: fence driver on ring 7 use gpu addr 0x0000000100000078, cpu addr 0xffff96f006d01078
[    1.547310] amdgpu 0000:01:00.0: fence driver on ring 8 use gpu addr 0x0000000100000088, cpu addr 0xffff96f006d01088
[    1.547386] amdgpu 0000:01:00.0: fence driver on ring 9 use gpu addr 0x0000000100000098, cpu addr 0xffff96f006d01098
[    1.547418] amdgpu 0000:01:00.0: fence driver on ring 10 use gpu addr 0x00000001000000a8, cpu addr 0xffff96f006d010a8
[    1.547756] amdgpu 0000:01:00.0: fence driver on ring 11 use gpu addr 0x0000000001033f40, cpu addr 0xffffaf980244ef40
[    1.547883] amdgpu 0000:01:00.0: fence driver on ring 12 use gpu addr 0x00000001000000c8, cpu addr 0xffff96f006d010c8
[    1.547913] amdgpu 0000:01:00.0: fence driver on ring 13 use gpu addr 0x00000001000000d8, cpu addr 0xffff96f006d010d8
[    1.547954] amdgpu 0000:01:00.0: fence driver on ring 14 use gpu addr 0x00000001000000e8, cpu addr 0xffff96f006d010e8
[    1.581232] amdgpu 0000:01:00.0: Direct firmware load for amdgpu/tonga_k_smc.bin failed with error -2
[    1.581256] [drm:amdgpu_cgs_get_firmware_info [amdgpu]] *ERROR* Failed to request firmware
[    1.581752] [drm:amdgpu_device_init [amdgpu]] *ERROR* hw_init of IP block &lt;amdgpu_powerplay&gt; failed -22
[    1.581806] amdgpu 0000:01:00.0: amdgpu_init failed
[    1.637123] Modules linked in: amdkfd amd_iommu_v2 amdgpu(+) i2c_algo_bit drm_kms_helper ttm drm crc32c_intel r8169 serio_raw mii fjes
[    1.637166]  [&lt;ffffffffc01e2932&gt;] amdgpu_ttm_mem_global_release+0x12/0x20 [amdgpu]
[    1.637188]  [&lt;ffffffffc01e437c&gt;] amdgpu_ttm_fini+0x13c/0x1d0 [amdgpu]
[    1.637200]  [&lt;ffffffffc01e6222&gt;] amdgpu_bo_fini+0x12/0x40 [amdgpu]
[    1.637215]  [&lt;ffffffffc0203ed2&gt;] gmc_v8_0_sw_fini+0x42/0x50 [amdgpu]
[    1.637227]  [&lt;ffffffffc01d2422&gt;] amdgpu_fini+0x292/0x410 [amdgpu]
[    1.637239]  [&lt;ffffffffc01d4139&gt;] amdgpu_device_init+0xce9/0x13a0 [amdgpu]
[    1.637252]  [&lt;ffffffffc01d6a3b&gt;] amdgpu_driver_load_kms+0x5b/0x210 [amdgpu]
[    1.637274]  [&lt;ffffffffc01d14ac&gt;] amdgpu_pci_probe+0xbc/0xe0 [amdgpu]
[    1.637306]  [&lt;ffffffffc02ea095&gt;] amdgpu_init+0x95/0xa8 [amdgpu]
[    1.637369] [drm] amdgpu: ttm finalized                                                                                                                                    
[    1.637371] amdgpu 0000:01:00.0: Fatal error during GPU init                                                                                                               
[    1.637427] [drm] amdgpu: finishing device.                                                                                                                                
[    1.637883] amdgpu: probe of 0000:01:00.0 failed with error -22  



[With 4.8.16-300.fc25.x86_64 ]
bash-4.3$ sudo dmesg |grep amdgpu
[    1.569975] [drm] amdgpu kernel modesetting enabled.
[    1.578380] amdgpu 0000:01:00.0: Invalid PCI ROM header signature: expecting 0xaa55, got 0xffff
[    1.578705] amdgpu 0000:01:00.0: VRAM: 4096M 0x0000000000000000 - 0x00000000FFFFFFFF (4096M used)
[    1.578706] amdgpu 0000:01:00.0: GTT: 4096M 0x0000000100000000 - 0x00000001FFFFFFFF
[    1.578775] [drm] amdgpu: 4096M of VRAM memory ready
[    1.578776] [drm] amdgpu: 4096M of GTT memory ready.
[    1.580418] amdgpu 0000:01:00.0: amdgpu: using MSI.
[    1.580433] [drm] amdgpu: irq initialized.
[    1.587481] amdgpu: powerplay initialized
[    1.587837] amdgpu 0000:01:00.0: fence driver on ring 0 use gpu addr 0x0000000100000008, cpu addr 0xffff8b1f8690e008
[    1.587897] amdgpu 0000:01:00.0: fence driver on ring 1 use gpu addr 0x0000000100000018, cpu addr 0xffff8b1f8690e018
[    1.587949] amdgpu 0000:01:00.0: fence driver on ring 2 use gpu addr 0x0000000100000028, cpu addr 0xffff8b1f8690e028
[    1.587998] amdgpu 0000:01:00.0: fence driver on ring 3 use gpu addr 0x0000000100000038, cpu addr 0xffff8b1f8690e038
[    1.588042] amdgpu 0000:01:00.0: fence driver on ring 4 use gpu addr 0x0000000100000048, cpu addr 0xffff8b1f8690e048
[    1.588120] amdgpu 0000:01:00.0: fence driver on ring 5 use gpu addr 0x0000000100000058, cpu addr 0xffff8b1f8690e058
[    1.588155] amdgpu 0000:01:00.0: fence driver on ring 6 use gpu addr 0x0000000100000068, cpu addr 0xffff8b1f8690e068
[    1.588198] amdgpu 0000:01:00.0: fence driver on ring 7 use gpu addr 0x0000000100000078, cpu addr 0xffff8b1f8690e078
[    1.588230] amdgpu 0000:01:00.0: fence driver on ring 8 use gpu addr 0x0000000100000088, cpu addr 0xffff8b1f8690e088
[    1.588287] amdgpu 0000:01:00.0: fence driver on ring 9 use gpu addr 0x0000000100000098, cpu addr 0xffff8b1f8690e098
[    1.588311] amdgpu 0000:01:00.0: fence driver on ring 10 use gpu addr 0x00000001000000a8, cpu addr 0xffff8b1f8690e0a8
[    1.588688] amdgpu 0000:01:00.0: fence driver on ring 11 use gpu addr 0x0000000000890f40, cpu addr 0xffffa0a681e4ef40
[    1.588808] amdgpu 0000:01:00.0: fence driver on ring 12 use gpu addr 0x00000001000000c8, cpu addr 0xffff8b1f8690e0c8
[    1.588835] amdgpu 0000:01:00.0: fence driver on ring 13 use gpu addr 0x00000001000000d8, cpu addr 0xffff8b1f8690e0d8
[    2.162030] fbcon: amdgpudrmfb (fb0) is primary device
[    2.482033] amdgpu 0000:01:00.0: fb0: amdgpudrmfb frame buffer device
[    2.490912] [drm] Initialized amdgpu 3.3.0 20150101 for 0000:01:00.0 on minor 0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073612</commentid>
    <comment_count>6</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-17 16:08:47 -0500</bug_when>
    <thetext>Does it not seem that the existing AMD opensource driver maybe incompatible with the 4.9.3-200.fc25.x86_64 kernel and needs updating?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073686</commentid>
    <comment_count>7</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-01-17 16:43:02 -0500</bug_when>
    <thetext>https://koji.fedoraproject.org/koji/taskinfo?taskID=17314239 I pulled in a couple of &apos;low hanging&apos; ATI graphics fixes to this build, can you please test this? This update will also be available in bodhi.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073783</commentid>
    <comment_count>8</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-17 16:53:22 -0500</bug_when>
    <thetext>Where exactly to download it?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10073805</commentid>
    <comment_count>9</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-17 16:58:37 -0500</bug_when>
    <thetext>(In reply to Laura Abbott from comment #7)
&gt; https://koji.fedoraproject.org/koji/taskinfo?taskID=17314239 I pulled in a
&gt; couple of &apos;low hanging&apos; ATI graphics fixes to this build, can you please
&gt; test this? This update will also be available in bodhi.

I only see kernel-4.9.4-200.fc25 in bodhi.  Where is the link to download *201?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10076968</commentid>
    <comment_count>10</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-18 10:34:11 -0500</bug_when>
    <thetext>I downloaded your 4.9.4-201 kernel packages but was unable to install them because of conflicts with existing packages.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10077341</commentid>
    <comment_count>11</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-18 12:11:01 -0500</bug_when>
    <thetext>
(In reply to Laura Abbott from comment #7)
&gt; https://koji.fedoraproject.org/koji/taskinfo?taskID=17314239 I pulled in a
&gt; couple of &apos;low hanging&apos; ATI graphics fixes to this build, can you please
&gt; test this? This update will also be available in bodhi.

I was able to install the following packages:
kernel-4.9.4-201.fc25.x86_64.rpm kernel-core-4.9.4-201.fc25.x86_64.rpm kernel-modules-4.9.4-201.fc25.x86_64.rpm kernel-modules-extra-4.9.4-201.fc25.x86_64.rpm  kernel-devel-4.9.4-201.fc25.x86_64.rpm kernel-tools-libs-4.9.4-201.fc25.x86_64.rpm (--force) kernel-tools-4.9.4-201.fc25.x86_64.rpm (--force)

I was unable to install the other packages either because of conflicts with the previous installed kernel.  Booting into kernel-4.9.4-201.fc25 does not resolve the problem of duplicate displays on the dual monitors and the individual monitors unrecognised.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10080468</commentid>
    <comment_count>12</comment_count>
    <who name="SP">scp.stjohn</who>
    <bug_when>2017-01-19 09:47:43 -0500</bug_when>
    <thetext>Looked at the output of dmesg|grep amdgpu again and there it is and apparently a previously reported bug:

&quot;Direct firmware load for amdgpu/tonga_k_smc.bin failed with error -2&quot;
The last firmware update for Fedora is sometime in September 2016 and it does not include tonga_k_smc.bin.
 
Here is the bug report: https://bugzilla.redhat.com/show_bug.cgi?id=1413488
The updated firmware has been submitted to bodhi
https://bodhi.fedoraproject.org/updates/FEDORA-2017-2adfb69272

The solution is to install the updated firmware from Koji; rmmod amdgpu and modprobe amdgpu to reload the module. This corrects the problem.  In order for it not to reappear on reboot necessitates removing and reinstalling the recent kernel.  

So this could be marked as solved except that updated firmware package should be distributed before kernel updates.

Thank you Laura Abbott for your work on the kernel development.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
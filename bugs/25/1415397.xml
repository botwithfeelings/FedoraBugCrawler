<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1415397</bug_id>
          
          <creation_ts>2017-01-21 08:35:00 -0500</creation_ts>
          <short_desc>Problem with ds2490 kernel module</short_desc>
          <delta_ts>2017-02-14 10:49:44 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>kernel</component>
          <version>25</version>
          <rep_platform>x86_64</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>urgent</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Paweł">pmarciniak</reporter>
          <assigned_to name="Kernel Maintainer List">kernel-maint</assigned_to>
          <cc>duncan</cc>
    
    
    <cc>gansalmon</cc>
    
    
    <cc>ichavero</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>jkastner</cc>
    
    
    <cc>jonathan</cc>
    
    
    <cc>kernel-maint</cc>
    
    
    <cc>labbott</cc>
    
    
    <cc>madhu.chinakonda</cc>
    
    
    <cc>mchehab</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>kernel-4.9.9-200.fc25</cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-13 17:23:48</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10085948</commentid>
    <comment_count>0</comment_count>
    <who name="Paweł">pmarciniak</who>
    <bug_when>2017-01-21 08:35:40 -0500</bug_when>
    <thetext>Description of problem:
kernel module ds2490 stop working

Version-Release number of selected component (if applicable):
kernel-4.9.x

How reproducible:
Run kernel 4.9.x with ds2490 usb to 1- wire bridge

Actual results:
ds2490 doesn&apos;t work, flooding log with errors like this
Jan 21 12:17:23 corsair.sunwire.eu kernel: Failed to read 1-wire data from 0x81: err=-11.
Jan 21 12:17:23 corsair.sunwire.eu kernel: Failed to read 1-wire data from 0x81: err=-11.
....

Expected results:
Work like in kernel 4.8.x

Additional info:
likely solution
https://www.spinics.net/lists/kernel/msg2425181.html

LOG
Jan 21 12:17:23 corsair.sunwire.eu kernel: usb 3-7: new full-speed USB device number 6 using xhci_hcd
Jan 21 12:17:23 corsair.sunwire.eu kernel: usb 3-7: New USB device found, idVendor=04fa, idProduct=2490
Jan 21 12:17:23 corsair.sunwire.eu kernel: usb 3-7: New USB device strings: Mfr=0, Product=0, SerialNumber=0
Jan 21 12:17:23 corsair.sunwire.eu mtp-probe[3766]: checking bus 3, device 6: &quot;/sys/devices/pci0000:00/0000:00:14.0/usb3/3-7&quot;
Jan 21 12:17:23 corsair.sunwire.eu mtp-probe[3766]: bus: 3, device: 6 was not an MTP device
Jan 21 12:17:23 corsair.sunwire.eu kernel: Driver for 1-wire Dallas network protocol.
Jan 21 12:17:23 corsair.sunwire.eu kernel: usbcore: registered new interface driver DS9490R
Jan 21 12:17:23 corsair.sunwire.eu kernel: ------------[ cut here ]------------
Jan 21 12:17:23 corsair.sunwire.eu kernel: WARNING: CPU: 4 PID: 3772 at drivers/usb/core/hcd.c:1584 usb_hcd_map_urb_for_dma+0x37f/0x570
Jan 21 12:17:23 corsair.sunwire.eu kernel: transfer buffer not dma capable
Jan 21 12:17:23 corsair.sunwire.eu kernel: Modules linked in: ds2490 wire vhost_net vhost macvtap macvlan xt_CHECKSUM iptable_mangle ipt_MASQUERADE nf_nat_masquerade_ipv4 iptable_nat nf_nat_ipv4 nf_nat tun bridge ebtable_filter ebtables ip6table_filter ip6_tables fuse nf_conntrack_
Jan 21 12:17:23 corsair.sunwire.eu kernel:  snd_seq mei_me snd_seq_device drm ie31200_edac mei lpc_ich shpchp edac_core snd_pcm snd_timer snd elan_i2c wmi soundcore snd_soc_sst_acpi snd_soc_sst_match i2c_designware_platform tpm_tis video dw_dmac spi_pxa2xx_platform i2c_designware_c
Jan 21 12:17:23 corsair.sunwire.eu kernel: CPU: 4 PID: 3772 Comm: w1_bus_master1 Not tainted 4.9.4-201.fc25.x86_64 #1
Jan 21 12:17:23 corsair.sunwire.eu kernel: Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./Z97 Extreme4, BIOS P2.50 07/27/2016
Jan 21 12:17:23 corsair.sunwire.eu kernel:  ffffc25f08bcf9e0 ffffffff993f3ddd ffffc25f08bcfa30 0000000000000000
Jan 21 12:17:23 corsair.sunwire.eu kernel:  ffffc25f08bcfa20 ffffffff990a202b 0000063000000001 ffff9fc6d8eb1cc0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  0000000000000000 ffff9fc6d1d60000 0000000000000002 ffff9fc6fb9a6000
Jan 21 12:17:23 corsair.sunwire.eu kernel: Call Trace:
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff993f3ddd&gt;] dump_stack+0x63/0x86
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990a202b&gt;] __warn+0xcb/0xf0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990a20af&gt;] warn_slowpath_fmt+0x5f/0x80
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995ec86f&gt;] usb_hcd_map_urb_for_dma+0x37f/0x570
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995ed05a&gt;] usb_hcd_submit_urb+0x35a/0xb50
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff991121a8&gt;] ? del_timer_sync+0x48/0x50
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff9922fac1&gt;] ? __slab_free+0xa1/0x2a0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990d9ee3&gt;] ? update_curr+0xf3/0x170
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990d6e05&gt;] ? pick_next_entity+0x85/0x130
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995eea04&gt;] usb_submit_urb+0x2f4/0x560
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990d3879&gt;] ? sched_clock_cpu+0x99/0xb0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995ef31e&gt;] usb_start_wait_urb+0x6e/0x170
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995ef86d&gt;] usb_bulk_msg+0xbd/0x160
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff995ef91e&gt;] usb_interrupt_msg+0xe/0x10
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc083c5a6&gt;] ds_recv_status_nodump.isra.6.constprop.8+0x76/0xd0 [ds2490]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc083c804&gt;] ds9490r_search+0x124/0x230 [ds2490]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc0831f20&gt;] ? w1_master_attribute_store_add+0xc0/0xc0 [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990cd132&gt;] ? check_preempt_curr+0x52/0x90
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990dbd9c&gt;] ? dequeue_task_fair+0x5ec/0x940
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff99025728&gt;] ? __switch_to+0x2a8/0x5c0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc0831f20&gt;] ? w1_master_attribute_store_add+0xc0/0xc0 [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc0834a12&gt;] w1_search_devices+0x32/0x3b [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc083287f&gt;] w1_search_process_cb+0x5f/0x100 [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc0832a7b&gt;] w1_process+0xdb/0x110 [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffffc08329a0&gt;] ? w1_process_callbacks+0x80/0x80 [wire]
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990c2569&gt;] kthread+0xd9/0xf0
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff990c2490&gt;] ? kthread_park+0x60/0x60
Jan 21 12:17:23 corsair.sunwire.eu kernel:  [&lt;ffffffff9981ced5&gt;] ret_from_fork+0x25/0x30
Jan 21 12:17:23 corsair.sunwire.eu kernel: ---[ end trace b3b79f03b6178313 ]---
Jan 21 12:17:23 corsair.sunwire.eu kernel: Failed to read 1-wire data from 0x81: err=-11.
Jan 21 12:17:23 corsair.sunwire.eu kernel: Failed to read 1-wire data from 0x81: err=-11.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10086599</commentid>
    <comment_count>1</comment_count>
      <attachid>1243292</attachid>
    <who name="Paweł">pmarciniak</who>
    <bug_when>2017-01-22 03:01:51 -0500</bug_when>
    <thetext>Created attachment 1243292
ds2490 dma able patch</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10086601</commentid>
    <comment_count>2</comment_count>
    <who name="Paweł">pmarciniak</who>
    <bug_when>2017-01-22 03:05:47 -0500</bug_when>
    <thetext>Another source of the patch https://lkml.org/lkml/2017/1/18/895
Patch works fine for me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10135007</commentid>
    <comment_count>3</comment_count>
    <who name="Laura Abbott">labbott</who>
    <bug_when>2017-02-09 10:46:02 -0500</bug_when>
    <thetext>I was hoping the maintainer would say something before bringing it in. I pulled this patch in to the 4.9.9 update and sent a reply to the list.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10136413</commentid>
    <comment_count>4</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-09 18:46:47 -0500</bug_when>
    <thetext>kernel-4.9.9-200.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-fb89ca752a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138759</commentid>
    <comment_count>5</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-10 11:23:46 -0500</bug_when>
    <thetext>kernel-4.9.9-200.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-fb89ca752a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10138848</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-10 11:44:09 -0500</bug_when>
    <thetext>kernel-4.9.9-100.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-92d84f68cf</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10140215</commentid>
    <comment_count>7</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-11 11:48:20 -0500</bug_when>
    <thetext>kernel-4.9.9-100.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-92d84f68cf</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10144536</commentid>
    <comment_count>8</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-13 17:23:48 -0500</bug_when>
    <thetext>kernel-4.9.9-200.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10144596</commentid>
    <comment_count>9</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-13 17:48:46 -0500</bug_when>
    <thetext>kernel-4.9.9-100.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10147071</commentid>
    <comment_count>10</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-02-14 10:49:44 -0500</bug_when>
    <thetext>kernel-4.9.9-200.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>1243292</attachid>
            <date>2017-01-22 03:01:00 -0500</date>
            <delta_ts>2017-01-22 03:01:51 -0500</delta_ts>
            <desc>ds2490 dma able patch</desc>
            <filename>ds2490-dma-able.patch</filename>
            <type>text/plain</type>
            <size>8535</size>
            <attacher name="Paweł">pmarciniak</attacher>
            
              <data encoding="base64">RnJvbTogTWFjaWVqIFMuIFN6bWlnaWVybyA8bWFpbEBtYWNpZWouc3ptaWdpZXJvLm5hbWU+ClNp
Z25lZC1vZmYtYnk6IE1hY2llaiBTLiBTem1pZ2llcm8gPG1haWxAbWFjaWVqLnN6bWlnaWVyby5u
YW1lPgpTdWJqZWN0OiBkczI0OTAgVVNCIHRyYW5zZmVyIGJ1ZmZlcnMgbmVlZCB0byBiZSBETUFh
YmxlCgotLS0KIGRyaXZlcnMvdzEvbWFzdGVycy9kczI0OTAuYyB8IDE0MiArKysrKysrKysrKysr
KysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDg0IGluc2Vy
dGlvbnMoKyksIDU4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdzEvbWFzdGVy
cy9kczI0OTAuYyBiL2RyaXZlcnMvdzEvbWFzdGVycy9kczI0OTAuYwotLS0gYS9kcml2ZXJzL3cx
L21hc3RlcnMvZHMyNDkwLmMKKysrIGIvZHJpdmVycy93MS9tYXN0ZXJzL2RzMjQ5MC5jCkBAIC0x
NTMsNiArMTUzLDkgQEAgc3RydWN0IGRzX2RldmljZQogCSAqLwogCXUxNgkJCXNwdV9iaXQ7CiAK
Kwl1OAkJCXN0X2J1ZltTVF9TSVpFXTsKKwl1OAkJCWJ5dGVfYnVmOworCiAJc3RydWN0IHcxX2J1
c19tYXN0ZXIJbWFzdGVyOwogfTsKIApAQCAtMTc0LDcgKzE3Nyw2IEBAIHN0cnVjdCBkc19zdGF0
dXMKIAl1OAkJCWRhdGFfaW5fYnVmZmVyX3N0YXR1czsKIAl1OAkJCXJlc2VydmVkMTsKIAl1OAkJ
CXJlc2VydmVkMjsKLQogfTsKIAogc3RhdGljIHN0cnVjdCB1c2JfZGV2aWNlX2lkIGRzX2lkX3Rh
YmxlIFtdID0gewpAQCAtMjQ0LDI4ICsyNDYsNiBAQCBzdGF0aWMgaW50IGRzX3NlbmRfY29udHJv
bChzdHJ1Y3QgZHNfZGV2aWNlICpkZXYsIHUxNiB2YWx1ZSwgdTE2IGluZGV4KQogCXJldHVybiBl
cnI7CiB9CiAKLXN0YXRpYyBpbnQgZHNfcmVjdl9zdGF0dXNfbm9kdW1wKHN0cnVjdCBkc19kZXZp
Y2UgKmRldiwgc3RydWN0IGRzX3N0YXR1cyAqc3QsCi0JCQkJIHVuc2lnbmVkIGNoYXIgKmJ1Ziwg
aW50IHNpemUpCi17Ci0JaW50IGNvdW50LCBlcnI7Ci0KLQltZW1zZXQoc3QsIDAsIHNpemVvZigq
c3QpKTsKLQotCWNvdW50ID0gMDsKLQllcnIgPSB1c2JfaW50ZXJydXB0X21zZyhkZXYtPnVkZXYs
IHVzYl9yY3ZpbnRwaXBlKGRldi0+dWRldiwKLQkJZGV2LT5lcFtFUF9TVEFUVVNdKSwgYnVmLCBz
aXplLCAmY291bnQsIDEwMDApOwotCWlmIChlcnIgPCAwKSB7Ci0JCXByX2VycigiRmFpbGVkIHRv
IHJlYWQgMS13aXJlIGRhdGEgZnJvbSAweCV4OiBlcnI9JWQuXG4iLAotCQkgICAgICAgZGV2LT5l
cFtFUF9TVEFUVVNdLCBlcnIpOwotCQlyZXR1cm4gZXJyOwotCX0KLQotCWlmIChjb3VudCA+PSBz
aXplb2YoKnN0KSkKLQkJbWVtY3B5KHN0LCBidWYsIHNpemVvZigqc3QpKTsKLQotCXJldHVybiBj
b3VudDsKLX0KLQogc3RhdGljIGlubGluZSB2b2lkIGRzX3ByaW50X21zZyh1bnNpZ25lZCBjaGFy
ICpidWYsIHVuc2lnbmVkIGNoYXIgKnN0ciwgaW50IG9mZikKIHsKIAlwcl9pbmZvKCIlNDVzOiAl
OHhcbiIsIHN0ciwgYnVmW29mZl0pOwpAQCAtMzI0LDYgKzMwNCwzNSBAQCBzdGF0aWMgdm9pZCBk
c19kdW1wX3N0YXR1cyhzdHJ1Y3QgZHNfZGV2aWNlICpkZXYsIHVuc2lnbmVkIGNoYXIgKmJ1Ziwg
aW50IGNvdW50KQogCX0KIH0KIAorc3RhdGljIGludCBkc19yZWN2X3N0YXR1cyhzdHJ1Y3QgZHNf
ZGV2aWNlICpkZXYsIHN0cnVjdCBkc19zdGF0dXMgKnN0LAorCQkJICBib29sIGR1bXApCit7CisJ
aW50IGNvdW50LCBlcnI7CisKKwlpZiAoc3QpCisJCW1lbXNldChzdCwgMCwgc2l6ZW9mKCpzdCkp
OworCisJY291bnQgPSAwOworCWVyciA9IHVzYl9pbnRlcnJ1cHRfbXNnKGRldi0+dWRldiwKKwkJ
CQl1c2JfcmN2aW50cGlwZShkZXYtPnVkZXYsCisJCQkJCSAgICAgICBkZXYtPmVwW0VQX1NUQVRV
U10pLAorCQkJCWRldi0+c3RfYnVmLCBzaXplb2YoZGV2LT5zdF9idWYpLAorCQkJCSZjb3VudCwg
MTAwMCk7CisJaWYgKGVyciA8IDApIHsKKwkJcHJfZXJyKCJGYWlsZWQgdG8gcmVhZCAxLXdpcmUg
ZGF0YSBmcm9tIDB4JXg6IGVycj0lZC5cbiIsCisJCSAgICAgICBkZXYtPmVwW0VQX1NUQVRVU10s
IGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJaWYgKGR1bXApCisJCWRzX2R1bXBfc3RhdHVz
KGRldiwgZGV2LT5zdF9idWYsIGNvdW50KTsKKworCWlmIChzdCAmJiBjb3VudCA+PSBzaXplb2Yo
KnN0KSkKKwkJbWVtY3B5KHN0LCBkZXYtPnN0X2J1Ziwgc2l6ZW9mKCpzdCkpOworCisJcmV0dXJu
IGNvdW50OworfQorCiBzdGF0aWMgdm9pZCBkc19yZXNldF9kZXZpY2Uoc3RydWN0IGRzX2Rldmlj
ZSAqZGV2KQogewogCWRzX3NlbmRfY29udHJvbF9jbWQoZGV2LCBDVExfUkVTRVRfREVWSUNFLCAw
KTsKQEAgLTM0NCw3ICszNTMsNiBAQCBzdGF0aWMgdm9pZCBkc19yZXNldF9kZXZpY2Uoc3RydWN0
IGRzX2RldmljZSAqZGV2KQogc3RhdGljIGludCBkc19yZWN2X2RhdGEoc3RydWN0IGRzX2Rldmlj
ZSAqZGV2LCB1bnNpZ25lZCBjaGFyICpidWYsIGludCBzaXplKQogewogCWludCBjb3VudCwgZXJy
OwotCXN0cnVjdCBkc19zdGF0dXMgc3Q7CiAKIAkvKiBDYXJlZnVsIG9uIHNpemUuICBJZiBzaXpl
IGlzIGxlc3MgdGhhbiB3aGF0IGlzIGF2YWlsYWJsZSBpbgogCSAqIHRoZSBpbnB1dCBidWZmZXIs
IHRoZSBkZXZpY2UgZmFpbHMgdGhlIGJ1bGsgdHJhbnNmZXIgYW5kCkBAIC0zNTksMTQgKzM2Nyw5
IEBAIHN0YXRpYyBpbnQgZHNfcmVjdl9kYXRhKHN0cnVjdCBkc19kZXZpY2UgKmRldiwgdW5zaWdu
ZWQgY2hhciAqYnVmLCBpbnQgc2l6ZSkKIAllcnIgPSB1c2JfYnVsa19tc2coZGV2LT51ZGV2LCB1
c2JfcmN2YnVsa3BpcGUoZGV2LT51ZGV2LCBkZXYtPmVwW0VQX0RBVEFfSU5dKSwKIAkJCQlidWYs
IHNpemUsICZjb3VudCwgMTAwMCk7CiAJaWYgKGVyciA8IDApIHsKLQkJdTggYnVmW1NUX1NJWkVd
OwotCQlpbnQgY291bnQ7Ci0KIAkJcHJfaW5mbygiQ2xlYXJpbmcgZXAweCV4LlxuIiwgZGV2LT5l
cFtFUF9EQVRBX0lOXSk7CiAJCXVzYl9jbGVhcl9oYWx0KGRldi0+dWRldiwgdXNiX3JjdmJ1bGtw
aXBlKGRldi0+dWRldiwgZGV2LT5lcFtFUF9EQVRBX0lOXSkpOwotCi0JCWNvdW50ID0gZHNfcmVj
dl9zdGF0dXNfbm9kdW1wKGRldiwgJnN0LCBidWYsIHNpemVvZihidWYpKTsKLQkJZHNfZHVtcF9z
dGF0dXMoZGV2LCBidWYsIGNvdW50KTsKKwkJZHNfcmVjdl9zdGF0dXMoZGV2LCBOVUxMLCB0cnVl
KTsKIAkJcmV0dXJuIGVycjsKIAl9CiAKQEAgLTQwNCw3ICs0MDcsNiBAQCBpbnQgZHNfc3RvcF9w
dWxzZShzdHJ1Y3QgZHNfZGV2aWNlICpkZXYsIGludCBsaW1pdCkKIHsKIAlzdHJ1Y3QgZHNfc3Rh
dHVzIHN0OwogCWludCBjb3VudCA9IDAsIGVyciA9IDA7Ci0JdTggYnVmW1NUX1NJWkVdOwogCiAJ
ZG8gewogCQllcnIgPSBkc19zZW5kX2NvbnRyb2woZGV2LCBDVExfSEFMVF9FWEVfSURMRSwgMCk7
CkBAIC00MTMsNyArNDE1LDcgQEAgaW50IGRzX3N0b3BfcHVsc2Uoc3RydWN0IGRzX2RldmljZSAq
ZGV2LCBpbnQgbGltaXQpCiAJCWVyciA9IGRzX3NlbmRfY29udHJvbChkZXYsIENUTF9SRVNVTUVf
RVhFLCAwKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwotCQllcnIgPSBkc19yZWN2X3N0YXR1c19u
b2R1bXAoZGV2LCAmc3QsIGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCQllcnIgPSBkc19yZWN2X3N0YXR1
cyhkZXYsICZzdCwgZmFsc2UpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTQ1NiwxOCAr
NDU4LDE3IEBAIGludCBkc19kZXRlY3Qoc3RydWN0IGRzX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHNf
c3RhdHVzICpzdCkKIAogc3RhdGljIGludCBkc193YWl0X3N0YXR1cyhzdHJ1Y3QgZHNfZGV2aWNl
ICpkZXYsIHN0cnVjdCBkc19zdGF0dXMgKnN0KQogewotCXU4IGJ1ZltTVF9TSVpFXTsKIAlpbnQg
ZXJyLCBjb3VudCA9IDA7CiAKIAlkbyB7CiAJCXN0LT5zdGF0dXMgPSAwOwotCQllcnIgPSBkc19y
ZWN2X3N0YXR1c19ub2R1bXAoZGV2LCBzdCwgYnVmLCBzaXplb2YoYnVmKSk7CisJCWVyciA9IGRz
X3JlY3Zfc3RhdHVzKGRldiwgc3QsIGZhbHNlKTsKICNpZiAwCiAJCWlmIChlcnIgPj0gMCkgewog
CQkJaW50IGk7CiAJCQlwcmludGsoIjB4JXg6IGNvdW50PSVkLCBzdGF0dXM6ICIsIGRldi0+ZXBb
RVBfU1RBVFVTXSwgZXJyKTsKIAkJCWZvciAoaT0wOyBpPGVycjsgKytpKQotCQkJCXByaW50aygi
JTAyeCAiLCBidWZbaV0pOworCQkJCXByaW50aygiJTAyeCAiLCBkZXYtPnN0X2J1ZltpXSk7CiAJ
CQlwcmludGsoIlxuIik7CiAJCX0KICNlbmRpZgpAQCAtNDg1LDcgKzQ4Niw3IEBAIHN0YXRpYyBp
bnQgZHNfd2FpdF9zdGF0dXMoc3RydWN0IGRzX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHNfc3RhdHVz
ICpzdCkKIAkgKiBjYW4gZG8gc29tZXRoaW5nIHdpdGggaXQpLgogCSAqLwogCWlmIChlcnIgPiAx
NiB8fCBjb3VudCA+PSAxMDAgfHwgZXJyIDwgMCkKLQkJZHNfZHVtcF9zdGF0dXMoZGV2LCBidWYs
IGVycik7CisJCWRzX2R1bXBfc3RhdHVzKGRldiwgZGV2LT5zdF9idWYsIGVycik7CiAKIAkvKiBF
eHRlbmRlZCBkYXRhIGlzbid0IGFuIGVycm9yLiAgV2VsbCwgYSBzaG9ydCBpcywgYnV0IHRoZSBk
dW1wCiAJICogd291bGQgaGF2ZSBhbHJlYWR5IHRvbGQgdGhlIHVzZXIgdGhhdCBhbmQgd2UgY2Fu
J3QgZG8gYW55dGhpbmcKQEAgLTYwOCw3ICs2MDksNiBAQCBzdGF0aWMgaW50IGRzX3dyaXRlX2J5
dGUoc3RydWN0IGRzX2RldmljZSAqZGV2LCB1OCBieXRlKQogewogCWludCBlcnI7CiAJc3RydWN0
IGRzX3N0YXR1cyBzdDsKLQl1OCByYnl0ZTsKIAogCWVyciA9IGRzX3NlbmRfY29udHJvbChkZXYs
IENPTU1fQllURV9JTyB8IENPTU1fSU0gfCBkZXYtPnNwdV9iaXQsIGJ5dGUpOwogCWlmIChlcnIp
CkBAIC02MjEsMTEgKzYyMSwxMSBAQCBzdGF0aWMgaW50IGRzX3dyaXRlX2J5dGUoc3RydWN0IGRz
X2RldmljZSAqZGV2LCB1OCBieXRlKQogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKLQllcnIg
PSBkc19yZWN2X2RhdGEoZGV2LCAmcmJ5dGUsIHNpemVvZihyYnl0ZSkpOworCWVyciA9IGRzX3Jl
Y3ZfZGF0YShkZXYsICZkZXYtPmJ5dGVfYnVmLCAxKTsKIAlpZiAoZXJyIDwgMCkKIAkJcmV0dXJu
IGVycjsKIAotCXJldHVybiAhKGJ5dGUgPT0gcmJ5dGUpOworCXJldHVybiAhKGJ5dGUgPT0gZGV2
LT5ieXRlX2J1Zik7CiB9CiAKIHN0YXRpYyBpbnQgZHNfcmVhZF9ieXRlKHN0cnVjdCBkc19kZXZp
Y2UgKmRldiwgdTggKmJ5dGUpCkBAIC03MTIsNyArNzEyLDYgQEAgc3RhdGljIHZvaWQgZHM5NDkw
cl9zZWFyY2godm9pZCAqZGF0YSwgc3RydWN0IHcxX21hc3RlciAqbWFzdGVyLAogCWludCBlcnI7
CiAJdTE2IHZhbHVlLCBpbmRleDsKIAlzdHJ1Y3QgZHNfc3RhdHVzIHN0OwotCXU4IHN0X2J1ZltT
VF9TSVpFXTsKIAlpbnQgc2VhcmNoX2xpbWl0OwogCWludCBmb3VuZCA9IDA7CiAJaW50IGk7CkBA
IC03MjQsNyArNzIzLDEyIEBAIHN0YXRpYyB2b2lkIGRzOTQ5MHJfc2VhcmNoKHZvaWQgKmRhdGEs
IHN0cnVjdCB3MV9tYXN0ZXIgKm1hc3RlciwKIAkvKiBGSUZPIDEyOCBieXRlcywgYnVsayBwYWNr
ZXQgc2l6ZSA2NCwgcmVhZCBhIG11bHRpcGxlIG9mIHRoZQogCSAqIHBhY2tldCBzaXplLgogCSAq
LwotCXU2NCBidWZbMio2NC84XTsKKwljb25zdCBzaXplX3QgYnVmc2l6ZSA9IDIgKiA2NDsKKwl1
NjQgKmJ1ZjsKKworCWJ1ZiA9IGttYWxsb2MoYnVmc2l6ZSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFi
dWYpCisJCXJldHVybjsKIAogCW11dGV4X2xvY2soJm1hc3Rlci0+YnVzX211dGV4KTsKIApAQCAt
NzQ1LDEwICs3NDksOSBAQCBzdGF0aWMgdm9pZCBkczk0OTByX3NlYXJjaCh2b2lkICpkYXRhLCBz
dHJ1Y3QgdzFfbWFzdGVyICptYXN0ZXIsCiAJZG8gewogCQlzY2hlZHVsZV90aW1lb3V0KGp0aW1l
KTsKIAotCQlpZiAoZHNfcmVjdl9zdGF0dXNfbm9kdW1wKGRldiwgJnN0LCBzdF9idWYsIHNpemVv
ZihzdF9idWYpKSA8Ci0JCQlzaXplb2Yoc3QpKSB7CisJCWVyciA9IGRzX3JlY3Zfc3RhdHVzKGRl
diwgJnN0LCBmYWxzZSk7CisJCWlmIChlcnIgPCAwIHx8IGVyciA8IHNpemVvZihzdCkpCiAJCQli
cmVhazsKLQkJfQogCiAJCWlmIChzdC5kYXRhX2luX2J1ZmZlcl9zdGF0dXMpIHsKIAkJCS8qIEJ1
bGsgaW4gY2FuIHJlY2VpdmUgcGFydGlhbCBpZHMsIGJ1dCB3aGVuIGl0IGRvZXMKQEAgLTc1OCw3
ICs3NjEsNyBAQCBzdGF0aWMgdm9pZCBkczk0OTByX3NlYXJjaCh2b2lkICpkYXRhLCBzdHJ1Y3Qg
dzFfbWFzdGVyICptYXN0ZXIsCiAJCQkgKiBidWxrIHdpdGhvdXQgZmlyc3QgY2hlY2tpbmcgaWYg
c3RhdHVzIHNheXMgdGhlcmUKIAkJCSAqIGlzIGRhdGEgdG8gcmVhZC4KIAkJCSAqLwotCQkJZXJy
ID0gZHNfcmVjdl9kYXRhKGRldiwgKHU4ICopYnVmLCBzaXplb2YoYnVmKSk7CisJCQllcnIgPSBk
c19yZWN2X2RhdGEoZGV2LCAodTggKilidWYsIGJ1ZnNpemUpOwogCQkJaWYgKGVyciA8IDApCiAJ
CQkJYnJlYWs7CiAJCQlmb3IgKGkgPSAwOyBpIDwgZXJyLzg7ICsraSkgewpAQCAtNzk0LDkgKzc5
NywxNCBAQCBzdGF0aWMgdm9pZCBkczk0OTByX3NlYXJjaCh2b2lkICpkYXRhLCBzdHJ1Y3QgdzFf
bWFzdGVyICptYXN0ZXIsCiAJfQogc2VhcmNoX291dDoKIAltdXRleF91bmxvY2soJm1hc3Rlci0+
YnVzX211dGV4KTsKKwlrZnJlZShidWYpOwogfQogCiAjaWYgMAorLyoKKyAqIEZJWE1FOiBpZiB0
aGlzIGRpc2FibGVkIGNvZGUgaXMgZXZlciB1c2VkIGluIHRoZSBmdXR1cmUgYWxsIGRzX3NlbmRf
ZGF0YSgpCisgKiBjYWxscyBtdXN0IGJlIGNoYW5nZWQgdG8gdXNlIGEgRE1BYWJsZSBidWZmZXIu
CisgKi8KIHN0YXRpYyBpbnQgZHNfbWF0Y2hfYWNjZXNzKHN0cnVjdCBkc19kZXZpY2UgKmRldiwg
dTY0IGluaXQpCiB7CiAJaW50IGVycjsKQEAgLTg0NSwxMyArODUzLDEyIEBAIHN0YXRpYyBpbnQg
ZHNfc2V0X3BhdGgoc3RydWN0IGRzX2RldmljZSAqZGV2LCB1NjQgaW5pdCkKIAogc3RhdGljIHU4
IGRzOTQ5MHJfdG91Y2hfYml0KHZvaWQgKmRhdGEsIHU4IGJpdCkKIHsKLQl1OCByZXQ7CiAJc3Ry
dWN0IGRzX2RldmljZSAqZGV2ID0gZGF0YTsKIAotCWlmIChkc190b3VjaF9iaXQoZGV2LCBiaXQs
ICZyZXQpKQorCWlmIChkc190b3VjaF9iaXQoZGV2LCBiaXQsICZkZXYtPmJ5dGVfYnVmKSkKIAkJ
cmV0dXJuIDA7CiAKLQlyZXR1cm4gcmV0OworCXJldHVybiBkZXYtPmJ5dGVfYnVmOwogfQogCiAj
aWYgMApAQCAtODY2LDEzICs4NzMsMTIgQEAgc3RhdGljIHU4IGRzOTQ5MHJfcmVhZF9iaXQodm9p
ZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHNfZGV2aWNlICpkZXYgPSBkYXRhOwogCWludCBlcnI7Ci0J
dTggYml0ID0gMDsKIAotCWVyciA9IGRzX3RvdWNoX2JpdChkZXYsIDEsICZiaXQpOworCWVyciA9
IGRzX3RvdWNoX2JpdChkZXYsIDEsICZkZXYtPmJ5dGVfYnVmKTsKIAlpZiAoZXJyKQogCQlyZXR1
cm4gMDsKIAotCXJldHVybiBiaXQgJiAxOworCXJldHVybiBkZXYtPmJ5dGVfYnVmICYgMTsKIH0K
ICNlbmRpZgogCkBAIC04ODcsMzIgKzg5Myw1MiBAQCBzdGF0aWMgdTggZHM5NDkwcl9yZWFkX2J5
dGUodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHNfZGV2aWNlICpkZXYgPSBkYXRhOwogCWludCBl
cnI7Ci0JdTggYnl0ZSA9IDA7CiAKLQllcnIgPSBkc19yZWFkX2J5dGUoZGV2LCAmYnl0ZSk7CisJ
ZXJyID0gZHNfcmVhZF9ieXRlKGRldiwgJmRldi0+Ynl0ZV9idWYpOwogCWlmIChlcnIpCiAJCXJl
dHVybiAwOwogCi0JcmV0dXJuIGJ5dGU7CisJcmV0dXJuIGRldi0+Ynl0ZV9idWY7CiB9CiAKIHN0
YXRpYyB2b2lkIGRzOTQ5MHJfd3JpdGVfYmxvY2sodm9pZCAqZGF0YSwgY29uc3QgdTggKmJ1Ziwg
aW50IGxlbikKIHsKIAlzdHJ1Y3QgZHNfZGV2aWNlICpkZXYgPSBkYXRhOworCXU4ICp0YnVmOwor
CisJaWYgKGxlbiA8PSAwKQorCQlyZXR1cm47CisKKwl0YnVmID0ga21hbGxvYyhsZW4sIEdGUF9L
RVJORUwpOworCWlmICghdGJ1ZikKKwkJcmV0dXJuOwogCi0JZHNfd3JpdGVfYmxvY2soZGV2LCAo
dTggKilidWYsIGxlbik7CisJbWVtY3B5KHRidWYsIGJ1ZiwgbGVuKTsKKwlkc193cml0ZV9ibG9j
ayhkZXYsIHRidWYsIGxlbik7CisKKwlrZnJlZSh0YnVmKTsKIH0KIAogc3RhdGljIHU4IGRzOTQ5
MHJfcmVhZF9ibG9jayh2b2lkICpkYXRhLCB1OCAqYnVmLCBpbnQgbGVuKQogewogCXN0cnVjdCBk
c19kZXZpY2UgKmRldiA9IGRhdGE7CiAJaW50IGVycjsKKwl1OCAqdGJ1ZjsKIAotCWVyciA9IGRz
X3JlYWRfYmxvY2soZGV2LCBidWYsIGxlbik7Ci0JaWYgKGVyciA8IDApCisJaWYgKGxlbiA8PSAw
KQorCQlyZXR1cm4gMDsKKworCXRidWYgPSBrbWFsbG9jKGxlbiwgR0ZQX0tFUk5FTCk7CisJaWYg
KCF0YnVmKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBsZW47CisJZXJyID0gZHNfcmVhZF9ibG9j
ayhkZXYsIHRidWYsIGxlbik7CisJaWYgKGVyciA+PSAwKQorCQltZW1jcHkoYnVmLCB0YnVmLCBs
ZW4pOworCisJa2ZyZWUodGJ1Zik7CisKKwlyZXR1cm4gZXJyID49IDAgPyBsZW4gOiAwOwogfQog
CiBzdGF0aWMgdTggZHM5NDkwcl9yZXNldCh2b2lkICpkYXRhKQoKICAK
</data>

          </attachment>
      

    </bug>

</bugzilla>
<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>1415558</bug_id>
          
          <creation_ts>2017-01-22 23:31:00 -0500</creation_ts>
          <short_desc>emulation failure on Intel Xeon X5450</short_desc>
          <delta_ts>2017-02-05 15:23:16 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>qemu</component>
          <version>25</version>
          <rep_platform>Unspecified</rep_platform>
          <op_sys>Unspecified</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>CURRENTRELEASE</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>unspecified</priority>
          <bug_severity>unspecified</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kyle Marek">psppsn96</reporter>
          <assigned_to name="Fedora Virtualization Maintainers">virt-maint</assigned_to>
          <cc>amit.shah</cc>
    
    
    <cc>berrange</cc>
    
    
    <cc>cfergeau</cc>
    
    
    <cc>crobinso</cc>
    
    
    <cc>dwmw2</cc>
    
    
    <cc>itamar</cc>
    
    
    <cc>pbonzini</cc>
    
    
    <cc>psppsn96</cc>
    
    
    <cc>rjones</cc>
    
    
    <cc>virt-maint</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in></cf_fixed_in>
          <cf_doc_type>If docs needed, set a value</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-02-05 15:23:16</cf_last_closed>
          <cf_type>Bug</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>10087544</commentid>
    <comment_count>0</comment_count>
    <who name="Kyle Marek">psppsn96</who>
    <bug_when>2017-01-22 23:31:53 -0500</bug_when>
    <thetext>Description of problem:
Host machine is a Dell PowerEdge 2950 with two Intel Xeon X5450 CPUs. I&apos;m using Libvirt to manage QEMU virtual machines, and have discovered that the execution of iPXE (from the included ROMs) causes QEMU to crash.

My experience with this issue is spotty on other machines. So far, the only other host I have noticed this exact issue with is a Dell Latitude E5500. Newer Intel and AMD hosts do not suffer from this issue.

Version-Release number of selected component (if applicable):
qemu-system-x86-2.7.1-2.fc25.x86_64
seabios-bin-1.9.3-1.fc25.noarch
ipxe-roms-qemu-20160622-1.git0418631.fc25.noarch

How reproducible:
100%

Steps to Reproduce:
1. Run: qemu-system-x86_64 -display none -nodefaults -nodefconfig -no-user-config -machine q35,accel=kvm -cpu qemu64 -monitor stdio -device qxl-vga -device virtio-net-pci # This command will leave only a virtio NIC to boot from, booting the iPXE ROM.

Actual results:

QEMU stops execution (&quot;info status&quot; shows &quot;VM status: paused (internal-error)&quot;), displays:
KVM internal error. Suberror: 1
emulation failure
EAX=f81a8cc0 EBX=000000a0 ECX=00002e50 EDX=0009eed8
ESI=07fa4bc0 EDI=07ef4000 EBP=ffffffff ESP=00007b92
EIP=000006ab EFL=00000087 [--S--PC] CPL=0 II=0 A20=1 SMM=0 HLT=0
ES =0000 00000000 ffffffff 00c09300
CS =9c48 0009c480 ffffffff 00809b00
SS =0000 00000000 ffffffff 00809300
DS =9ccc 0009ccc0 ffffffff 00c09300
FS =0000 00000000 ffffffff 00c09300
GS =0000 00000000 ffffffff 00c09300
LDT=0000 00000000 0000ffff 00008200
TR =0000 00000000 0000ffff 00008b00
GDT=     00000000 00000000
IDT=     00000000 000003ff
CR0=00000010 CR2=00000000 CR3=00000000 CR4=00000000
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000000
Code=00 16 66 9c 66 60 0f a8 0f a0 06 1e 16 0e fa 2e 8e 1e 90 06 &lt;0f&gt; ae 06 00 1d 0f 01 0e f6 1c 0f 01 06 f0 1c fc 66 b9 38 00 00 00 66 ba 10 02 00 00 66 68

Expected results:
QEMU continues graceful execution past 1 second (remaining at the &quot;(qemu) &quot; prompt).

Additional info:
Changing &quot;accel=&quot; from &quot;kvm&quot; to &quot;tcg&quot; (disabling KVM acceleration) results in a working VM, but a lack of hardware acceleration makes this type of virtualization useless for my purposes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10121980</commentid>
    <comment_count>1</comment_count>
    <who name="Cole Robinson">crobinso</who>
    <bug_when>2017-02-05 14:15:56 -0500</bug_when>
    <thetext>Is this still reproducing with latest qemu and kernel? May also try updating ipxe with the rawhide version, packages are linked here:

https://koji.fedoraproject.org/koji/buildinfo?buildID=822610

There was an emulation issue triggered by ipxe recently but I didn&apos;t catch all the details, that might be what you are hitting</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10122027</commentid>
    <comment_count>2</comment_count>
    <who name="Kyle Marek">psppsn96</who>
    <bug_when>2017-02-05 15:23:16 -0500</bug_when>
    <thetext>Updating kernel (and thus kernel-core and kernel-modules) alone fixed my issue. Updating all other packages (including qemu, and rawhide ipxe) does not &quot;re-break&quot; iPXE. The issue is no longer observed on either host.

The kernel change across the reboot was from 4.9.4-201.fc25.x86_64 to 4.9.6-200.fc25.x86_64 for the PowerEdge, and from 4.8.8-300.x86_64 to 4.9.6-200.fc25.x86_64 for the Latitude.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
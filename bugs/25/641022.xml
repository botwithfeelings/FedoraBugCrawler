<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1"
          urlbase="https://bugzilla.redhat.com/"
          
          maintainer="bugzilla-error-list@redhat.com"
>

    <bug>
          <bug_id>641022</bug_id>
          
          <creation_ts>2010-10-07 11:02:00 -0400</creation_ts>
          <short_desc>python-debuginfo package owns a world-writable /usr/src/debug/tmp directory</short_desc>
          <delta_ts>2017-04-27 16:54:56 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Fedora</classification>
          <product>Fedora</product>
          <component>rpm</component>
          <version>25</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>ERRATA</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>Reopened</keywords>
          <priority>low</priority>
          <bug_severity>medium</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>468246</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Fabrice Bellet">fabrice</reporter>
          <assigned_to>packaging-team-maint</assigned_to>
          <cc>dmalcolm</cc>
    
    
    <cc>ignatenko</cc>
    
    
    <cc>ivazqueznet</cc>
    
    
    <cc>james.antill</cc>
    
    
    <cc>jonathansteffan</cc>
    
    
    <cc>kardos.lubos</cc>
    
    
    <cc>mclasen</cc>
    
    
    <cc>mjw</cc>
    
    
    <cc>packaging-team-maint</cc>
    
    
    <cc>rhbz2</cc>
    
    
    <cc>robinlee.sysu</cc>
    
    
    <cc>vmukhame</cc>
          <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>
          
          <cf_fixed_in>rpm-4.13.0.1-4.fc26</cf_fixed_in>
          <cf_doc_type>Bug Fix</cf_doc_type>
          <cf_release_notes></cf_release_notes>
          <cf_story_points>---</cf_story_points>
          
          <cf_environment></cf_environment>
          <cf_last_closed>2017-04-27 16:54:56</cf_last_closed>
          <cf_type>---</cf_type>
          <cf_regression_status>---</cf_regression_status>
          <cf_mount_type>---</cf_mount_type>
          <cf_documentation_action>---</cf_documentation_action>
          <cf_crm></cf_crm>
          <cf_verified_branch></cf_verified_branch>
          <cf_category>---</cf_category>
          <cf_ovirt_team>---</cf_ovirt_team>
          
          <cf_cloudforms_team>---</cf_cloudforms_team>
          
          
          
          
          <target_release>---</target_release>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>3200060</commentid>
    <comment_count>0</comment_count>
    <who name="Fabrice Bellet">fabrice</who>
    <bug_when>2010-10-07 11:02:17 -0400</bug_when>
    <thetext>[root@dhcp-2 debug]# ls -ld /usr/src/debug/tmp
drwxrwxrwt 2 root root 4096 Sep 16 20:02 /usr/src/debug/tmp
[root@dhcp-2 debug]# rpm -qf /usr/src/debug/tmp
python-debuginfo-2.7-8.fc14.1.x86_64
[root@dhcp-2 debug]# rpm -V python-debuginfo-2.7-8.fc14.1.x86_64
[root@dhcp-2 debug]#</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>4974893</commentid>
    <comment_count>1</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2012-08-16 14:02:32 -0400</bug_when>
    <thetext>This message is a notice that Fedora 14 is now at end of life. Fedora 
has stopped maintaining and issuing updates for Fedora 14. It is 
Fedora&apos;s policy to close all bug reports from releases that are no 
longer maintained.  At this time, all open bugs with a Fedora &apos;version&apos;
of &apos;14&apos; have been closed as WONTFIX.

(Please note: Our normal process is to give advanced warning of this 
occurring, but we forgot to do that. A thousand apologies.)

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, feel free to reopen 
this bug and simply change the &apos;version&apos; to a later Fedora version.

Bug Reporter: Thank you for reporting this issue and we are sorry that 
we were unable to fix it before Fedora 14 reached end of life. If you 
would still like to see this bug fixed and are able to reproduce it 
against a later version of Fedora, you are encouraged to click on 
&quot;Clone This Bug&quot; (top right of this page) and open it against that 
version of Fedora.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events.  Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.

The process we are following is described here: 
http://fedoraproject.org/wiki/BugZappers/HouseKeeping</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>7173895</commentid>
    <comment_count>2</comment_count>
    <who name="Robin Lee">robinlee.sysu</who>
    <bug_when>2014-06-11 09:55:00 -0400</bug_when>
    <thetext>persist in python-debuginfo-2.7.5-11.fc20.x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8277313</commentid>
    <comment_count>3</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2015-05-29 04:37:41 -0400</bug_when>
    <thetext>This message is a reminder that Fedora 20 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 20. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;20&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 20 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8307815</commentid>
    <comment_count>4</comment_count>
    <who name="Robin Lee">robinlee.sysu</who>
    <bug_when>2015-06-04 22:29:42 -0400</bug_when>
    <thetext>Persist in python-2.7.10-1.fc23</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>8445356</commentid>
    <comment_count>5</comment_count>
    <who name="Jan Kurik">jkurik</who>
    <bug_when>2015-07-15 11:18:38 -0400</bug_when>
    <thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 23 development cycle.
Changing version to &apos;23&apos;.

(As we did not run this process for some time, it could affect also pre-Fedora 23 development
cycle bugs. We are very sorry. It will help us with cleanup during Fedora 23 End Of Life. Thank you.)

More information and reason for this action is here:
https://fedoraproject.org/wiki/BugZappers/HouseKeeping/Fedora23</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9919520</commentid>
    <comment_count>6</comment_count>
    <who name="Fedora End Of Life">jkurik</who>
    <bug_when>2016-11-24 05:28:07 -0500</bug_when>
    <thetext>This message is a reminder that Fedora 23 is nearing its end of life.
Approximately 4 (four) weeks from now Fedora will stop maintaining
and issuing updates for Fedora 23. It is Fedora&apos;s policy to close all
bug reports from releases that are no longer maintained. At that time
this bug will be closed as EOL if it remains open with a Fedora  &apos;version&apos;
of &apos;23&apos;.

Package Maintainer: If you wish for this bug to remain open because you
plan to fix it in a currently maintained version, simply change the &apos;version&apos; 
to a later Fedora version.

Thank you for reporting this issue and we are sorry that we were not 
able to fix it before Fedora 23 is end of life. If you would still like 
to see this bug fixed and are able to reproduce it against a later version 
of Fedora, you are encouraged  change the &apos;version&apos; to a later Fedora 
version prior this bug is closed as described in the policy above.

Although we aim to fix as many bugs as possible during every release&apos;s 
lifetime, sometimes those efforts are overtaken by events. Often a 
more recent Fedora release includes newer upstream software that fixes 
bugs or makes them obsolete.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>9931423</commentid>
    <comment_count>7</comment_count>
    <who name="Fabrice Bellet">fabrice</who>
    <bug_when>2016-11-26 15:05:10 -0500</bug_when>
    <thetext>Hmm, the package owning /usr/src/debug/tmp changed to glib2-debuginfo in Fedora 24. Reassigning.

[root@bonobo ~]# rpm -qf /usr/src/debug/tmp
glib2-debuginfo-2.48.2-1.fc24.x86_64
[root@bonobo ~]# ls -ld /usr/src/debug/tmp
drwxrwxrwt. 2 root root 4096 Aug 18 07:42 /usr/src/debug/tmp
[root@bonobo ~]# rpm -V glib2-debuginfo-2.48.2-1.fc24.x86_64
[root@bonobo ~]#</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10316320</commentid>
    <comment_count>8</comment_count>
    <who name="Robin Lee">robinlee.sysu</who>
    <bug_when>2017-04-08 09:43:08 -0400</bug_when>
    <thetext>In case that binary compiled from source generated in /tmp, a
/usr/src/debug/tmp directory will be created with the same mode as
/tmp, a.k.a 777, which should be avoided.

Upstream PR: https://github.com/rpm-software-management/rpm/pull/194</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10316399</commentid>
    <comment_count>9</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2017-04-08 10:48:57 -0400</bug_when>
    <thetext>(In reply to Robin Lee from comment #8)
&gt; In case that binary compiled from source generated in /tmp, a
&gt; /usr/src/debug/tmp directory will be created with the same mode as
&gt; /tmp, a.k.a 777, which should be avoided.
&gt; 
&gt; Upstream PR: https://github.com/rpm-software-management/rpm/pull/194

Thanks. Explicitly setting all directories under /usr/debug/src to 0755 instead of using a+rx is a very good idea. It is surprising we didn&apos;t catch this earlier.

Besides that fix (which I agree should be included) we should figure out why the (empty) tmp dir is included in the fist place directly under /usr/src/debug/. We are doing something else wrong if we include any file or directory not under /usr/src/debug/&lt;package-nvr&gt;/. I suspect there is some relative path (../../tmp/.. ?) involved that somehow confuses debugedit or find-debuginfo.sh. So please keep this bug open even if the above patch is applied.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10316854</commentid>
    <comment_count>10</comment_count>
    <who name="Robin Lee">robinlee.sysu</who>
    <bug_when>2017-04-08 23:38:13 -0400</bug_when>
    <thetext>(In reply to Mark Wielaard from comment #9)
&gt; (In reply to Robin Lee from comment #8)
&gt; &gt; In case that binary compiled from source generated in /tmp, a
&gt; &gt; /usr/src/debug/tmp directory will be created with the same mode as
&gt; &gt; /tmp, a.k.a 777, which should be avoided.
&gt; &gt; 
&gt; &gt; Upstream PR: https://github.com/rpm-software-management/rpm/pull/194
&gt; 
&gt; Thanks. Explicitly setting all directories under /usr/debug/src to 0755
&gt; instead of using a+rx is a very good idea. It is surprising we didn&apos;t catch
&gt; this earlier.
&gt; 
&gt; Besides that fix (which I agree should be included) we should figure out why
&gt; the (empty) tmp dir is included in the fist place directly under
&gt; /usr/src/debug/. We are doing something else wrong if we include any file or
&gt; directory not under /usr/src/debug/&lt;package-nvr&gt;/. I suspect there is some
&gt; relative path (../../tmp/.. ?) involved that somehow confuses debugedit or
&gt; find-debuginfo.sh. So please keep this bug open even if the above patch is
&gt; applied.

In the case of glib2, libgobject-2.0.so actually has a source file named /tmp/tmpXXXX.c. So it seems proper for debugedit to generate a path /tmp/tmpXXXX.c to $SOURCEFILE. Though /tmp/tmpXXXX.c is cleaned at the moment of debuginfo generating.

A simple fix may be just travelling /usr/debug/src, and delete empty directories, in find-debuginfo.sh.

After that, the most proper fix would be for all those packages that compiling binaries from temporary source files, generate the temporary source files within the build directory, and don&apos;t clean them after building.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10317053</commentid>
    <comment_count>11</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2017-04-09 04:41:41 -0400</bug_when>
    <thetext>(In reply to Robin Lee from comment #10)
&gt; In the case of glib2, libgobject-2.0.so actually has a source file named
&gt; /tmp/tmpXXXX.c. So it seems proper for debugedit to generate a path
&gt; /tmp/tmpXXXX.c to $SOURCEFILE. Though /tmp/tmpXXXX.c is cleaned at the
&gt; moment of debuginfo generating.

Aha. That does make sense. But it means you cannot really debug such code because we fail to ship that (generated) source file.

&gt; A simple fix may be just travelling /usr/debug/src, and delete empty
&gt; directories, in find-debuginfo.sh.

We keep the empty directories in case there is a relative path through such a directory because some DWARF consumers rely on actual fill path to a source file existing. See this comment in debugedit.c:

  /* Ensure the CU current directory will exist even if only empty.  Source
     filenames possibly located in its parent directories refer relatively to
     it and the debugger (GDB) cannot safely optimize out the missing
     CU current dir subdirectories.  */

&gt; After that, the most proper fix would be for all those packages that
&gt; compiling binaries from temporary source files, generate the temporary
&gt; source files within the build directory, and don&apos;t clean them after building.

We used to have problems rewriting source path that would result in a larger path. But most of such issues have been resolved these days. So we could in theory include the actual source file and rewrite /tmp/foobar.c to /usr/debug/src/&lt;package-nvr&gt;/tmp/foobar.c. We just have to figure out when such files/paths make sense. I assume we don&apos;t want to do this for any standard include file under /usr/include/ for example.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10352899</commentid>
    <comment_count>12</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2017-04-21 06:10:18 -0400</bug_when>
    <thetext>This can happen in two ways. Either a compile_unit has a comp_dir with a directory outside the RPM_BUILD_DIR or the compile_unit doesn&apos;t have a comp_dir, but the name attribute is an absolute path outside the RPM_BUILD_DIR.

The following hello.spec shows the issue (using /var/tmp instead of /tmp/ to show this issue isn&apos;t unique to packages building some sources in /tmp).

$ cat hello.spec 
Summary: hello world
Name: hello
Version: 1.0
Release: 1
License: GPL

%description
hello world

%prep
%setup -c -T

%build
echo &apos;int main (int argc, char **argv) { return 0; }&apos; &gt; /var/tmp/foo.c
cp /var/tmp/foo.c /var/tmp/bar.c

# This will change the comp_dir to /var/tmp.
pushd /var/tmp
gcc -g -o foo foo.c
popd
mv /var/tmp/foo foo

# As long as say.c doesn&apos;t include any files no comp_dir will be created.
# But the DW_AT_name will be the full file path. debugedit will use the
# dirname as comp_dir.
gcc -g -o bar /var/tmp/bar.c

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/usr/local/bin
cp foo bar $RPM_BUILD_ROOT/usr/local/bin/

%files
%defattr(-,root,root)
/usr/local/bin/foo
/usr/local/bin/bar

%changelog
* Thu Apr 20 2017 Mark Wielaard &lt;mjw@fedoraproject.org&gt; - 1.0.1
- Hello

$ rpmbuild -ba hello.spec
$ rpm2cpio /home/mark/rpmbuild/RPMS/x86_64/hello-debuginfo-1.0-1.x86_64.rpm | cpio --list --verbose | grep var
63 blocks
drwxr-xr-x   3 root     root            0 Apr 21 11:52 ./usr/src/debug/var
drwxrwxrwt   2 root     root            0 Apr 21 11:52 ./usr/src/debug/var/tmp

On fedora rawhide (with %_unique_debug_srcs set) the var and var/tmp directories end up under ./usr/src/debug/hello-1.0-1.x86_64/ which is slightly better (because then they won&apos;t conflict with other debuginfo packages). But still bogus since those locations are still empty and might actually be confused for actual directories with the same name that did exist under the original build root.

With current trunk git rpm the directories are at least all chmod 0755.

We really shouldn&apos;t include these directories (and if we do then we should also get the source files included). The cause is the code that makes sure that even if a directory (comp_dir) is empty we still include it (in case a file uses a relative path through it) is too greedy. It should only do that for directories which are actually under the original RPM_BUILD_DIR.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10355831</commentid>
    <comment_count>13</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2017-04-24 06:02:35 -0400</bug_when>
    <thetext>(In reply to Mark Wielaard from comment #12)
&gt; We really shouldn&apos;t include these directories (and if we do then we should
&gt; also get the source files included). The cause is the code that makes sure
&gt; that even if a directory (comp_dir) is empty we still include it (in case a
&gt; file uses a relative path through it) is too greedy. It should only do that
&gt; for directories which are actually under the original RPM_BUILD_DIR.

The following patch submitted upstream fixes that:
http://lists.rpm.org/pipermail/rpm-maint/2017-April/005462.html

If it gets accepted I&apos;ll add it and the patch from Robin Lee to explicitly set the directory mode to 0755 to the fedora rpm package.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10361908</commentid>
    <comment_count>14</comment_count>
    <who name="Mark Wielaard">mjw</who>
    <bug_when>2017-04-25 16:18:51 -0400</bug_when>
    <thetext>(In reply to Mark Wielaard from comment #13)
&gt; If it gets accepted I&apos;ll add it and the patch from Robin Lee to explicitly
&gt; set the directory mode to 0755 to the fedora rpm package.

Accepted upstream and now in rpm-4.13.0.1-4.fc26 and rpm-4.13.0.1-20.fc27.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10364234</commentid>
    <comment_count>15</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-26 08:01:46 -0400</bug_when>
    <thetext>rpm-4.13.0.1-4.fc26 has been submitted as an update to Fedora 26. https://bodhi.fedoraproject.org/updates/FEDORA-2017-b8a3febd40</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10366432</commentid>
    <comment_count>16</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-26 17:53:03 -0400</bug_when>
    <thetext>rpm-4.13.0.1-4.fc26 has been pushed to the Fedora 26 testing repository. If problems still persist, please make note of it in this bug report.
See https://fedoraproject.org/wiki/QA:Updates_Testing for
instructions on how to install test updates.
You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-b8a3febd40</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>10370246</commentid>
    <comment_count>17</comment_count>
    <who name="Fedora Update System">updates</who>
    <bug_when>2017-04-27 16:54:56 -0400</bug_when>
    <thetext>rpm-4.13.0.1-4.fc26 has been pushed to the Fedora 26 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>
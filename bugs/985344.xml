<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.redhat.com/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.12068.1" urlbase="https://bugzilla.redhat.com/" maintainer="bugzilla-error-list@redhat.com">

  <bug>
    <bug_id>985344</bug_id>

    <creation_ts>2013-07-17 06:24:00 -0400</creation_ts>
    <short_desc>libdigidocpp does not build because /usr/include/minizip/crypt.h is not compatible with C++ compiler</short_desc>
    <delta_ts>2017-03-05 21:51:14 -0500</delta_ts>
    <reporter_accessible>1</reporter_accessible>
    <cclist_accessible>1</cclist_accessible>
    <classification_id>2</classification_id>
    <classification>Fedora</classification>
    <product>Fedora</product>
    <component>libdigidocpp</component>
    <version>26</version>
    <rep_platform>Unspecified</rep_platform>
    <op_sys>Unspecified</op_sys>
    <bug_status>CLOSED</bug_status>
    <resolution>ERRATA</resolution>

    <see_also>https://bugzilla.redhat.com/show_bug.cgi?id=1424609</see_also>
    <bug_file_loc>http://koji.fedoraproject.org/koji/taskinfo?taskID=5618593</bug_file_loc>
    <status_whiteboard></status_whiteboard>
    <keywords>Reopened</keywords>
    <priority>unspecified</priority>
    <bug_severity>unspecified</bug_severity>
    <target_milestone>---</target_milestone>
    <dependson>1415937</dependson>

    <everconfirmed>1</everconfirmed>
    <reporter name="Petr Pisar">ppisar</reporter>
    <assigned_to name="Mihkel Vain">turakas</assigned_to>
    <cc>antti.andreimann</cc>

    <cc>kalevlember</cc>

    <cc>klember</cc>

    <cc>pertusus</cc>

    <cc>praiskup</cc>

    <cc>pschiffe</cc>

    <cc>tuju</cc>

    <cc>turakas</cc>
    <qa_contact name="Fedora Extras Quality Assurance">extras-qa</qa_contact>

    <cf_fixed_in>zlib-1.2.8-3.fc20 libdigidocpp-3.12.3-1.fc24 libdigidocpp-3.12.3-1.fc25</cf_fixed_in>
  <cf_doc_type>Bug Fix</cf_doc_type>
<cf_release_notes></cf_release_notes>
<cf_story_points>---</cf_story_points>

<cf_environment></cf_environment>
<cf_last_closed>2017-03-05 15:49:49</cf_last_closed>
<cf_type>Bug</cf_type>
<cf_regression_status>---</cf_regression_status>
<cf_mount_type>---</cf_mount_type>
<cf_documentation_action>---</cf_documentation_action>
<cf_crm></cf_crm>
<cf_verified_branch></cf_verified_branch>
<cf_category>---</cf_category>
<cf_ovirt_team>---</cf_ovirt_team>

<cf_cloudforms_team>---</cf_cloudforms_team>

<target_release>---</target_release>

<votes>0</votes>

<comment_sort_order>oldest_to_newest</comment_sort_order>
<long_desc isprivate="0">
<commentid>6115887</commentid>
<comment_count>0</comment_count>
<who name="Petr Pisar">ppisar</who>
<bug_when>2013-07-17 06:24:37 -0400</bug_when>
<thetext>libdigidocpp-0.3.0-19.fc20 fails to build in rawhide because g++ complains on some constructs in a zlib header file: [100%] Building CXX object src/CMakeFiles/_digidoc__PYTHON__.dir/digidocPYTHON_wrap.cxx.o cd
/builddir/build/BUILD/libdigidocpp-0.3.0/x86_64-redhat-linux-gnu/src &amp;&amp; /usr/bin/c++ -DDIGIDOCPP_CONFIG_DIR=\&quot;/etc/digidocpp\&quot; -D_digidoc__PYTHON___EXPORTS -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
-fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC -I/usr/include/minizip -I/builddir/build/BUILD/libdigidocpp-0.3.0/x86_64-redhat-linux-gnu/src -Wno-format -I/usr/include/python2.7
-I/builddir/build/BUILD/libdigidocpp-0.3.0/x86_64-redhat-linux-gnu/src/python -I/builddir/build/BUILD/libdigidocpp-0.3.0/src -o CMakeFiles/_digidoc__PYTHON__.dir/digidocPYTHON_wrap.cxx.o -c
/builddir/build/BUILD/libdigidocpp-0.3.0/x86_64-redhat-linux-gnu/src/digidocPYTHON_wrap.cxx In file included from /usr/lib64/perl5/CORE/reentr.h:109:0, from /usr/lib64/perl5/CORE/op.h:688, from /usr/lib64/perl5/CORE/perl.h:3479, from
/builddir/build/BUILD/libdigidocpp-0.3.0/x86_64-redhat-linux-gnu/src/digidocPERL_wrap.cxx:744: /usr/include/minizip/crypt.h:35:53: error: &apos;z_crc_t&apos; does not name a type static int decrypt_byte(unsigned long* pkeys, const z_crc_t*
pcrc_32_tab) ^ /usr/include/minizip/crypt.h:35:62: error: ISO C++ forbids declaration of &apos;pcrc_32_tab&apos; with no type [-fpermissive] static int decrypt_byte(unsigned long* pkeys, const z_crc_t* pcrc_32_tab)</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>6139126</commentid>
<comment_count>1</comment_count>
<who name="Kalev Lember">kalevlember</who>
<bug_when>2013-07-24 17:24:37 -0400</bug_when>
<thetext>Reassigning to zlib. Looks like minizip.h is missing zconf.h include for z_crc_t.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>6200360</commentid>
<comment_count>2</comment_count>
<who name="Kalev Lember">kalevlember</who>
<bug_when>2013-08-10 09:33:55 -0400</bug_when>
<thetext>I&apos;ve submitted a patch for this upstream at http://mail.madler.net/pipermail/zlib-devel_madler.net/2013-August/003081.html</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>6200367</commentid>
<comment_count>3</comment_count>
<who name="Kalev Lember">kalevlember</who>
<bug_when>2013-08-10 09:49:08 -0400</bug_when>
<thetext>... and went ahead and did a zlib build for rawhide with the patch backported, zlib-1.2.8-3.fc20.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10090891</commentid>
<comment_count>4</comment_count>
<who name="Pavel Raiskup">praiskup</who>
<bug_when>2017-01-24 02:02:54 -0500</bug_when>
<thetext>I&apos;m not able to see the upstream zlib report because the mail archive is dead (already reported to admins). But the fix seems to be wrong; the crypt.h file is not supposed to be included directly but rather via zip.h or unzip.h. Maybe
this is related to NOUNCRYPT fixed by _totally_ undocumented commit 64704e73bce559f2bd1a in Fedora&apos;s zlib package, I re-submitted this: https://github.com/madler/zlib/pull/210 I noted that latest build of libdigidocpp still depends on libz.so.1
(correct), but I also see that the minizip is built as a part of libdigidocpp which looks like a bug (you should depend on libminizip.so). Because there&apos;s FTBFS bug 1415937 (IMHO issue in building yet another bundled libraries, please don&apos;t
if possible), I stopped further analyzing for now. Re-opened to let you know that the zlib fix zlib-1.2.8-minizip-include.patch is going to be reverted soon, unless I&apos;ll be proven it is wrong decision.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10164895</commentid>
<comment_count>5</comment_count>
<who name="Mihkel Vain">turakas</who>
<bug_when>2017-02-19 13:23:48 -0500</bug_when>
<thetext>Removing dependency from bundled minizip is easy. Correct me if I&apos;m wrong. zlib-1.2.8-minizip-include.patch is already reverted in rawhide? If I remove bundled minizip and do a mock build against F25... all seems ok. Against rawhide,
then there seems to be a problem with openssl 1.1 (reported to upstream). Besides openssl issues I currently do not see any build problems with libdigidocpp in relevance of minizip. Ot am I missing something obvious here? $ fedpkg diff diff --git
a/libdigidocpp.spec b/libdigidocpp.spec index 5794e27..7b73ddb 100644 --- a/libdigidocpp.spec +++ b/libdigidocpp.spec @@ -1,6 +1,6 @@ Name: libdigidocpp Version: 3.12.2 -Release: 1%{?dist} +Release: 2%{?dist} Summary: Library for creating and
validating BDoc and DDoc containers License: LGPLv2+ URL: https://github.com/open-eid/libdigidocpp @@ -11,6 +11,7 @@ BuildRequires: libdigidoc-devel BuildRequires: openssl-devel BuildRequires: xml-security-c-devel BuildRequires: xsd +BuildRequires:
minizip-devel # Provide xxd BuildRequires: vim-common @@ -45,6 +46,9 @@ The %{name}-doc package contains documentation provided by upstream. %prep %setup -q +# Remove bundled minizip +rm -rf minizip + %build %{cmake} . \
-DCMAKE_INSTALL_SYSCONFDIR=/etc \ @@ -86,6 +90,9 @@ rm -rf %{buildroot} %changelog +* Sun Feb 19 2017 Mihkel Vain &lt;mihkel@fedoraproject.org&gt; - 3.12.2-2 +- Remove bundled minizip + * Sun Jul 10 2016 Mihkel Vain &lt;mihkel@fedoraproject.org&gt; -
3.12.2-1 - New upstream release</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10166294</commentid>
<comment_count>6</comment_count>
<who name="Pavel Raiskup">praiskup</who>
<bug_when>2017-02-20 04:38:02 -0500</bug_when>
<thetext>(In reply to Mihkel Vain from comment #5) &gt; Removing dependency from bundled minizip is easy. Nice! Glad to see that you also &apos;rm -r minizip&apos; subdir and it works fine. &gt; Correct me if I&apos;m wrong.
zlib-1.2.8-minizip-include.patch is already &gt; reverted in rawhide? Correct. &gt; If I remove bundled minizip and do a mock build against F25... all seems ok. &gt; Against rawhide, then there seems to be a problem with openssl 1.1 (reported &gt; to
upstream). Did you consider building (for now) against compat-openssl10-devel ? &gt; Besides openssl issues I currently do not see any build problems with &gt; libdigidocpp in relevance of minizip. Ot am I missing something obvious here? Not
something I would consider obvious :).</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10168034</commentid>
<comment_count>7</comment_count>
<who name="Mihkel Vain">turakas</who>
<bug_when>2017-02-20 12:28:03 -0500</bug_when>
<thetext>&gt; &gt; Did you consider building (for now) against compat-openssl10-devel ? &gt; Not that easy I think. I tried a mock build and it failed. libdigidocpp also depends on xml-security-c-devel and this again depends on openssl-devel (not
compat-openssl10-devel) and since we have really old version of xml-security-c in Fedora repos, it also has FTBFS reported. Meanwhile I managed to contact xml-security-c maintainer(anttix) and he gave committer rights to someone named bruno who
requested those rights a while ago. Anttix is a busy guy and he is not actively participating as a package maintainer. I also wrote an e-mail to bruno and asked is he able to update that package any time soon. No reply yet.
https://admin.fedoraproject.org/pkgdb/package/rpms/xml-security-c/ So. Lets keeps this report open, but I think in general it is actually resolved. But lets wait a bit and see. Basically all my packages need an updated xml-security-c.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10183211</commentid>
<comment_count>8</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-02-24 17:55:15 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc25 has been submitted as an update to Fedora 25. https://bodhi.fedoraproject.org/updates/FEDORA-2017-cc45511239</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10183217</commentid>
<comment_count>9</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-02-24 18:13:22 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc24 has been submitted as an update to Fedora 24. https://bodhi.fedoraproject.org/updates/FEDORA-2017-ccdfb3688e</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10184233</commentid>
<comment_count>10</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-02-25 23:51:05 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc24 has been pushed to the Fedora 24 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install
test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-ccdfb3688e</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10184251</commentid>
<comment_count>11</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-02-26 00:26:06 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc25 has been pushed to the Fedora 25 testing repository. If problems still persist, please make note of it in this bug report. See https://fedoraproject.org/wiki/QA:Updates_Testing for instructions on how to install
test updates. You can provide feedback for this update here: https://bodhi.fedoraproject.org/updates/FEDORA-2017-cc45511239</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10190450</commentid>
<comment_count>12</comment_count>
<who name="Fedora End Of Life">jkurik</who>
<bug_when>2017-02-28 04:34:21 -0500</bug_when>
<thetext>This bug appears to have been reported against &apos;rawhide&apos; during the Fedora 26 development cycle. Changing version to &apos;26&apos;.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10209281</commentid>
<comment_count>13</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-03-05 15:49:49 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc24 has been pushed to the Fedora 24 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>
<long_desc isprivate="0">
<commentid>10209597</commentid>
<comment_count>14</comment_count>
<who name="Fedora Update System">updates</who>
<bug_when>2017-03-05 21:51:14 -0500</bug_when>
<thetext>libdigidocpp-3.12.3-1.fc25 has been pushed to the Fedora 25 stable repository. If problems still persist, please make note of it in this bug report.</thetext>
</long_desc>

</bug>

</bugzilla>
